% Options for packages loaded elsewhere
\PassOptionsToPackage{unicode}{hyperref}
\PassOptionsToPackage{hyphens}{url}
%
\documentclass[
  oneside]{book}
\usepackage{amsmath,amssymb}
\usepackage{lmodern}
\usepackage{iftex}
\ifPDFTeX
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
  \usepackage{textcomp} % provide euro and other symbols
\else % if luatex or xetex
  \usepackage{unicode-math}
  \defaultfontfeatures{Scale=MatchLowercase}
  \defaultfontfeatures[\rmfamily]{Ligatures=TeX,Scale=1}
\fi
% Use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\IfFileExists{microtype.sty}{% use microtype if available
  \usepackage[]{microtype}
  \UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\makeatletter
\@ifundefined{KOMAClassName}{% if non-KOMA class
  \IfFileExists{parskip.sty}{%
    \usepackage{parskip}
  }{% else
    \setlength{\parindent}{0pt}
    \setlength{\parskip}{6pt plus 2pt minus 1pt}}
}{% if KOMA class
  \KOMAoptions{parskip=half}}
\makeatother
\usepackage{xcolor}
\IfFileExists{xurl.sty}{\usepackage{xurl}}{} % add URL line breaks if available
\IfFileExists{bookmark.sty}{\usepackage{bookmark}}{\usepackage{hyperref}}
\hypersetup{
  pdftitle={Data Skills for Reproducible Research},
  hidelinks,
  pdfcreator={LaTeX via pandoc}}
\urlstyle{same} % disable monospaced font for URLs
\usepackage[margin=1in]{geometry}
\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\usepackage{framed}
\definecolor{shadecolor}{RGB}{248,248,248}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.94,0.16,0.16}{#1}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.77,0.63,0.00}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\BuiltInTok}[1]{#1}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.64,0.00,0.00}{\textbf{#1}}}
\newcommand{\ExtensionTok}[1]{#1}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ImportTok}[1]{#1}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\NormalTok}[1]{#1}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.81,0.36,0.00}{\textbf{#1}}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\RegionMarkerTok}[1]{#1}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\usepackage{longtable,booktabs,array}
\usepackage{calc} % for calculating minipage widths
% Correct order of tables after \paragraph or \subparagraph
\usepackage{etoolbox}
\makeatletter
\patchcmd\longtable{\par}{\if@noskipsec\mbox{}\fi\par}{}{}
\makeatother
% Allow footnotes in longtable head/foot
\IfFileExists{footnotehyper.sty}{\usepackage{footnotehyper}}{\usepackage{footnote}}
\makesavenoteenv{longtable}
\usepackage{graphicx}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
% Set default figure placement to htbp
\makeatletter
\def\fps@figure{htbp}
\makeatother
\setlength{\emergencystretch}{3em} % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\setcounter{secnumdepth}{5}
\usepackage{booktabs}

\usepackage{tcolorbox}
\usepackage[T1]{fontenc}

\definecolor{dangcol}{RGB}{152,62,130}
\definecolor{warncol}{RGB}{245,220,112}
\definecolor{infocol}{RGB}{70,122,172}
\definecolor{trycol}{RGB}{97,88,156}

\newtcolorbox{dangerous}{
  colback=dangcol!10,
  colframe=dangcol,
  coltext=black,
  boxsep=5pt,
  arc=4pt
}

\newtcolorbox{warning}{
  colback=warncol!10,
  colframe=warncol,
  coltext=black,
  boxsep=5pt,
  arc=4pt
}

\newtcolorbox{info}{
  colback=infocol!10,
  colframe=infocol,
  coltext=black,
  boxsep=5pt,
  arc=4pt
}

\newtcolorbox{try}{
  colback=trycol!10,
  colframe=trycol,
  coltext=black,
  boxsep=5pt,
  arc=4pt
}
\ifLuaTeX
  \usepackage{selnolig}  % disable illegal ligatures
\fi
\usepackage[]{natbib}
\bibliographystyle{plainnat}

\title{Data Skills for Reproducible Research}
\usepackage{etoolbox}
\makeatletter
\providecommand{\subtitle}[1]{% add subtitle to \maketitle
  \apptocmd{\@title}{\par {\large #1 \par}}{}{}
}
\makeatother
\subtitle{v2}
\author{}
\date{\vspace{-2.5em}2021-09-25}

\begin{document}
\maketitle

{
\setcounter{tocdepth}{1}
\tableofcontents
}
\hypertarget{overview}{%
\chapter*{Overview}\label{overview}}
\addcontentsline{toc}{chapter}{Overview}

This book provides an overview of skills needed for reproducible research and open science using the statistical programming language R and tidyverse packages. It covers data visualisation, data tidying and wrangling, archiving, iteration and functions, probability and data simulations, general linear models, and reproducible workflows.

The book is also available in \href{reprores-v2.pdf}{PDF}, \href{reprores-v2.epub}{ePub} and \href{reprores-v2.mobi}{Kindle} formats, but these may have odd formatting where the onlne book has interactive elements like quizzes and shiny apps.

\hypertarget{resources}{%
\section*{Resources}\label{resources}}
\addcontentsline{toc}{section}{Resources}

\begin{itemize}
\item
  \href{https://www.youtube.com/playlist?list=PLA2iRWVwbpTKqULIFGBIe4Bg-YounTV1J}{Data Skills Videos}
  Each chapter has several short video lectures for the main learning outcomes. The videos are captioned and watching with the captioning on is a useful way to learn the jargon of computational reproducibility. If you cannot access YouTube, the videos are available by request.
\item
  \href{https://github.com/psyteachr/reprores-v2}{reprores}
  This is a custom R package for this course. You can install it with the code below. It will download all of the packages that are used in the book, along with an offline copy of this book, the shiny apps used in the book, and the exercises.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{devtools}\SpecialCharTok{::}\FunctionTok{install\_github}\NormalTok{(}\StringTok{"psyteachr/reprores{-}v2"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}
\item
  \href{https://psyteachr.github.io/glossary}{glossary}
  Coding and statistics both have a lot of specialist terms. Throughout this book, jargon will be linked to the glossary.
\end{itemize}

\hypertarget{how-to-learn-data-skills}{%
\section*{How to learn data skills}\label{how-to-learn-data-skills}}
\addcontentsline{toc}{section}{How to learn data skills}

Learning data skills is kind of like having a gym membership (HT to \href{https://twitter.com/McAleerP}{Phil McAleer} for the analogy). You'll be given state-of-the-art equipment to use and instructions for how to use them, but your data skills won't get any stronger unless you practice.

Data skills do not require you to memorise lots of code. You will be introduced to many different functions, but the main skill to learn is how to efficiently find the information you need. This will require getting used to the structure of help files and \href{https://www.rstudio.com/resources/cheatsheets/}{cheat sheets}, learning how to Goggle your problem and choose a helpful solution, and learning how to read error messages.

Learning to code involves making a \textbf{lot} of mistakes. These mistakes are completely essential to the process, so try not to feel too frustrated. Many of the chapter exercises will give you broken code to fix so you get experience seeing what common errors look like. As you become a more experienced coder, you might not make fewer errors, but you'll recover from them much faster.

\hypertarget{i-found-a-bug}{%
\section*{I found a bug!}\label{i-found-a-bug}}
\addcontentsline{toc}{section}{I found a bug!}

This book is a work in progress, so you might find errors. Please help me fix them! The best way is to open an \href{https://github.com/PsyTeachR/reprores-v2/issues}{issue on github} that describes the error, but you can also \href{mailto:lisa.debruine@glasgow.ac.uk?subject=reprores}{email Lisa}.

\hypertarget{other-resources}{%
\section*{Other Resources}\label{other-resources}}
\addcontentsline{toc}{section}{Other Resources}

\begin{itemize}
\tightlist
\item
  \href{https://www.rstudio.com/resources/cheatsheets/}{RStudio Cheat Sheets}
\item
  \href{https://psyarxiv.com/q34k8}{Improving Pedagogy through Registered Reports}
\item
  \href{https://learningstatisticswithr-bookdown.netlify.com}{Learning Statistics with R} by Navarro
\item
  \href{http://r4ds.had.co.nz}{R for Data Science} by Grolemund and Wickham
\item
  \href{https://www.coursera.org/learn/statistical-inferences/}{Improving your statistical inferences} on Coursera
\item
  \href{http://swirlstats.com}{swirl}
\item
  \href{http://swcarpentry.github.io/r-novice-gapminder/}{R for Reproducible Scientific Analysis}
\item
  \href{http://tryr.codeschool.com}{codeschool.com}
\item
  \href{https://www.datacamp.com/courses/free-introduction-to-r}{datacamp}
\item
  \href{http://style.tidyverse.org}{Style guide for R programming}
\item
  \href{https://twitter.com/search?q=\%2523rstats}{\#rstats on twitter} highly recommended!
\end{itemize}

\hypertarget{intro}{%
\chapter{Getting Started}\label{intro}}

\hypertarget{ilo-intro}{%
\section{Learning Objectives}\label{ilo-intro}}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Understand the components of the \protect\hyperlink{rstudio_ide}{RStudio IDE} \href{https://youtu.be/CbA6ZVlJE78}{(video)}
\item
  Type commands into the \protect\hyperlink{console}{console} \href{https://youtu.be/wbI4c_7y0kE}{(video)}
\item
  Understand \protect\hyperlink{coding-terms}{coding terms} and \protect\hyperlink{function_syx}{function syntax} \href{https://youtu.be/X5P038N5Q8I}{(video)}
\item
  Install a \protect\hyperlink{install-package}{package} \href{https://youtu.be/u_pvHnqkVCE}{(video)}
\item
  Know the methods for getting \protect\hyperlink{help}{help}
\end{enumerate}

\hypertarget{r-and-rstudio}{%
\section{R and RStudio}\label{r-and-rstudio}}

R is a programming environment for data processing and statistical analysis. We use R in Psychology at the University of Glasgow to promote reproducible research. This refers to being able to document and reproduce all of the steps between raw data and results. R allows you to write scripts that combine data files, clean data, and run analyses. There are many other ways to do this, including writing SPSS syntax files, but we find R to be a useful tool that is free, open source, and commonly used by research psychologists.

\begin{info}
See Appendix \ref{installingr} for more information on on how to install R and associated programs.

\end{info}

\hypertarget{rconsole}{%
\subsection{The Base R Console}\label{rconsole}}

If you open up the application called R, you will see an ``R Console'' window that looks something like this.

\begin{figure}

{\centering \includegraphics[width=1\linewidth]{images/intro/r_console} 

}

\caption{The R Console window.}\label{fig:img-repl}
\end{figure}

You can close R and never open it again. We'll be working entirely in RStudio in this class.

\begin{warning}
ALWAYS REMEMBER: Launch R though the RStudio IDE

Launch (RStudio.app), not (R.app).

\end{warning}

\hypertarget{rstudio_ide}{%
\subsection{RStudio}\label{rstudio_ide}}

\href{http://www.rstudio.com}{RStudio} is an Integrated Development Environment (IDE). This is a program that serves as a text editor, file manager, and provides many functions to help you read and write R code.

\begin{figure}

{\centering \includegraphics[width=1\linewidth]{images/intro/rstudio} 

}

\caption{The RStudio IDE}\label{fig:img-rstudio}
\end{figure}

RStudio is arranged with four window panes. By default, the upper left pane is the \textbf{source pane}, where you view and edit source code from files. The bottom left pane is usually the \textbf{console pane}, where you can type in commands and view output messages. The right panes have several different tabs that show you information about your code. You can change the location of panes and what tabs are shown under \textbf{\texttt{Preferences\ \textgreater{}\ Pane\ Layout}}.

\hypertarget{configure-rstudio}{%
\subsection{Configure RStudio}\label{configure-rstudio}}

In this class, you will be learning how to do reproducible research. This involves writing scripts that completely and transparently perform some analysis from start to finish in a way that yields the same result for different people using the same software on different computers. Transparency is a key value of science, as embodied in the ``trust but verify'' motto.

When you do things reproducibly, others can understand and check your work. This benefits science, but there is a selfish reason, too: the most important person who will benefit from a reproducible script is your future self. When you return to an analysis after two weeks of vacation, you will thank your earlier self for doing things in a transparent, reproducible way, as you can easily pick up right where you left off.

There are two tweaks that you should do to your RStudio installation to maximize reproducibility. Go to \textbf{\texttt{Global\ Options...}} under the \textbf{\texttt{Tools}} menu (Cmd-,), and uncheck the box that says \textbf{\texttt{Restore\ .RData\ into\ workspace\ at\ startup}}. If you keep things around in your workspace, things will get messy, and unexpected things will happen. You should always start with a clear workspace. This also means that you never want to save your workspace when you exit, so set this to \textbf{\texttt{Never}}. The only thing you want to save are your scripts.

\begin{figure}

{\centering \includegraphics[width=0.66\linewidth]{images/intro/repro} 

}

\caption{Alter these settings for increased reproducibility.}\label{fig:img-repro}
\end{figure}

\begin{try}

Your settings should have:

\begin{itemize}
\tightlist
\item
  Restore .RData into workspace at startup: CheckedNot Checked
\item
  Save workspace to .RData on exit: AlwaysNeverAsk
\end{itemize}

\end{try}

\hypertarget{console}{%
\section{Console commands}\label{console}}

We are first going to learn about how to interact with the console. In general, you will be developing R scripts or R Markdown files, rather than working directly in the console window. However, you can consider the console a kind of ``sandbox'' where you can try out lines of code and adapt them until you get them to do what you want. Then you can copy them back into the script editor.

Mostly, however, you will be typing into the script editor window (either into an R script or an R Markdown file) and then sending the commands to the console by placing the cursor on the line and holding down the Ctrl key while you press Enter. The Ctrl+Enter key sequence sends the command in the script to the console.

One simple way to learn about the R console is to use it as a calculator. Enter the lines of code below and see if your results match. Be prepared to make lots of typos (at first).

\begin{Shaded}
\begin{Highlighting}[]
\DecValTok{1} \SpecialCharTok{+} \DecValTok{1}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 2
\end{verbatim}

The R console remembers a history of the commands you typed in the past. Use the up and down arrow keys on your keyboard to scroll backwards and forwards through your history. It's a lot faster than re-typing.

\begin{Shaded}
\begin{Highlighting}[]
\DecValTok{1} \SpecialCharTok{+} \DecValTok{1} \SpecialCharTok{+} \DecValTok{3}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 5
\end{verbatim}

You can break up mathematical expressions over multiple lines; R waits for a complete expression before processing it.

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# here comes a long expression}
\DocumentationTok{\#\# let\textquotesingle{}s break it over multiple lines}
\DecValTok{1} \SpecialCharTok{+} \DecValTok{2} \SpecialCharTok{+} \DecValTok{3} \SpecialCharTok{+} \DecValTok{4} \SpecialCharTok{+} \DecValTok{5} \SpecialCharTok{+} \DecValTok{6} \SpecialCharTok{+}
    \DecValTok{7} \SpecialCharTok{+} \DecValTok{8} \SpecialCharTok{+} \DecValTok{9} \SpecialCharTok{+}
    \DecValTok{10}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 55
\end{verbatim}

Text inside quotes is called a string.

\begin{Shaded}
\begin{Highlighting}[]
\StringTok{"Good afternoon"}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "Good afternoon"
\end{verbatim}

You can break up text over multiple lines; R waits for a close quote before processing it. If you want to include a double quote inside this quoted string, escape it with a backslash.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{africa }\OtherTok{\textless{}{-}} \StringTok{"I hear the drums echoing tonight  }
\StringTok{But she hears only whispers of some quiet conversation  }
\StringTok{She\textquotesingle{}s coming in, 12:30 flight  }
\StringTok{The moonlit wings reflect the stars that guide me towards salvation  }
\StringTok{I stopped an old man along the way  }
\StringTok{Hoping to find some old forgotten words or ancient melodies  }
\StringTok{He turned to me as if to say, }\SpecialCharTok{\textbackslash{}"}\StringTok{Hurry boy, it\textquotesingle{}s waiting there for you}\SpecialCharTok{\textbackslash{}"}

\StringTok{{-} Toto"}

\FunctionTok{cat}\NormalTok{(africa) }\CommentTok{\# cat() prints the string}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## I hear the drums echoing tonight  
## But she hears only whispers of some quiet conversation  
## She's coming in, 12:30 flight  
## The moonlit wings reflect the stars that guide me towards salvation  
## I stopped an old man along the way  
## Hoping to find some old forgotten words or ancient melodies  
## He turned to me as if to say, "Hurry boy, it's waiting there for you"
## 
## - Toto
\end{verbatim}

\hypertarget{coding-terms}{%
\section{Coding Terms}\label{coding-terms}}

\hypertarget{vars}{%
\subsection{Objects}\label{vars}}

Often you want to store the result of some computation for later use. You can store it in an object (also sometimes called a variable). An object in R:

\begin{itemize}
\tightlist
\item
  contains only letters, numbers, full stops, and underscores
\item
  starts with a letter or a full stop and a letter
\item
  distinguishes uppercase and lowercase letters (\texttt{rickastley} is not the same as \texttt{RickAstley})
\end{itemize}

The following are valid and different objects:

\begin{itemize}
\tightlist
\item
  \texttt{songdata}
\item
  \texttt{SongData}
\item
  \texttt{song\_data}
\item
  \texttt{song.data}
\item
  \texttt{.song.data}
\item
  \texttt{never\_gonna\_give\_you\_up\_never\_gonna\_let\_you\_down}
\end{itemize}

The following are not valid objects:

\begin{itemize}
\tightlist
\item
  \texttt{\_song\_data}
\item
  \texttt{1song}
\item
  \texttt{.1song}
\item
  \texttt{song\ data}
\item
  \texttt{song-data}
\end{itemize}

Use the assignment operator\textless-` to assign the value on the right to the object named on the left.

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# use the assignment operator \textquotesingle{}\textless{}{-}\textquotesingle{}}
\DocumentationTok{\#\# R stores the number in the object}
\NormalTok{x }\OtherTok{\textless{}{-}} \DecValTok{5}
\end{Highlighting}
\end{Shaded}

Now that we have set \texttt{x} to a value, we can do something with it:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\SpecialCharTok{*} \DecValTok{2}

\DocumentationTok{\#\# R evaluates the expression and stores the result in the object boring\_calculation}
\NormalTok{boring\_calculation }\OtherTok{\textless{}{-}} \DecValTok{2} \SpecialCharTok{+} \DecValTok{2}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 10
\end{verbatim}

Note that it doesn't print the result back at you when it's stored. To view the result, just type the object name on a blank line.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{boring\_calculation}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 4
\end{verbatim}

Once an object is assigned a value, its value doesn't change unless you reassign the object, even if the objects you used to calculate it change. Predict what the code below does and test yourself:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{this\_year }\OtherTok{\textless{}{-}} \DecValTok{2019}
\NormalTok{my\_birth\_year }\OtherTok{\textless{}{-}} \DecValTok{1976}
\NormalTok{my\_age }\OtherTok{\textless{}{-}}\NormalTok{ this\_year }\SpecialCharTok{{-}}\NormalTok{ my\_birth\_year}
\NormalTok{this\_year }\OtherTok{\textless{}{-}} \DecValTok{2020}
\end{Highlighting}
\end{Shaded}

\begin{try}

After all the code above is run:

\begin{itemize}
\tightlist
\item
  \texttt{this\_year} = 4344197620192020
\item
  \texttt{my\_birth\_year} = 4344197620192020
\item
  \texttt{my\_age} = 4344197620192020
\end{itemize}

\end{try}

\hypertarget{the-environment}{%
\subsection{The environment}\label{the-environment}}

Any time you assign something to a new object, R creates a new entry in the global environment. Objects in the global environment exist until you end your session; then they disappear forever (unless you save them).

Look at the \textbf{\texttt{Environment}} tab in the upper right pane. It lists all of the objects you have created. Click the broom icon to clear all of the objects and start fresh. You can also use the following functions in the console to view all objects, remove one object, or remove all objects.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ls}\NormalTok{()            }\CommentTok{\# print the objects in the global environment}
\FunctionTok{rm}\NormalTok{(}\StringTok{"x"}\NormalTok{)         }\CommentTok{\# remove the object named x from the global environment}
\FunctionTok{rm}\NormalTok{(}\AttributeTok{list =} \FunctionTok{ls}\NormalTok{()) }\CommentTok{\# clear out the global environment}
\end{Highlighting}
\end{Shaded}

\begin{info}
In the upper right corner of the Environment tab, change \textbf{\texttt{List}} to \textbf{\texttt{Grid}}. Now you can see the type, length, and size of your objects, and reorder the list by any of these attributes.

\end{info}

\hypertarget{whitespace}{%
\subsection{Whitespace}\label{whitespace}}

R mostly ignores whitespace: spaces, tabs, and line breaks. This means that you can use whitespace to help you organise your code.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# a and b are identical}
\NormalTok{a }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(}\AttributeTok{ctl =} \StringTok{"Control Condition"}\NormalTok{, }\AttributeTok{exp1 =} \StringTok{"Experimental Condition 1"}\NormalTok{, }\AttributeTok{exp2 =} \StringTok{"Experimental Condition 2"}\NormalTok{)}

\CommentTok{\# but b is much easier to read}
\NormalTok{b }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(}\AttributeTok{ctl  =} \StringTok{"Control Condition"}\NormalTok{, }
          \AttributeTok{exp1 =} \StringTok{"Experimental Condition 1"}\NormalTok{, }
          \AttributeTok{exp2 =} \StringTok{"Experimental Condition 2"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

When you see \texttt{\textgreater{}} at the beginning of a line, that means R is waiting for you to start a new command. However, if you see a \texttt{+} instead of \texttt{\textgreater{}} at the start of the line, that means R is waiting for you to finish a command you started on a previous line. If you want to cancel whatever command you started, just press the Esc key in the console window and you'll get back to the \texttt{\textgreater{}} command prompt.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# R waits until next line for evaluation}
\NormalTok{(}\DecValTok{3} \SpecialCharTok{+} \DecValTok{2}\NormalTok{) }\SpecialCharTok{*}
     \DecValTok{5}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 25
\end{verbatim}

It is often useful to break up long functions onto several lines.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{cat}\NormalTok{(}\StringTok{"3, 6, 9, the goose drank wine"}\NormalTok{,}
    \StringTok{"The monkey chewed tobacco on the streetcar line"}\NormalTok{,}
    \StringTok{"The line broke, the monkey got choked"}\NormalTok{,}
    \StringTok{"And they all went to heaven in a little rowboat"}\NormalTok{,}
    \AttributeTok{sep =} \StringTok{"  }\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 3, 6, 9, the goose drank wine  
## The monkey chewed tobacco on the streetcar line  
## The line broke, the monkey got choked  
## And they all went to heaven in a little rowboat
\end{verbatim}

\hypertarget{function_syx}{%
\subsection{Function syntax}\label{function_syx}}

A lot of what you do in R involves calling a function and storing the results. A function is a named section of code that can be reused.

For example, \texttt{sd} is a function that returns the standard deviation of the vector of numbers that you provide as the input argument. Functions are set up like this:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{function\_name}\NormalTok{(argument1, }\AttributeTok{argument2 =} \StringTok{"value"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

The arguments in parentheses can be named (e.g., \texttt{argument1\ =\ 10}) or you can skip the names if you put them in the exact same order that they're defined in the function. You can check this by typing \texttt{?sd} (or whatever function name you're looking up) into the console and the Help pane will show you the default order under \textbf{Usage}. You can skip arguments that have a default value specified.

Most functions return a value, but may also produce side effects like printing to the console.

To illustrate, the function \texttt{rnorm()} generates random numbers from the standard normal distribution. The help page for \texttt{rnorm()} (accessed by typing \texttt{?rnorm} in the console) shows that it has the syntax

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{rnorm}\NormalTok{(n, }\AttributeTok{mean =} \DecValTok{0}\NormalTok{, }\AttributeTok{sd =} \DecValTok{1}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

where \texttt{n} is the number of randomly generated numbers you want, \texttt{mean} is the mean of the distribution, and \texttt{sd} is the standard deviation. The default mean is 0, and the default standard deviation is 1. There is no default for \texttt{n}, which means you'll get an error if you don't specify it:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{rnorm}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Error in rnorm(): argument "n" is missing, with no default
\end{verbatim}

If you want 10 random numbers from a normal distribution with mean of 0 and standard deviation, you can just use the defaults.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{rnorm}\NormalTok{(}\DecValTok{10}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1]  0.3644909  1.0551302  2.0720850  0.6152214 -0.2526608 -0.4186245
##  [7] -0.1663370  0.1821596  1.1473016  0.9838531
\end{verbatim}

If you want 10 numbers from a normal distribution with a mean of 100:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{rnorm}\NormalTok{(}\DecValTok{10}\NormalTok{, }\DecValTok{100}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1] 100.32126  99.03195 100.08633  98.23100  98.76142  99.97122 101.28922
##  [8] 100.83947  99.28170 100.09866
\end{verbatim}

This would be an equivalent but less efficient way of calling the function:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{rnorm}\NormalTok{(}\AttributeTok{n =} \DecValTok{10}\NormalTok{, }\AttributeTok{mean =} \DecValTok{100}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1] 100.13668 100.11537  99.73778 101.14736 101.39270 100.92577  99.07943
##  [8] 100.45524 100.72273 100.62765
\end{verbatim}

We don't need to name the arguments because R will recognize that we intended to fill in the first and second arguments by their position in the function call. However, if we want to change the default for an argument coming later in the list, then we need to name it. For instance, if we wanted to keep the default \texttt{mean\ =\ 0} but change the standard deviation to 100, we would do it this way:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{rnorm}\NormalTok{(}\DecValTok{10}\NormalTok{, }\AttributeTok{sd =} \DecValTok{100}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1] -145.718925 -246.111293   45.212757   -7.484518   63.115975  128.406898
##  [7]   35.714157  170.416315  -39.284274  -65.863168
\end{verbatim}

Some functions give a list of options after an argument; this means the default value is the first option. The usage entry for the {power.t.test}{(}{)} function looks like this:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{power.t.test}\NormalTok{(}\AttributeTok{n =} \ConstantTok{NULL}\NormalTok{, }\AttributeTok{delta =} \ConstantTok{NULL}\NormalTok{, }\AttributeTok{sd =} \DecValTok{1}\NormalTok{, }\AttributeTok{sig.level =} \FloatTok{0.05}\NormalTok{,}
             \AttributeTok{power =} \ConstantTok{NULL}\NormalTok{,}
             \AttributeTok{type =} \FunctionTok{c}\NormalTok{(}\StringTok{"two.sample"}\NormalTok{, }\StringTok{"one.sample"}\NormalTok{, }\StringTok{"paired"}\NormalTok{),}
             \AttributeTok{alternative =} \FunctionTok{c}\NormalTok{(}\StringTok{"two.sided"}\NormalTok{, }\StringTok{"one.sided"}\NormalTok{),}
             \AttributeTok{strict =} \ConstantTok{FALSE}\NormalTok{, }\AttributeTok{tol =}\NormalTok{ .Machine}\SpecialCharTok{$}\NormalTok{double.eps}\SpecialCharTok{\^{}}\FloatTok{0.25}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{try}

\begin{itemize}
\tightlist
\item
  What is the default value for \texttt{sd}? 1NULLtwo.sample0.05
\item
  What is the default value for \texttt{type}? one.samplepairedNULLtwo.sample
\item
  Which is equivalent to {power.t.test}{(}{100}, {0.5}{)}?

  \hypertarget{radio_DMJHDVUVPF}{}
  {power.t.test()} {power.t.test(n = 100)} {power.t.test(100, 0.5, sig.level = 1, sd = 0.05)} {power.t.test(delta = 0.5, n = 100)}
\end{itemize}

\end{try}

\hypertarget{install-package}{%
\section{Add-on packages}\label{install-package}}

One of the great things about R is that it is \textbf{user extensible}: anyone can create a new add-on software package that extends its functionality. There are currently thousands of add-on packages that R users have created to solve many different kinds of problems, or just simply to have fun. There are packages for data visualisation, machine learning, neuroimaging, eyetracking, web scraping, and playing games such as Sudoku.

Add-on packages are not distributed with base R, but have to be downloaded and installed from an archive, in the same way that you would, for instance, download and install PokemonGo on your smartphone.

The main repository where packages reside is called CRAN, the Comprehensive R Archive Network. A package has to pass strict tests devised by the R core team to be allowed to be part of the CRAN archive. You can install from the CRAN archive through R using the {install.packages}{(}{)} function.

There is an important distinction between \textbf{installing} a package and \textbf{loading} a package.

\hypertarget{installing-a-package}{%
\subsection{Installing a package}\label{installing-a-package}}

This is done using {install.packages}{(}{)}. This is like installing an app on your phone: you only have to do it once and the app will remain installed until you remove it. For instance, if you want to use PokemonGo on your phone, you install it once from the App Store or Play Store, and you don't have to re-install it each time you want to use it. Once you launch the app, it will run in the background until you close it or restart your phone. Likewise, when you install a package, the package will be available (but not \emph{loaded}) every time you open up R.

\begin{warning}
You may only be able to permanently install packages if you are using R on your own system; you may not be able to do this on public workstations if you lack the appropriate privileges.

\end{warning}

Install the esquisse package on your system. This package lets you create plots interactively and copy the code needed to make them reproducibly.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# type this in the console pane}
\FunctionTok{install.packages}\NormalTok{(}\StringTok{"esquisse"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

If you don't already have packages like ggplot2 and shiny installed, it will also install these \textbf{dependencies} for you. If you don't get an error message at the end, the installation was successful.

\begin{dangerous}
Never install a package from inside a script. Only do this from the console pane.

\end{dangerous}

\hypertarget{loading-a-package}{%
\subsection{Loading a package}\label{loading-a-package}}

This is done using {library}{(}{packagename}{)}. This is like \textbf{launching} an app on your phone: the functionality is only there where the app is launched and remains there until you close the app or restart. Likewise, when you run {library}{(}{packagename}{)} within a session, the functionality of the package referred to by \texttt{packagename} will be made available for your R session. The next time you start R, you will need to run the {library}{(}{)} function again if you want to access its functionality.

You can load the functions in esquisse for your current R session as follows:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(esquisse)}
\end{Highlighting}
\end{Shaded}

You might get some red text when you load a package, this is normal. It is usually warning you that this package has functions that have the same name as other packages you've already loaded.

Now you can run the function {esquisse}{::}{esquisser}{(}{)}, which runs an interactive plotting example on the built-in dataset \texttt{diamonds} from the ggplot2 package.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{esquisse}\SpecialCharTok{::}\FunctionTok{esquisser}\NormalTok{(ggplot2}\SpecialCharTok{::}\NormalTok{diamonds)}
\end{Highlighting}
\end{Shaded}

\begin{info}
You can use the convention \texttt{package::function()} to indicate in which add-on package a function resides. For instance, if you see {readr}{::}{read\_csv}{(}{)}, that refers to the function {read\_csv}{(}{)} in the readr add-on package.

\end{info}

\hypertarget{tidyverse}{%
\subsection{Tidyverse}\label{tidyverse}}

tidyverseis a meta-package that loads several packages we'll be using in almost every script:

\begin{itemize}
\tightlist
\item
  ggplot2, for data visualisation (Chapter~\ref{ggplot})
\item
  readr, for data import (Chapter~\ref{data})
\item
  tibble, for tables (Chapter~\ref{data})
\item
  tidyr, for data tidying (Chapter~\ref{tidyr})
\item
  dplyr, for data manipulation (Chapter~\ref{dplyr})
\item
  purrr, for repeating things (Chapter~\ref{func})
\item
  stringr, for strings
\item
  forcats, for factors
\end{itemize}

\hypertarget{install-from-github}{%
\subsection{Install from GitHub}\label{install-from-github}}

Many R packages are not yet on CRAN because they are still in development. Increasingly, datasets and code for papers are available as packages you can download from github. You'll need to install the devtools package to be able to install packages from github. Check if you have a package installed by trying to load it (e.g., if you don't have devtools installed, {library}{(}{devtools}{)} will display an error message) or by searching for it in the packages tab in the lower right pane. All listed packages are installed; all checked packages are currently loaded.

\begin{figure}

{\centering \includegraphics[width=1\linewidth]{images/intro/packages} 

}

\caption{Check installed and loaded packages in the packages tab in the lower right pane.}\label{fig:img-packages}
\end{figure}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# install devtools if you get}
\CommentTok{\# Error in loadNamespace(name) : there is no package called ‘devtools’}
\CommentTok{\# install.packages("devtools")}
\NormalTok{devtools}\SpecialCharTok{::}\FunctionTok{install\_github}\NormalTok{(}\StringTok{"psyteachr/reprores{-}v2"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

After you install the reprores package, load it using the {library}{(}{)} function. You can then try out some of the functions below.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(reprores)}

\CommentTok{\# opens a local copy of this book in your web browser}
\FunctionTok{book}\NormalTok{()}

\CommentTok{\# opens a shiny app that lets you see how simulated data would look in different plot styles}
\FunctionTok{app}\NormalTok{(}\StringTok{"plotdemo"}\NormalTok{)}

\CommentTok{\# creates and opens a file containing the exercises for this chapter}
\FunctionTok{exercise}\NormalTok{(}\DecValTok{1}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{try}
How many different ways can you find to discover what functions are available in the reprores package?

\end{try}

reprores contains datasets that we will be using in future lessons. {getdata}{(}{)} creates a directory called data with all of the class datasets.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# loads the disgust dataset}
\FunctionTok{data}\NormalTok{(}\StringTok{"disgust"}\NormalTok{)}

\CommentTok{\# shows the documentation for the built{-}in dataset \textasciigrave{}disgust\textasciigrave{}}
\NormalTok{?disgust}

\CommentTok{\# saves datasets into a "data" folder in your working directory}
\FunctionTok{getdata}\NormalTok{(}\StringTok{"data"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{help}{%
\section{Getting help}\label{help}}

You will feel like you need a \emph{lot} of help when you're starting to learn. This won't really go away, and it isn't supposed to. Experienced coders are also constantly looking things up; it's impossible to memorise everything. The goal is to learn enough about the structure of R that you can look things up quickly. This is why there is so much specialised jargon in coding; it's easier to google ``adding vectors in R'' than ``adding lists of things that are the same kind of data in R''.

\hypertarget{function-help}{%
\subsection{Function Help}\label{function-help}}

Start up help in a browser using the function \texttt{help.start()}.

If a function is in base R or a loaded package, you can use the \texttt{help("function\_name")} function or the \texttt{?function\_name} shortcut to access the help file. If the package isn't loaded, specify the package name as the second argument to the help function.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# these methods are all equivalent ways of getting help}
\FunctionTok{help}\NormalTok{(}\StringTok{"rnorm"}\NormalTok{)}
\NormalTok{?rnorm}
\FunctionTok{help}\NormalTok{(}\StringTok{"rnorm"}\NormalTok{, }\AttributeTok{package=}\StringTok{"stats"}\NormalTok{) }
\end{Highlighting}
\end{Shaded}

When the package isn't loaded or you aren't sure what package the function is in, use the shortcut \texttt{??function\_name}.

\begin{try}

\begin{itemize}
\tightlist
\item
  What is the first argument to the \texttt{mean} function? trimna.rmmeanx
\item
  What package is \texttt{read\_excel} in? readrreadxlbasestats
\end{itemize}

\end{try}

\hypertarget{googling}{%
\subsection{Googling}\label{googling}}

If the function help doesn't help, or you're not even sure what function you need, try Googling your question. It will take some practice to be able to use the right jargon in your search terms to get what you want. It helps to put ``R'' or ``rstats'', or ``tidyverse'' in the search text, or the name of the relevant package, like ggplot2.

\hypertarget{vignettes}{%
\subsection{Vignettes}\label{vignettes}}

Many packages, especially \href{https://www.tidyverse.org/packages/}{tidyverse} ones, have helpful websites with vignettes explaining how to use their functions. Some of the vignettes are also available inside R.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# opens a list of available vignettes}
\FunctionTok{vignette}\NormalTok{(}\AttributeTok{package =} \StringTok{"ggplot2"}\NormalTok{)}

\CommentTok{\# opens a specific vignette in the Help pane}
\FunctionTok{vignette}\NormalTok{(}\StringTok{"ggplot2{-}specs"}\NormalTok{, }\AttributeTok{package =} \StringTok{"ggplot2"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{glossaryintro}{%
\section{Glossary}\label{glossaryintro}}

Each chapter ends with a glossary table defining the jargon introduced in this chapter. The links below take you to the \href{https://psyteachr.github.io/glossary}{glossary book}, which you can also download for offline use.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# install the glossary package (only once)}
\NormalTok{devtools}\SpecialCharTok{::}\FunctionTok{install\_github}\NormalTok{(}\StringTok{"psyteachr/glossary"}\NormalTok{)}

\CommentTok{\# open the glossary offline }
\NormalTok{glossary}\SpecialCharTok{::}\FunctionTok{book}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{tabular}{l|l}
\hline
term & definition\\
\hline
argument & A variable that provides input to a function.\\
\hline
assignment-operator & The symbol <-, which functions like = and assigns the value on the right to the object on the left\\
\hline
base-r & The set of R functions that come with a basic installation of R, before you add external packages\\
\hline
console & The pane in RStudio where you can type in commands and view output messages.\\
\hline
cran & The Comprehensive R Archive Network: a network of ftp and web servers around the world that store identical, up-to-date, versions of code and documentation for R.\\
\hline
escape & Include special characters like " inside of a string by prefacing them with a backslash.\\
\hline
factor & A data type where a specific set of values are stored with labels; An explanatory variable manipulated by the experimenter\\
\hline
function & A named section of code that can be reused.\\
\hline
global-environment & The interactive workspace where your script runs\\
\hline
ide & Integrated Development Environment: a program that serves as a text editor, file manager, and provides functions to help you read and write code. RStudio is an IDE for R.\\
\hline
normal-distribution & A symmetric distribution of data where values near the centre are most probable.\\
\hline
object & A word that identifies and stores the value of some data for later use.\\
\hline
package & A group of R functions.\\
\hline
panes & RStudio is arranged with four window "panes".\\
\hline
r-markdown & The R-specific version of markdown: a way to specify formatting, such as headers, paragraphs, lists, bolding, and links, as well as code blocks and inline code.\\
\hline
reproducible-research & Research that documents all of the steps between raw data and results in a way that can be verified.\\
\hline
script & A plain-text file that contains commands in a coding language, such as R.\\
\hline
standard-deviation & A descriptive statistic that measures how spread out data are relative to the mean.\\
\hline
string & A piece of text inside of quotes.\\
\hline
variable & A word that identifies and stores the value of some data for later use.\\
\hline
vector & A type of data structure that collects values with the same data type, like T/F values, numbers, or strings.\\
\hline
whitespace & Spaces, tabs and line breaks\\
\hline
\end{tabular}

\hypertarget{resources-intro}{%
\section{Further Resources}\label{resources-intro}}

\begin{itemize}
\tightlist
\item
  \href{http://r4ds.had.co.nz/introduction.html}{Chapter 1: Introduction} in \emph{R for Data Science}
\item
  \href{https://github.com/rstudio/cheatsheets/raw/master/rstudio-ide.pdf}{RStudio IDE Cheatsheet}
\item
  \href{https://rstudio.cloud/}{RStudio Cloud}
\end{itemize}

\hypertarget{repro}{%
\chapter{Reproducible Workflows}\label{repro}}

\hypertarget{ilo-repro}{%
\section{Learning Objectives}\label{ilo-repro}}

\hypertarget{basic}{%
\subsection*{Basic}\label{basic}}
\addcontentsline{toc}{subsection}{Basic}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Organise a \protect\hyperlink{projects}{project} \href{https://youtu.be/y-KiPueC9xw}{(video)}
\item
  Create and compile an \protect\hyperlink{rmarkdown}{Rmarkdown document} \href{https://youtu.be/EqJiAlJAl8Y}{(video)}
\item
  Edit the YAML header to add table of contents and other options
\item
  Include a table
\item
  Include a figure
\item
  Report the output of an analysis using inline R
\item
  Add a bibliography and in-line citations
\end{enumerate}

\hypertarget{intermediate}{%
\subsection*{Intermediate}\label{intermediate}}
\addcontentsline{toc}{subsection}{Intermediate}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{7}
\tightlist
\item
  Output doc and PDF formats
\item
  Format tables using \texttt{kableExtra}
\end{enumerate}

\hypertarget{setup-repro}{%
\section{Setup}\label{setup-repro}}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(tidyverse)}
\FunctionTok{library}\NormalTok{(knitr)}
\end{Highlighting}
\end{Shaded}

\hypertarget{why-learn-reproducible-reports}{%
\section{Why learn reproducible reports?}\label{why-learn-reproducible-reports}}

Have you ever worked on a report, creating a summary table for the demographics, making beautiful plots, getting the analysis just right, and copying all the relevant numbers into your manuscript, only to find out that you forgot to exclude a test run and have to redo everything?

An R Markdown document produces a reproducible report that fixes this problem. Although this requires a bit of extra effort at the start, it will more than pay you back by allowing you to update your entire report with the push of a button whenever anything changes.

Studies also show that many, if not most, papers in the scientific literature have reporting errors. For example, more than half of over 250,000 psychology papers published between 1985 and 2013 have at least one value that is statistically incompatible (e.g., a p-value that is not possible given a t-value and degrees of freedom) \citep{nuijten2016prevalence}. Reproducible reports help avoid transcription and rounding errors.

We will make reproducible reports following the principles of \href{https://en.wikipedia.org/wiki/Literate_programming}{literate programming}. The basic idea is to have the text of the report together in a single document along with the code needed to perform all analyses and generate the tables. The report is then ``compiled'' from the original format into some other, more portable format, such as HTML or PDF. This is different from traditional cutting and pasting approaches where, for instance, you create a graph in Microsoft Excel or a statistics program like SPSS and then paste it into Microsoft Word.

\hypertarget{projects}{%
\section{Organising a project}\label{projects}}

First, we need to get organised. Projects in RStudio are a way to group all of the files you need for one project. Most projects include scripts, data files, and output files like the PDF report created by the script or images.

\hypertarget{file-system}{%
\subsection{File System}\label{file-system}}

Modern computers tend to hide the file system from users, but we need to understand a little bit about how files are stored on your computer in order to get a script to find your data. Your computer's file system is like a big box (or directory) that contains both files and smaller boxes, or ``subdirectories''. You can specify the location of a file with its name and the names of all the directories it is inside.

For example, if Lisa is looking for a file called \texttt{report.Rmd}on their Desktop, they can specify the full file path like this: \texttt{/Users/lisad/Desktop/report.Rmd}, because the \texttt{Desktop} directory is inside the \texttt{lisad} directory, which is inside the \texttt{Users} directory, which is located at the base of the whole file system. If that file was on \emph{your} desktop, you would probably have a different path unless your user directory is also called \texttt{lisad}. You can also use the \texttt{\textasciitilde{}} shortcut to represent the user directory of the person who is currently logged in, like this: \texttt{\textasciitilde{}/Desktop/report.Rmd}.

\hypertarget{working-directory}{%
\subsection{Working Directory}\label{working-directory}}

Where should you put all of your files? You usually want to have all of your scripts and data files for a single project inside one folder on your computer, the working directory for that project. You can organise files in subdirectories inside this main project directory, such as putting all raw data files in a directory called data and saving any image files to a directory called images.

Your script should only reference files in three locations, using the appropriate format.

\begin{longtable}[]{@{}ll@{}}
\toprule
Where & Example \\
\midrule
\endhead
on the web & ``\url{https://psyteachr.github.io/ads-v1/data/widgets_gadgets.xlsx}'' \\
in the working directory & ``widgets\_gadgets.xlsx'' \\
in a subdirectory & ``data/widgets\_gadgets.xlsx'' \\
\bottomrule
\end{longtable}

\begin{warning}
Never set or change your working directory in a script.

\end{warning}

R Markdown files will automatically use the same directory the .Rmd file is in as the working directory.

If your script needs a file in a subdirectory of your working directory, such as, data/widgets\_gadgets.xlsx, load it in using a relative path so that it is accessible if you move the working directory to another location or computer:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dat }\OtherTok{\textless{}{-}} \FunctionTok{read\_csv}\NormalTok{(}\StringTok{"data/widgets\_gadgets.xlsx"}\NormalTok{)  }\CommentTok{\# correct}
\end{Highlighting}
\end{Shaded}

Do not load it in using an absolute path:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dat }\OtherTok{\textless{}{-}} \FunctionTok{read\_csv}\NormalTok{(}\StringTok{"C:/My Files/2020{-}2021/data/widgets\_gadgets.xlsx"}\NormalTok{)   }\CommentTok{\# wrong}
\end{Highlighting}
\end{Shaded}

\begin{info}
Also note the convention of using forward slashes, unlike the Windows-specific convention of using backward slashes. This is to make references to files work for everyone, regardless of their operating system.

\end{info}

\hypertarget{naming-things}{%
\subsection{Naming Things}\label{naming-things}}

Name files so that both people and computers can easily find things. Here are some important principles:

\begin{itemize}
\tightlist
\item
  file and directory names should only contain letters, numbers, dashes, and underscores, with a full stop (\texttt{.}) between the file name and extension (that means no spaces!)
\item
  be consistent with capitalisation (set a rule to make it easy to remember, like always use lowercase)
\item
  use underscores (\texttt{\_}) to separate parts of the file name, and dashes (\texttt{-}) to separate words in a section
\item
  name files with a pattern that alphabetises in a sensible order and makes it easy for you to find the file you're looking for
\item
  prefix a filename with an underscore to move it to the top of the list, or prefix all files with numbers to control their order
\end{itemize}

For example, these file names are a mess:

\begin{itemize}
\tightlist
\item
  report.doc
\item
  report final.doc
\item
  Data (Customers) 11-15.xls
\item
  Customers Data Nov 12.xls
\item
  final report2.doc
\item
  project notes.txt
\item
  Vendor Data November 15.xls
\end{itemize}

Here is one way to structure them so that similar files have the same structure and it's easy for a human to scan the list or to use code to find relevant files. See if you can figure out what the last one should be.

\begin{itemize}
\tightlist
\item
  \_project-notes.txt
\item
  report\_v1.doc
\item
  report\_v2.doc
\item
  report\_v3.doc
\item
  data\_customer\_2021-11-12.xls
\item
  data\_customer\_2021-11-15.xls
\item
  vendor-data\_2021-11-15.xlsdata-vendor-2021\_11\_15.xlsdata\_vendor\_2021-11-15.xlsdata\_2021-11-15\_vendor.xls
\end{itemize}

\begin{try}
Think of other ways to name the files above. Look at some of your own project files and see what you can improve.

\end{try}

\hypertarget{start-a-project}{%
\subsection{Start a Project}\label{start-a-project}}

Now that we understand how the file system work and how to name things to make it easier for scripts to access them, we're ready to make our first project.

First, make a new directory where you will keep all of your materials for this class. You can set this directory to be the default working directory under the General tab of the Global Options. This means that files will be saved here by default if you aren't working in a project.

Next, choose \textbf{\texttt{New\ Project...}} under the \textbf{\texttt{File}} menu to create a new project called 02-reports. Make sure you save it inside the directory you just made. RStudio will restart itself and open with this new project directory as the working directory.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{include\_graphics}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{"images/repro/new\_proj\_1.png"}\NormalTok{,}
                   \StringTok{"images/repro/new\_proj\_2.png"}\NormalTok{,}
                   \StringTok{"images/repro/new\_proj\_3.png"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{figure}

{\centering \includegraphics[width=1\linewidth]{images/repro/new_proj_1} 

}

\caption{Starting a new project.}\label{fig:unnamed-chunk-2-1}
\end{figure}
\begin{figure}

{\centering \includegraphics[width=1\linewidth]{images/repro/new_proj_2} 

}

\caption{Starting a new project.}\label{fig:unnamed-chunk-2-2}
\end{figure}
\begin{figure}

{\centering \includegraphics[width=1\linewidth]{images/repro/new_proj_3} 

}

\caption{Starting a new project.}\label{fig:unnamed-chunk-2-3}
\end{figure}

Click on the Files tab in the lower right pane to see the contents of the project directory. You will see a file called \texttt{02-reports.Rproj}, which is a file that contains all of the project information.You can double-click on it to open up the project.

\begin{info}
Depending on your settings, you may also see a directory called \texttt{.Rproj.user}, which contains your specific user settings. You can ignore this and other ``invisible'' files that start with a full stop.

\end{info}

\hypertarget{r-markdown}{%
\section{R Markdown}\label{r-markdown}}

In this lesson, we will learn to make an R Markdown document with a table of contents, appropriate headers, code chunks, tables, images, inline R, and a bibliography.

We will use R Markdown to create reproducible reports, which enables mixing of text and code. A reproducible script will contain sections of code in code blocks. A code block starts and ends with three backtick symbols in a row, with some information about the code between curly brackets, such as \texttt{\{r\ chunk-name,\ echo=FALSE\}} (this runs the code, but does not show the text of the code block in the compiled document). The text outside of code blocks is written in markdown, which is a way to specify formatting, such as headers, paragraphs, lists, bolding, and links.

\begin{figure}

{\centering \includegraphics[width=1\linewidth]{images/repro/reproducible_script} 

}

\caption{A reproducible script.}\label{fig:img-reproducible-script}
\end{figure}

If you open up a new R Markdown file from a template, you will see an example document with several code blocks in it. To create an HTML or PDF report from an R Markdown (Rmd) document, you compile it. Compiling a document is called knitting in RStudio. There is a button that looks like a ball of yarn with needles through it that you click on to compile your file into a report.

\begin{try}
Create a new R Markdown file from the \textbf{\texttt{File\ \textgreater{}\ New\ File\ \textgreater{}\ R\ Markdown...}} menu. Change the title and author, then click the knit button to create an html file.

\end{try}

\hypertarget{yaml-header}{%
\subsection{YAML Header}\label{yaml-header}}

The YAML header is where you can set several options.

\begin{verbatim}
---
title: "My Demo Document"
author: "Me"
output:
  html_document:
    df_print: kable
    theme: 
      version: 4
      bootswatch: yeti
    highlight: tango
    toc: true
    toc_float:
      collapsed: false
      smooth_scroll: false
    toc_depth: 3
    number_sections: false
---
\end{verbatim}

\begin{info}
Try changing the values from \texttt{false} to \texttt{true} to see what the options do.

\end{info}

The \texttt{df\_print:\ kable} option prints data frames using \texttt{knitr::kable}. You'll learn below how to further customise tables.

The built-in bootswatch themes are: default, cerulean, cosmo, darkly, flatly, journal, lumen, paper, readable, sandstone, simplex, spacelab, united, and yeti. You can \href{https://bootswatch.com/4/}{view and download more themes}.

\begin{figure}

{\centering \includegraphics[width=1\linewidth]{images/repro/bootswatch} 

}

\caption{Light themes in versions 3 and 4.}\label{fig:img-bootswatch}
\end{figure}

\hypertarget{setup}{%
\subsection{Setup}\label{setup}}

When you create a new R Markdown file in RStudio, a setup chunk is automatically created.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{knitr}\SpecialCharTok{::}\NormalTok{opts\_chunk}\SpecialCharTok{$}\FunctionTok{set}\NormalTok{(}\AttributeTok{echo =} \ConstantTok{TRUE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

You can set more default options for code chunks here. See the \href{https://yihui.name/knitr/options/}{knitr options documentation} for explanations of the possible options.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{knitr}\SpecialCharTok{::}\NormalTok{opts\_chunk}\SpecialCharTok{$}\FunctionTok{set}\NormalTok{(}
  \AttributeTok{fig.width  =} \DecValTok{8}\NormalTok{, }
  \AttributeTok{fig.height =} \DecValTok{5}\NormalTok{, }
  \AttributeTok{fig.path   =} \StringTok{\textquotesingle{}images/\textquotesingle{}}\NormalTok{,}
  \AttributeTok{echo       =} \ConstantTok{FALSE}\NormalTok{, }
  \AttributeTok{warning    =} \ConstantTok{TRUE}\NormalTok{, }
  \AttributeTok{message    =} \ConstantTok{FALSE}\NormalTok{,}
  \AttributeTok{cache      =} \ConstantTok{FALSE}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

The code above sets the following options:

\begin{itemize}
\tightlist
\item
  \texttt{fig.width\ \ =\ 8} : default figure width is 8 inches (you can change this for individual figures)
\item
  \texttt{fig.height\ =\ 5} : default figure height is 5 inches
\item
  \texttt{fig.path\ \ \ =\ \textquotesingle{}images/\textquotesingle{}} : figures are saved in the directory ``images''
\item
  \texttt{echo\ \ \ \ \ \ \ =\ FALSE} : do not show code chunks in the rendered document
\item
  \texttt{warning\ \ \ \ =\ FALSE} : do not show any function warnings
\item
  \texttt{message\ \ \ \ =\ FALSE} : do not show any function messages
\item
  \texttt{cache\ \ \ \ \ \ =\ FALSE} : run all the code to create all of the images and objects each time you knit (set to \texttt{TRUE} if you have time-consuming code)
\end{itemize}

Find a list of the current chunk options by typing {str}{(}{knitr}{::}{opts\_chunk}{\$}{get}{(}{)}{)} in the console.

You can also add the packages you need in this chunk using {library}{(}{)}. Often when you are working on a script, you will realize that you need to load another add-on package. Don't bury the call to {library}{(}{package\_I\_need}{)} way down in the script. Put it in the top, so the user has an overview of what packages are needed.

\begin{try}
We'll be using function from the package tidyverse, so load that in your setup chunk.

\end{try}

\hypertarget{structure}{%
\subsection{Structure}\label{structure}}

If you include a table of contents (\texttt{toc}), it is created from your document headers. Headers in markdown are created by prefacing the header title with one or more hashes (\texttt{\#}).

Use the following structure when developing your own analysis scripts:

\begin{itemize}
\tightlist
\item
  load in any add-on packages you need to use
\item
  define any custom functions
\item
  load or simulate the data you will be working with
\item
  work with the data
\item
  save anything you need to save
\end{itemize}

\begin{try}
Delete the default text and add some structure to your document by creating headers and subheaders. We're going to load some data, create a summary table, plot the data, and analyse it.

\end{try}

\hypertarget{code-chunks}{%
\subsection{Code Chunks}\label{code-chunks}}

You can include code chunks that create and display images, tables, or computations to include in your text. Let's start by loading some data.

First, create a code chunk in your document. This code loads some data from the web.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pets }\OtherTok{\textless{}{-}} \FunctionTok{read\_csv}\NormalTok{(}\StringTok{"https://psyteachr.github.io/reprores/data/pets.csv"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Rows: 800 Columns: 6
\end{verbatim}

\begin{verbatim}
## -- Column specification --------------------------------------------------------
## Delimiter: ","
## chr (3): id, pet, country
## dbl (3): score, age, weight
\end{verbatim}

\begin{verbatim}
## 
## i Use `spec()` to retrieve the full column specification for this data.
## i Specify the column types or set `show_col_types = FALSE` to quiet this message.
\end{verbatim}

\hypertarget{comments}{%
\subsubsection{Comments}\label{comments}}

You can add comments inside R chunks with the hash symbol (\texttt{\#}). The R interpreter will ignore characters from the hash to the end of the line.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# simulating new data}

\NormalTok{n }\OtherTok{\textless{}{-}} \FunctionTok{nrow}\NormalTok{(pets) }\CommentTok{\# the total number of pet}
\NormalTok{mu }\OtherTok{\textless{}{-}} \FunctionTok{mean}\NormalTok{(pets}\SpecialCharTok{$}\NormalTok{score) }\CommentTok{\# the mean score for all pets}
\NormalTok{sd }\OtherTok{\textless{}{-}} \FunctionTok{sd}\NormalTok{(pets}\SpecialCharTok{$}\NormalTok{score) }\CommentTok{\# the SD for score for all pets}

\NormalTok{simulated\_scores }\OtherTok{\textless{}{-}} \FunctionTok{rnorm}\NormalTok{(n, mu, sd)}
\end{Highlighting}
\end{Shaded}

It's usually good practice to start a code chunk with a comment that explains what you're doing there, especially if the code is not explained in the text of the report.

If you name your objects clearly, you often don't need to add clarifying comments. For example, if I'd named the three objects above \texttt{total\_pet\_n}, \texttt{mean\_score} and \texttt{sd\_score}, I would omit the comments.

It's a bit of an art to comment your code well. The best way to develop this skill is to read a lot of other people's code and have others review your code.

\hypertarget{tables}{%
\subsubsection{Tables}\label{tables}}

Next, create a code chunk where you want to display a table of the descriptives (e.g., Participants section of the Methods). We'll use tidyverse functions you will learn in the \protect\hyperlink{tidyr}{data wrangling lectures} to create summary statistics for each group.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pets }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{group\_by}\NormalTok{(pet) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{summarise}\NormalTok{(}
    \AttributeTok{n =} \FunctionTok{n}\NormalTok{(),}
    \AttributeTok{mean\_weight =} \FunctionTok{mean}\NormalTok{(weight),}
    \AttributeTok{mean\_score =} \FunctionTok{mean}\NormalTok{(score)}
\NormalTok{  )}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 3 x 4
##   pet        n mean_weight mean_score
##   <chr>  <int>       <dbl>      <dbl>
## 1 cat      300        9.37       90.2
## 2 dog      400       19.1       100. 
## 3 ferret   100        4.78      112.
\end{verbatim}

The table above is OK, but it could be more reader-friendly by changing the column labels, rounding the means, and adding a caption. You can use {knitr}{::}{kable}{(}{)} for this.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{summary\_table }\OtherTok{\textless{}{-}}\NormalTok{pets }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{group\_by}\NormalTok{(pet) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{summarise}\NormalTok{(}
    \AttributeTok{n =} \FunctionTok{n}\NormalTok{(),}
    \AttributeTok{mean\_weight =} \FunctionTok{mean}\NormalTok{(weight),}
    \AttributeTok{mean\_score =} \FunctionTok{mean}\NormalTok{(score)}
\NormalTok{  )}

\NormalTok{newnames }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"Pet Type"}\NormalTok{, }\StringTok{"N"}\NormalTok{, }\StringTok{"Mean Weight"}\NormalTok{, }\StringTok{"Mean Score"}\NormalTok{)}

\NormalTok{knitr}\SpecialCharTok{::}\FunctionTok{kable}\NormalTok{(summary\_table, }
             \AttributeTok{digits =} \DecValTok{2}\NormalTok{, }
             \AttributeTok{col.names =}\NormalTok{ newnames,}
             \AttributeTok{caption =} \StringTok{"Summary statistics for the pets dataset."}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{table}

\caption{\label{tab:unnamed-chunk-6}Summary statistics for the pets dataset.}
\centering
\begin{tabular}[t]{l|r|r|r}
\hline
Pet Type & N & Mean Weight & Mean Score\\
\hline
cat & 300 & 9.37 & 90.24\\
\hline
dog & 400 & 19.07 & 99.98\\
\hline
ferret & 100 & 4.78 & 111.78\\
\hline
\end{tabular}
\end{table}

\begin{info}
Notice that the r chunk specifies the option \texttt{results=\textquotesingle{}asis\textquotesingle{}}. This lets you format the table using the \texttt{kable()} function from \texttt{knitr}. You can also use more specialised functions from \href{https://crsh.github.io/papaja_man/reporting.html\#tables}{papaja} or \href{https://haozhu233.github.io/kableExtra/awesome_table_in_html.html}{kableExtra} to format your tables.

\end{info}

\hypertarget{images}{%
\subsubsection{Images}\label{images}}

Next, create a code chunk where you want to display an image in your document. Let's put it in the Results section. We'll use some code that you'll learn more about in the \protect\hyperlink{ggplot}{data visualisation lecture} to show violin-boxplots for the groups.

Notice how the figure caption is formatted in the chunk options.

\begin{verbatim}
```r
ggplot(pets, aes(pet, score, fill = country)) +
  geom_violin(alpha = 0.5) +
  geom_boxplot(width = 0.25, 
               position = position_dodge(width = 0.9),
               show.legend = FALSE) +
  scale_fill_manual(values = c("orange", "dodgerblue")) +
  xlab("") +
  ylab("Score") +
  theme(text = element_text(size = 20, family = "Times"))
```

\begin{figure}

{\centering \includegraphics[width=1\linewidth]{02-repro_files/figure-latex/unnamed-chunk-7-1} 

}

\caption{Figure 1. Scores by pet type and country.}\label{fig:unnamed-chunk-7}
\end{figure}
\end{verbatim}

\begin{figure}

{\centering \includegraphics[width=1\linewidth]{02-repro_files/figure-latex/unnamed-chunk-8-1} 

}

\caption{Figure 1. Scores by pet type and country.}\label{fig:unnamed-chunk-8}
\end{figure}

\begin{info}
The last line changes the default text size and font, which can be useful for generating figures that meet a journal's requirements.

\end{info}

You can also include images that you did not create in R using the typical markdown syntax for images:

\begin{verbatim}
![All the Things by [Hyperbole and a Half](http://hyperboleandahalf.blogspot.com/)](images/memes/x-all-the-things.png){style="width: 50%"}
\end{verbatim}

\begin{figure}
\centering
\includegraphics{images/memes/x-all-the-things.png}
\caption{All the Things by \href{http://hyperboleandahalf.blogspot.com/}{Hyperbole and a Half}}
\end{figure}

\hypertarget{in-line-r}{%
\subsubsection{In-line R}\label{in-line-r}}

Now let's analyse the pets data to see if cats are heavier than ferrets. First we'll run the analysis code. Then we'll save any numbers we might want to use in our manuscript to variables and round them appropriately. Finally, we'll use {glue}{::}{glue}{(}{)} to format a results string.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# analysis}
\NormalTok{cat\_weight }\OtherTok{\textless{}{-}} \FunctionTok{filter}\NormalTok{(pets, pet }\SpecialCharTok{==} \StringTok{"cat"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{pull}\NormalTok{(weight)}
\NormalTok{ferret\_weight }\OtherTok{\textless{}{-}} \FunctionTok{filter}\NormalTok{(pets, pet }\SpecialCharTok{==} \StringTok{"ferret"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{pull}\NormalTok{(weight)}
\NormalTok{weight\_test }\OtherTok{\textless{}{-}} \FunctionTok{t.test}\NormalTok{(cat\_weight, ferret\_weight)}

\CommentTok{\# round individual values you want to report}
\NormalTok{t }\OtherTok{\textless{}{-}}\NormalTok{ weight\_test}\SpecialCharTok{$}\NormalTok{statistic }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{round}\NormalTok{(}\DecValTok{2}\NormalTok{)}
\NormalTok{df }\OtherTok{\textless{}{-}}\NormalTok{ weight\_test}\SpecialCharTok{$}\NormalTok{parameter }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{round}\NormalTok{(}\DecValTok{1}\NormalTok{)}
\NormalTok{p }\OtherTok{\textless{}{-}}\NormalTok{ weight\_test}\SpecialCharTok{$}\NormalTok{p.value }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{round}\NormalTok{(}\DecValTok{3}\NormalTok{)}
\CommentTok{\# handle p{-}values \textless{} .001}
\NormalTok{p\_symbol }\OtherTok{\textless{}{-}} \FunctionTok{ifelse}\NormalTok{(p }\SpecialCharTok{\textless{}}\NormalTok{ .}\DecValTok{001}\NormalTok{, }\StringTok{"\textless{}"}\NormalTok{, }\StringTok{"="}\NormalTok{)}
\ControlFlowTok{if}\NormalTok{ (p }\SpecialCharTok{\textless{}}\NormalTok{ .}\DecValTok{001}\NormalTok{) p }\OtherTok{\textless{}{-}}\NormalTok{ .}\DecValTok{001}

\CommentTok{\# format the results string}
\NormalTok{weight\_result }\OtherTok{\textless{}{-}}\NormalTok{ glue}\SpecialCharTok{::}\FunctionTok{glue}\NormalTok{(}\StringTok{"t = \{t\}, df = \{df\}, p \{p\_symbol\} \{p\}"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

You can insert the results into a paragraph with inline R code that looks like this:

\textbf{Rendered text:}\\
Cats were significantly heavier than ferrets (t = 18.42, df = 180.4, p \textless{} 0.001).

\hypertarget{bibliography}{%
\subsection{Bibliography}\label{bibliography}}

There are several ways to do in-text citations and automatically generate a \href{https://rmarkdown.rstudio.com/authoring_bibliographies_and_citations.html\#bibliographies}{bibliography} in R Markdown. Markdown files need a BibTex file that contains the references you need to cite. You specify the name of this file in the YAML header, like \texttt{bibliography:\ filename.bib} and reference citations in text using an at symbol and a shortname, like \texttt{{[}@tidyverse{]}}.

\hypertarget{converting-from-reference-software}{%
\subsubsection{Converting from reference software}\label{converting-from-reference-software}}

Most reference software like EndNote, Zotero or Mendeley have exporting options that can export to BibTeX format. You just need to check the shortnames in the resulting file.

\hypertarget{create-a-bibtex-file-manually}{%
\subsubsection{Create a BibTeX File Manually}\label{create-a-bibtex-file-manually}}

You can make a BibTeX file and add citations manually. Make a new Text File in RStudio called ``bibliography.bib''.

Next, add the line \texttt{bibliography:\ bibliography.bib} to your YAML header.

You can add citations in the following format:

\begin{verbatim}
@article{shortname,
  author = {Author One and Author Two and Author Three},
  title = {Paper Title},
  journal = {Journal Title},
  volume = {vol},
  number = {issue},
  pages = {startpage--endpage},
  year = {year},
  doi = {doi}
}
\end{verbatim}

\hypertarget{citing-r-packages}{%
\subsubsection{Citing R packages}\label{citing-r-packages}}

You can get the citation for an R package using the functions \texttt{citation()} and \texttt{toBibtex()}. You can paste the bibtex entry into your bibliography.bib file. Make sure to add a short name (e.g., ``faux'') before the first comma to refer to the reference.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{citation}\NormalTok{(}\AttributeTok{package=}\StringTok{"faux"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{toBibtex}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## @Manual{,
##   title = {faux: Simulation for Factorial Designs},
##   author = {Lisa DeBruine},
##   doi = {10.5281/zenodo.2669586},
##   publisher = {Zenodo},
##   year = {2021},
##   note = {R package version 1.1.0},
##   url = {https://debruine.github.io/faux/},
## }
\end{verbatim}

\hypertarget{download-citation-info}{%
\subsubsection{Download Citation Info}\label{download-citation-info}}

\href{https://scholar.google.com/}{Google Scholar} entries have a BibTeX citation option. This is usually the easiest way to get the relevant values, although you have to add the DOI yourself.

Some journal websites also let you download citations in bibtex format. For example, go to the publisher's page for \href{https://journals.sagepub.com/doi/abs/10.1177/2515245918770963}{Equivalence Testing for Psychological Research: A Tutorial}, click on the Cite button (in the sidebar or under the bottom Explore More menu), choose BibTeX format, and download the citation. You can open up the file in a text editor and copy the text. It should look like this:

\begin{verbatim}
@article{doi:10.1177/2515245918770963,
author = {Daniël Lakens and Anne M. Scheel and Peder M. Isager},
title ={Equivalence Testing for Psychological Research: A Tutorial},
journal = {Advances in Methods and Practices in Psychological Science},
volume = {1},
number = {2},
pages = {259-269},
year = {2018},
doi = {10.1177/2515245918770963},

URL = { 
        https://doi.org/10.1177/2515245918770963
    
},
eprint = { 
        https://doi.org/10.1177/2515245918770963
    
}
,
    abstract = { Psychologists must be able to test both for the presence of an effect and for the absence of an effect. In addition to testing against zero, researchers can use the two one-sided tests (TOST) procedure to test for equivalence and reject the presence of a smallest effect size of interest (SESOI). The TOST procedure can be used to determine if an observed effect is surprisingly small, given that a true effect at least as extreme as the SESOI exists. We explain a range of approaches to determine the SESOI in psychological science and provide detailed examples of how equivalence tests should be performed and reported. Equivalence tests are an important extension of the statistical tools psychologists currently use and enable researchers to falsify predictions about the presence, and declare the absence, of meaningful effects. }
}
\end{verbatim}

Paste the reference into your bibliography.bib file. Change \texttt{doi:10.1177/2515245918770963} in the first line of the reference to a shortname you will use to cite the reference in your manuscript. We'll use \texttt{TOSTtutorial}.

\hypertarget{in-text-citations}{%
\subsubsection{In-text citations}\label{in-text-citations}}

You can cite reference in text like this:

\begin{verbatim}
This tutorial uses several R packages [@tidyverse;@rmarkdown].
\end{verbatim}

This tutorial uses several R packages \citep{tidyverse, rmarkdown}.

Put a minus in front of the @ if you just want the year:

\begin{verbatim}
Lakens, Scheel and Isengar [-@TOSTtutorial] wrote a tutorial explaining how to test for the absence of an effect.
\end{verbatim}

Lakens, Scheel and Isengar \citeyearpar{TOSTtutorial} wrote a tutorial explaining how to test for the absence of an effect.

\hypertarget{citation-styles}{%
\subsubsection{Citation Styles}\label{citation-styles}}

You can search a \href{https://www.zotero.org/styles}{list of style files} for various journals and download a file that will format your bibliography for a specific journal's style. You'll need to add the line \texttt{csl:\ filename.csl} to your YAML header.

\begin{info}
Add some citations to your bibliography.bib file, reference them in your text, and render your manuscript to see the automatically generated reference section. Try a few different citation style files.

\end{info}

\hypertarget{output-formats}{%
\subsection{Output Formats}\label{output-formats}}

You can knit your file to PDF or Word if you have the right packages installed on your computer. You can also create presentations, dashboards, websites, and even books with R markdown. In fact, the book you are reading right now was created using R markdown. See \href{https://rmarkdown.rstudio.com/formats.html}{RStudio Formats} for a list of all the output types.

\hypertarget{glossary-repro}{%
\section{Glossary}\label{glossary-repro}}

\begin{tabular}{l|l}
\hline
term & definition\\
\hline
absolute-path & A file path that starts with / and is not appended to the working directory\\
\hline
chunk & A section of code in an R Markdown file\\
\hline
directory & A collection or "folder" of files on a computer.\\
\hline
extension & The end part of a file name that tells you what type of file it is (e.g., .R or .Rmd).\\
\hline
knit & To create an HTML, PDF, or Word document from an R Markdown (Rmd) document\\
\hline
markdown & A way to specify formatting, such as headers, paragraphs, lists, bolding, and links.\\
\hline
path & A string representing the location of a file or directory.\\
\hline
project & A way to organise related files in RStudio\\
\hline
r-markdown & The R-specific version of markdown: a way to specify formatting, such as headers, paragraphs, lists, bolding, and links, as well as code blocks and inline code.\\
\hline
relative-path & The location of a file in relation to the working directory.\\
\hline
reproducibility & The extent to which the findings of a study can be repeated in some other context\\
\hline
working-directory & The filepath where R is currently reading and writing files.\\
\hline
yaml & A structured format for information\\
\hline
\end{tabular}

\hypertarget{resources-repro}{%
\section{Further Resources}\label{resources-repro}}

\begin{itemize}
\tightlist
\item
  \href{http://r4ds.had.co.nz/r-markdown.html}{Chapter 27: R Markdown} in \emph{R for Data Science}
\item
  \href{https://github.com/rstudio/cheatsheets/raw/master/rmarkdown.pdf}{R Markdown Cheat Sheet}
\item
  \href{https://www.rstudio.com/wp-content/uploads/2015/03/rmarkdown-reference.pdf}{R Markdown reference Guide}
\item
  \href{https://rmarkdown.rstudio.com/lesson-1.html}{R Markdown Tutorial}
\item
  \href{https://bookdown.org/yihui/rmarkdown/}{R Markdown: The Definitive Guide} by Yihui Xie, J. J. Allaire, \& Garrett Grolemund
\item
  \href{https://slides.djnavarro.net/project-structure/}{Project Structure} by Danielle Navarro
\item
  \href{https://speakerdeck.com/jennybc/how-to-name-files}{How to name files} by Jenny Bryan
\item
  \href{https://crsh.github.io/papaja_man/}{Papaja} Reproducible APA Manuscripts
\item
  \href{https://the-turing-way.netlify.app/}{The Turing Way}
\end{itemize}

\hypertarget{ggplot}{%
\chapter{Data Visualisation}\label{ggplot}}

\hypertarget{ilo-ggplot}{%
\section{Learning Objectives}\label{ilo-ggplot}}

\hypertarget{basic-1}{%
\subsection*{Basic}\label{basic-1}}
\addcontentsline{toc}{subsection}{Basic}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Understand what types of graphs are best for \protect\hyperlink{vartypes}{different types of data} \href{https://youtu.be/tOFQFPRgZ3M}{(video)}

  \begin{itemize}
  \tightlist
  \item
    1 discrete
  \item
    1 continuous
  \item
    2 discrete
  \item
    2 continuous
  \item
    1 discrete, 1 continuous
  \item
    3 continuous
  \end{itemize}
\item
  Create common types of graphs with ggplot2 \href{https://youtu.be/kKlQupjD__g}{(video)}

  \begin{itemize}
  \tightlist
  \item
    \protect\hyperlink{geom_bar}{\texttt{geom\_bar()}}
  \item
    \protect\hyperlink{geom_density}{\texttt{geom\_density()}}
  \item
    \protect\hyperlink{geom_freqpoly}{\texttt{geom\_freqpoly()}}
  \item
    \protect\hyperlink{geom_histogram}{\texttt{geom\_histogram()}}
  \item
    \protect\hyperlink{geom_col}{\texttt{geom\_col()}}
  \item
    \protect\hyperlink{geom_boxplot}{\texttt{geom\_boxplot()}}
  \item
    \protect\hyperlink{geom_violin}{\texttt{geom\_violin()}}
  \item
    \protect\hyperlink{vertical_intervals}{Vertical Intervals}

    \begin{itemize}
    \tightlist
    \item
      \texttt{geom\_crossbar()}
    \item
      \texttt{geom\_errorbar()}
    \item
      \texttt{geom\_linerange()}
    \item
      \texttt{geom\_pointrange()}
    \end{itemize}
  \item
    \protect\hyperlink{geom_point}{\texttt{geom\_point()}}
  \item
    \protect\hyperlink{geom_smooth}{\texttt{geom\_smooth()}}
  \end{itemize}
\item
  Set custom \protect\hyperlink{custom-size}{size},
  \protect\hyperlink{custom-labels}{labels},
  \protect\hyperlink{custom-colours}{colours}, and
  \protect\hyperlink{themes}{themes} \href{https://youtu.be/6pHuCbOh86s}{(video)}
\item
  \href{combo_plots}{Combine plots} on the same plot, as facets, or as a grid using patchwork \href{https://youtu.be/AnqlfuU-VZk}{(video)}
\item
  \protect\hyperlink{ggsave}{Save plots} as an image file \href{https://youtu.be/f1Y53mjEli0}{(video)}
\end{enumerate}

\hypertarget{intermediate-1}{%
\subsection*{Intermediate}\label{intermediate-1}}
\addcontentsline{toc}{subsection}{Intermediate}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{5}
\tightlist
\item
  Add lines to graphs
\item
  Deal with \protect\hyperlink{overlap}{overlapping data}
\item
  Create less common types of graphs

  \begin{itemize}
  \tightlist
  \item
    \protect\hyperlink{geom_tile}{\texttt{geom\_tile()}}
  \item
    \protect\hyperlink{geom_density2d}{\texttt{geom\_density2d()}}
  \item
    \protect\hyperlink{geom_bin2d}{\texttt{geom\_bin2d()}}
  \item
    \protect\hyperlink{geom_hex}{\texttt{geom\_hex()}}
  \item
    \protect\hyperlink{geom_count}{\texttt{geom\_count()}}
  \end{itemize}
\item
  Adjust axes (e.g., flip coordinates, set axis limits)
\item
  Create interactive graphs with \protect\hyperlink{plotly}{\texttt{plotly}}
\end{enumerate}

\hypertarget{setup_ggplot}{%
\section{Setup}\label{setup_ggplot}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# libraries needed for these graphs}
\FunctionTok{library}\NormalTok{(tidyverse)}
\FunctionTok{library}\NormalTok{(patchwork) }
\FunctionTok{library}\NormalTok{(plotly)}
\FunctionTok{library}\NormalTok{(ggwordcloud)}
\FunctionTok{library}\NormalTok{(reprores)}

\FunctionTok{set.seed}\NormalTok{(}\DecValTok{30250}\NormalTok{) }\CommentTok{\# makes sure random numbers are reproducible}
\end{Highlighting}
\end{Shaded}

\hypertarget{vartypes}{%
\section{Common Variable Combinations}\label{vartypes}}

Continuous variables are properties you can measure, like height. Discrete variables are things you can count, like the number of pets you have. Categorical variables can be nominal, where the categories don't really have an order, like cats, dogs and ferrets (even though ferrets are obviously best). They can also be ordinal, where there is a clear order, but the distance between the categories isn't something you could exactly equate, like points on a Likert rating scale.

Different types of visualisations are good for different types of variables.

Load the \texttt{pets} dataset and explore it with \texttt{glimpse(pets)} or \texttt{View(pets)}. This is a simulated dataset with one random factor (\texttt{id}), two categorical factors (\texttt{pet}, \texttt{country}) and three continuous variables (\texttt{score}, \texttt{age}, \texttt{weight}).

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{data}\NormalTok{(}\StringTok{"pets"}\NormalTok{, }\AttributeTok{package =} \StringTok{"reprores"}\NormalTok{)}
\CommentTok{\# if you don\textquotesingle{}t have the reprores package, use:}
\CommentTok{\# pets \textless{}{-} read\_csv("https://psyteachr.github.io/reprores/data/pets.csv", col\_types = "cffiid")}
\FunctionTok{glimpse}\NormalTok{(pets)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Rows: 800
## Columns: 6
## $ id      <chr> "S001", "S002", "S003", "S004", "S005", "S006", "S007", "S008"~
## $ pet     <fct> dog, dog, dog, dog, dog, dog, dog, dog, dog, dog, dog, dog, do~
## $ country <fct> UK, UK, UK, UK, UK, UK, UK, UK, UK, UK, UK, UK, UK, UK, UK, UK~
## $ score   <int> 90, 107, 94, 120, 111, 110, 100, 107, 106, 109, 85, 110, 102, ~
## $ age     <int> 6, 8, 2, 10, 4, 8, 9, 8, 6, 11, 5, 9, 1, 10, 7, 8, 1, 8, 5, 13~
## $ weight  <dbl> 19.78932, 20.01422, 19.14863, 19.56953, 21.39259, 21.31880, 19~
\end{verbatim}

\begin{try}

Before you read ahead, come up with an example of each type of variable combination and sketch the types of graphs that would best display these data.

\begin{itemize}
\tightlist
\item
  1 categorical
\item
  1 continuous
\item
  2 categorical
\item
  2 continuous
\item
  1 categorical, 1 continuous
\item
  3 continuous
\end{itemize}

\end{try}

\hypertarget{basic-plots}{%
\section{Basic Plots}\label{basic-plots}}

R has some basic plotting functions, but they're difficult to use and aesthetically not very nice. They can be useful to have a quick look at data while you're working on a script, though. The function \texttt{plot()} usually defaults to a sensible type of plot, depending on whether the arguments \texttt{x} and \texttt{y} are categorical, continuous, or missing.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{plot}\NormalTok{(}\AttributeTok{x =}\NormalTok{ pets}\SpecialCharTok{$}\NormalTok{pet)}
\end{Highlighting}
\end{Shaded}

\begin{figure}

{\centering \includegraphics[width=1\linewidth]{03-ggplot_files/figure-latex/plot0-1} 

}

\caption{plot() with categorical x}\label{fig:plot0}
\end{figure}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{plot}\NormalTok{(}\AttributeTok{x =}\NormalTok{ pets}\SpecialCharTok{$}\NormalTok{pet, }\AttributeTok{y =}\NormalTok{ pets}\SpecialCharTok{$}\NormalTok{score)}
\end{Highlighting}
\end{Shaded}

\begin{figure}

{\centering \includegraphics[width=1\linewidth]{03-ggplot_files/figure-latex/plot1-1} 

}

\caption{plot() with categorical x and continuous y}\label{fig:plot1}
\end{figure}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{plot}\NormalTok{(}\AttributeTok{x =}\NormalTok{ pets}\SpecialCharTok{$}\NormalTok{age, }\AttributeTok{y =}\NormalTok{ pets}\SpecialCharTok{$}\NormalTok{weight)}
\end{Highlighting}
\end{Shaded}

\begin{figure}

{\centering \includegraphics[width=1\linewidth]{03-ggplot_files/figure-latex/plot2-1} 

}

\caption{plot() with continuous x and y}\label{fig:plot2}
\end{figure}

The function \texttt{hist()} creates a quick histogram so you can see the distribution of your data. You can adjust how many columns are plotted with the argument \texttt{breaks}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{hist}\NormalTok{(pets}\SpecialCharTok{$}\NormalTok{score, }\AttributeTok{breaks =} \DecValTok{20}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{figure}

{\centering \includegraphics[width=1\linewidth]{03-ggplot_files/figure-latex/hist-1} 

}

\caption{hist()}\label{fig:hist}
\end{figure}

\hypertarget{ggplots}{%
\section{GGplots}\label{ggplots}}

While the functions above are nice for quick visualisations, it's hard to make pretty, publication-ready plots. The package \texttt{ggplot2} (loaded with \texttt{tidyverse}) is one of the most common packages for creating beautiful visualisations.

\texttt{ggplot2} creates plots using a ``grammar of graphics'' where you add geoms in layers. It can be complex to understand, but it's very powerful once you have a mental model of how it works.

Let's start with a totally empty plot layer created by the \texttt{ggplot()} function with no arguments.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{figure}

{\centering \includegraphics[width=1\linewidth]{03-ggplot_files/figure-latex/ggplot-empty-1} 

}

\caption{A plot base created by ggplot()}\label{fig:ggplot-empty}
\end{figure}

The first argument to \texttt{ggplot()} is the \texttt{data} table you want to plot. Let's use the \texttt{pets} data we loaded above. The second argument is the \texttt{mapping} for which columns in your data table correspond to which properties of the plot, such as the \texttt{x}-axis, the \texttt{y}-axis, line \texttt{colour} or \texttt{linetype}, point \texttt{shape}, or object \texttt{fill}. These mappings are specified by the \texttt{aes()} function. Just adding this to the \texttt{ggplot} function creates the labels and ranges for the \texttt{x} and \texttt{y} axes. They usually have sensible default values, given your data, but we'll learn how to change them later.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mapping }\OtherTok{\textless{}{-}} \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ pet, }
               \AttributeTok{y =}\NormalTok{ score, }
               \AttributeTok{colour =}\NormalTok{ country, }
               \AttributeTok{fill =}\NormalTok{ country)}
\FunctionTok{ggplot}\NormalTok{(}\AttributeTok{data =}\NormalTok{ pets, }\AttributeTok{mapping =}\NormalTok{ mapping)}
\end{Highlighting}
\end{Shaded}

\begin{figure}

{\centering \includegraphics[width=1\linewidth]{03-ggplot_files/figure-latex/ggplot-labels-1} 

}

\caption{Empty ggplot with x and y labels}\label{fig:ggplot-labels}
\end{figure}

\begin{info}
People usually omit the argument names and just put the \texttt{aes()} function directly as the second argument to \texttt{ggplot}. They also usually omit \texttt{x} and \texttt{y} as argument names to \texttt{aes()} (but you have to name the other properties).

\end{info}

Next we can add ``geoms'', or plot styles. You literally add them with the \texttt{+} symbol. You can also add other plot attributes, such as labels, or change the theme and base font size.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(pets, }\FunctionTok{aes}\NormalTok{(pet, score, }\AttributeTok{colour =}\NormalTok{ country, }\AttributeTok{fill =}\NormalTok{ country)) }\SpecialCharTok{+}
  \FunctionTok{geom\_violin}\NormalTok{(}\AttributeTok{alpha =} \FloatTok{0.5}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{labs}\NormalTok{(}\AttributeTok{x =} \StringTok{"Pet type"}\NormalTok{,}
       \AttributeTok{y =} \StringTok{"Score on an Important Test"}\NormalTok{,}
       \AttributeTok{colour =} \StringTok{"Country of Origin"}\NormalTok{,}
       \AttributeTok{fill =} \StringTok{"Country of Origin"}\NormalTok{,}
       \AttributeTok{title =} \StringTok{"My first plot!"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{(}\AttributeTok{base\_size =} \DecValTok{15}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{figure}

{\centering \includegraphics[width=1\linewidth]{03-ggplot_files/figure-latex/ggplot-geom-1} 

}

\caption{Violin plot with country represented by colour.}\label{fig:ggplot-geom}
\end{figure}

\hypertarget{common-plot-types}{%
\section{Common Plot Types}\label{common-plot-types}}

There are many geoms, and they can take different arguments to customise their appearance. We'll learn about some of the most common below.

\hypertarget{geom_bar}{%
\subsection{Bar plot}\label{geom_bar}}

Bar plots are good for categorical data where you want to represent the count.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(pets, }\FunctionTok{aes}\NormalTok{(pet)) }\SpecialCharTok{+}
  \FunctionTok{geom\_bar}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{figure}

{\centering \includegraphics[width=1\linewidth]{03-ggplot_files/figure-latex/barplot-1} 

}

\caption{Bar plot}\label{fig:barplot}
\end{figure}

\hypertarget{geom_density}{%
\subsection{Density plot}\label{geom_density}}

Density plots are good for one continuous variable, but only if you have a fairly large number of observations.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(pets, }\FunctionTok{aes}\NormalTok{(score)) }\SpecialCharTok{+}
  \FunctionTok{geom\_density}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{figure}

{\centering \includegraphics[width=1\linewidth]{03-ggplot_files/figure-latex/density-1} 

}

\caption{Density plot}\label{fig:density}
\end{figure}

You can represent subsets of a variable by assigning the category variable to the argument \texttt{group}, \texttt{fill}, or \texttt{color}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(pets, }\FunctionTok{aes}\NormalTok{(score, }\AttributeTok{fill =}\NormalTok{ pet)) }\SpecialCharTok{+}
  \FunctionTok{geom\_density}\NormalTok{(}\AttributeTok{alpha =} \FloatTok{0.5}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{figure}

{\centering \includegraphics[width=1\linewidth]{03-ggplot_files/figure-latex/density-grouped-1} 

}

\caption{Grouped density plot}\label{fig:density-grouped}
\end{figure}

\begin{try}
Try changing the \texttt{alpha} argument to figure out what it does.

\end{try}

\hypertarget{geom_freqpoly}{%
\subsection{Frequency polygons}\label{geom_freqpoly}}

If you want the y-axis to represent count rather than density, try \texttt{geom\_freqpoly()}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(pets, }\FunctionTok{aes}\NormalTok{(score, }\AttributeTok{color =}\NormalTok{ pet)) }\SpecialCharTok{+}
  \FunctionTok{geom\_freqpoly}\NormalTok{(}\AttributeTok{binwidth =} \DecValTok{5}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{figure}

{\centering \includegraphics[width=1\linewidth]{03-ggplot_files/figure-latex/freqpoly-1} 

}

\caption{Frequency ploygon plot}\label{fig:freqpoly}
\end{figure}

\begin{try}
Try changing the \texttt{binwidth} argument to 10 and 1. How do you figure out the right value?

\end{try}

\hypertarget{geom_histogram}{%
\subsection{Histogram}\label{geom_histogram}}

Histograms are also good for one continuous variable, and work well if you don't have many observations. Set the \texttt{binwidth} to control how wide each bar is.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(pets, }\FunctionTok{aes}\NormalTok{(score)) }\SpecialCharTok{+}
  \FunctionTok{geom\_histogram}\NormalTok{(}\AttributeTok{binwidth =} \DecValTok{5}\NormalTok{, }\AttributeTok{fill =} \StringTok{"white"}\NormalTok{, }\AttributeTok{color =} \StringTok{"black"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{figure}

{\centering \includegraphics[width=1\linewidth]{03-ggplot_files/figure-latex/histogram-1} 

}

\caption{Histogram}\label{fig:histogram}
\end{figure}

\begin{info}
Histograms in ggplot look pretty bad unless you set the \texttt{fill} and \texttt{color}.

\end{info}

If you show grouped histograms, you also probably want to change the default \texttt{position} argument.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(pets, }\FunctionTok{aes}\NormalTok{(score, }\AttributeTok{fill=}\NormalTok{pet)) }\SpecialCharTok{+}
  \FunctionTok{geom\_histogram}\NormalTok{(}\AttributeTok{binwidth =} \DecValTok{5}\NormalTok{, }\AttributeTok{alpha =} \FloatTok{0.5}\NormalTok{, }
                 \AttributeTok{position =} \StringTok{"dodge"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{figure}

{\centering \includegraphics[width=1\linewidth]{03-ggplot_files/figure-latex/histogram-grouped-1} 

}

\caption{Grouped Histogram}\label{fig:histogram-grouped}
\end{figure}

\begin{try}
Try changing the \texttt{position} argument to ``identity'', ``fill'', ``dodge'', or ``stack''.

\end{try}

\hypertarget{geom_col}{%
\subsection{Column plot}\label{geom_col}}

Column plots are the worst way to represent grouped continuous data, but also one of the most common. If your data are already aggregated (e.g., you have rows for each group with columns for the mean and standard error), you can use \texttt{geom\_bar} or \texttt{geom\_col} and \texttt{geom\_errorbar} directly. If not, you can use the function \texttt{stat\_summary} to calculate the mean and standard error and send those numbers to the appropriate geom for plotting.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(pets, }\FunctionTok{aes}\NormalTok{(pet, score, }\AttributeTok{fill=}\NormalTok{pet)) }\SpecialCharTok{+}
  \FunctionTok{stat\_summary}\NormalTok{(}\AttributeTok{fun =}\NormalTok{ mean, }\AttributeTok{geom =} \StringTok{"col"}\NormalTok{, }\AttributeTok{alpha =} \FloatTok{0.5}\NormalTok{) }\SpecialCharTok{+} 
  \FunctionTok{stat\_summary}\NormalTok{(}\AttributeTok{fun.data =}\NormalTok{ mean\_se, }\AttributeTok{geom =} \StringTok{"errorbar"}\NormalTok{,}
               \AttributeTok{width =} \FloatTok{0.25}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{coord\_cartesian}\NormalTok{(}\AttributeTok{ylim =} \FunctionTok{c}\NormalTok{(}\DecValTok{80}\NormalTok{, }\DecValTok{120}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{figure}

{\centering \includegraphics[width=1\linewidth]{03-ggplot_files/figure-latex/colplot-statsum-1} 

}

\caption{Column plot}\label{fig:colplot-statsum}
\end{figure}

\begin{try}
Try changing the values for \texttt{coord\_cartesian}. What does this do?

\end{try}

\hypertarget{geom_boxplot}{%
\subsection{Boxplot}\label{geom_boxplot}}

Boxplots are great for representing the distribution of grouped continuous variables. They fix most of the problems with using bar/column plots for continuous data.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(pets, }\FunctionTok{aes}\NormalTok{(pet, score, }\AttributeTok{fill=}\NormalTok{pet)) }\SpecialCharTok{+}
  \FunctionTok{geom\_boxplot}\NormalTok{(}\AttributeTok{alpha =} \FloatTok{0.5}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{figure}

{\centering \includegraphics[width=1\linewidth]{03-ggplot_files/figure-latex/boxplot-1} 

}

\caption{Box plot}\label{fig:boxplot}
\end{figure}

\hypertarget{geom_violin}{%
\subsection{Violin plot}\label{geom_violin}}

Violin pots are like sideways, mirrored density plots. They give even more information than a boxplot about distribution and are especially useful when you have non-normal distributions.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(pets, }\FunctionTok{aes}\NormalTok{(pet, score, }\AttributeTok{fill=}\NormalTok{pet)) }\SpecialCharTok{+}
  \FunctionTok{geom\_violin}\NormalTok{(}\AttributeTok{draw\_quantiles =}\NormalTok{ .}\DecValTok{5}\NormalTok{,}
              \AttributeTok{trim =} \ConstantTok{FALSE}\NormalTok{, }\AttributeTok{alpha =} \FloatTok{0.5}\NormalTok{,)}
\end{Highlighting}
\end{Shaded}

\begin{figure}

{\centering \includegraphics[width=1\linewidth]{03-ggplot_files/figure-latex/violin-1} 

}

\caption{Violin plot}\label{fig:violin}
\end{figure}

\begin{try}
Try changing the \texttt{quantile} argument. Set it to a vector of the numbers 0.1 to 0.9 in steps of 0.1.

\end{try}

\hypertarget{vertical_intervals}{%
\subsection{Vertical intervals}\label{vertical_intervals}}

Boxplots and violin plots don't always map well onto inferential stats that use the mean. You can represent the mean and standard error or any other value you can calculate.

Here, we will create a table with the means and standard errors for two groups. We'll learn how to calculate this from raw data in the chapter on \protect\hyperlink{dplyr}{data wrangling}. We also create a new object called \texttt{gg} that sets up the base of the plot.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dat }\OtherTok{\textless{}{-}} \FunctionTok{tibble}\NormalTok{(}
  \AttributeTok{group =} \FunctionTok{c}\NormalTok{(}\StringTok{"A"}\NormalTok{, }\StringTok{"B"}\NormalTok{),}
  \AttributeTok{mean =} \FunctionTok{c}\NormalTok{(}\DecValTok{10}\NormalTok{, }\DecValTok{20}\NormalTok{),}
  \AttributeTok{se =} \FunctionTok{c}\NormalTok{(}\DecValTok{2}\NormalTok{, }\DecValTok{3}\NormalTok{)}
\NormalTok{)}
\NormalTok{gg }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{(dat, }\FunctionTok{aes}\NormalTok{(group, mean, }
                      \AttributeTok{ymin =}\NormalTok{ mean}\SpecialCharTok{{-}}\NormalTok{se, }
                      \AttributeTok{ymax =}\NormalTok{ mean}\SpecialCharTok{+}\NormalTok{se))}
\end{Highlighting}
\end{Shaded}

The trick above can be useful if you want to represent the same data in different ways. You can add different geoms to the base plot without having to re-type the base plot code.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{gg }\SpecialCharTok{+} \FunctionTok{geom\_crossbar}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{figure}

{\centering \includegraphics[width=1\linewidth]{03-ggplot_files/figure-latex/geom-crossbar-1} 

}

\caption{geom_crossbar()}\label{fig:geom-crossbar}
\end{figure}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{gg }\SpecialCharTok{+} \FunctionTok{geom\_errorbar}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{figure}

{\centering \includegraphics[width=1\linewidth]{03-ggplot_files/figure-latex/geom-errorbar-1} 

}

\caption{geom_errorbar()}\label{fig:geom-errorbar}
\end{figure}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{gg }\SpecialCharTok{+} \FunctionTok{geom\_linerange}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{figure}

{\centering \includegraphics[width=1\linewidth]{03-ggplot_files/figure-latex/geom-linerange-1} 

}

\caption{geom_linerange()}\label{fig:geom-linerange}
\end{figure}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{gg }\SpecialCharTok{+} \FunctionTok{geom\_pointrange}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{figure}

{\centering \includegraphics[width=1\linewidth]{03-ggplot_files/figure-latex/geom-pointrange-1} 

}

\caption{geom_pointrange()}\label{fig:geom-pointrange}
\end{figure}

You can also use the function \texttt{stats\_summary} to calculate mean, standard error, or any other value for your data and display it using any geom.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(pets, }\FunctionTok{aes}\NormalTok{(pet, score, }\AttributeTok{color=}\NormalTok{pet)) }\SpecialCharTok{+}
  \FunctionTok{stat\_summary}\NormalTok{(}\AttributeTok{fun.data =}\NormalTok{ mean\_se, }\AttributeTok{geom =} \StringTok{"crossbar"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{stat\_summary}\NormalTok{(}\AttributeTok{fun.min =} \ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{mean}\NormalTok{(x) }\SpecialCharTok{{-}} \FunctionTok{sd}\NormalTok{(x),}
               \AttributeTok{fun.max =} \ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{mean}\NormalTok{(x) }\SpecialCharTok{+} \FunctionTok{sd}\NormalTok{(x),}
               \AttributeTok{geom =} \StringTok{"errorbar"}\NormalTok{, }\AttributeTok{width =} \DecValTok{0}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}\AttributeTok{legend.position =} \StringTok{"none"}\NormalTok{) }\CommentTok{\# gets rid of the legend}
\end{Highlighting}
\end{Shaded}

\begin{figure}

{\centering \includegraphics[width=1\linewidth]{03-ggplot_files/figure-latex/vertint-statssum-1} 

}

\caption{Vertical intervals with stats_summary()}\label{fig:vertint-statssum}
\end{figure}

\hypertarget{geom_point}{%
\subsection{Scatter plot}\label{geom_point}}

Scatter plots are a good way to represent the relationship between two continuous variables.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(pets, }\FunctionTok{aes}\NormalTok{(age, score, }\AttributeTok{color =}\NormalTok{ pet)) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{figure}

{\centering \includegraphics[width=1\linewidth]{03-ggplot_files/figure-latex/scatter-1} 

}

\caption{Scatter plot using geom_point()}\label{fig:scatter}
\end{figure}

\hypertarget{geom_smooth}{%
\subsection{Line graph}\label{geom_smooth}}

You often want to represent the relationship as a single line.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(pets, }\FunctionTok{aes}\NormalTok{(age, score, }\AttributeTok{color =}\NormalTok{ pet)) }\SpecialCharTok{+}
  \FunctionTok{geom\_smooth}\NormalTok{(}\AttributeTok{formula =}\NormalTok{ y }\SpecialCharTok{\textasciitilde{}}\NormalTok{ x, }\AttributeTok{method=}\StringTok{"lm"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{figure}

{\centering \includegraphics[width=1\linewidth]{03-ggplot_files/figure-latex/smooth-1} 

}

\caption{Line plot using geom_smooth()}\label{fig:smooth}
\end{figure}

\begin{try}
What are some other options for the \texttt{method} argument to \texttt{geom\_smooth}? When might you want to use them?

\end{try}

\begin{info}

You can plot functions other than the linear \texttt{y\ \textasciitilde{}\ x}. The code below creates a data table where \texttt{x} is 101 values between -10 and 10. and \texttt{y} is \texttt{x} squared plus \texttt{3*x} plus \texttt{1}. You'll probably recognise this from algebra as the quadratic equation. You can set the \texttt{formula} argument in \texttt{geom\_smooth} to a quadratic formula (\texttt{y\ \textasciitilde{}\ x\ +\ I(x\^{}2)}) to fit a quadratic function to the data.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{quad }\OtherTok{\textless{}{-}} \FunctionTok{tibble}\NormalTok{(}
  \AttributeTok{x =} \FunctionTok{seq}\NormalTok{(}\SpecialCharTok{{-}}\DecValTok{10}\NormalTok{, }\DecValTok{10}\NormalTok{, }\AttributeTok{length.out =} \DecValTok{101}\NormalTok{),}
  \AttributeTok{y =}\NormalTok{ x}\SpecialCharTok{\^{}}\DecValTok{2} \SpecialCharTok{+} \DecValTok{3}\SpecialCharTok{*}\NormalTok{x }\SpecialCharTok{+} \DecValTok{1}
\NormalTok{)}

\FunctionTok{ggplot}\NormalTok{(quad, }\FunctionTok{aes}\NormalTok{(x, y)) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{geom\_smooth}\NormalTok{(}\AttributeTok{formula =}\NormalTok{ y }\SpecialCharTok{\textasciitilde{}}\NormalTok{ x }\SpecialCharTok{+} \FunctionTok{I}\NormalTok{(x}\SpecialCharTok{\^{}}\DecValTok{2}\NormalTok{), }
              \AttributeTok{method=}\StringTok{"lm"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{figure}

{\centering \includegraphics[width=1\linewidth]{03-ggplot_files/figure-latex/quadratic-1} 

}

\caption{Fitting quadratic functions}\label{fig:quadratic}
\end{figure}

\end{info}

\hypertarget{customisation}{%
\section{Customisation}\label{customisation}}

\hypertarget{custom-size}{%
\subsection{Size and Position}\label{custom-size}}

You can change the size, aspect ratio and position of plots in an R Markdown document in the setup chunk.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{knitr}\SpecialCharTok{::}\NormalTok{opts\_chunk}\SpecialCharTok{$}\FunctionTok{set}\NormalTok{(}
  \AttributeTok{fig.width  =} \DecValTok{8}\NormalTok{, }\CommentTok{\# figures default to 8 inches wide}
  \AttributeTok{fig.height =} \DecValTok{5}\NormalTok{, }\CommentTok{\# figures default to 5 inches tall}
  \AttributeTok{fig.path   =} \StringTok{\textquotesingle{}images/\textquotesingle{}}\NormalTok{, }\CommentTok{\# figures saved in images directory}
  \AttributeTok{out.width =} \StringTok{"90\%"}\NormalTok{, }\CommentTok{\# images take up 90\% of page width}
  \AttributeTok{fig.align =} \StringTok{\textquotesingle{}center\textquotesingle{}} \CommentTok{\# centre images}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

You can change defaults for any single image using chunk options.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(pets, }\FunctionTok{aes}\NormalTok{(age, score, }\AttributeTok{color =}\NormalTok{ pet)) }\SpecialCharTok{+}
  \FunctionTok{geom\_smooth}\NormalTok{(}\AttributeTok{formula =}\NormalTok{ y}\SpecialCharTok{\textasciitilde{}}\NormalTok{x, }\AttributeTok{method =}\NormalTok{ lm)}
\end{Highlighting}
\end{Shaded}

\textbackslash begin\{figure\}

\{\centering \includegraphics[width=1\linewidth]{images/fig-chunk-example1-out-1}

\}

\textbackslash caption\{10x3 inches at 100\% width centre aligned.\}\label{fig:fig-chunk-example1-out}
\textbackslash end\{figure\}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(pets, }\FunctionTok{aes}\NormalTok{(age, score, }\AttributeTok{color =}\NormalTok{ pet)) }\SpecialCharTok{+}
  \FunctionTok{geom\_smooth}\NormalTok{(}\AttributeTok{formula =}\NormalTok{ y}\SpecialCharTok{\textasciitilde{}}\NormalTok{x, }\AttributeTok{method =}\NormalTok{ lm)}
\end{Highlighting}
\end{Shaded}

\textbackslash begin\{figure\}

\includegraphics[width=0.5\linewidth]{images/fig-chunk-example2-out-1} \hfill{}

\textbackslash caption\{5x3 inches at 50\% width aligned left.\}\label{fig:fig-chunk-example2-out}
\textbackslash end\{figure\}

\hypertarget{custom-labels}{%
\subsection{Labels}\label{custom-labels}}

You can set custom titles and axis labels in a few different ways.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(pets, }\FunctionTok{aes}\NormalTok{(age, score, }\AttributeTok{color =}\NormalTok{ pet)) }\SpecialCharTok{+}
  \FunctionTok{geom\_smooth}\NormalTok{(}\AttributeTok{formula =}\NormalTok{ y }\SpecialCharTok{\textasciitilde{}}\NormalTok{ x, }\AttributeTok{method=}\StringTok{"lm"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{labs}\NormalTok{(}\AttributeTok{title =} \StringTok{"Pet Score with Age"}\NormalTok{,}
       \AttributeTok{x =} \StringTok{"Age (in Years)"}\NormalTok{,}
       \AttributeTok{y =} \StringTok{"Pet Score"}\NormalTok{,}
       \AttributeTok{color =} \StringTok{"Pet Type"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{figure}

{\centering \includegraphics[width=0.9\linewidth]{images/line-labels1-1} 

}

\caption{Set custom labels with labs()}\label{fig:line-labels1}
\end{figure}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(pets, }\FunctionTok{aes}\NormalTok{(age, score, }\AttributeTok{color =}\NormalTok{ pet)) }\SpecialCharTok{+}
  \FunctionTok{geom\_smooth}\NormalTok{(}\AttributeTok{formula =}\NormalTok{ y }\SpecialCharTok{\textasciitilde{}}\NormalTok{ x, }\AttributeTok{method=}\StringTok{"lm"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{ggtitle}\NormalTok{(}\StringTok{"Pet Score with Age"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{xlab}\NormalTok{(}\StringTok{"Age (in Years)"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{ylab}\NormalTok{(}\StringTok{"Pet Score"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{figure}

{\centering \includegraphics[width=0.9\linewidth]{images/line-labels2-1} 

}

\caption{Set custom labels with individual functions}\label{fig:line-labels2}
\end{figure}

The functions {labs}{(}{)}, {xlab}{(}{)}, and {ylab}{(}{)} are convenient when you just want to change a label name, but the \texttt{scale\_\{aesthetic\}\_\{type\}} functions are worth learning because they let you customise many things about any aesthetic property (e.g., \texttt{x}, \texttt{y}, \texttt{colour}, \texttt{fill}, \texttt{shape}, \texttt{linetype}), as long as you choose the correct type (usually \texttt{continuous} or \texttt{discrete}, but there are also special scale functions for other data types like dates).

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(pets, }\FunctionTok{aes}\NormalTok{(age, score, }\AttributeTok{color =}\NormalTok{ pet)) }\SpecialCharTok{+}
  \FunctionTok{geom\_smooth}\NormalTok{(}\AttributeTok{formula =}\NormalTok{ y }\SpecialCharTok{\textasciitilde{}}\NormalTok{ x, }\AttributeTok{method=}\StringTok{"lm"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{ggtitle}\NormalTok{(}\StringTok{"Pet Score with Age"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{scale\_x\_continuous}\NormalTok{(}\AttributeTok{name =} \StringTok{"Age (in Years)"}\NormalTok{, }
                     \AttributeTok{breaks =} \DecValTok{0}\SpecialCharTok{:}\DecValTok{16}\NormalTok{,}
                     \AttributeTok{minor\_breaks =} \ConstantTok{NULL}\NormalTok{, }
                     \AttributeTok{trans =} \StringTok{"reverse"}\NormalTok{,}
                     \AttributeTok{position =} \StringTok{"top"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{scale\_y\_continuous}\NormalTok{(}\AttributeTok{name =} \StringTok{"Pet Score"}\NormalTok{, }
                     \AttributeTok{n.breaks =} \DecValTok{16}\NormalTok{, }
                     \AttributeTok{limits =} \FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{, }\DecValTok{150}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{scale\_color\_discrete}\NormalTok{(}\AttributeTok{name =} \StringTok{"Pet Type"}\NormalTok{, }
                       \AttributeTok{labels =} \FunctionTok{c}\NormalTok{(}\StringTok{"Dogs"}\NormalTok{, }\StringTok{"Cats"}\NormalTok{, }\StringTok{"Ferrets"}\NormalTok{), }
                       \AttributeTok{type =} \FunctionTok{c}\NormalTok{(}\StringTok{"purple"}\NormalTok{, }\StringTok{"green"}\NormalTok{, }\StringTok{"orange"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{figure}

{\centering \includegraphics[width=0.9\linewidth]{images/line-labels3-1} 

}

\caption{Set custom labels with scale functions}\label{fig:line-labels3}
\end{figure}

\begin{try}
Use the help on the scale functions above to learn about the possible arguments. See what happens when you change the arguments above.

\end{try}

\hypertarget{custom-colours}{%
\subsection{Colours}\label{custom-colours}}

You can set custom values for colour and fill using the \texttt{scale\_\{aesthetic\}\_\{type\}} functions like \texttt{scale\_colour\_manual()} or \texttt{scale\_fill\_manual()}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(pets, }\FunctionTok{aes}\NormalTok{(pet, score, }\AttributeTok{colour =}\NormalTok{ pet, }\AttributeTok{fill =}\NormalTok{ pet)) }\SpecialCharTok{+}
  \FunctionTok{geom\_violin}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{scale\_color\_manual}\NormalTok{(}\AttributeTok{values =} \FunctionTok{c}\NormalTok{(}\StringTok{"darkgreen"}\NormalTok{, }\StringTok{"dodgerblue"}\NormalTok{, }\StringTok{"orange"}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{scale\_fill\_manual}\NormalTok{(}\AttributeTok{values =} \FunctionTok{c}\NormalTok{(}\StringTok{"\#CCFFCC"}\NormalTok{, }\StringTok{"\#BBDDFF"}\NormalTok{, }\StringTok{"\#FFCC66"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{figure}

{\centering \includegraphics[width=0.9\linewidth]{images/line-labels-1} 

}

\caption{Set custom colour}\label{fig:line-labels}
\end{figure}

The \href{http://www.cookbook-r.com/Graphs/Colors_(ggplot2)/}{Colours chapter in Cookbook for R} has many more ways to customise colour.

\hypertarget{themes}{%
\subsection{Themes}\label{themes}}

GGplot comes with several additional themes and the ability to fully customise your theme. Type \texttt{?theme} into the console to see the full list. Other packages such as \texttt{cowplot} also have custom themes. You can add a custom theme to the end of your ggplot object and specify a new \texttt{base\_size} to make the default fonts and lines larger or smaller.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(pets, }\FunctionTok{aes}\NormalTok{(age, score, }\AttributeTok{color =}\NormalTok{ pet)) }\SpecialCharTok{+}
  \FunctionTok{geom\_smooth}\NormalTok{(}\AttributeTok{formula =}\NormalTok{ y }\SpecialCharTok{\textasciitilde{}}\NormalTok{ x, }\AttributeTok{method=}\StringTok{"lm"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{theme\_minimal}\NormalTok{(}\AttributeTok{base\_size =} \DecValTok{18}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{figure}

{\centering \includegraphics[width=0.9\linewidth]{images/themes-1} 

}

\caption{Minimal theme with 18-point base font size}\label{fig:themes}
\end{figure}

It's more complicated, but you can fully customise your theme with \texttt{theme()}. You can save this to an object and add it to the end of all of your plots to make the style consistent. Alternatively, you can set the theme at the top of a script with \texttt{theme\_set()} and this will apply to all subsequent ggplot plots.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# always start with a base theme that is closest to your desired theme}
\NormalTok{vampire\_theme }\OtherTok{\textless{}{-}} \FunctionTok{theme\_dark}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}
    \AttributeTok{rect =} \FunctionTok{element\_rect}\NormalTok{(}\AttributeTok{fill =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{panel.background =} \FunctionTok{element\_rect}\NormalTok{(}\AttributeTok{fill =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{text =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{size =} \DecValTok{20}\NormalTok{, }\AttributeTok{colour =} \StringTok{"white"}\NormalTok{),}
    \AttributeTok{axis.text =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{size =} \DecValTok{16}\NormalTok{, }\AttributeTok{colour =} \StringTok{"grey70"}\NormalTok{),}
    \AttributeTok{line =} \FunctionTok{element\_line}\NormalTok{(}\AttributeTok{colour =} \StringTok{"white"}\NormalTok{, }\AttributeTok{size =} \DecValTok{2}\NormalTok{),}
    \AttributeTok{panel.grid =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{axis.line =} \FunctionTok{element\_line}\NormalTok{(}\AttributeTok{colour =} \StringTok{"white"}\NormalTok{),}
    \AttributeTok{axis.ticks =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{legend.position =} \StringTok{"top"}
\NormalTok{  )}

\FunctionTok{theme\_set}\NormalTok{(vampire\_theme)}

\FunctionTok{ggplot}\NormalTok{(pets, }\FunctionTok{aes}\NormalTok{(age, score, }\AttributeTok{color =}\NormalTok{ pet)) }\SpecialCharTok{+}
  \FunctionTok{geom\_smooth}\NormalTok{(}\AttributeTok{formula =}\NormalTok{ y }\SpecialCharTok{\textasciitilde{}}\NormalTok{ x, }\AttributeTok{method=}\StringTok{"lm"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{figure}

{\centering \includegraphics[width=0.9\linewidth]{images/custom-themes-1} 

}

\caption{Custom theme}\label{fig:custom-themes}
\end{figure}

\hypertarget{ggsave}{%
\subsection{Save as file}\label{ggsave}}

You can save a ggplot using \texttt{ggsave()}. It saves the last ggplot you made, by default, but you can specify which plot you want to save if you assigned that plot to a variable.

You can set the \texttt{width} and \texttt{height} of your plot. The default units are inches, but you can change the \texttt{units} argument to ``in'', ``cm'', or ``mm''.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{box }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{(pets, }\FunctionTok{aes}\NormalTok{(pet, score, }\AttributeTok{fill=}\NormalTok{pet)) }\SpecialCharTok{+}
  \FunctionTok{geom\_boxplot}\NormalTok{(}\AttributeTok{alpha =} \FloatTok{0.5}\NormalTok{)}

\NormalTok{violin }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{(pets, }\FunctionTok{aes}\NormalTok{(pet, score, }\AttributeTok{fill=}\NormalTok{pet)) }\SpecialCharTok{+}
  \FunctionTok{geom\_violin}\NormalTok{(}\AttributeTok{alpha =} \FloatTok{0.5}\NormalTok{)}

\FunctionTok{ggsave}\NormalTok{(}\StringTok{"demog\_violin\_plot.png"}\NormalTok{, }\AttributeTok{width =} \DecValTok{5}\NormalTok{, }\AttributeTok{height =} \DecValTok{7}\NormalTok{)}

\FunctionTok{ggsave}\NormalTok{(}\StringTok{"demog\_box\_plot.jpg"}\NormalTok{, }\AttributeTok{plot =}\NormalTok{ box, }\AttributeTok{width =} \DecValTok{5}\NormalTok{, }\AttributeTok{height =} \DecValTok{7}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{info}
The file type is set from the filename suffix, or by
specifying the argument \texttt{device}, which can take the following values:
``eps'', ``ps'', ``tex'', ``pdf'', ``jpeg'', ``tiff'', ``png'', ``bmp'', ``svg'' or ``wmf''.

\end{info}

\hypertarget{combo_plots}{%
\section{Combination Plots}\label{combo_plots}}

\hypertarget{violinbox-plot}{%
\subsection{Violinbox plot}\label{violinbox-plot}}

A combination of a violin plot to show the shape of the distribution and a boxplot to show the median and interquartile ranges can be a very useful visualisation.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(pets, }\FunctionTok{aes}\NormalTok{(pet, score, }\AttributeTok{fill =}\NormalTok{ pet)) }\SpecialCharTok{+}
  \FunctionTok{geom\_violin}\NormalTok{(}\AttributeTok{show.legend =} \ConstantTok{FALSE}\NormalTok{) }\SpecialCharTok{+} 
  \FunctionTok{geom\_boxplot}\NormalTok{(}\AttributeTok{width =} \FloatTok{0.2}\NormalTok{, }\AttributeTok{fill =} \StringTok{"white"}\NormalTok{, }
               \AttributeTok{show.legend =} \ConstantTok{FALSE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{figure}

{\centering \includegraphics[width=0.9\linewidth]{images/violinbox-1} 

}

\caption{Violin-box plot}\label{fig:violinbox}
\end{figure}

\begin{info}
Set the \texttt{show.legend} argument to \texttt{FALSE} to hide the legend. We do this here because the x-axis already labels the pet types.

\end{info}

\hypertarget{violin-point-range-plot}{%
\subsection{Violin-point-range plot}\label{violin-point-range-plot}}

You can use \texttt{stat\_summary()} to superimpose a point-range plot showing the mean ± 1 SD. You'll learn how to write your own functions in the lesson on \protect\hyperlink{func}{Iteration and Functions}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(pets, }\FunctionTok{aes}\NormalTok{(pet, score, }\AttributeTok{fill=}\NormalTok{pet)) }\SpecialCharTok{+}
  \FunctionTok{geom\_violin}\NormalTok{(}\AttributeTok{trim =} \ConstantTok{FALSE}\NormalTok{, }\AttributeTok{alpha =} \FloatTok{0.5}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{stat\_summary}\NormalTok{(}
    \AttributeTok{fun =}\NormalTok{ mean,}
    \AttributeTok{fun.max =} \ControlFlowTok{function}\NormalTok{(x) \{}\FunctionTok{mean}\NormalTok{(x) }\SpecialCharTok{+} \FunctionTok{sd}\NormalTok{(x)\},}
    \AttributeTok{fun.min =} \ControlFlowTok{function}\NormalTok{(x) \{}\FunctionTok{mean}\NormalTok{(x) }\SpecialCharTok{{-}} \FunctionTok{sd}\NormalTok{(x)\},}
    \AttributeTok{geom=}\StringTok{"pointrange"}
\NormalTok{  )}
\end{Highlighting}
\end{Shaded}

\begin{figure}

{\centering \includegraphics[width=0.9\linewidth]{images/stat-summary-1} 

}

\caption{Point-range plot using stat_summary()}\label{fig:stat-summary}
\end{figure}

\hypertarget{violin-jitter-plot}{%
\subsection{Violin-jitter plot}\label{violin-jitter-plot}}

If you don't have a lot of data points, it's good to represent them individually. You can use \texttt{geom\_jitter} to do this.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# sample\_n chooses 50 random observations from the dataset}
\FunctionTok{ggplot}\NormalTok{(}\FunctionTok{sample\_n}\NormalTok{(pets, }\DecValTok{50}\NormalTok{), }\FunctionTok{aes}\NormalTok{(pet, score, }\AttributeTok{fill=}\NormalTok{pet)) }\SpecialCharTok{+}
  \FunctionTok{geom\_violin}\NormalTok{(}
    \AttributeTok{trim =} \ConstantTok{FALSE}\NormalTok{,}
    \AttributeTok{draw\_quantiles =} \FunctionTok{c}\NormalTok{(}\FloatTok{0.25}\NormalTok{, }\FloatTok{0.5}\NormalTok{, }\FloatTok{0.75}\NormalTok{), }
    \AttributeTok{alpha =} \FloatTok{0.5}
\NormalTok{  ) }\SpecialCharTok{+} 
  \FunctionTok{geom\_jitter}\NormalTok{(}
    \AttributeTok{width =} \FloatTok{0.15}\NormalTok{, }\CommentTok{\# points spread out over 15\% of available width}
    \AttributeTok{height =} \DecValTok{0}\NormalTok{, }\CommentTok{\# do not move position on the y{-}axis}
    \AttributeTok{alpha =} \FloatTok{0.5}\NormalTok{, }
    \AttributeTok{size =} \DecValTok{3}
\NormalTok{  )}
\end{Highlighting}
\end{Shaded}

\begin{figure}

{\centering \includegraphics[width=0.9\linewidth]{images/violin-jitter-1} 

}

\caption{Violin-jitter plot}\label{fig:violin-jitter}
\end{figure}

\hypertarget{scatter-line-graph}{%
\subsection{Scatter-line graph}\label{scatter-line-graph}}

If your graph isn't too complicated, it's good to also show the individual data points behind the line.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(}\FunctionTok{sample\_n}\NormalTok{(pets, }\DecValTok{50}\NormalTok{), }\FunctionTok{aes}\NormalTok{(age, weight, }\AttributeTok{colour =}\NormalTok{ pet)) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{geom\_smooth}\NormalTok{(}\AttributeTok{formula =}\NormalTok{ y }\SpecialCharTok{\textasciitilde{}}\NormalTok{ x, }\AttributeTok{method=}\StringTok{"lm"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{figure}

{\centering \includegraphics[width=0.9\linewidth]{images/scatter-line-1} 

}

\caption{Scatter-line plot}\label{fig:scatter-line}
\end{figure}

\hypertarget{plot_grid}{%
\subsection{Grid of plots}\label{plot_grid}}

You can use the \href{https://patchwork.data-imaginist.com/}{\texttt{patchwork}} package to easily make grids of different graphs. First, you have to assign each plot a name.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{gg }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{(pets, }\FunctionTok{aes}\NormalTok{(pet, score, }\AttributeTok{colour =}\NormalTok{ pet))}
\NormalTok{nolegend }\OtherTok{\textless{}{-}} \FunctionTok{theme}\NormalTok{(}\AttributeTok{legend.position =} \DecValTok{0}\NormalTok{)}

\NormalTok{vp }\OtherTok{\textless{}{-}}\NormalTok{ gg }\SpecialCharTok{+} \FunctionTok{geom\_violin}\NormalTok{(}\AttributeTok{alpha =} \FloatTok{0.5}\NormalTok{) }\SpecialCharTok{+}\NormalTok{ nolegend }\SpecialCharTok{+}
  \FunctionTok{ggtitle}\NormalTok{(}\StringTok{"Violin Plot"}\NormalTok{)}
\NormalTok{bp }\OtherTok{\textless{}{-}}\NormalTok{ gg }\SpecialCharTok{+} \FunctionTok{geom\_boxplot}\NormalTok{(}\AttributeTok{alpha =} \FloatTok{0.5}\NormalTok{) }\SpecialCharTok{+}\NormalTok{ nolegend }\SpecialCharTok{+}
  \FunctionTok{ggtitle}\NormalTok{(}\StringTok{"Box Plot"}\NormalTok{)}
\NormalTok{cp }\OtherTok{\textless{}{-}}\NormalTok{ gg }\SpecialCharTok{+} \FunctionTok{stat\_summary}\NormalTok{(}\AttributeTok{fun =}\NormalTok{ mean, }\AttributeTok{geom =} \StringTok{"col"}\NormalTok{, }\AttributeTok{fill =} \StringTok{"white"}\NormalTok{) }\SpecialCharTok{+}\NormalTok{ nolegend }\SpecialCharTok{+}
  \FunctionTok{ggtitle}\NormalTok{(}\StringTok{"Column Plot"}\NormalTok{)}
\NormalTok{dp }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{(pets, }\FunctionTok{aes}\NormalTok{(score, }\AttributeTok{colour =}\NormalTok{ pet)) }\SpecialCharTok{+} 
  \FunctionTok{geom\_density}\NormalTok{() }\SpecialCharTok{+}\NormalTok{ nolegend }\SpecialCharTok{+}
  \FunctionTok{ggtitle}\NormalTok{(}\StringTok{"Density Plot"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Then you add all the plots together.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{vp }\SpecialCharTok{+}\NormalTok{ bp }\SpecialCharTok{+}\NormalTok{ cp }\SpecialCharTok{+}\NormalTok{ dp}
\end{Highlighting}
\end{Shaded}

\begin{figure}

{\centering \includegraphics[width=0.9\linewidth]{images/patchwork-add-1} 

}

\caption{Default grid of plots}\label{fig:patchwork-add}
\end{figure}

You can use \texttt{+}, \texttt{\textbar{}}, \texttt{/}, and parentheses to customise your layout.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(vp }\SpecialCharTok{|}\NormalTok{ bp }\SpecialCharTok{|}\NormalTok{ cp) }\SpecialCharTok{/}\NormalTok{ dp}
\end{Highlighting}
\end{Shaded}

\begin{figure}

{\centering \includegraphics[width=0.9\linewidth]{images/patchwork-layout-1} 

}

\caption{Custom plot layout.}\label{fig:patchwork-layout}
\end{figure}

You can alter the plot layout to control the number and widths of plots per row or column, and add annotation.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{vp }\SpecialCharTok{+}\NormalTok{ bp }\SpecialCharTok{+}\NormalTok{ cp }\SpecialCharTok{+} 
  \FunctionTok{plot\_layout}\NormalTok{(}\AttributeTok{nrow =} \DecValTok{1}\NormalTok{, }\AttributeTok{width =} \FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{2}\NormalTok{,}\DecValTok{1}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{plot\_annotation}\NormalTok{(}\AttributeTok{title =} \StringTok{"Pet Scores"}\NormalTok{,}
                  \AttributeTok{subtitle =} \StringTok{"Three plots visualising the same data"}\NormalTok{,}
                  \AttributeTok{tag\_levels =} \StringTok{"a"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{figure}

{\centering \includegraphics[width=0.9\linewidth]{images/patchwork-annotate-1} 

}

\caption{Plot annotation.}\label{fig:patchwork-annotate}
\end{figure}

\begin{try}
Check the help for \texttt{plot\_layout()} and plot\_annotation()` to see what else you can do with them.

\end{try}

\hypertarget{overlap}{%
\section{Overlapping Discrete Data}\label{overlap}}

\hypertarget{reducing-opacity}{%
\subsection{Reducing Opacity}\label{reducing-opacity}}

You can deal with overlapping data points (very common if you're using Likert scales) by reducing the opacity of the points. You need to use trial and error to adjust these so they look right.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(pets, }\FunctionTok{aes}\NormalTok{(age, score, }\AttributeTok{colour =}\NormalTok{ pet)) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\AttributeTok{alpha =} \FloatTok{0.25}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{geom\_smooth}\NormalTok{(}\AttributeTok{formula =}\NormalTok{ y }\SpecialCharTok{\textasciitilde{}}\NormalTok{ x, }\AttributeTok{method=}\StringTok{"lm"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{figure}

{\centering \includegraphics[width=0.9\linewidth]{images/overlap-alpha-1} 

}

\caption{Deal with overlapping data using transparency}\label{fig:overlap-alpha}
\end{figure}

\hypertarget{geom_count}{%
\subsection{Proportional Dot Plots}\label{geom_count}}

Or you can set the size of the dot proportional to the number of overlapping observations using \texttt{geom\_count()}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(pets, }\FunctionTok{aes}\NormalTok{(age, score, }\AttributeTok{colour =}\NormalTok{ pet)) }\SpecialCharTok{+}
  \FunctionTok{geom\_count}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{figure}

{\centering \includegraphics[width=0.9\linewidth]{images/overlap-size-1} 

}

\caption{Deal with overlapping data using geom_count()}\label{fig:overlap-size}
\end{figure}

Alternatively, you can transform your data (we will learn to do this in the \protect\hyperlink{dplyr}{data wrangling} chapter) to create a count column and use the count to set the dot colour.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pets }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{group\_by}\NormalTok{(age, score) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{summarise}\NormalTok{(}\AttributeTok{count =} \FunctionTok{n}\NormalTok{(), }\AttributeTok{.groups =} \StringTok{"drop"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{ggplot}\NormalTok{(}\FunctionTok{aes}\NormalTok{(age, score, }\AttributeTok{color=}\NormalTok{count)) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\AttributeTok{size =} \DecValTok{2}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{scale\_color\_viridis\_c}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{figure}

{\centering \includegraphics[width=0.9\linewidth]{images/overlap-colour-1} 

}

\caption{Deal with overlapping data using dot colour}\label{fig:overlap-colour}
\end{figure}

\begin{info}
The \href{https://cran.r-project.org/web/packages/viridis/vignettes/intro-to-viridis.html}{viridis package} changes the colour themes to be easier to read by people with colourblindness and to print better in greyscale. Viridis is built into \texttt{ggplot2} since v3.0.0. It uses \texttt{scale\_colour\_viridis\_c()} and \texttt{scale\_fill\_viridis\_c()} for continuous variables and \texttt{scale\_colour\_viridis\_d()} and \texttt{scale\_fill\_viridis\_d()} for discrete variables.

\end{info}

\hypertarget{overlapping-continuous-data}{%
\section{Overlapping Continuous Data}\label{overlapping-continuous-data}}

Even if the variables are continuous, overplotting might obscure any relationships if you have lots of data.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(pets, }\FunctionTok{aes}\NormalTok{(age, score)) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{figure}

{\centering \includegraphics[width=0.9\linewidth]{images/overplot-point-1} 

}

\caption{Overplotted data}\label{fig:overplot-point}
\end{figure}

\hypertarget{geom_density2d}{%
\subsection{2D Density Plot}\label{geom_density2d}}

Use \texttt{geom\_density2d()} to create a contour map.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(pets, }\FunctionTok{aes}\NormalTok{(age, score)) }\SpecialCharTok{+}
  \FunctionTok{geom\_density2d}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{figure}

{\centering \includegraphics[width=0.9\linewidth]{images/density2d-1} 

}

\caption{Contour map with geom_density2d()}\label{fig:density2d}
\end{figure}

You can use \texttt{geom\_density2d\_filled()} to create a heatmap-style density plot.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(pets, }\FunctionTok{aes}\NormalTok{(age, score)) }\SpecialCharTok{+}
  \FunctionTok{geom\_density2d\_filled}\NormalTok{(}\AttributeTok{n =} \DecValTok{5}\NormalTok{, }\AttributeTok{h =} \DecValTok{10}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{figure}

{\centering \includegraphics[width=0.9\linewidth]{images/density2d-fill-1} 

}

\caption{Heatmap-density plot}\label{fig:density2d-fill}
\end{figure}

\begin{try}
Try \texttt{geom\_density2d\_filled(n\ =\ 5,\ h\ =\ 10)} instead. Play with different values of \texttt{n} and \texttt{h} and try to guess what they do.

\end{try}

\hypertarget{geom_bin2d}{%
\subsection{2D Histogram}\label{geom_bin2d}}

Use \texttt{geom\_bin2d()} to create a rectangular heatmap of bin counts. Set the \texttt{binwidth} to the x and y dimensions to capture in each box.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(pets, }\FunctionTok{aes}\NormalTok{(age, score)) }\SpecialCharTok{+}
  \FunctionTok{geom\_bin2d}\NormalTok{(}\AttributeTok{binwidth =} \FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{5}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{figure}

{\centering \includegraphics[width=0.9\linewidth]{images/bin2d-1} 

}

\caption{Heatmap of bin counts}\label{fig:bin2d}
\end{figure}

\hypertarget{geom_hex}{%
\subsection{Hexagonal Heatmap}\label{geom_hex}}

Use \texttt{geomhex()} to create a hexagonal heatmap of bin counts. Adjust the \texttt{binwidth}, \texttt{xlim()}, \texttt{ylim()} and/or the figure dimensions to make the hexagons more or less stretched.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(pets, }\FunctionTok{aes}\NormalTok{(age, score)) }\SpecialCharTok{+}
  \FunctionTok{geom\_hex}\NormalTok{(}\AttributeTok{binwidth =} \FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{5}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{figure}

{\centering \includegraphics[width=0.9\linewidth]{images/overplot-hex-1} 

}

\caption{Hexagonal heatmap of bin counts}\label{fig:overplot-hex}
\end{figure}

\hypertarget{geom_tile}{%
\subsection{Correlation Heatmap}\label{geom_tile}}

I've included the code for creating a correlation matrix from a table of variables, but you don't need to understand how this is done yet. We'll cover \texttt{mutate()} and \texttt{gather()} functions in the \protect\hyperlink{dplyr}{dplyr} and \protect\hyperlink{tidyr}{tidyr} lessons.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{heatmap }\OtherTok{\textless{}{-}}\NormalTok{ pets }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{select\_if}\NormalTok{(is.numeric) }\SpecialCharTok{\%\textgreater{}\%} \CommentTok{\# get just the numeric columns}
  \FunctionTok{cor}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%} \CommentTok{\# create the correlation matrix}
  \FunctionTok{as\_tibble}\NormalTok{(}\AttributeTok{rownames =} \StringTok{"V1"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} \CommentTok{\# make it a tibble}
  \FunctionTok{gather}\NormalTok{(}\StringTok{"V2"}\NormalTok{, }\StringTok{"r"}\NormalTok{, }\DecValTok{2}\SpecialCharTok{:}\FunctionTok{ncol}\NormalTok{(.)) }\CommentTok{\# wide to long (V2)}
\end{Highlighting}
\end{Shaded}

Once you have a correlation matrix in the correct (long) format, it's easy to make a heatmap using \texttt{geom\_tile()}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(heatmap, }\FunctionTok{aes}\NormalTok{(V1, V2, }\AttributeTok{fill=}\NormalTok{r)) }\SpecialCharTok{+}
  \FunctionTok{geom\_tile}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{scale\_fill\_viridis\_c}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{figure}

{\centering \includegraphics[width=0.9\linewidth]{images/heatmap-1} 

}

\caption{Heatmap using geom_tile()}\label{fig:heatmap}
\end{figure}

\hypertarget{word-clouds}{%
\section{Word Clouds}\label{word-clouds}}

You can visualise qualitative data using the package ggwordcloud. In the example below, we'll use a dataset from ggwordcloud called \texttt{thankyou\_words\_small} that lists the words for ``thank you'' in 34 languages, plus the number of native speakers and total speakers. We're going to plot the names of the languages, sized by the number of speakers.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# load the data}
\FunctionTok{data}\NormalTok{(}\StringTok{"thankyou\_words\_small"}\NormalTok{, }\AttributeTok{package =} \StringTok{"ggwordcloud"}\NormalTok{)}

\CommentTok{\# create the ggwordclouds}
\FunctionTok{ggplot}\NormalTok{(thankyou\_words\_small, }
                   \FunctionTok{aes}\NormalTok{(}\AttributeTok{label =}\NormalTok{ name, }
                       \AttributeTok{color =}\NormalTok{ name, }
                       \AttributeTok{size =}\NormalTok{ speakers)) }\SpecialCharTok{+}
\NormalTok{  ggwordcloud}\SpecialCharTok{::}\FunctionTok{geom\_text\_wordcloud}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{scale\_size\_area}\NormalTok{(}\AttributeTok{max\_size =} \DecValTok{12}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{theme\_minimal}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics[width=0.9\linewidth]{images/unnamed-chunk-6-1} \end{center}

\begin{try}
Look at the \href{https://cran.r-project.org/web/packages/ggwordcloud/vignettes/ggwordcloud.html}{ggwordcloud vignette} and see what elese you can do with the plot above. Try changing the colour scheme or the maximum word size. What happens if you use the \texttt{thankyou\_words} dataset with 147 words?

\end{try}

\hypertarget{plotly}{%
\section{Interactive Plots}\label{plotly}}

You can use the \texttt{plotly} package to make interactive graphs. Just assign your ggplot to a variable and use the function \texttt{ggplotly()}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{demog\_plot }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{(pets, }\FunctionTok{aes}\NormalTok{(age, score, }\AttributeTok{fill=}\NormalTok{pet)) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{geom\_smooth}\NormalTok{(}\AttributeTok{formula =}\NormalTok{ y}\SpecialCharTok{\textasciitilde{}}\NormalTok{x, }\AttributeTok{method =}\NormalTok{ lm)}

\FunctionTok{ggplotly}\NormalTok{(demog\_plot)}
\end{Highlighting}
\end{Shaded}

\begin{figure}

{\centering \includegraphics[width=0.9\linewidth]{images/plotly-1} 

}

\caption{Interactive graph using plotly}\label{fig:plotly}
\end{figure}

\begin{info}
Hover over the data points above and click on the legend items.

\end{info}

\hypertarget{glossary-ggplot}{%
\section{Glossary}\label{glossary-ggplot}}

\begin{tabular}{l|l}
\hline
term & definition\\
\hline
chunk & A section of code in an R Markdown file\\
\hline
continuous & Data that can take on any values between other existing values.\\
\hline
discrete & Data that can only take certain values, such as integers.\\
\hline
geom & The geometric style in which data are displayed, such as boxplot, density, or histogram.\\
\hline
likert & A rating scale with a small number of discrete points in order\\
\hline
nominal & Categorical variables that don\&\#39;t have an inherent order, such as types of animal.\\
\hline
ordinal & Discrete variables that have an inherent order, such as number of legs\\
\hline
\end{tabular}

\hypertarget{resources-ggplot}{%
\section{Further Resources}\label{resources-ggplot}}

\begin{itemize}
\tightlist
\item
  \href{https://psyarxiv.com/4huvw/}{Data visualisation using R, for researchers who don't use R}
\item
  \href{http://r4ds.had.co.nz/data-visualisation.html}{Chapter 3: Data Visualisation} of \emph{R for Data Science}
\item
  \href{https://github.com/rstudio/cheatsheets/raw/master/data-visualization-2.1.pdf}{ggplot2 cheat sheet}
\item
  \href{https://ggplot2.tidyverse.org/articles/}{ggplot2 FAQs}
\item
  \href{http://r4ds.had.co.nz/graphics-for-communication.html}{Chapter 28: Graphics for communication} of \emph{R for Data Science}
\item
  \href{http://socviz.co/look-at-data.html}{Look at Data} from \href{http://socviz.co/}{Data Vizualization for Social Science}
\item
  \href{https://psyteachr.github.io/hack-your-data/}{Hack Your Data Beautiful} workshop by University of Glasgow postgraduate students
\item
  \href{http://www.cookbook-r.com/Graphs}{Graphs} in \emph{Cookbook for R}
\item
  \href{https://ggplot2.tidyverse.org/reference/}{ggplot2 documentation}
\item
  \href{http://www.r-graph-gallery.com/}{The R Graph Gallery} (this is really useful)
\item
  \href{http://r-statistics.co/Top50-Ggplot2-Visualizations-MasterList-R-Code.html}{Top 50 ggplot2 Visualizations}
\item
  \href{http://www.cookbook-r.com/Graphs/}{R Graphics Cookbook} by Winston Chang
\item
  \href{https://www.ggplot2-exts.org/}{ggplot extensions}
\item
  \href{https://plot.ly/ggplot2/}{plotly} for creating interactive graphs
\end{itemize}

\hypertarget{data}{%
\chapter{Working with Data}\label{data}}

\hypertarget{ilo-data}{%
\section{Learning Objectives}\label{ilo-data}}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Load \protect\hyperlink{builtin}{built-in datasets} \href{https://youtu.be/Z5fK5VGmzlY}{(video)}
\item
  \protect\hyperlink{import_data}{Import data} from CSV and Excel files \href{https://youtu.be/a7Ra-hnB8l8}{(video)}
\item
  Create a \protect\hyperlink{tables-data}{data table} \href{https://youtu.be/k-aqhurepb4}{(video)}
\item
  Understand the use the \protect\hyperlink{data_types}{basic data types} \href{https://youtu.be/jXQrF18Jaac}{(video)}
\item
  Understand and use the \protect\hyperlink{containers}{basic container types} (list, vector) \href{https://youtu.be/4xU7uKNdoig}{(video)}
\item
  Use \protect\hyperlink{vectorized_ops}{vectorized operations} \href{https://youtu.be/9I5MdS7UWmI}{(video)}
\item
  Be able to \protect\hyperlink{Troubleshooting}{troubleshoot} common data import problems \href{https://youtu.be/gcxn4LJ_vAI}{(video)}
\end{enumerate}

\hypertarget{setup-data}{%
\section{Setup}\label{setup-data}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# libraries needed for these examples}
\FunctionTok{library}\NormalTok{(tidyverse)}
\FunctionTok{library}\NormalTok{(reprores)}
\end{Highlighting}
\end{Shaded}

\hypertarget{data-tables}{%
\section{Data tables}\label{data-tables}}

\hypertarget{builtin}{%
\subsection{Built-in data}\label{builtin}}

R comes with built-in datasets. Some packages, like tidyr and reprores, also contain data. The \texttt{data()} function lists the datasets available in a package.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# lists datasets in reprores}
\FunctionTok{data}\NormalTok{(}\AttributeTok{package =} \StringTok{"reprores"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Type the name of a dataset into the console to see the data. Type \texttt{?smalldata} into the console to see the dataset description.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{smalldata}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 10 x 4
##    id    group     pre  post
##    <chr> <chr>   <dbl> <dbl>
##  1 S01   control  98.5 107. 
##  2 S02   control 104.   89.1
##  3 S03   control 105.  124. 
##  4 S04   control  92.4  70.7
##  5 S05   control 124.  125. 
##  6 S06   exp      97.5 102. 
##  7 S07   exp      87.8 126. 
##  8 S08   exp      77.2  72.3
##  9 S09   exp      97.0 109. 
## 10 S10   exp     102.  114.
\end{verbatim}

You can also use the \texttt{data()} function to load a dataset into your global environment.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# loads smalldata into the environment}
\FunctionTok{data}\NormalTok{(}\StringTok{"smalldata"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Always, always, always, look at your data once you've created or loaded a table. Also look at it after each step that transforms your table. There are three main ways to look at your tibble: \texttt{print()}, \texttt{glimpse()}, and \texttt{View()}.

The \texttt{print()} method can be run explicitly, but is more commonly called by just typing the variable name on the blank line. The default is not to print the entire table, but just the first 10 rows. It's rare to print your data in a script; that is something you usually are doing for a sanity check, and you should just do it in the console.

Let's look at the \texttt{smalldata} table that we made above.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{smalldata}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 10 x 4
##    id    group     pre  post
##    <chr> <chr>   <dbl> <dbl>
##  1 S01   control  98.5 107. 
##  2 S02   control 104.   89.1
##  3 S03   control 105.  124. 
##  4 S04   control  92.4  70.7
##  5 S05   control 124.  125. 
##  6 S06   exp      97.5 102. 
##  7 S07   exp      87.8 126. 
##  8 S08   exp      77.2  72.3
##  9 S09   exp      97.0 109. 
## 10 S10   exp     102.  114.
\end{verbatim}

The function \texttt{glimpse()} gives a sideways version of the tibble. This is useful if the table is very wide and you can't see all of the columns. It also tells you the data type of each column in angled brackets after each column name. We'll learn about \protect\hyperlink{data_types}{data types} below.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{glimpse}\NormalTok{(smalldata)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Rows: 10
## Columns: 4
## $ id    <chr> "S01", "S02", "S03", "S04", "S05", "S06", "S07", "S08", "S09", "~
## $ group <chr> "control", "control", "control", "control", "control", "exp", "e~
## $ pre   <dbl> 98.46606, 104.39774, 105.13377, 92.42574, 123.53268, 97.48676, 8~
## $ post  <dbl> 106.70508, 89.09030, 123.67230, 70.70178, 124.95526, 101.61697, ~
\end{verbatim}

The other way to look at the table is a more graphical spreadsheet-like version given by \texttt{View()} (capital `V'). It can be useful in the console, but don't ever put this one in a script because it will create an annoying pop-up window when the user runs it.
Now you can click on \texttt{smalldata} in the environment pane to open it up in a viewer that looks a bit like Excel.

You can get a quick summary of a dataset with the \texttt{summary()} function.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{summary}\NormalTok{(smalldata)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##       id               group                pre              post       
##  Length:10          Length:10          Min.   : 77.15   Min.   : 70.70  
##  Class :character   Class :character   1st Qu.: 93.57   1st Qu.: 92.22  
##  Mode  :character   Mode  :character   Median : 97.98   Median :107.76  
##                                        Mean   : 98.57   Mean   :103.79  
##                                        3rd Qu.:103.88   3rd Qu.:121.19  
##                                        Max.   :123.53   Max.   :126.30
\end{verbatim}

You can even do things like calculate the difference between the means of two columns.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pre\_mean }\OtherTok{\textless{}{-}} \FunctionTok{mean}\NormalTok{(smalldata}\SpecialCharTok{$}\NormalTok{pre)}
\NormalTok{post\_mean }\OtherTok{\textless{}{-}} \FunctionTok{mean}\NormalTok{(smalldata}\SpecialCharTok{$}\NormalTok{post)}
\NormalTok{post\_mean }\SpecialCharTok{{-}}\NormalTok{ pre\_mean}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 5.223055
\end{verbatim}

\hypertarget{import_data}{%
\subsection{Importing data}\label{import_data}}

Built-in data are nice for examples, but you're probably more interested in your own data. There are many different types of files that you might work with when doing data analysis. These different file types are usually distinguished by the three letter extension following a period at the end of the file name. Here are some examples of different types of files and the functions you would use to read them in or write them out.

\begin{longtable}[]{@{}llll@{}}
\toprule
Extension & File Type & Reading & Writing \\
\midrule
\endhead
.csv & Comma-separated values & \texttt{readr::read\_csv()} & \texttt{readr::write\_csv()} \\
.tsv, .txt & Tab-separated values & \texttt{readr::read\_tsv()} & \texttt{readr::write\_tsv()} \\
.xls, .xlsx & Excel workbook & \texttt{readxl::read\_excel()} & \texttt{rio::export()} \\
.sav & SPSS files & \texttt{haven::read\_sav()} & \texttt{haven::write\_sav()} \\
.json & JSON files & \texttt{jsonlite::read\_json()} & \texttt{jsonlite::write\_json()} \\
.mat, \ldots{} & Multiple types & \texttt{rio::import()} & \texttt{rio::export()} \\
\bottomrule
\end{longtable}

The double colon means that the function on the right comes from the package on the left, so \texttt{readr::read\_csv()} refers to the \texttt{read\_csv()} function in the readr package, and \texttt{readxl::read\_excel()} refers to the function \texttt{read\_excel()} in the readxl package. The function \texttt{rio::import()} from the rio package will read almost any type of data file, including SPSS and Matlab. Check the help with \texttt{?rio::import} to see a full list.

You can get a directory of data files used in this class for tutorials and exercises with the following code, which will create a directory called ``data'' in your project directory. Alternatively, you can download a \href{data/data.zip}{zip file of the datasets}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{psyteachr}\SpecialCharTok{::}\FunctionTok{getdata}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\hypertarget{csv-files}{%
\subsubsection{CSV Files}\label{csv-files}}

The most common file type you will encounter in this class is .csv (comma-separated values). As the name suggests, a CSV file distinguishes which values go with which variable by separating them with commas, and text values are sometimes enclosed in double quotes. The first line of a file usually provides the names of the variables.

For example, here is a small CSV containing demo data:

\begin{verbatim}
```
character,integer,double,logical,date
A,1,1.5,TRUE,05-Sep-21
B,2,2.5,TRUE,04-Sep-21
C,3,3.5,FALSE,03-Sep-21
D,4,4.5,FALSE,02-Sep-21
E,5,5.5,,01-Sep-21
F,6,6.5,TRUE,31-Aug-21
```
\end{verbatim}

There are five variables in this dataset, and their names are given in the first line of the file: \texttt{character}, \texttt{integer}, \texttt{double} ,`\texttt{logical}, and \texttt{date}. You can see that the values for each of these variables are given in order, separated by commas, on each subsequent line of the file.

Use \texttt{readr::read\_csv()} to read in the data as assign it to an object called \texttt{demo\_csv}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{demo\_csv  }\OtherTok{\textless{}{-}}\NormalTok{ readr}\SpecialCharTok{::}\FunctionTok{read\_csv}\NormalTok{(}\StringTok{"data/demo.csv"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Rows: 6 Columns: 5
\end{verbatim}

\begin{verbatim}
## -- Column specification --------------------------------------------------------
## Delimiter: ","
## chr (2): character, date
## dbl (2): integer, double
## lgl (1): logical
\end{verbatim}

\begin{verbatim}
## 
## i Use `spec()` to retrieve the full column specification for this data.
## i Specify the column types or set `show_col_types = FALSE` to quiet this message.
\end{verbatim}

This function will give you some information about the data you just read in so you can check the column names and \protect\hyperlink{data_types}{data types}. If it makes a mistake, such as reading the ``date'' column as a character, you can manually set the column data types. Just copy the ``Column specification'' that was printed when you first imported the data, and make any changes you need.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ct }\OtherTok{\textless{}{-}} \FunctionTok{cols}\NormalTok{(}
  \AttributeTok{character =} \FunctionTok{col\_character}\NormalTok{(),}
  \AttributeTok{integer =} \FunctionTok{col\_double}\NormalTok{(),}
  \AttributeTok{double =} \FunctionTok{col\_double}\NormalTok{(),}
  \AttributeTok{logical =} \FunctionTok{col\_logical}\NormalTok{(),}
  \AttributeTok{date =} \FunctionTok{col\_date}\NormalTok{(}\AttributeTok{format =} \StringTok{"\%d{-}\%b{-}\%y"}\NormalTok{)}
\NormalTok{)}

\NormalTok{demo  }\OtherTok{\textless{}{-}}\NormalTok{ readr}\SpecialCharTok{::}\FunctionTok{read\_csv}\NormalTok{(}\StringTok{"data/demo.csv"}\NormalTok{, }\AttributeTok{col\_types =}\NormalTok{ ct)}
\end{Highlighting}
\end{Shaded}

\begin{info}
For dates, you might need to set the format. See \texttt{?strptime} for a list of the codes used to represent different date formats. Above, {``\%d-\%b-\%y''} means that the dates are formatted like \texttt{\{day\ number\}-\{month\ abbreviation\}-\{2-digit\ year\}}.

\end{info}

We'll learn more about how to fix data import problems in the \protect\hyperlink{troubleshooting}{troubleshooting} section below.

\hypertarget{other-file-types}{%
\subsubsection{Other File Types}\label{other-file-types}}

Use the functions below to read in other file types.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{demo\_tsv  }\OtherTok{\textless{}{-}}\NormalTok{ readr}\SpecialCharTok{::}\FunctionTok{read\_tsv}\NormalTok{(}\StringTok{"data/demo.tsv"}\NormalTok{)}
\NormalTok{demo\_xls  }\OtherTok{\textless{}{-}}\NormalTok{ readxl}\SpecialCharTok{::}\FunctionTok{read\_excel}\NormalTok{(}\StringTok{"data/demo.xlsx"}\NormalTok{)}
\NormalTok{demo\_sav  }\OtherTok{\textless{}{-}}\NormalTok{ haven}\SpecialCharTok{::}\FunctionTok{read\_sav}\NormalTok{(}\StringTok{"data/demo.sav"}\NormalTok{)}
\NormalTok{demo\_json }\OtherTok{\textless{}{-}}\NormalTok{ jsonlite}\SpecialCharTok{::}\FunctionTok{read\_json}\NormalTok{(}\StringTok{"data/demo.json"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

You can access Google Sheets directly from R using googlesheets4.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(googlesheets4)}

\FunctionTok{gs4\_deauth}\NormalTok{() }\CommentTok{\# skip authorisation for public data}

\NormalTok{url }\OtherTok{\textless{}{-}} \StringTok{"https://docs.google.com/spreadsheets/d/1yhAPP0hk6fNssL9UdpJ7m\_vx00VY5PQKHspx6DNQNSY/"}

\NormalTok{demo\_goo  }\OtherTok{\textless{}{-}}\NormalTok{ googlesheets4}\SpecialCharTok{::}\FunctionTok{read\_sheet}\NormalTok{(url)}
\end{Highlighting}
\end{Shaded}

\begin{try}

Try loading in all five of the \texttt{5factor} datasets in the data directory.

Solution

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ocean\_csv  }\OtherTok{\textless{}{-}}\NormalTok{ readr}\SpecialCharTok{::}\FunctionTok{read\_csv}\NormalTok{(}\StringTok{"data/5factor.csv"}\NormalTok{)}
\NormalTok{ocean\_tsv  }\OtherTok{\textless{}{-}}\NormalTok{ readr}\SpecialCharTok{::}\FunctionTok{read\_tsv}\NormalTok{(}\StringTok{"data/5factor.txt"}\NormalTok{)}
\NormalTok{ocean\_xls  }\OtherTok{\textless{}{-}}\NormalTok{ readxl}\SpecialCharTok{::}\FunctionTok{read\_excel}\NormalTok{(}\StringTok{"data/5factor.xls"}\NormalTok{)}
\NormalTok{ocean\_xlsx }\OtherTok{\textless{}{-}}\NormalTok{ readxl}\SpecialCharTok{::}\FunctionTok{read\_excel}\NormalTok{(}\StringTok{"data/5factor.xlsx"}\NormalTok{)}
\NormalTok{ocean\_sav  }\OtherTok{\textless{}{-}}\NormalTok{ haven}\SpecialCharTok{::}\FunctionTok{read\_sav}\NormalTok{(}\StringTok{"data/5factor.sav"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\end{try}

\hypertarget{looking-at-data}{%
\subsection{Looking at data}\label{looking-at-data}}

Now that you've loaded some data, look the upper right hand window of RStudio, under the Environment tab. You will see the objects listed, along with their number of observations (rows) and variables (columns). This is your first check that everything went OK.

Always, always, always, look at your data once you've created or loaded a table. Also look at it after each step that transforms your table. There are three main ways to look at your table: {View}{(}{)}, {print}{(}{)}, {tibble}{::}{glimpse}{(}{)}.

\hypertarget{view}{%
\subsubsection{View()}\label{view}}

A familiar way to look at the table is given by {View}{(}{)} (uppercase `V'). This command can be useful in the console, but don't ever put this one in a script because it will create an annoying pop-up window when the user runs it. Or you can click on an objects in the environment pane to open it up in a viewer that looks a bit like Excel. You can close the tab when you're done looking at it; it won't remove the object.

\hypertarget{print}{%
\subsubsection{print()}\label{print}}

The {print}{(}{)} method can be run explicitly, but is more commonly called by just typing the variable name on the blank line. The default is not to print the entire table, but just the first 10 rows.

Let's look at the \texttt{demo\_tsv} table that we loaded above. Depending on how wide your screen is, you might need to click on an arrow at the right of the table to see the last column.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{demo\_tsv}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 6 x 5
##   character integer double logical date     
##   <chr>       <dbl>  <dbl> <lgl>   <chr>    
## 1 A               1    1.5 TRUE    05-Sep-21
## 2 B               2    2.5 TRUE    04-Sep-21
## 3 C               3    3.5 FALSE   03-Sep-21
## 4 D               4    4.5 FALSE   02-Sep-21
## 5 E               5    5.5 NA      01-Sep-21
## 6 F               6    6.5 TRUE    31-Aug-21
\end{verbatim}

\hypertarget{glimpse}{%
\subsubsection{glimpse()}\label{glimpse}}

The function {tibble}{::}{glimpse}{(}{)} gives a sideways version of the table. This is useful if the table is very wide and you can't see all of the columns. It also tells you the data type of each column in angled brackets after each column name.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{glimpse}\NormalTok{(demo\_xls)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Rows: 6
## Columns: 5
## $ character <chr> "A", "B", "C", "D", "E", "F"
## $ integer   <dbl> 1, 2, 3, 4, 5, 6
## $ double    <dbl> 1.5, 2.5, 3.5, 4.5, 5.5, 6.5
## $ logical   <lgl> TRUE, TRUE, FALSE, FALSE, NA, TRUE
## $ date      <chr> "05-Sep-21", "04-Sep-21", "03-Sep-21", "02-Sep-21", "01-Sep-~
\end{verbatim}

\hypertarget{summary-function}{%
\subsubsection{summary()}\label{summary-function}}

You can get a quick summary of a dataset with the {summary}{(}{)} function.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{summary}\NormalTok{(demo\_sav)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##   character            integer         double        logical   
##  Length:6           Min.   :1.00   Min.   :1.50   Min.   :0.0  
##  Class :character   1st Qu.:2.25   1st Qu.:2.75   1st Qu.:0.0  
##  Mode  :character   Median :3.50   Median :4.00   Median :1.0  
##                     Mean   :3.50   Mean   :4.00   Mean   :0.6  
##                     3rd Qu.:4.75   3rd Qu.:5.25   3rd Qu.:1.0  
##                     Max.   :6.00   Max.   :6.50   Max.   :1.0  
##                                                   NA's   :1    
##      date          
##  Length:6          
##  Class :character  
##  Mode  :character  
##                    
##                    
##                    
## 
\end{verbatim}

\hypertarget{creating-data}{%
\subsection{Creating data}\label{creating-data}}

If we are creating a data table from scratch, we can use the \texttt{tibble::tibble()} function, and type the data right in. The tibble package is part of the tidyverse package that we loaded at the start of this chapter.

Let's create a small table with the names of three Avatar characters and their bending type. The \texttt{tibble()} function takes arguments with the names that you want your columns to have. The values are vectors that list the column values in order.

If you don't know the value for one of the cells, you can enter \texttt{NA}, which we have to do for Sokka because he doesn't have any bending ability. If all the values in the column are the same, you can just enter one value and it will be copied for each row.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{avatar }\OtherTok{\textless{}{-}} \FunctionTok{tibble}\NormalTok{(}
  \AttributeTok{name =} \FunctionTok{c}\NormalTok{(}\StringTok{"Katara"}\NormalTok{, }\StringTok{"Toph"}\NormalTok{, }\StringTok{"Sokka"}\NormalTok{),}
  \AttributeTok{bends =} \FunctionTok{c}\NormalTok{(}\StringTok{"water"}\NormalTok{, }\StringTok{"earth"}\NormalTok{, }\ConstantTok{NA}\NormalTok{),}
  \AttributeTok{friendly =} \ConstantTok{TRUE}
\NormalTok{)}

\CommentTok{\# print it}
\NormalTok{avatar}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 3 x 3
##   name   bends friendly
##   <chr>  <chr> <lgl>   
## 1 Katara water TRUE    
## 2 Toph   earth TRUE    
## 3 Sokka  <NA>  TRUE
\end{verbatim}

\hypertarget{writing-data}{%
\subsection{Writing Data}\label{writing-data}}

If you have data that you want to save to a CSV file, use \texttt{readr::write\_csv()}, as follows.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{write\_csv}\NormalTok{(avatar, }\StringTok{"avatar.csv"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

This will save the data in CSV format to your working directory.

Writing to Google Sheets is a little trickier. Even if a Google Sheet is publicly editable, you can't add data to it without authorising your account.

You can authorise interactively using the following code (and your own email), which will prompt you to authorise ``Tidyverse API Packages'' the first time you do this.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{gs4\_auth}\NormalTok{(}\AttributeTok{email =} \StringTok{"debruine@gmail.com"}\NormalTok{)}
\NormalTok{sheet\_id }\OtherTok{\textless{}{-}} \FunctionTok{gs4\_create}\NormalTok{(}\StringTok{"demo{-}file"}\NormalTok{, }\AttributeTok{sheets =}\NormalTok{ demo)}

\NormalTok{new\_data }\OtherTok{\textless{}{-}} \FunctionTok{tibble}\NormalTok{(}
  \AttributeTok{character =} \StringTok{"Z"}\NormalTok{,}
  \AttributeTok{integer =}\NormalTok{ 0L,}
  \AttributeTok{double =} \FloatTok{0.5}\NormalTok{,}
  \AttributeTok{logical =} \ConstantTok{FALSE}\NormalTok{,}
  \AttributeTok{date =} \StringTok{"01{-}Jan{-}00"}
\NormalTok{)}

\FunctionTok{sheet\_append}\NormalTok{(sheet\_id, new\_data)}
\NormalTok{demo }\OtherTok{\textless{}{-}} \FunctionTok{read\_sheet}\NormalTok{(sheet\_id)}
\end{Highlighting}
\end{Shaded}

\begin{try}

\begin{itemize}
\tightlist
\item
  Create a new table called \texttt{family} with the first name, last name, and age of your family members.
\item
  Save it to a CSV file called family.csv.
\item
  Clear the object from your environment by restarting R or with the code {remove}{(}{family}{)}.
\item
  Load the data back in and view it.
\end{itemize}

\end{try}

Solution

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# create the table}
\NormalTok{family }\OtherTok{\textless{}{-}} \FunctionTok{tribble}\NormalTok{(}
  \SpecialCharTok{\textasciitilde{}}\NormalTok{first\_name, }\SpecialCharTok{\textasciitilde{}}\NormalTok{last\_name, }\SpecialCharTok{\textasciitilde{}}\NormalTok{age,}
  \StringTok{"Lisa"}\NormalTok{, }\StringTok{"DeBruine"}\NormalTok{, }\DecValTok{45}\NormalTok{,}
  \StringTok{"Robbie"}\NormalTok{, }\StringTok{"Jones"}\NormalTok{, }\DecValTok{14}
\NormalTok{)}

\CommentTok{\# save the data to CSV}
\FunctionTok{export}\NormalTok{(family, }\StringTok{"data/family.csv"}\NormalTok{)}

\CommentTok{\# remove the object from the environment}
\FunctionTok{remove}\NormalTok{(family)}

\CommentTok{\# load the data}
\NormalTok{family }\OtherTok{\textless{}{-}} \FunctionTok{import}\NormalTok{(}\StringTok{"data/family.csv"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

:::

We'll be working with tabular data a lot in this class, but tabular data is made up of vectors, which group together data with the same basic data type. The following sections explain some of this terminology to help you understand the functions we'll be learning to process and analyse data.

\hypertarget{data_types}{%
\section{Basic data types}\label{data_types}}

Data can be numbers, words, true/false values or combinations of these. In order to understand some later concepts, it's useful to have a basic understanding of data types in R: numeric, character, and logical

\hypertarget{numeric-data}{%
\subsection{Numeric data}\label{numeric-data}}

All of the real numbers are numeric data types (imaginary numbers are ``complex''). There are two types of numeric data, integer and double. Integers are the whole numbers, like {-}{1}, {0} and {1}. Doubles are numbers that can have fractional amounts. If you just type a plain number such as {10}, it is stored as a double, even if it doesn't have a decimal point. If you want it to be an exact integer, use the \texttt{L} suffix ({10L}).

If you ever want to know the data type of something, use the \texttt{typeof()} function.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{typeof}\NormalTok{(}\DecValTok{10}\NormalTok{)   }\CommentTok{\# double}
\FunctionTok{typeof}\NormalTok{(}\FloatTok{10.0}\NormalTok{) }\CommentTok{\# double}
\FunctionTok{typeof}\NormalTok{(10L)  }\CommentTok{\# integer}
\FunctionTok{typeof}\NormalTok{(10i)  }\CommentTok{\# complex}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "double"
## [1] "double"
## [1] "integer"
## [1] "complex"
\end{verbatim}

If you want to know if something is numeric (a double or an integer), you can use the function \texttt{is.numeric()} and it will tell you if it is numeric (\texttt{TRUE}) or not (\texttt{FALSE}).

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{is.numeric}\NormalTok{(10L)}
\FunctionTok{is.numeric}\NormalTok{(}\FloatTok{10.0}\NormalTok{)}
\FunctionTok{is.numeric}\NormalTok{(}\StringTok{"Not a number"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] TRUE
## [1] TRUE
## [1] FALSE
\end{verbatim}

\hypertarget{character-data}{%
\subsection{Character data}\label{character-data}}

Character strings are any text between quotation marks.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{typeof}\NormalTok{(}\StringTok{"This is a character string"}\NormalTok{)}
\FunctionTok{typeof}\NormalTok{(}\StringTok{\textquotesingle{}You can use double or single quotes\textquotesingle{}}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "character"
## [1] "character"
\end{verbatim}

This can include quotes, but you have to escape it using a backslash to signal the the quote isn't meant to be the end of the string.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my\_string }\OtherTok{\textless{}{-}} \StringTok{"The instructor said, }\SpecialCharTok{\textbackslash{}"}\StringTok{R is cool,}\SpecialCharTok{\textbackslash{}"}\StringTok{ and the class agreed."}
\FunctionTok{cat}\NormalTok{(my\_string) }\CommentTok{\# cat() prints the arguments}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## The instructor said, "R is cool," and the class agreed.
\end{verbatim}

\hypertarget{logical-data}{%
\subsection{Logical Data}\label{logical-data}}

Logical data (also sometimes called ``boolean'' values) is one of two values: true or false. In R, we always write them in uppercase: \texttt{TRUE} and \texttt{FALSE}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{class}\NormalTok{(}\ConstantTok{TRUE}\NormalTok{)}
\FunctionTok{class}\NormalTok{(}\ConstantTok{FALSE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "logical"
## [1] "logical"
\end{verbatim}

When you compare two values with an operator, such as checking to see if 10 is greater than 5, the resulting value is logical.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{is.logical}\NormalTok{(}\DecValTok{10} \SpecialCharTok{\textgreater{}} \DecValTok{5}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] TRUE
\end{verbatim}

\begin{info}
You might also see logical values abbreviated as \texttt{T} and \texttt{F}, or \texttt{0} and \texttt{1}. This can cause some problems down the road, so we will always spell out the whole thing.

\end{info}

\hypertarget{factors}{%
\subsection{Factors}\label{factors}}

A factor is a specific type of integer that lets you specify the categories and their order. This is useful in data tables to make plots display with categories in the correct order.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{myfactor }\OtherTok{\textless{}{-}} \FunctionTok{factor}\NormalTok{(}\StringTok{"B"}\NormalTok{, }\AttributeTok{levels =} \FunctionTok{c}\NormalTok{(}\StringTok{"A"}\NormalTok{, }\StringTok{"B"}\NormalTok{,}\StringTok{"C"}\NormalTok{))}
\NormalTok{myfactor}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] B
## Levels: A B C
\end{verbatim}

Factors are a type of integer, but you can tell that they are factors by checking their \texttt{class()}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{typeof}\NormalTok{(myfactor)}
\FunctionTok{class}\NormalTok{(myfactor)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "integer"
## [1] "factor"
\end{verbatim}

\hypertarget{dates-and-times}{%
\subsection{Dates and Times}\label{dates-and-times}}

Dates and times are represented by doubles with special classes. Dates and times are very hard to work with, but the lubridate package provides functions to help you with this.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{today }\OtherTok{\textless{}{-}}\NormalTok{ lubridate}\SpecialCharTok{::}\FunctionTok{today}\NormalTok{()}
\NormalTok{now }\OtherTok{\textless{}{-}}\NormalTok{ lubridate}\SpecialCharTok{::}\FunctionTok{now}\NormalTok{(}\AttributeTok{tzone =} \StringTok{"GMT"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Date and datetimes are a type of double, but you can tell that they are dates by checking their \texttt{class()}. Datetimes can have one or more of a few classes that start with \texttt{POSIX}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{typeof}\NormalTok{(today)}
\FunctionTok{typeof}\NormalTok{(now)}
\FunctionTok{class}\NormalTok{(today)}
\FunctionTok{class}\NormalTok{(now)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "double"
## [1] "double"
## [1] "Date"
## [1] "POSIXct" "POSIXt"
\end{verbatim}

\begin{try}

What data types are these:

\begin{itemize}
\tightlist
\item
  \texttt{100} integerdoublecharacterlogicalfactor
\item
  \texttt{100L} integerdoublecharacterlogicalfactor
\item
  \texttt{"100"} integerdoublecharacterlogicalfactor
\item
  \texttt{100.0} integerdoublecharacterlogicalfactor
\item
  \texttt{-100L} integerdoublecharacterlogicalfactor
\item
  \texttt{factor(100)} integerdoublecharacterlogicalfactor
\item
  \texttt{TRUE} integerdoublecharacterlogicalfactor
\item
  \texttt{"TRUE"} integerdoublecharacterlogicalfactor
\item
  \texttt{FALSE} integerdoublecharacterlogicalfactor
\item
  \texttt{1\ ==\ 2} integerdoublecharacterlogicalfactor
\end{itemize}

\end{try}

\hypertarget{containers}{%
\section{Basic container types}\label{containers}}

Individual data values can be grouped together into containers. The main types of containers we'll work with are vectors, lists, and data tables.

\hypertarget{vectors}{%
\subsection{Vectors}\label{vectors}}

A vector in R is like a vector in mathematics: a set of ordered elements. All of the elements in a vector must be of the same data type (numeric, character, logical). You can create a vector by enclosing the elements in the function \texttt{c()}.

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# put information into a vector using c(...)}
\FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{2}\NormalTok{, }\DecValTok{3}\NormalTok{, }\DecValTok{4}\NormalTok{)}
\FunctionTok{c}\NormalTok{(}\StringTok{"this"}\NormalTok{, }\StringTok{"is"}\NormalTok{, }\StringTok{"cool"}\NormalTok{)}
\DecValTok{1}\SpecialCharTok{:}\DecValTok{6} \CommentTok{\# shortcut to make a vector of all integers x:y}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 1 2 3 4
## [1] "this" "is"   "cool"
## [1] 1 2 3 4 5 6
\end{verbatim}

\begin{try}

What happens when you mix types? What class is the variable \texttt{mixed}?

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mixed }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\DecValTok{2}\NormalTok{, }\StringTok{"good"}\NormalTok{, 2L, }\StringTok{"b"}\NormalTok{, }\ConstantTok{TRUE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\end{try}

\begin{warning}
You can't mix data types in a vector; all elements of the vector must be the same data type. If you mix them, R will ``coerce'' them so that they are all the same. If you mix doubles and integers, the integers will be changed to doubles. If you mix characters and numeric types, the numbers will be coerced to characters, so \texttt{10} would turn into ``10''.

\end{warning}

\hypertarget{selecting-values-from-a-vector}{%
\subsubsection{Selecting values from a vector}\label{selecting-values-from-a-vector}}

If we wanted to pick specific values out of a vector by position, we can use square brackets (an extract operator, or \texttt{{[}{]}}) after the vector.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{values }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\DecValTok{10}\NormalTok{, }\DecValTok{20}\NormalTok{, }\DecValTok{30}\NormalTok{, }\DecValTok{40}\NormalTok{, }\DecValTok{50}\NormalTok{)}
\NormalTok{values[}\DecValTok{2}\NormalTok{] }\CommentTok{\# selects the second value}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 20
\end{verbatim}

You can select more than one value from the vector by putting a vector of numbers inside the square brackets. For example, you can select the 18th, 19th, 20th, 21st, 4th, 9th and 15th letter from the built-in vector \texttt{LETTERS} (which gives all the uppercase letters in the Latin alphabet).

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{word }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\DecValTok{18}\NormalTok{, }\DecValTok{19}\NormalTok{, }\DecValTok{20}\NormalTok{, }\DecValTok{21}\NormalTok{, }\DecValTok{4}\NormalTok{, }\DecValTok{9}\NormalTok{, }\DecValTok{15}\NormalTok{)}
\NormalTok{LETTERS[word]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "R" "S" "T" "U" "D" "I" "O"
\end{verbatim}

\begin{try}

Can you decode the secret message?

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{secret }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\DecValTok{14}\NormalTok{, }\DecValTok{5}\NormalTok{, }\DecValTok{22}\NormalTok{, }\DecValTok{5}\NormalTok{, }\DecValTok{18}\NormalTok{, }\DecValTok{7}\NormalTok{, }\DecValTok{15}\NormalTok{, }\DecValTok{14}\NormalTok{, }\DecValTok{14}\NormalTok{, }\DecValTok{1}\NormalTok{, }\DecValTok{7}\NormalTok{, }\DecValTok{9}\NormalTok{, }\DecValTok{22}\NormalTok{, }\DecValTok{5}\NormalTok{, }\DecValTok{25}\NormalTok{, }\DecValTok{15}\NormalTok{, }\DecValTok{21}\NormalTok{, }\DecValTok{21}\NormalTok{, }\DecValTok{16}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\end{try}

You can also create `named' vectors, where each element has a name. For example:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{vec }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\AttributeTok{first =} \FloatTok{77.9}\NormalTok{, }\AttributeTok{second =} \SpecialCharTok{{-}}\FloatTok{13.2}\NormalTok{, }\AttributeTok{third =} \FloatTok{100.1}\NormalTok{)}
\NormalTok{vec}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  first second  third 
##   77.9  -13.2  100.1
\end{verbatim}

We can then access elements by name using a character vector within the square brackets. We can put them in any order we want, and we can repeat elements:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{vec[}\FunctionTok{c}\NormalTok{(}\StringTok{"third"}\NormalTok{, }\StringTok{"second"}\NormalTok{, }\StringTok{"second"}\NormalTok{)]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  third second second 
##  100.1  -13.2  -13.2
\end{verbatim}

\begin{info}
We can get the vector of names using the \texttt{names()} function, and we can set or change them using something like \texttt{names(vec2)\ \textless{}-\ c("n1",\ "n2",\ "n3")}.

\end{info}

Another way to access elements is by using a logical vector within the square brackets. This will pull out the elements of the vector for which the corresponding element of the logical vector is \texttt{TRUE}. If the logical vector doesn't have the same length as the original, it will repeat. You can find out how long a vector is using the \texttt{length()} function.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{length}\NormalTok{(LETTERS)}
\NormalTok{LETTERS[}\FunctionTok{c}\NormalTok{(}\ConstantTok{TRUE}\NormalTok{, }\ConstantTok{FALSE}\NormalTok{)]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 26
##  [1] "A" "C" "E" "G" "I" "K" "M" "O" "Q" "S" "U" "W" "Y"
\end{verbatim}

\hypertarget{rep_seq}{%
\subsubsection{Repeating Sequences}\label{rep_seq}}

Here are some useful tricks to save typing when creating vectors.

In the command \texttt{x:y} the \texttt{:} operator would give you the sequence of number starting at \texttt{x}, and going to \texttt{y} in increments of 1.

\begin{Shaded}
\begin{Highlighting}[]
\DecValTok{1}\SpecialCharTok{:}\DecValTok{10}
\FloatTok{15.3}\SpecialCharTok{:}\FloatTok{20.5}
\DecValTok{0}\SpecialCharTok{:{-}}\DecValTok{10}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1]  1  2  3  4  5  6  7  8  9 10
## [1] 15.3 16.3 17.3 18.3 19.3 20.3
##  [1]   0  -1  -2  -3  -4  -5  -6  -7  -8  -9 -10
\end{verbatim}

What if you want to create a sequence but with something other than integer steps? You can use the \texttt{seq()} function. Look at the examples below and work out what the arguments do.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{seq}\NormalTok{(}\AttributeTok{from =} \SpecialCharTok{{-}}\DecValTok{1}\NormalTok{, }\AttributeTok{to =} \DecValTok{1}\NormalTok{, }\AttributeTok{by =} \FloatTok{0.2}\NormalTok{)}
\FunctionTok{seq}\NormalTok{(}\DecValTok{0}\NormalTok{, }\DecValTok{100}\NormalTok{, }\AttributeTok{length.out =} \DecValTok{11}\NormalTok{)}
\FunctionTok{seq}\NormalTok{(}\DecValTok{0}\NormalTok{, }\DecValTok{10}\NormalTok{, }\AttributeTok{along.with =}\NormalTok{ LETTERS)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1] -1.0 -0.8 -0.6 -0.4 -0.2  0.0  0.2  0.4  0.6  0.8  1.0
##  [1]   0  10  20  30  40  50  60  70  80  90 100
##  [1]  0.0  0.4  0.8  1.2  1.6  2.0  2.4  2.8  3.2  3.6  4.0  4.4  4.8  5.2  5.6
## [16]  6.0  6.4  6.8  7.2  7.6  8.0  8.4  8.8  9.2  9.6 10.0
\end{verbatim}

What if you want to repeat a vector many times? You could either type it out (painful) or use the \texttt{rep()} function, which can repeat vectors in different ways.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{rep}\NormalTok{(}\DecValTok{0}\NormalTok{, }\DecValTok{10}\NormalTok{)                      }\CommentTok{\# ten zeroes}
\FunctionTok{rep}\NormalTok{(}\FunctionTok{c}\NormalTok{(1L, 3L), }\AttributeTok{times =} \DecValTok{7}\NormalTok{)       }\CommentTok{\# alternating 1 and 3, 7 times}
\FunctionTok{rep}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{"A"}\NormalTok{, }\StringTok{"B"}\NormalTok{, }\StringTok{"C"}\NormalTok{), }\AttributeTok{each =} \DecValTok{2}\NormalTok{) }\CommentTok{\# A to C, 2 times each}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1] 0 0 0 0 0 0 0 0 0 0
##  [1] 1 3 1 3 1 3 1 3 1 3 1 3 1 3
## [1] "A" "A" "B" "B" "C" "C"
\end{verbatim}

The \texttt{rep()} function is useful to create a vector of logical values (\texttt{TRUE}/\texttt{FALSE} or \texttt{1}/\texttt{0}) to select values from another vector.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Get subject IDs in the pattern Y Y N N ...}
\NormalTok{subject\_ids }\OtherTok{\textless{}{-}} \DecValTok{1}\SpecialCharTok{:}\DecValTok{40}
\NormalTok{yynn }\OtherTok{\textless{}{-}} \FunctionTok{rep}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\ConstantTok{TRUE}\NormalTok{, }\ConstantTok{FALSE}\NormalTok{), }\AttributeTok{each =} \DecValTok{2}\NormalTok{, }
            \AttributeTok{length.out =} \FunctionTok{length}\NormalTok{(subject\_ids))}
\NormalTok{subject\_ids[yynn]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1]  1  2  5  6  9 10 13 14 17 18 21 22 25 26 29 30 33 34 37 38
\end{verbatim}

\hypertarget{vectorized_ops}{%
\subsubsection{Vectorized Operations}\label{vectorized_ops}}

R performs calculations on vectors in a special way. Let's look at an example using \(z\)-scores. A \(z\)-score is a deviation score(a score minus a mean) divided by a standard deviation. Let's say we have a set of four IQ scores.

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# example IQ scores: mu = 100, sigma = 15}
\NormalTok{iq }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\DecValTok{86}\NormalTok{, }\DecValTok{101}\NormalTok{, }\DecValTok{127}\NormalTok{, }\DecValTok{99}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

If we want to subtract the mean from these four scores, we just use the following code:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{iq }\SpecialCharTok{{-}} \DecValTok{100}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] -14   1  27  -1
\end{verbatim}

This subtracts 100 from each element of the vector. R automatically assumes that this is what you wanted to do; it is called a vectorized operation and it makes it possible to express operations more efficiently.

To calculate \(z\)-scores we use the formula:

\(z = \frac{X - \mu}{\sigma}\)

where X are the scores, \(\mu\) is the mean, and \(\sigma\) is the standard deviation. We can expression this formula in R as follows:

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# z{-}scores}
\NormalTok{(iq }\SpecialCharTok{{-}} \DecValTok{100}\NormalTok{) }\SpecialCharTok{/} \DecValTok{15}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] -0.93333333  0.06666667  1.80000000 -0.06666667
\end{verbatim}

You can see that it computed all four \(z\)-scores with a single line of code. In later chapters, we'll use vectorised operations to process our data, such as reverse-scoring some questionnaire items.

\hypertarget{lists}{%
\subsection{Lists}\label{lists}}

Recall that vectors can contain data of only one type. What if you want to store a collection of data of different data types? For that purpose you would use a list. Define a list using the \texttt{list()} function.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{data\_types }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(}
  \AttributeTok{double =} \FloatTok{10.0}\NormalTok{,}
  \AttributeTok{integer =}\NormalTok{ 10L,}
  \AttributeTok{character =} \StringTok{"10"}\NormalTok{,}
  \AttributeTok{logical =} \ConstantTok{TRUE}
\NormalTok{)}

\FunctionTok{str}\NormalTok{(data\_types) }\CommentTok{\# str() prints lists in a condensed format}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## List of 4
##  $ double   : num 10
##  $ integer  : int 10
##  $ character: chr "10"
##  $ logical  : logi TRUE
\end{verbatim}

You can refer to elements of a list using square brackets like a vector, but you can also use the dollar sign notation (\texttt{\$}) if the list items have names.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{data\_types}\SpecialCharTok{$}\NormalTok{logical}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] TRUE
\end{verbatim}

\begin{try}

Explore the 5 ways shown below to extract a value from a list. What data type is each object? What is the difference between the single and double brackets? Which one is the same as the dollar sign?

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{bracket1 }\OtherTok{\textless{}{-}}\NormalTok{ data\_types[}\DecValTok{1}\NormalTok{]}
\NormalTok{bracket2 }\OtherTok{\textless{}{-}}\NormalTok{ data\_types[[}\DecValTok{1}\NormalTok{]]}
\NormalTok{name1    }\OtherTok{\textless{}{-}}\NormalTok{ data\_types[}\StringTok{"double"}\NormalTok{]}
\NormalTok{name2    }\OtherTok{\textless{}{-}}\NormalTok{ data\_types[[}\StringTok{"double"}\NormalTok{]]}
\NormalTok{dollar   }\OtherTok{\textless{}{-}}\NormalTok{ data\_types}\SpecialCharTok{$}\NormalTok{double}
\end{Highlighting}
\end{Shaded}

\end{try}

\hypertarget{tables-data}{%
\subsection{Tables}\label{tables-data}}

The built-in, imported, and created data above are tabular data, data arranged in the form of a table.

Tabular data structures allow for a collection of data of different types (characters, integers, logical, etc.) but subject to the constraint that each ``column'' of the table (element of the list) must have the same number of elements. The base R version of a table is called a \texttt{data.frame}, while the `tidyverse' version is called a \texttt{tibble}. Tibbles are far easier to work with, so we'll be using those. To learn more about differences between these two data structures, see \texttt{vignette("tibble")}.

Tabular data becomes especially important for when we talk about tidy data in \protect\hyperlink{tidyr}{chapter 4}, which consists of a set of simple principles for structuring data.

\hypertarget{creating-a-table}{%
\subsubsection{Creating a table}\label{creating-a-table}}

We learned how to create a table by importing a Excel or CSV file, and creating a table from scratch using the \texttt{tibble()} function. You can also use the \texttt{tibble::tribble()} function to create a table by row, rather than by column. You start by listing the column names, each preceded by a tilde (\texttt{\textasciitilde{}}), then you list the values for each column, row by row, separated by commas (don't forget a comma at the end of each row). This method can be easier for some data, but doesn't let you use shortcuts, like setting all of the values in a column to the same value or a \protect\hyperlink{rep_seq}{repeating sequence}.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# by column using tibble}
\NormalTok{avatar\_by\_col }\OtherTok{\textless{}{-}} \FunctionTok{tibble}\NormalTok{(}
  \AttributeTok{name =} \FunctionTok{c}\NormalTok{(}\StringTok{"Katara"}\NormalTok{, }\StringTok{"Toph"}\NormalTok{, }\StringTok{"Sokka"}\NormalTok{, }\StringTok{"Azula"}\NormalTok{),}
  \AttributeTok{bends =} \FunctionTok{c}\NormalTok{(}\StringTok{"water"}\NormalTok{, }\StringTok{"earth"}\NormalTok{, }\ConstantTok{NA}\NormalTok{, }\StringTok{"fire"}\NormalTok{),}
  \AttributeTok{friendly =} \FunctionTok{rep}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\ConstantTok{TRUE}\NormalTok{, }\ConstantTok{FALSE}\NormalTok{), }\FunctionTok{c}\NormalTok{(}\DecValTok{3}\NormalTok{, }\DecValTok{1}\NormalTok{))}
\NormalTok{)}

\CommentTok{\# by row using tribble}
\NormalTok{avatar\_by\_row }\OtherTok{\textless{}{-}} \FunctionTok{tribble}\NormalTok{(}
  \SpecialCharTok{\textasciitilde{}}\NormalTok{name,    }\SpecialCharTok{\textasciitilde{}}\NormalTok{bends, }\SpecialCharTok{\textasciitilde{}}\NormalTok{friendly,}
  \StringTok{"Katara"}\NormalTok{, }\StringTok{"water"}\NormalTok{,       }\ConstantTok{TRUE}\NormalTok{,}
  \StringTok{"Toph"}\NormalTok{,   }\StringTok{"earth"}\NormalTok{,       }\ConstantTok{TRUE}\NormalTok{,}
  \StringTok{"Sokka"}\NormalTok{,  }\ConstantTok{NA}\NormalTok{,            }\ConstantTok{TRUE}\NormalTok{,}
  \StringTok{"Azula"}\NormalTok{,  }\StringTok{"fire"}\NormalTok{,        }\ConstantTok{FALSE}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{table-info}{%
\subsubsection{Table info}\label{table-info}}

We can get information about the table using the functions \texttt{ncol()} (number of columns), \texttt{nrow()} (number of rows), \texttt{dim()} (the number of rows and number of columns), and \texttt{name()} (the column names).

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{nrow}\NormalTok{(avatar) }\CommentTok{\# how many rows?}
\FunctionTok{ncol}\NormalTok{(avatar) }\CommentTok{\# how many columns?}
\FunctionTok{dim}\NormalTok{(avatar)  }\CommentTok{\# what are the table dimensions?}
\FunctionTok{names}\NormalTok{(avatar) }\CommentTok{\# what are the column names?}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 3
## [1] 3
## [1] 3 3
## [1] "name"     "bends"    "friendly"
\end{verbatim}

\hypertarget{row-col-access}{%
\subsubsection{Accessing rows and columns}\label{row-col-access}}

There are various ways of accessing specific columns or rows from a table. The ones below are from base R and are useful to know about, but you'll be learning easier (and more readable) ways in the \protect\hyperlink{tidyr}{tidyr} and \protect\hyperlink{dplyr}{dplyr} lessons. Examples of these base R accessing functions are provided here for reference, since you might see them in other people's scripts.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{katara     }\OtherTok{\textless{}{-}}\NormalTok{ avatar[}\DecValTok{1}\NormalTok{, ] }\CommentTok{\# first row}
\NormalTok{type       }\OtherTok{\textless{}{-}}\NormalTok{ avatar[, }\DecValTok{2}\NormalTok{] }\CommentTok{\# second column (bends)}
\NormalTok{benders    }\OtherTok{\textless{}{-}}\NormalTok{ avatar[}\FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{2}\NormalTok{), ] }\CommentTok{\# selected rows (by number)}
\NormalTok{bends\_name }\OtherTok{\textless{}{-}}\NormalTok{ avatar[, }\FunctionTok{c}\NormalTok{(}\StringTok{"bends"}\NormalTok{, }\StringTok{"name"}\NormalTok{)] }\CommentTok{\# selected columns (by name)}
\NormalTok{friendly   }\OtherTok{\textless{}{-}}\NormalTok{ avatar}\SpecialCharTok{$}\NormalTok{friendly  }\CommentTok{\# by column name}
\end{Highlighting}
\end{Shaded}

\hypertarget{troubleshooting}{%
\section{Troubleshooting}\label{troubleshooting}}

What if you import some data and it guesses the wrong column type? The most common reason is that a numeric column has some non-numbers in it somewhere. Maybe someone wrote a note in an otherwise numeric column. Columns have to be all one data type, so if there are any characters, the whole column is converted to character strings, and numbers like {1.2} get represented as {``1.2''}, which will cause very weird errors like \texttt{"100"\ \textless{}\ "9"\ ==\ TRUE}. You can catch this by using {glimpse}{(}{)} to check your data.

The data directory you created with \texttt{reprores::getdata()} contains a file called ``mess.csv''. Let's try loading this dataset.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mess }\OtherTok{\textless{}{-}} \FunctionTok{read\_csv}\NormalTok{(}\StringTok{"data/mess.csv"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Rows: 27 Columns: 1
\end{verbatim}

\begin{verbatim}
## -- Column specification --------------------------------------------------------
## Delimiter: ","
## chr (1): This is my messy dataset
\end{verbatim}

\begin{verbatim}
## 
## i Use `spec()` to retrieve the full column specification for this data.
## i Specify the column types or set `show_col_types = FALSE` to quiet this message.
\end{verbatim}

You'll get a warning with many parsing errors and \texttt{mess} is just a single column of the word ``junk''. View the file \texttt{data/mess.csv} by clicking on it in the File pane, and choosing ``View File''. Here are the first 10 lines. What went wrong?

\begin{verbatim}
This is my messy dataset

junk,order,score,letter,good,min_max,date
junk,1,-1,a,1,1 - 2,2020-01-1

junk,missing,0.72,b,1,2 - 3,2020-01-2

junk,3,-0.62,c,FALSE,3 - 4,2020-01-3

junk,4,2.03,d,T,4 - 5,2020-01-4
\end{verbatim}

First, the file starts with a note: ``This is my messy dataset''. We want to skip the first two lines. You can do this with the argument \texttt{skip} in \texttt{read\_csv()}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mess }\OtherTok{\textless{}{-}} \FunctionTok{read\_csv}\NormalTok{(}\StringTok{"data/mess.csv"}\NormalTok{, }\AttributeTok{skip =} \DecValTok{2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Rows: 26 Columns: 7
\end{verbatim}

\begin{verbatim}
## -- Column specification --------------------------------------------------------
## Delimiter: ","
## chr (6): junk, order, letter, good, min_max, date
## dbl (1): score
\end{verbatim}

\begin{verbatim}
## 
## i Use `spec()` to retrieve the full column specification for this data.
## i Specify the column types or set `show_col_types = FALSE` to quiet this message.
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mess}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 26 x 7
##    junk  order   score letter good  min_max date      
##    <chr> <chr>   <dbl> <chr>  <chr> <chr>   <chr>     
##  1 junk  1       -1    a      1     1 - 2   2020-01-1 
##  2 junk  missing  0.72 b      1     2 - 3   2020-01-2 
##  3 junk  3       -0.62 c      FALSE 3 - 4   2020-01-3 
##  4 junk  4        2.03 d      T     4 - 5   2020-01-4 
##  5 junk  5       NA    e      1     5 - 6   2020-01-5 
##  6 junk  6        0.99 f      0     6 - 7   2020-01-6 
##  7 junk  7        0.03 g      T     7 - 8   2020-01-7 
##  8 junk  8        0.67 h      TRUE  8 - 9   2020-01-8 
##  9 junk  9        0.57 i      1     9 - 10  2020-01-9 
## 10 junk  10       0.9  j      T     10 - 11 2020-01-10
## # ... with 16 more rows
\end{verbatim}

OK, that's a little better, but this table is still a serious mess in several ways:

\begin{itemize}
\tightlist
\item
  \texttt{junk} is a column that we don't need
\item
  \texttt{order} should be an integer column
\item
  \texttt{good} should be a logical column
\item
  \texttt{good} uses all kinds of different ways to record TRUE and FALSE values
\item
  \texttt{min\_max} contains two pieces of numeric information, but is a character column
\item
  \texttt{date} should be a date column
\end{itemize}

We'll learn how to deal with this mess in Chapters~\ref{tidyr} and \ref{dplyr}, but we can fix a few things by setting the \texttt{col\_types} argument in {read\_csv}{(}{)} to specify the column types for our two columns that were guessed wrong and skip the ``junk'' column. The argument \texttt{col\_types} takes a list where the name of each item in the list is a column name and the value is from the table below. You can use the function, like {col\_double}{(}{)} or the abbreviation, like {``l''}. Omitted column names are guessed.

\begin{longtable}[]{@{}lll@{}}
\toprule
function & & abbreviation \\
\midrule
\endhead
col\_logical() & l & logical values \\
col\_integer() & i & integer values \\
col\_double() & d & numeric values \\
col\_character() & c & strings \\
col\_factor(levels, ordered) & f & a fixed set of values \\
col\_date(format = "") & D & with the locale's date\_format \\
col\_time(format = "") & t & with the locale's time\_format \\
col\_datetime(format = "") & T & ISO8601 date time \\
col\_number() & n & numbers containing the grouping\_mark \\
col\_skip() & \_, - & don't import this column \\
col\_guess() & ? & parse using the ``best'' type based on the input \\
\bottomrule
\end{longtable}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# omitted values are guessed}
\CommentTok{\# ?col\_date for format options}
\NormalTok{ct }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(}
  \AttributeTok{junk =} \StringTok{"{-}"}\NormalTok{, }\CommentTok{\# skip this column}
  \AttributeTok{order =} \StringTok{"i"}\NormalTok{,}
  \AttributeTok{good =} \StringTok{"l"}\NormalTok{,}
  \AttributeTok{date =} \FunctionTok{col\_date}\NormalTok{(}\AttributeTok{format =} \StringTok{"\%Y{-}\%m{-}\%d"}\NormalTok{)}
\NormalTok{)}

\NormalTok{tidier }\OtherTok{\textless{}{-}} \FunctionTok{read\_csv}\NormalTok{(}\StringTok{"data/mess.csv"}\NormalTok{, }
                   \AttributeTok{skip =} \DecValTok{2}\NormalTok{,}
                   \AttributeTok{col\_types =}\NormalTok{ ct)}
\end{Highlighting}
\end{Shaded}

You will get a message about ``1 parsing failure'' when you run this. Warnings look scary at first, but always start by reading the message. The table tells you what row (\texttt{2}) and column (\texttt{order}) the error was found in, what kind of data was expected (\texttt{integer}), and what the actual value was ({``missing''}). If you specifically tell {read\_csv}{(}{)} to import a column as an integer, any characters in the column will produce a warning like this and then be recorded as \texttt{NA}. You can manually set what the missing values were recorded as with the \texttt{na} argument.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{tidiest }\OtherTok{\textless{}{-}} \FunctionTok{read\_csv}\NormalTok{(}\StringTok{"data/mess.csv"}\NormalTok{, }
                   \AttributeTok{skip =} \DecValTok{2}\NormalTok{,}
                   \AttributeTok{na =} \StringTok{"missing"}\NormalTok{,}
                   \AttributeTok{col\_types =}\NormalTok{ ct)}
\end{Highlighting}
\end{Shaded}

Now \texttt{order} is an integer where ``missing'' is now \texttt{NA}, \texttt{good} is a logical value, where {0} and {F} are converted to {FALSE} and {1} and {T} are converted to {TRUE}, and \texttt{date} is a date type (adding leading zeros to the day). We'll learn in later chapters how to fix other problems, such as the \texttt{min\_max} column containing two different types of data.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{tidiest}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 26 x 6
##    order score letter good  min_max date      
##    <int> <chr> <chr>  <lgl> <chr>   <date>    
##  1     1 -1    a      TRUE  1 - 2   2020-01-01
##  2    NA 0.72  b      TRUE  2 - 3   2020-01-02
##  3     3 -0.62 c      FALSE 3 - 4   2020-01-03
##  4     4 2.03  d      TRUE  4 - 5   2020-01-04
##  5     5 NA    e      TRUE  5 - 6   2020-01-05
##  6     6 0.99  f      FALSE 6 - 7   2020-01-06
##  7     7 0.03  g      TRUE  7 - 8   2020-01-07
##  8     8 0.67  h      TRUE  8 - 9   2020-01-08
##  9     9 0.57  i      TRUE  9 - 10  2020-01-09
## 10    10 0.9   j      TRUE  10 - 11 2020-01-10
## # ... with 16 more rows
\end{verbatim}

\hypertarget{glossary-data}{%
\section{Glossary}\label{glossary-data}}

\begin{tabular}{l|l}
\hline
term & definition\\
\hline
base-r & The set of R functions that come with a basic installation of R, before you add external packages\\
\hline
character & A data type representing strings of text.\\
\hline
coercion & Changing the data type of values in a vector to a single compatible type.\\
\hline
csv & Comma-separated variable: a file type for representing data where each variable is separated from the next by a comma.\\
\hline
data-type & The kind of data represented by an object.\\
\hline
deviation-score & A score minus the mean\\
\hline
double & A data type representing a real decimal number\\
\hline
escape & Include special characters like " inside of a string by prefacing them with a backslash.\\
\hline
extension & The end part of a file name that tells you what type of file it is (e.g., .R or .Rmd).\\
\hline
extract-operator & A symbol used to get values from a container object, such as [, [[, or \$\\
\hline
factor & A data type where a specific set of values are stored with labels; An explanatory variable manipulated by the experimenter\\
\hline
global-environment & The interactive workspace where your script runs\\
\hline
integer & A data type representing whole numbers.\\
\hline
list & A container data type that allows items with different data types to be grouped together.\\
\hline
logical & A data type representing TRUE or FALSE values.\\
\hline
numeric & A data type representing a real decimal number or integer.\\
\hline
object & A word that identifies and stores the value of some data for later use.\\
\hline
operator & A symbol that performs a mathematical operation, such as +, -, *, /\\
\hline
panes & RStudio is arranged with four window "panes".\\
\hline
tabular-data & Data in a rectangular table format, where each row has an entry for each column.\\
\hline
tidy-data & A format for data that maps the meaning onto the structure.\\
\hline
tidyverse & A set of R packages that help you create and work with tidy data\\
\hline
vector & A type of data structure that collects values with the same data type, like T/F values, numbers, or strings.\\
\hline
vectorized & An operator or function that acts on each element in a vector\\
\hline
\end{tabular}

\hypertarget{resources-data}{%
\section{Further Resources}\label{resources-data}}

\begin{itemize}
\tightlist
\item
  \href{http://r4ds.had.co.nz/data-import.html}{Chapter 11: Data Import} in \emph{R for Data Science}
\item
  \href{https://github.com/rstudio/cheatsheets/raw/master/data-import.pdf}{RStudio Data Import Cheatsheet}
\end{itemize}

\hypertarget{joins}{%
\chapter{Data Relations}\label{joins}}

\hypertarget{ilo-joins}{%
\section{Learning Objectives}\label{ilo-joins}}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Be able to use the 4 mutating join verbs: \href{https://youtu.be/WV0yg6f3DNM}{(video)}

  \begin{itemize}
  \tightlist
  \item
    \protect\hyperlink{left_join}{\texttt{left\_join()}}
  \item
    \protect\hyperlink{right_join}{\texttt{right\_join()}}
  \item
    \protect\hyperlink{inner_join}{\texttt{inner\_join()}}
  \item
    \protect\hyperlink{full_join}{\texttt{full\_join()}}
  \end{itemize}
\item
  Be able to use the 2 filtering join verbs: \href{https://youtu.be/ijoCEKifefQ}{(video)}

  \begin{itemize}
  \tightlist
  \item
    \protect\hyperlink{semi_join}{\texttt{semi\_join()}}
  \item
    \protect\hyperlink{anti_join}{\texttt{anti\_join()}}
  \end{itemize}
\item
  Be able to use the 2 binding join verbs: \href{https://youtu.be/8RWdNhbVZ4I}{(video)}

  \begin{itemize}
  \tightlist
  \item
    \protect\hyperlink{bind_rows}{\texttt{bind\_rows()}}
  \item
    \protect\hyperlink{bind_cols}{\texttt{bind\_cols()}}
  \end{itemize}
\item
  Be able to use the 3 set operations: \href{https://youtu.be/c3V33ElWUYI}{(video)}

  \begin{itemize}
  \tightlist
  \item
    \protect\hyperlink{intersect}{\texttt{intersect()}}
  \item
    \protect\hyperlink{union}{\texttt{union()}}
  \item
    \protect\hyperlink{setdiff}{\texttt{setdiff()}}
  \end{itemize}
\end{enumerate}

\hypertarget{setup-joins}{%
\section{Setup}\label{setup-joins}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# libraries needed}
\FunctionTok{library}\NormalTok{(tidyverse)}
\FunctionTok{library}\NormalTok{(reprores)}
\end{Highlighting}
\end{Shaded}

\hypertarget{data-1}{%
\section{Data}\label{data-1}}

First, we'll create two small data tables.

\texttt{subject} has id, gender and age for subjects 1-5. Age and gender are missing for subject 3.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{subject }\OtherTok{\textless{}{-}} \FunctionTok{tibble}\NormalTok{(}
  \AttributeTok{id =} \DecValTok{1}\SpecialCharTok{:}\DecValTok{5}\NormalTok{,}
  \AttributeTok{gender =} \FunctionTok{c}\NormalTok{(}\StringTok{"m"}\NormalTok{, }\StringTok{"m"}\NormalTok{, }\ConstantTok{NA}\NormalTok{, }\StringTok{"nb"}\NormalTok{, }\StringTok{"f"}\NormalTok{),}
  \AttributeTok{age =} \FunctionTok{c}\NormalTok{(}\DecValTok{19}\NormalTok{, }\DecValTok{22}\NormalTok{, }\ConstantTok{NA}\NormalTok{, }\DecValTok{19}\NormalTok{, }\DecValTok{18}\NormalTok{)}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{tabular}{r|l|r}
\hline
id & gender & age\\
\hline
1 & m & 19\\
\hline
2 & m & 22\\
\hline
3 & NA & NA\\
\hline
4 & nb & 19\\
\hline
5 & f & 18\\
\hline
\end{tabular}

\texttt{exp} has subject id and the score from an experiment. Some subjects are missing, some completed twice, and some are not in the subject table.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{exp }\OtherTok{\textless{}{-}} \FunctionTok{tibble}\NormalTok{(}
  \AttributeTok{id =} \FunctionTok{c}\NormalTok{(}\DecValTok{2}\NormalTok{, }\DecValTok{3}\NormalTok{, }\DecValTok{4}\NormalTok{, }\DecValTok{4}\NormalTok{, }\DecValTok{5}\NormalTok{, }\DecValTok{5}\NormalTok{, }\DecValTok{6}\NormalTok{, }\DecValTok{6}\NormalTok{, }\DecValTok{7}\NormalTok{),}
  \AttributeTok{score =} \FunctionTok{c}\NormalTok{(}\DecValTok{10}\NormalTok{, }\DecValTok{18}\NormalTok{, }\DecValTok{21}\NormalTok{, }\DecValTok{23}\NormalTok{, }\DecValTok{9}\NormalTok{, }\DecValTok{11}\NormalTok{, }\DecValTok{11}\NormalTok{, }\DecValTok{12}\NormalTok{, }\DecValTok{3}\NormalTok{)}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{tabular}{r|r}
\hline
id & score\\
\hline
2 & 10\\
\hline
3 & 18\\
\hline
4 & 21\\
\hline
4 & 23\\
\hline
5 & 9\\
\hline
5 & 11\\
\hline
6 & 11\\
\hline
6 & 12\\
\hline
7 & 3\\
\hline
\end{tabular}

\hypertarget{mutating-joins}{%
\section{Mutating Joins}\label{mutating-joins}}

Mutating joins act like the \texttt{mutate()} function in that they add new columns to one table based on values in another table.

All the mutating joins have this basic syntax:

\texttt{****\_join(x,\ y,\ by\ =\ NULL,\ suffix\ =\ c(".x",\ ".y")}

\begin{itemize}
\tightlist
\item
  \texttt{x} = the first (left) table
\item
  \texttt{y} = the second (right) table
\item
  \texttt{by} = what columns to match on. If you leave this blank, it will match on all columns with the same names in the two tables.
\item
  \texttt{suffix} = if columns have the same name in the two tables, but you aren't joining by them, they get a suffix to make them unambiguous. This defaults to ``.x'' and ``.y'', but you can change it to something more meaningful.
\end{itemize}

\begin{info}
You can leave out the \texttt{by} argument if you're matching on all of the columns with the same name, but it's good practice to always specify it so your code is robust to changes in the loaded data.

\end{info}

\hypertarget{left_join}{%
\subsection{left\_join()}\label{left_join}}

\begin{figure}

{\centering \includegraphics[width=1\linewidth]{images/joins/left_join} 

}

\caption{Left Join}\label{fig:img-left-join}
\end{figure}

A \texttt{left\_join} keeps all the data from the first (left) table and joins anything that matches from the second (right) table. If the right table has more than one match for a row in the right table, there will be more than one row in the joined table (see ids 4 and 5).

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{left\_join}\NormalTok{(subject, exp, }\AttributeTok{by =} \StringTok{"id"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 7 x 4
##      id gender   age score
##   <dbl> <chr>  <dbl> <dbl>
## 1     1 m         19    NA
## 2     2 m         22    10
## 3     3 <NA>      NA    18
## 4     4 nb        19    21
## 5     4 nb        19    23
## 6     5 f         18     9
## 7     5 f         18    11
\end{verbatim}

\begin{figure}

{\centering \includegraphics[width=1\linewidth]{images/joins/left_join_rev} 

}

\caption{Left Join (reversed)}\label{fig:img-left-join-rev}
\end{figure}

The order of tables is swapped here, so the result is all rows from the \texttt{exp} table joined to any matching rows from the \texttt{subject} table.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{left\_join}\NormalTok{(exp, subject, }\AttributeTok{by =} \StringTok{"id"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 9 x 4
##      id score gender   age
##   <dbl> <dbl> <chr>  <dbl>
## 1     2    10 m         22
## 2     3    18 <NA>      NA
## 3     4    21 nb        19
## 4     4    23 nb        19
## 5     5     9 f         18
## 6     5    11 f         18
## 7     6    11 <NA>      NA
## 8     6    12 <NA>      NA
## 9     7     3 <NA>      NA
\end{verbatim}

\hypertarget{right_join}{%
\subsection{right\_join()}\label{right_join}}

\begin{figure}

{\centering \includegraphics[width=1\linewidth]{images/joins/right_join} 

}

\caption{Right Join}\label{fig:img-right-join}
\end{figure}

A \texttt{right\_join} keeps all the data from the second (right) table and joins anything that matches from the first (left) table.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{right\_join}\NormalTok{(subject, exp, }\AttributeTok{by =} \StringTok{"id"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 9 x 4
##      id gender   age score
##   <dbl> <chr>  <dbl> <dbl>
## 1     2 m         22    10
## 2     3 <NA>      NA    18
## 3     4 nb        19    21
## 4     4 nb        19    23
## 5     5 f         18     9
## 6     5 f         18    11
## 7     6 <NA>      NA    11
## 8     6 <NA>      NA    12
## 9     7 <NA>      NA     3
\end{verbatim}

\begin{info}
This table has the same information as \texttt{left\_join(exp,\ subject,\ by\ =\ "id")}, but the columns are in a different order (left table, then right table).

\end{info}

\hypertarget{inner_join}{%
\subsection{inner\_join()}\label{inner_join}}

\begin{figure}

{\centering \includegraphics[width=1\linewidth]{images/joins/inner_join} 

}

\caption{Inner Join}\label{fig:img-inner-join}
\end{figure}

An \texttt{inner\_join} returns all the rows that have a match in the other table.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{inner\_join}\NormalTok{(subject, exp, }\AttributeTok{by =} \StringTok{"id"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 6 x 4
##      id gender   age score
##   <dbl> <chr>  <dbl> <dbl>
## 1     2 m         22    10
## 2     3 <NA>      NA    18
## 3     4 nb        19    21
## 4     4 nb        19    23
## 5     5 f         18     9
## 6     5 f         18    11
\end{verbatim}

\hypertarget{full_join}{%
\subsection{full\_join()}\label{full_join}}

\begin{figure}

{\centering \includegraphics[width=1\linewidth]{images/joins/full_join} 

}

\caption{Full Join}\label{fig:img-full-join}
\end{figure}

A \texttt{full\_join} lets you join up rows in two tables while keeping all of the information from both tables. If a row doesn't have a match in the other table, the other table's column values are set to \texttt{NA}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{full\_join}\NormalTok{(subject, exp, }\AttributeTok{by =} \StringTok{"id"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 10 x 4
##       id gender   age score
##    <dbl> <chr>  <dbl> <dbl>
##  1     1 m         19    NA
##  2     2 m         22    10
##  3     3 <NA>      NA    18
##  4     4 nb        19    21
##  5     4 nb        19    23
##  6     5 f         18     9
##  7     5 f         18    11
##  8     6 <NA>      NA    11
##  9     6 <NA>      NA    12
## 10     7 <NA>      NA     3
\end{verbatim}

\hypertarget{filtering-joins}{%
\section{Filtering Joins}\label{filtering-joins}}

Filtering joins act like the \texttt{filter()} function in that they remove rows from the data in one table based on the values in another table. The result of a filtering join will only contain rows from the left table and have the same number or fewer rows than the left table.

\hypertarget{semi_join}{%
\subsection{semi\_join()}\label{semi_join}}

\begin{figure}

{\centering \includegraphics[width=1\linewidth]{images/joins/semi_join} 

}

\caption{Semi Join}\label{fig:img-semi-join}
\end{figure}

A \texttt{semi\_join} returns all rows from the left table where there are matching values in the right table, keeping just columns from the left table.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{semi\_join}\NormalTok{(subject, exp, }\AttributeTok{by =} \StringTok{"id"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 4 x 3
##      id gender   age
##   <int> <chr>  <dbl>
## 1     2 m         22
## 2     3 <NA>      NA
## 3     4 nb        19
## 4     5 f         18
\end{verbatim}

\begin{info}
Unlike an inner join, a semi join will never duplicate the rows in the left table if there is more than one matching row in the right table.

\end{info}

\begin{figure}

{\centering \includegraphics[width=1\linewidth]{images/joins/semi_join_rev} 

}

\caption{Semi Join (Reversed)}\label{fig:img-semi-join-rev}
\end{figure}

Order matters in a semi join.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{semi\_join}\NormalTok{(exp, subject, }\AttributeTok{by =} \StringTok{"id"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 6 x 2
##      id score
##   <dbl> <dbl>
## 1     2    10
## 2     3    18
## 3     4    21
## 4     4    23
## 5     5     9
## 6     5    11
\end{verbatim}

\hypertarget{anti_join}{%
\subsection{anti\_join()}\label{anti_join}}

\begin{figure}

{\centering \includegraphics[width=1\linewidth]{images/joins/anti_join} 

}

\caption{Anti Join}\label{fig:img-anti-join}
\end{figure}

An \texttt{anti\_join} return all rows from the left table where there are \emph{not} matching values in the right table, keeping just columns from the left table.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{anti\_join}\NormalTok{(subject, exp, }\AttributeTok{by =} \StringTok{"id"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 1 x 3
##      id gender   age
##   <int> <chr>  <dbl>
## 1     1 m         19
\end{verbatim}

\begin{figure}

{\centering \includegraphics[width=1\linewidth]{images/joins/anti_join_rev} 

}

\caption{Anti Join (Reversed)}\label{fig:img-anti-join-rev}
\end{figure}

Order matters in an anti join.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{anti\_join}\NormalTok{(exp, subject, }\AttributeTok{by =} \StringTok{"id"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 3 x 2
##      id score
##   <dbl> <dbl>
## 1     6    11
## 2     6    12
## 3     7     3
\end{verbatim}

\hypertarget{binding-joins}{%
\section{Binding Joins}\label{binding-joins}}

Binding joins bind one table to another by adding their rows or columns together.

\hypertarget{bind_rows}{%
\subsection{bind\_rows()}\label{bind_rows}}

You can combine the rows of two tables with \texttt{bind\_rows}.

Here we'll add subject data for subjects 6-9 and bind that to the original subject table.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{new\_subjects }\OtherTok{\textless{}{-}} \FunctionTok{tibble}\NormalTok{(}
  \AttributeTok{id =} \DecValTok{6}\SpecialCharTok{:}\DecValTok{9}\NormalTok{,}
  \AttributeTok{gender =} \FunctionTok{c}\NormalTok{(}\StringTok{"nb"}\NormalTok{, }\StringTok{"m"}\NormalTok{, }\StringTok{"f"}\NormalTok{, }\StringTok{"f"}\NormalTok{),}
  \AttributeTok{age =} \FunctionTok{c}\NormalTok{(}\DecValTok{19}\NormalTok{, }\DecValTok{16}\NormalTok{, }\DecValTok{20}\NormalTok{, }\DecValTok{19}\NormalTok{)}
\NormalTok{)}

\FunctionTok{bind\_rows}\NormalTok{(subject, new\_subjects)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 9 x 3
##      id gender   age
##   <int> <chr>  <dbl>
## 1     1 m         19
## 2     2 m         22
## 3     3 <NA>      NA
## 4     4 nb        19
## 5     5 f         18
## 6     6 nb        19
## 7     7 m         16
## 8     8 f         20
## 9     9 f         19
\end{verbatim}

The columns just have to have the same names, they don't have to be in the same order. Any columns that differ between the two tables will just have \texttt{NA} values for entries from the other table.

If a row is duplicated between the two tables (like id 5 below), the row will also be duplicated in the resulting table. If your tables have the exact same columns, you can use \texttt{union()} (see below) to avoid duplicates.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{new\_subjects }\OtherTok{\textless{}{-}} \FunctionTok{tibble}\NormalTok{(}
  \AttributeTok{id =} \DecValTok{5}\SpecialCharTok{:}\DecValTok{9}\NormalTok{,}
  \AttributeTok{age =} \FunctionTok{c}\NormalTok{(}\DecValTok{18}\NormalTok{, }\DecValTok{19}\NormalTok{, }\DecValTok{16}\NormalTok{, }\DecValTok{20}\NormalTok{, }\DecValTok{19}\NormalTok{),}
  \AttributeTok{gender =} \FunctionTok{c}\NormalTok{(}\StringTok{"f"}\NormalTok{, }\StringTok{"nb"}\NormalTok{, }\StringTok{"m"}\NormalTok{, }\StringTok{"f"}\NormalTok{, }\StringTok{"f"}\NormalTok{),}
  \AttributeTok{new =} \FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{2}\NormalTok{,}\DecValTok{3}\NormalTok{,}\DecValTok{4}\NormalTok{,}\DecValTok{5}\NormalTok{)}
\NormalTok{)}

\FunctionTok{bind\_rows}\NormalTok{(subject, new\_subjects)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 10 x 4
##       id gender   age   new
##    <int> <chr>  <dbl> <dbl>
##  1     1 m         19    NA
##  2     2 m         22    NA
##  3     3 <NA>      NA    NA
##  4     4 nb        19    NA
##  5     5 f         18    NA
##  6     5 f         18     1
##  7     6 nb        19     2
##  8     7 m         16     3
##  9     8 f         20     4
## 10     9 f         19     5
\end{verbatim}

\hypertarget{bind_cols}{%
\subsection{bind\_cols()}\label{bind_cols}}

You can merge two tables with the same number of rows using \texttt{bind\_cols}. This is only useful if the two tables have their rows in the exact same order. The only advantage over a left join is when the tables don't have any IDs to join by and you have to rely solely on their order.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{new\_info }\OtherTok{\textless{}{-}} \FunctionTok{tibble}\NormalTok{(}
  \AttributeTok{colour =} \FunctionTok{c}\NormalTok{(}\StringTok{"red"}\NormalTok{, }\StringTok{"orange"}\NormalTok{, }\StringTok{"yellow"}\NormalTok{, }\StringTok{"green"}\NormalTok{, }\StringTok{"blue"}\NormalTok{)}
\NormalTok{)}

\FunctionTok{bind\_cols}\NormalTok{(subject, new\_info)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 5 x 4
##      id gender   age colour
##   <int> <chr>  <dbl> <chr> 
## 1     1 m         19 red   
## 2     2 m         22 orange
## 3     3 <NA>      NA yellow
## 4     4 nb        19 green 
## 5     5 f         18 blue
\end{verbatim}

\hypertarget{set-operations}{%
\section{Set Operations}\label{set-operations}}

Set operations compare two tables and return rows that match (intersect), are in either table (union), or are in one table but not the other (setdiff).

\hypertarget{intersect}{%
\subsection{intersect()}\label{intersect}}

\texttt{intersect()} returns all rows in two tables that match exactly. The columns don't have to be in the same order.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{new\_subjects }\OtherTok{\textless{}{-}} \FunctionTok{tibble}\NormalTok{(}
  \AttributeTok{id =} \FunctionTok{seq}\NormalTok{(}\DecValTok{4}\NormalTok{, }\DecValTok{9}\NormalTok{),}
  \AttributeTok{age =} \FunctionTok{c}\NormalTok{(}\DecValTok{19}\NormalTok{, }\DecValTok{18}\NormalTok{, }\DecValTok{19}\NormalTok{, }\DecValTok{16}\NormalTok{, }\DecValTok{20}\NormalTok{, }\DecValTok{19}\NormalTok{),}
  \AttributeTok{gender =} \FunctionTok{c}\NormalTok{(}\StringTok{"f"}\NormalTok{, }\StringTok{"f"}\NormalTok{, }\StringTok{"m"}\NormalTok{, }\StringTok{"m"}\NormalTok{, }\StringTok{"f"}\NormalTok{, }\StringTok{"f"}\NormalTok{)}
\NormalTok{)}

\FunctionTok{intersect}\NormalTok{(subject, new\_subjects)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 1 x 3
##      id gender   age
##   <int> <chr>  <dbl>
## 1     5 f         18
\end{verbatim}

\begin{warning}

If you've forgotten to load dplyr or the tidyverse, base R also has an \texttt{intersect()} function. The error message can be confusing and looks something like this:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{base}\SpecialCharTok{::}\FunctionTok{intersect}\NormalTok{(subject, new\_subjects)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Error: Must subset rows with a valid subscript vector.
## i Logical subscripts must match the size of the indexed input.
## x Input has size 6 but subscript `!duplicated(x, fromLast = fromLast, ...)` has size 0.
\end{verbatim}

\end{warning}

\hypertarget{union}{%
\subsection{union()}\label{union}}

\texttt{union()} returns all the rows from both tables, removing duplicate rows.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{union}\NormalTok{(subject, new\_subjects)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 10 x 3
##       id gender   age
##    <int> <chr>  <dbl>
##  1     1 m         19
##  2     2 m         22
##  3     3 <NA>      NA
##  4     4 nb        19
##  5     5 f         18
##  6     4 f         19
##  7     6 m         19
##  8     7 m         16
##  9     8 f         20
## 10     9 f         19
\end{verbatim}

\begin{warning}

If you've forgotten to load dplyr or the tidyverse, base R also has a \texttt{union()} function. You usually won't get an error message, but the output won't be what you expect.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{base}\SpecialCharTok{::}\FunctionTok{union}\NormalTok{(subject, new\_subjects)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [[1]]
## [1] 1 2 3 4 5
## 
## [[2]]
## [1] "m"  "m"  NA   "nb" "f" 
## 
## [[3]]
## [1] 19 22 NA 19 18
## 
## [[4]]
## [1] 4 5 6 7 8 9
## 
## [[5]]
## [1] 19 18 19 16 20 19
## 
## [[6]]
## [1] "f" "f" "m" "m" "f" "f"
\end{verbatim}

\end{warning}

\hypertarget{setdiff}{%
\subsection{setdiff()}\label{setdiff}}

\texttt{setdiff} returns rows that are in the first table, but not in the second table.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{setdiff}\NormalTok{(subject, new\_subjects)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 4 x 3
##      id gender   age
##   <int> <chr>  <dbl>
## 1     1 m         19
## 2     2 m         22
## 3     3 <NA>      NA
## 4     4 nb        19
\end{verbatim}

Order matters for \texttt{setdiff}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{setdiff}\NormalTok{(new\_subjects, subject)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 5 x 3
##      id   age gender
##   <int> <dbl> <chr> 
## 1     4    19 f     
## 2     6    19 m     
## 3     7    16 m     
## 4     8    20 f     
## 5     9    19 f
\end{verbatim}

\begin{warning}

If you've forgotten to load dplyr or the tidyverse, base R also has a \texttt{setdiff()} function. You usually won't get an error message, but the output might not be what you expect because the base R \texttt{setdiff()} expects columns to be in the same order, so id 5 here registers as different between the two tables.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{base}\SpecialCharTok{::}\FunctionTok{setdiff}\NormalTok{(subject, new\_subjects)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 5 x 3
##      id gender   age
##   <int> <chr>  <dbl>
## 1     1 m         19
## 2     2 m         22
## 3     3 <NA>      NA
## 4     4 nb        19
## 5     5 f         18
\end{verbatim}

\end{warning}

\hypertarget{glossary-joins}{%
\section{Glossary}\label{glossary-joins}}

\begin{tabular}{l|l}
\hline
term & definition\\
\hline
base-r & The set of R functions that come with a basic installation of R, before you add external packages\\
\hline
binding-joins & Joins that bind one table to another by adding their rows or columns together.\\
\hline
filtering-joins & Joins that act like the dplyr::filter() function in that they remove rows from the data in one table based on the values in another table.\\
\hline
mutating-joins & Joins that act like the dplyr::mutate() function in that they add new columns to one table based on values in another table.\\
\hline
set-operations & Functions that compare two tables and return rows that match (intersect), are in either table (union), or are in one table but not the other (setdiff).\\
\hline
\end{tabular}

\hypertarget{resources-joins}{%
\section{Further Resources}\label{resources-joins}}

\begin{itemize}
\tightlist
\item
  \href{http://r4ds.had.co.nz/relational-data.html}{Chapter 13: Relational Data} in \emph{R for Data Science}
\item
  \href{http://stat545.com/bit001_dplyr-cheatsheet.html}{Cheatsheet for dplyr join functions}
\item
  \href{slides/05_joins_slides.pdf}{Lecture slides on dplyr two-table verbs}
\end{itemize}

\hypertarget{tidyr}{%
\chapter{Tidy Data}\label{tidyr}}

\hypertarget{ilo-tidyr}{%
\section{Learning Objectives}\label{ilo-tidyr}}

\hypertarget{basic-2}{%
\subsection*{Basic}\label{basic-2}}
\addcontentsline{toc}{subsection}{Basic}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Understand the concept of \protect\hyperlink{tidy-data}{tidy data} \href{https://youtu.be/EsSN4OdsNpc}{(video)}
\item
  Be able to convert between long and wide formats using pivot functions \href{https://youtu.be/4dvLmjhwN8I}{(video)}

  \begin{itemize}
  \tightlist
  \item
    \protect\hyperlink{pivot_longer}{\texttt{pivot\_longer()}}
  \item
    \protect\hyperlink{pivot_wider}{\texttt{pivot\_wider()}}
  \end{itemize}
\item
  Be able to use the 4 basic \texttt{tidyr} verbs \href{https://youtu.be/oUWjb0JC8zM}{(video)}

  \begin{itemize}
  \tightlist
  \item
    \protect\hyperlink{gather}{\texttt{gather()}}
  \item
    \protect\hyperlink{separate}{\texttt{separate()}}
  \item
    \protect\hyperlink{spread}{\texttt{spread()}}
  \item
    \protect\hyperlink{unite}{\texttt{unite()}}
  \end{itemize}
\item
  Be able to chain functions using \protect\hyperlink{pipes}{pipes} \href{https://youtu.be/itfrlLaN4SE}{(video)}
\end{enumerate}

\hypertarget{intermediate-2}{%
\subsection*{Intermediate}\label{intermediate-2}}
\addcontentsline{toc}{subsection}{Intermediate}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{4}
\tightlist
\item
  Be able to use \protect\hyperlink{regex}{regular expressions} to separate complex columns
\end{enumerate}

\hypertarget{setup-tidyr}{%
\section{Setup}\label{setup-tidyr}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# libraries needed}
\FunctionTok{library}\NormalTok{(tidyverse)}
\FunctionTok{library}\NormalTok{(reprores)}

\FunctionTok{set.seed}\NormalTok{(}\DecValTok{8675309}\NormalTok{) }\CommentTok{\# makes sure random numbers are reproducible}
\end{Highlighting}
\end{Shaded}

\hypertarget{tidy-data}{%
\section{Tidy Data}\label{tidy-data}}

\hypertarget{three-rules}{%
\subsection{Three Rules}\label{three-rules}}

\begin{itemize}
\tightlist
\item
  Each variable must have its own column
\item
  Each observation must have its own row
\item
  Each value must have its own cell
\end{itemize}

This table has three observations per row and the \texttt{total\_meanRT} column contains two values.

\begin{table}

\caption{\label{tab:unnamed-chunk-1}Untidy table}
\centering
\begin{tabular}[t]{r|r|r|r|r|r|r|l}
\hline
id & score\_1 & score\_2 & score\_3 & rt\_1 & rt\_2 & rt\_3 & total\_meanRT\\
\hline
1 & 4 & 3 & 7 & 857 & 890 & 859 & 14 (869)\\
\hline
2 & 3 & 1 & 1 & 902 & 900 & 959 & 5 (920)\\
\hline
3 & 2 & 5 & 4 & 757 & 823 & 901 & 11 (827)\\
\hline
4 & 6 & 2 & 6 & 844 & 788 & 624 & 14 (752)\\
\hline
5 & 1 & 7 & 2 & 659 & 764 & 690 & 10 (704)\\
\hline
\end{tabular}
\end{table}

This is the tidy version.

\begin{table}

\caption{\label{tab:unnamed-chunk-1}Tidy table}
\centering
\begin{tabular}[t]{r|l|r|r|l|l}
\hline
id & trial & rt & score & total & mean\_rt\\
\hline
1 & 1 & 857 & 4 & 14 & 869\\
\hline
1 & 2 & 890 & 3 & 14 & 869\\
\hline
1 & 3 & 859 & 7 & 14 & 869\\
\hline
2 & 1 & 902 & 3 & 5 & 920\\
\hline
2 & 2 & 900 & 1 & 5 & 920\\
\hline
2 & 3 & 959 & 1 & 5 & 920\\
\hline
3 & 1 & 757 & 2 & 11 & 827\\
\hline
3 & 2 & 823 & 5 & 11 & 827\\
\hline
3 & 3 & 901 & 4 & 11 & 827\\
\hline
4 & 1 & 844 & 6 & 14 & 752\\
\hline
4 & 2 & 788 & 2 & 14 & 752\\
\hline
4 & 3 & 624 & 6 & 14 & 752\\
\hline
5 & 1 & 659 & 1 & 10 & 704\\
\hline
5 & 2 & 764 & 7 & 10 & 704\\
\hline
5 & 3 & 690 & 2 & 10 & 704\\
\hline
\end{tabular}
\end{table}

\hypertarget{wide_long}{%
\subsection{Wide versus long}\label{wide_long}}

Data tables can be in wide format or long format (and sometimes a mix of the two). Wide data are where all of the observations about one subject are in the same row, while long data are where each observation is on a separate row. You often need to convert between these formats to do different types of analyses or data processing.

Imagine a study where each subject completes a questionnaire with three items. Each answer is an observation of that subject. You are probably most familiar with data like this in a wide format, where the subject \texttt{id} is in one column, and each of the three item responses is in its own column.

\begin{table}

\caption{\label{tab:wide-data}Wide data}
\centering
\begin{tabular}[t]{l|r|r|r}
\hline
id & Q1 & Q2 & Q3\\
\hline
A & 1 & 2 & 3\\
\hline
B & 4 & 5 & 6\\
\hline
\end{tabular}
\end{table}

The same data can be represented in a long format by creating a new column that specifies what \texttt{item} the observation is from and a new column that specifies the \texttt{value} of that observation.

\begin{table}

\caption{\label{tab:long-data}Long data}
\centering
\begin{tabular}[t]{l|l|r}
\hline
id & item & value\\
\hline
A & Q1 & 1\\
\hline
B & Q1 & 4\\
\hline
A & Q2 & 2\\
\hline
B & Q2 & 5\\
\hline
A & Q3 & 3\\
\hline
B & Q3 & 6\\
\hline
\end{tabular}
\end{table}

\begin{try}

Create a long version of the following table.

\begin{longtable}[]{@{}lll@{}}
\toprule
id & fav\_colour & fav\_animal \\
\midrule
\endhead
Lisa & red & echidna \\
Robbie & orange & babirusa \\
Steven & green & frog \\
\bottomrule
\end{longtable}

Answer

Your answer doesn't need to have the same column headers or be in the same order.

\begin{longtable}[]{@{}lll@{}}
\toprule
id & fav & answer \\
\midrule
\endhead
Lisa & colour & red \\
Lisa & animal & echidna \\
Robbie & colour & orange \\
Robbie & animal & babirusa \\
Steven & colour & green \\
Steven & animal & frog \\
\bottomrule
\end{longtable}

\end{try}

\hypertarget{pivot}{%
\section{Pivot Functions}\label{pivot}}

The pivot functions allow you to transform a data table from wide to long or long to wide in one step.

\hypertarget{load-data}{%
\subsection{Load Data}\label{load-data}}

We will used the dataset \texttt{personality} from the reprores package (or download the data from \href{./data/personality.csv}{personality.csv}). These data are from a 5-factor (personality) personality questionnaire. Each question is labelled with the domain (Op = openness, Co = conscientiousness, Ex = extroversion, Ag = agreeableness, and Ne = neuroticism) and the question number.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{data}\NormalTok{(}\StringTok{"personality"}\NormalTok{, }\AttributeTok{package =} \StringTok{"reprores"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{tabular}{r|l|r|r|r|r|r|r|r|r|r|r|r|r|r|r|r|r|r|r|r|r|r|r|r|r|r|r|r|r|r|r|r|r|r|r|r|r|r|r|r|r|r}
\hline
user\_id & date & Op1 & Ne1 & Ne2 & Op2 & Ex1 & Ex2 & Co1 & Co2 & Ne3 & Ag1 & Ag2 & Ne4 & Ex3 & Co3 & Op3 & Ex4 & Op4 & Ex5 & Ag3 & Co4 & Co5 & Ne5 & Op5 & Ag4 & Op6 & Co6 & Ex6 & Ne6 & Co7 & Ag5 & Co8 & Ex7 & Ne7 & Co9 & Op7 & Ne8 & Ag6 & Ag7 & Co10 & Ex8 & Ex9\\
\hline
0 & 2006-03-23 & 3 & 4 & 0 & 6 & 3 & 3 & 3 & 3 & 0 & 2 & 1 & 3 & 3 & 2 & 2 & 1 & 3 & 3 & 1 & 3 & 0 & 3 & 6 & 1 & 0 & 6 & 3 & 1 & 3 & 3 & 3 & 3 & NA & 3 & 0 & 2 & NA & 3 & 1 & 2 & 4\\
\hline
1 & 2006-02-08 & 6 & 0 & 6 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 6 & 6 & 6 & 0 & 6 & 0 & 0 & 0 & 0 & 6 & 6 & 0 & 6 & 0 & 6 & 0 & 6 & 6 & 6 & 6 & 0 & 6 & 0 & 6 & 6 & 0 & 6 & 0 & 6 & 0 & 6\\
\hline
2 & 2005-10-24 & 6 & 0 & 6 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 6 & 6 & 5 & 1 & 5 & 1 & 1 & 1 & 1 & 5 & 5 & 1 & 5 & 1 & 5 & 1 & 5 & 5 & 5 & 5 & 1 & 5 & 1 & 5 & 5 & 1 & 5 & 1 & 5 & 1 & 5\\
\hline
5 & 2005-12-07 & 6 & 4 & 4 & 4 & 2 & 3 & 3 & 3 & 1 & 4 & 0 & 2 & 5 & 3 & 5 & 3 & 6 & 6 & 1 & 5 & 5 & 4 & 2 & 4 & 1 & 4 & 3 & 1 & 1 & 0 & 1 & 4 & 2 & 4 & 5 & 1 & 2 & 1 & 5 & 4 & 5\\
\hline
8 & 2006-07-27 & 6 & 1 & 2 & 6 & 2 & 3 & 5 & 4 & 0 & 6 & 5 & 3 & 3 & 4 & 5 & 3 & 6 & 3 & 0 & 5 & 5 & 1 & 5 & 6 & 6 & 6 & 0 & 0 & 3 & 2 & 3 & 1 & 0 & 3 & 5 & 1 & 3 & 1 & 3 & 3 & 5\\
\hline
108 & 2006-02-28 & 3 & 2 & 1 & 4 & 4 & 4 & 4 & 3 & 1 & 5 & 4 & 2 & 3 & 4 & 4 & 3 & 3 & 3 & 4 & 3 & 3 & 1 & 4 & 5 & 4 & 5 & 4 & 1 & 4 & 5 & 4 & 2 & 2 & 4 & 4 & 1 & 4 & 3 & 5 & 4 & 2\\
\hline
\end{tabular}

\hypertarget{pivot_longer}{%
\subsection{pivot\_longer()}\label{pivot_longer}}

\texttt{pivot\_longer()} converts a wide data table to long format by converting the headers from specified columns into the values of new columns, and combining the values of those columns into a new condensed column.

\begin{itemize}
\tightlist
\item
  \texttt{cols} refers to the columns you want to make long You can refer to them by their names, like \texttt{col1,\ col2,\ col3,\ col4} or \texttt{col1:col4} or by their numbers, like \texttt{8,\ 9,\ 10} or \texttt{8:10}.
\item
  \texttt{names\_to} is what you want to call the new columns that the gathered column headers will go into; it's ``domain'' and ``qnumber'' in this example.
\item
  \texttt{names\_sep} is an optional argument if you have more than one value for \texttt{names\_to}. It specifies the characters or position to split the values of the \texttt{cols} headers.
\item
  \texttt{values\_to} is what you want to call the values in the columns \texttt{...}; they're ``score'' in this example.
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{personality\_long }\OtherTok{\textless{}{-}} \FunctionTok{pivot\_longer}\NormalTok{(}
  \AttributeTok{data =}\NormalTok{ personality, }
  \AttributeTok{cols =}\NormalTok{ Op1}\SpecialCharTok{:}\NormalTok{Ex9,                    }\CommentTok{\# columns to make long }
  \AttributeTok{names\_to =} \FunctionTok{c}\NormalTok{(}\StringTok{"domain"}\NormalTok{, }\StringTok{"qnumber"}\NormalTok{), }\CommentTok{\# new column names for headers}
  \AttributeTok{names\_sep =} \DecValTok{2}\NormalTok{,                     }\CommentTok{\# how to split the headers}
  \AttributeTok{values\_to =} \StringTok{"score"}                \CommentTok{\# new column name for values}
\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{glimpse}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Rows: 615,000
## Columns: 5
## $ user_id <dbl> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,~
## $ date    <date> 2006-03-23, 2006-03-23, 2006-03-23, 2006-03-23, 2006-03-23, 2~
## $ domain  <chr> "Op", "Ne", "Ne", "Op", "Ex", "Ex", "Co", "Co", "Ne", "Ag", "A~
## $ qnumber <chr> "1", "1", "2", "2", "1", "2", "1", "2", "3", "1", "2", "4", "3~
## $ score   <dbl> 3, 4, 0, 6, 3, 3, 3, 3, 0, 2, 1, 3, 3, 2, 2, 1, 3, 3, 1, 3, 0,~
\end{verbatim}

\begin{info}
You can pipe a data table to \texttt{glimpse()} at the end to have a quick look at it. It will still save to the object.

\end{info}

\begin{try}

What would you set \texttt{names\_sep} to in order to split the \texttt{cols} headers listed below into the results?

\begin{longtable}[]{@{}
  >{\raggedright\arraybackslash}p{(\columnwidth - 4\tabcolsep) * \real{0.24}}
  >{\raggedright\arraybackslash}p{(\columnwidth - 4\tabcolsep) * \real{0.38}}
  >{\raggedright\arraybackslash}p{(\columnwidth - 4\tabcolsep) * \real{0.38}}@{}}
\toprule
\texttt{cols} & \texttt{names\_to} & \texttt{names\_sep} \\
\midrule
\endhead
\texttt{A\_1}, \texttt{A\_2}, \texttt{B\_1}, \texttt{B\_2} & \texttt{c("condition",\ "version")} & AB12\_ \\
\texttt{A1}, \texttt{A2}, \texttt{B1}, \texttt{B2} & \texttt{c("condition",\ "version")} & AB12\_ \\
\texttt{cat-day\&pre}, \texttt{cat-day\&post}, \texttt{cat-night\&pre}, \texttt{cat-night\&post}, \texttt{dog-day\&pre}, \texttt{dog-day\&post}, \texttt{dog-night\&pre}, \texttt{dog-night\&post} & \texttt{c("pet",\ "time",\ "condition")} & -\&- \\
\bottomrule
\end{longtable}

\end{try}

\hypertarget{pivot_wider}{%
\subsection{pivot\_wider()}\label{pivot_wider}}

We can also go from long to wide format using the \texttt{pivot\_wider()} function.

\begin{itemize}
\tightlist
\item
  \texttt{names\_from} is the columns that contain your new column headers.
\item
  \texttt{values\_from} is the column that contains the values for the new columns.
\item
  \texttt{names\_sep} is the character string used to join names if \texttt{names\_from} is more than one column.
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{personality\_wide }\OtherTok{\textless{}{-}} \FunctionTok{pivot\_wider}\NormalTok{(}
  \AttributeTok{data =}\NormalTok{ personality\_long,}
  \AttributeTok{names\_from =} \FunctionTok{c}\NormalTok{(domain, qnumber),}
  \AttributeTok{values\_from =}\NormalTok{ score,}
  \AttributeTok{names\_sep =} \StringTok{""}
\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{glimpse}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Rows: 15,000
## Columns: 43
## $ user_id <dbl> 0, 1, 2, 5, 8, 108, 233, 298, 426, 436, 685, 807, 871, 881, 94~
## $ date    <date> 2006-03-23, 2006-02-08, 2005-10-24, 2005-12-07, 2006-07-27, 2~
## $ Op1     <dbl> 3, 6, 6, 6, 6, 3, 3, 6, 6, 3, 4, 5, 5, 5, 6, 4, 1, 2, 5, 6, 4,~
## $ Ne1     <dbl> 4, 0, 0, 4, 1, 2, 3, 4, 0, 3, 3, 3, 2, 1, 1, 3, 4, 5, 2, 4, 5,~
## $ Ne2     <dbl> 0, 6, 6, 4, 2, 1, 2, 3, 1, 2, 5, 5, 3, 1, 1, 1, 1, 6, 1, 2, 5,~
## $ Op2     <dbl> 6, 0, 0, 4, 6, 4, 4, 0, 0, 3, 4, 3, 3, 4, 5, 3, 3, 4, 1, 6, 6,~
## $ Ex1     <dbl> 3, 0, 0, 2, 2, 4, 4, 3, 5, 4, 1, 1, 3, 3, 1, 3, 5, 1, 0, 4, 1,~
## $ Ex2     <dbl> 3, 0, 0, 3, 3, 4, 5, 2, 5, 3, 4, 1, 3, 2, 1, 6, 5, 3, 4, 4, 1,~
## $ Co1     <dbl> 3, 0, 0, 3, 5, 4, 3, 4, 5, 3, 3, 3, 1, 5, 5, 4, 4, 5, 6, 4, 2,~
## $ Co2     <dbl> 3, 0, 0, 3, 4, 3, 3, 4, 5, 3, 5, 3, 3, 4, 5, 1, 5, 4, 5, 2, 5,~
## $ Ne3     <dbl> 0, 0, 0, 1, 0, 1, 4, 4, 0, 4, 2, 5, 1, 2, 5, 5, 2, 2, 1, 2, 5,~
## $ Ag1     <dbl> 2, 0, 0, 4, 6, 5, 5, 4, 2, 5, 4, 3, 2, 4, 5, 3, 5, 5, 5, 4, 4,~
## $ Ag2     <dbl> 1, 6, 6, 0, 5, 4, 5, 3, 4, 3, 5, 1, 5, 4, 2, 6, 5, 5, 5, 5, 2,~
## $ Ne4     <dbl> 3, 6, 6, 2, 3, 2, 3, 3, 0, 4, 4, 5, 5, 4, 5, 3, 2, 5, 2, 4, 5,~
## $ Ex3     <dbl> 3, 6, 5, 5, 3, 3, 3, 0, 6, 1, 4, 2, 3, 2, 1, 2, 5, 1, 0, 5, 5,~
## $ Co3     <dbl> 2, 0, 1, 3, 4, 4, 5, 4, 5, 3, 4, 3, 4, 4, 5, 4, 2, 4, 5, 2, 2,~
## $ Op3     <dbl> 2, 6, 5, 5, 5, 4, 3, 2, 4, 3, 3, 6, 5, 5, 6, 5, 4, 4, 3, 6, 5,~
## $ Ex4     <dbl> 1, 0, 1, 3, 3, 3, 4, 3, 5, 3, 2, 0, 3, 3, 1, 2, NA, 4, 4, 4, 1~
## $ Op4     <dbl> 3, 0, 1, 6, 6, 3, 3, 0, 6, 3, 4, 5, 4, 5, 6, 6, 2, 2, 4, 5, 5,~
## $ Ex5     <dbl> 3, 0, 1, 6, 3, 3, 4, 2, 5, 2, 2, 4, 2, 3, 0, 4, 5, 2, 3, 1, 1,~
## $ Ag3     <dbl> 1, 0, 1, 1, 0, 4, 4, 4, 3, 3, 4, 4, 3, 4, 4, 5, 5, 4, 5, 3, 4,~
## $ Co4     <dbl> 3, 6, 5, 5, 5, 3, 2, 4, 3, 1, 4, 3, 1, 2, 4, 2, NA, 5, 6, 1, 1~
## $ Co5     <dbl> 0, 6, 5, 5, 5, 3, 3, 1, 5, 1, 2, 4, 4, 4, 2, 1, 6, 4, 3, 1, 3,~
## $ Ne5     <dbl> 3, 0, 1, 4, 1, 1, 4, 5, 0, 3, 4, 6, 2, 0, 1, 1, 0, 4, 3, 1, 5,~
## $ Op5     <dbl> 6, 6, 5, 2, 5, 4, 3, 2, 6, 6, 2, 4, 3, 4, 6, 6, 6, 5, 3, 3, 5,~
## $ Ag4     <dbl> 1, 0, 1, 4, 6, 5, 5, 6, 6, 6, 4, 2, 4, 5, 4, 5, 6, 4, 5, 6, 5,~
## $ Op6     <dbl> 0, 6, 5, 1, 6, 4, 6, 0, 0, 3, 5, 3, 5, 5, 5, 2, 5, 1, 1, 6, 2,~
## $ Co6     <dbl> 6, 0, 1, 4, 6, 5, 6, 5, 4, 3, 5, 5, 4, 6, 6, 1, 3, 4, 5, 4, 6,~
## $ Ex6     <dbl> 3, 6, 5, 3, 0, 4, 3, 1, 6, 3, 2, 1, 4, 2, 1, 5, 6, 2, 1, 2, 1,~
## $ Ne6     <dbl> 1, 6, 5, 1, 0, 1, 3, 4, 0, 4, 4, 5, 2, 1, 5, 6, 1, 2, 2, 3, 5,~
## $ Co7     <dbl> 3, 6, 5, 1, 3, 4, NA, 2, 3, 3, 2, 2, 4, 2, 5, 2, 5, 5, 3, 1, 1~
## $ Ag5     <dbl> 3, 6, 5, 0, 2, 5, 6, 2, 2, 3, 4, 1, 3, 5, 2, 6, 5, 6, 5, 3, 3,~
## $ Co8     <dbl> 3, 0, 1, 1, 3, 4, 3, 0, 1, 3, 2, 2, 1, 2, 4, 3, 2, 4, 5, 2, 6,~
## $ Ex7     <dbl> 3, 6, 5, 4, 1, 2, 5, 3, 6, 3, 4, 3, 5, 1, 1, 6, 6, 3, 1, 1, 3,~
## $ Ne7     <dbl> NA, 0, 1, 2, 0, 2, 4, 4, 0, 3, 2, 5, 1, 2, 5, 2, 2, 4, 1, 3, 5~
## $ Co9     <dbl> 3, 6, 5, 4, 3, 4, 5, 3, 5, 3, 4, 3, 4, 4, 2, 4, 6, 5, 5, 2, 2,~
## $ Op7     <dbl> 0, 6, 5, 5, 5, 4, 6, 2, 1, 3, 2, 4, 5, 5, 6, 3, 6, 5, 2, 6, 5,~
## $ Ne8     <dbl> 2, 0, 1, 1, 1, 1, 5, 4, 0, 4, 4, 5, 1, 2, 5, 2, 1, 5, 1, 2, 5,~
## $ Ag6     <dbl> NA, 6, 5, 2, 3, 4, 5, 6, 1, 3, 4, 2, 3, 5, 1, 6, 2, 6, 6, 5, 3~
## $ Ag7     <dbl> 3, 0, 1, 1, 1, 3, 3, 5, 0, 3, 2, 1, 2, 3, 5, 6, 4, 4, 6, 6, 2,~
## $ Co10    <dbl> 1, 6, 5, 5, 3, 5, 1, 2, 5, 2, 4, 3, 4, 4, 3, 2, 5, 5, 5, 2, 2,~
## $ Ex8     <dbl> 2, 0, 1, 4, 3, 4, 2, 4, 6, 2, 4, 0, 4, 4, 1, 3, 5, 4, 3, 1, 1,~
## $ Ex9     <dbl> 4, 6, 5, 5, 5, 2, 3, 3, 6, 3, 3, 4, 4, 3, 2, 5, 5, 4, 4, 0, 4,~
\end{verbatim}

\hypertarget{tidy-verbs}{%
\section{Tidy Verbs}\label{tidy-verbs}}

The pivot functions above are relatively new functions that combine the four basic tidy verbs. You can also convert data between long and wide formats using these functions. Many researchers still use these functions and older code will not use the pivot functions, so it is useful to know how to interpret these.

\hypertarget{gather}{%
\subsection{gather()}\label{gather}}

Much like \texttt{pivot\_longer()}, \texttt{gather()} makes a wide data table long by creating a column for the headers and a column for the values. The main difference is that you cannot turn the headers into more than one column.

\begin{itemize}
\tightlist
\item
  \texttt{key} is what you want to call the new column that the gathered column headers will go into; it's ``question'' in this example. It is like \texttt{names\_to} in \texttt{pivot\_longer()}, but can only take one value (multiple values need to be separated after \texttt{separate()}).
\item
  \texttt{value} is what you want to call the values in the gathered columns; they're ``score'' in this example. It is like \texttt{values\_to} in \texttt{pivot\_longer()}.
\item
  \texttt{...} refers to the columns you want to gather. It is like \texttt{cols} in \texttt{pivot\_longer()}.
\end{itemize}

The \texttt{gather()} function converts \texttt{personality} from a wide data table to long format, with a row for each user/question observation. The resulting data table should have the columns: \texttt{user\_id}, \texttt{date}, \texttt{question}, and \texttt{score}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{personality\_gathered }\OtherTok{\textless{}{-}} \FunctionTok{gather}\NormalTok{(}
  \AttributeTok{data =}\NormalTok{ personality, }
  \AttributeTok{key =} \StringTok{"question"}\NormalTok{, }\CommentTok{\# new column name for gathered headers}
  \AttributeTok{value =} \StringTok{"score"}\NormalTok{,  }\CommentTok{\# new column name for gathered values}
\NormalTok{  Op1}\SpecialCharTok{:}\NormalTok{Ex9           }\CommentTok{\# columns to gather}
\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{glimpse}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Rows: 615,000
## Columns: 4
## $ user_id  <dbl> 0, 1, 2, 5, 8, 108, 233, 298, 426, 436, 685, 807, 871, 881, 9~
## $ date     <date> 2006-03-23, 2006-02-08, 2005-10-24, 2005-12-07, 2006-07-27, ~
## $ question <chr> "Op1", "Op1", "Op1", "Op1", "Op1", "Op1", "Op1", "Op1", "Op1"~
## $ score    <dbl> 3, 6, 6, 6, 6, 3, 3, 6, 6, 3, 4, 5, 5, 5, 6, 4, 1, 2, 5, 6, 4~
\end{verbatim}

\hypertarget{separate}{%
\subsection{separate()}\label{separate}}

\begin{itemize}
\tightlist
\item
  \texttt{col} is the column you want to separate
\item
  \texttt{into} is a vector of new column names
\item
  \texttt{sep} is the character(s) that separate your new columns. This defaults to anything that isn't alphanumeric, like .\texttt{,\_-/:} and is like the \texttt{names\_sep} argument in \texttt{pivot\_longer()}.
\end{itemize}

Split the \texttt{question} column into two columns: \texttt{domain} and \texttt{qnumber}.

There is no character to split on, here, but you can separate a column after a specific number of characters by setting \texttt{sep} to an integer. For example, to split ``abcde'' after the third character, use \texttt{sep\ =\ 3}, which results in \texttt{c("abc",\ "de")}. You can also use negative number to split before the \emph{n}th character from the right. For example, to split a column that has words of various lengths and 2-digit suffixes (like ``lisa03''``,''amanda38"), you can use \texttt{sep\ =\ -2}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{personality\_sep }\OtherTok{\textless{}{-}} \FunctionTok{separate}\NormalTok{(}
  \AttributeTok{data =}\NormalTok{ personality\_gathered, }
  \AttributeTok{col =}\NormalTok{ question,                }\CommentTok{\# column to separate}
  \AttributeTok{into =} \FunctionTok{c}\NormalTok{(}\StringTok{"domain"}\NormalTok{, }\StringTok{"qnumber"}\NormalTok{), }\CommentTok{\# new column names}
  \AttributeTok{sep =} \DecValTok{2}                        \CommentTok{\# where to separate}
\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{glimpse}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Rows: 615,000
## Columns: 5
## $ user_id <dbl> 0, 1, 2, 5, 8, 108, 233, 298, 426, 436, 685, 807, 871, 881, 94~
## $ date    <date> 2006-03-23, 2006-02-08, 2005-10-24, 2005-12-07, 2006-07-27, 2~
## $ domain  <chr> "Op", "Op", "Op", "Op", "Op", "Op", "Op", "Op", "Op", "Op", "O~
## $ qnumber <chr> "1", "1", "1", "1", "1", "1", "1", "1", "1", "1", "1", "1", "1~
## $ score   <dbl> 3, 6, 6, 6, 6, 3, 3, 6, 6, 3, 4, 5, 5, 5, 6, 4, 1, 2, 5, 6, 4,~
\end{verbatim}

\begin{warning}
If you want to separate just at full stops, you need to use \texttt{sep\ =\ "\textbackslash{}\textbackslash{}."}, not \texttt{sep\ =\ "."}. The two slashes \textbf{escape} the full stop, making it interpreted as a literal full stop and not the regular expression for any character.

\end{warning}

\hypertarget{unite}{%
\subsection{unite()}\label{unite}}

\begin{itemize}
\tightlist
\item
  \texttt{col} is your new united column
\item
  \texttt{...} refers to the columns you want to unite
\item
  \texttt{sep} is the character(s) that will separate your united columns
\end{itemize}

Put the domain and qnumber columns back together into a new column named \texttt{domain\_n}. Make it in a format like ``Op\_Q1''.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{personality\_unite }\OtherTok{\textless{}{-}} \FunctionTok{unite}\NormalTok{(}
  \AttributeTok{data =}\NormalTok{ personality\_sep, }
  \AttributeTok{col =} \StringTok{"domain\_n"}\NormalTok{, }\CommentTok{\# new column name}
\NormalTok{  domain, qnumber,  }\CommentTok{\# columns to unite}
  \AttributeTok{sep =} \StringTok{"\_Q"}        \CommentTok{\# separation characters}
\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{glimpse}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Rows: 615,000
## Columns: 4
## $ user_id  <dbl> 0, 1, 2, 5, 8, 108, 233, 298, 426, 436, 685, 807, 871, 881, 9~
## $ date     <date> 2006-03-23, 2006-02-08, 2005-10-24, 2005-12-07, 2006-07-27, ~
## $ domain_n <chr> "Op_Q1", "Op_Q1", "Op_Q1", "Op_Q1", "Op_Q1", "Op_Q1", "Op_Q1"~
## $ score    <dbl> 3, 6, 6, 6, 6, 3, 3, 6, 6, 3, 4, 5, 5, 5, 6, 4, 1, 2, 5, 6, 4~
\end{verbatim}

\hypertarget{spread}{%
\subsection{spread()}\label{spread}}

You can reverse the processes above, as well. For example, you can convert data from long format into wide format.

\begin{itemize}
\tightlist
\item
  \texttt{key} is the column that contains your new column headers. It is like \texttt{names\_from} in \texttt{pivot\_wider()}, but can only take one value (multiple values need to be merged first using \texttt{unite()}).
\item
  \texttt{value} is the column that contains the values in the new spread columns. It is like \texttt{values\_from} in \texttt{pivot\_wider()}.
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{personality\_spread }\OtherTok{\textless{}{-}} \FunctionTok{spread}\NormalTok{(}
  \AttributeTok{data =}\NormalTok{ personality\_unite,}
  \AttributeTok{key =}\NormalTok{ domain\_n, }\CommentTok{\# column that contains new headers}
  \AttributeTok{value =}\NormalTok{ score   }\CommentTok{\# column that contains new values}
\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{glimpse}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Rows: 15,000
## Columns: 43
## $ user_id <dbl> 0, 1, 2, 5, 8, 108, 233, 298, 426, 436, 685, 807, 871, 881, 94~
## $ date    <date> 2006-03-23, 2006-02-08, 2005-10-24, 2005-12-07, 2006-07-27, 2~
## $ Ag_Q1   <dbl> 2, 0, 0, 4, 6, 5, 5, 4, 2, 5, 4, 3, 2, 4, 5, 3, 5, 5, 5, 4, 4,~
## $ Ag_Q2   <dbl> 1, 6, 6, 0, 5, 4, 5, 3, 4, 3, 5, 1, 5, 4, 2, 6, 5, 5, 5, 5, 2,~
## $ Ag_Q3   <dbl> 1, 0, 1, 1, 0, 4, 4, 4, 3, 3, 4, 4, 3, 4, 4, 5, 5, 4, 5, 3, 4,~
## $ Ag_Q4   <dbl> 1, 0, 1, 4, 6, 5, 5, 6, 6, 6, 4, 2, 4, 5, 4, 5, 6, 4, 5, 6, 5,~
## $ Ag_Q5   <dbl> 3, 6, 5, 0, 2, 5, 6, 2, 2, 3, 4, 1, 3, 5, 2, 6, 5, 6, 5, 3, 3,~
## $ Ag_Q6   <dbl> NA, 6, 5, 2, 3, 4, 5, 6, 1, 3, 4, 2, 3, 5, 1, 6, 2, 6, 6, 5, 3~
## $ Ag_Q7   <dbl> 3, 0, 1, 1, 1, 3, 3, 5, 0, 3, 2, 1, 2, 3, 5, 6, 4, 4, 6, 6, 2,~
## $ Co_Q1   <dbl> 3, 0, 0, 3, 5, 4, 3, 4, 5, 3, 3, 3, 1, 5, 5, 4, 4, 5, 6, 4, 2,~
## $ Co_Q10  <dbl> 1, 6, 5, 5, 3, 5, 1, 2, 5, 2, 4, 3, 4, 4, 3, 2, 5, 5, 5, 2, 2,~
## $ Co_Q2   <dbl> 3, 0, 0, 3, 4, 3, 3, 4, 5, 3, 5, 3, 3, 4, 5, 1, 5, 4, 5, 2, 5,~
## $ Co_Q3   <dbl> 2, 0, 1, 3, 4, 4, 5, 4, 5, 3, 4, 3, 4, 4, 5, 4, 2, 4, 5, 2, 2,~
## $ Co_Q4   <dbl> 3, 6, 5, 5, 5, 3, 2, 4, 3, 1, 4, 3, 1, 2, 4, 2, NA, 5, 6, 1, 1~
## $ Co_Q5   <dbl> 0, 6, 5, 5, 5, 3, 3, 1, 5, 1, 2, 4, 4, 4, 2, 1, 6, 4, 3, 1, 3,~
## $ Co_Q6   <dbl> 6, 0, 1, 4, 6, 5, 6, 5, 4, 3, 5, 5, 4, 6, 6, 1, 3, 4, 5, 4, 6,~
## $ Co_Q7   <dbl> 3, 6, 5, 1, 3, 4, NA, 2, 3, 3, 2, 2, 4, 2, 5, 2, 5, 5, 3, 1, 1~
## $ Co_Q8   <dbl> 3, 0, 1, 1, 3, 4, 3, 0, 1, 3, 2, 2, 1, 2, 4, 3, 2, 4, 5, 2, 6,~
## $ Co_Q9   <dbl> 3, 6, 5, 4, 3, 4, 5, 3, 5, 3, 4, 3, 4, 4, 2, 4, 6, 5, 5, 2, 2,~
## $ Ex_Q1   <dbl> 3, 0, 0, 2, 2, 4, 4, 3, 5, 4, 1, 1, 3, 3, 1, 3, 5, 1, 0, 4, 1,~
## $ Ex_Q2   <dbl> 3, 0, 0, 3, 3, 4, 5, 2, 5, 3, 4, 1, 3, 2, 1, 6, 5, 3, 4, 4, 1,~
## $ Ex_Q3   <dbl> 3, 6, 5, 5, 3, 3, 3, 0, 6, 1, 4, 2, 3, 2, 1, 2, 5, 1, 0, 5, 5,~
## $ Ex_Q4   <dbl> 1, 0, 1, 3, 3, 3, 4, 3, 5, 3, 2, 0, 3, 3, 1, 2, NA, 4, 4, 4, 1~
## $ Ex_Q5   <dbl> 3, 0, 1, 6, 3, 3, 4, 2, 5, 2, 2, 4, 2, 3, 0, 4, 5, 2, 3, 1, 1,~
## $ Ex_Q6   <dbl> 3, 6, 5, 3, 0, 4, 3, 1, 6, 3, 2, 1, 4, 2, 1, 5, 6, 2, 1, 2, 1,~
## $ Ex_Q7   <dbl> 3, 6, 5, 4, 1, 2, 5, 3, 6, 3, 4, 3, 5, 1, 1, 6, 6, 3, 1, 1, 3,~
## $ Ex_Q8   <dbl> 2, 0, 1, 4, 3, 4, 2, 4, 6, 2, 4, 0, 4, 4, 1, 3, 5, 4, 3, 1, 1,~
## $ Ex_Q9   <dbl> 4, 6, 5, 5, 5, 2, 3, 3, 6, 3, 3, 4, 4, 3, 2, 5, 5, 4, 4, 0, 4,~
## $ Ne_Q1   <dbl> 4, 0, 0, 4, 1, 2, 3, 4, 0, 3, 3, 3, 2, 1, 1, 3, 4, 5, 2, 4, 5,~
## $ Ne_Q2   <dbl> 0, 6, 6, 4, 2, 1, 2, 3, 1, 2, 5, 5, 3, 1, 1, 1, 1, 6, 1, 2, 5,~
## $ Ne_Q3   <dbl> 0, 0, 0, 1, 0, 1, 4, 4, 0, 4, 2, 5, 1, 2, 5, 5, 2, 2, 1, 2, 5,~
## $ Ne_Q4   <dbl> 3, 6, 6, 2, 3, 2, 3, 3, 0, 4, 4, 5, 5, 4, 5, 3, 2, 5, 2, 4, 5,~
## $ Ne_Q5   <dbl> 3, 0, 1, 4, 1, 1, 4, 5, 0, 3, 4, 6, 2, 0, 1, 1, 0, 4, 3, 1, 5,~
## $ Ne_Q6   <dbl> 1, 6, 5, 1, 0, 1, 3, 4, 0, 4, 4, 5, 2, 1, 5, 6, 1, 2, 2, 3, 5,~
## $ Ne_Q7   <dbl> NA, 0, 1, 2, 0, 2, 4, 4, 0, 3, 2, 5, 1, 2, 5, 2, 2, 4, 1, 3, 5~
## $ Ne_Q8   <dbl> 2, 0, 1, 1, 1, 1, 5, 4, 0, 4, 4, 5, 1, 2, 5, 2, 1, 5, 1, 2, 5,~
## $ Op_Q1   <dbl> 3, 6, 6, 6, 6, 3, 3, 6, 6, 3, 4, 5, 5, 5, 6, 4, 1, 2, 5, 6, 4,~
## $ Op_Q2   <dbl> 6, 0, 0, 4, 6, 4, 4, 0, 0, 3, 4, 3, 3, 4, 5, 3, 3, 4, 1, 6, 6,~
## $ Op_Q3   <dbl> 2, 6, 5, 5, 5, 4, 3, 2, 4, 3, 3, 6, 5, 5, 6, 5, 4, 4, 3, 6, 5,~
## $ Op_Q4   <dbl> 3, 0, 1, 6, 6, 3, 3, 0, 6, 3, 4, 5, 4, 5, 6, 6, 2, 2, 4, 5, 5,~
## $ Op_Q5   <dbl> 6, 6, 5, 2, 5, 4, 3, 2, 6, 6, 2, 4, 3, 4, 6, 6, 6, 5, 3, 3, 5,~
## $ Op_Q6   <dbl> 0, 6, 5, 1, 6, 4, 6, 0, 0, 3, 5, 3, 5, 5, 5, 2, 5, 1, 1, 6, 2,~
## $ Op_Q7   <dbl> 0, 6, 5, 5, 5, 4, 6, 2, 1, 3, 2, 4, 5, 5, 6, 3, 6, 5, 2, 6, 5,~
\end{verbatim}

\hypertarget{pipes}{%
\section{Pipes}\label{pipes}}

Pipes are a way to order your code in a more readable format.

Let's say you have a small data table with 10 participant IDs, two columns with variable type A, and 2 columns with variable type B. You want to calculate the mean of the A variables and the mean of the B variables and return a table with 10 rows (1 for each participant) and 3 columns (\texttt{id}, \texttt{A\_mean} and \texttt{B\_mean}).

One way you could do this is by creating a new object at every step and using that object in the next step. This is pretty clear, but you've created 6 unnecessary data objects in your environment. This can get confusing in very long scripts.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# make a data table with 10 subjects}
\NormalTok{data\_original }\OtherTok{\textless{}{-}} \FunctionTok{tibble}\NormalTok{(}
  \AttributeTok{id =} \DecValTok{1}\SpecialCharTok{:}\DecValTok{10}\NormalTok{,}
  \AttributeTok{A1 =} \FunctionTok{rnorm}\NormalTok{(}\DecValTok{10}\NormalTok{, }\DecValTok{0}\NormalTok{),}
  \AttributeTok{A2 =} \FunctionTok{rnorm}\NormalTok{(}\DecValTok{10}\NormalTok{, }\DecValTok{1}\NormalTok{),}
  \AttributeTok{B1 =} \FunctionTok{rnorm}\NormalTok{(}\DecValTok{10}\NormalTok{, }\DecValTok{2}\NormalTok{),}
  \AttributeTok{B2 =} \FunctionTok{rnorm}\NormalTok{(}\DecValTok{10}\NormalTok{, }\DecValTok{3}\NormalTok{)}
\NormalTok{)}

\CommentTok{\# gather columns A1 to B2 into "variable" and "value" columns}
\NormalTok{data\_gathered }\OtherTok{\textless{}{-}} \FunctionTok{gather}\NormalTok{(data\_original, variable, value, A1}\SpecialCharTok{:}\NormalTok{B2)}

\CommentTok{\# separate the variable column at the \_ into "var" and "var\_n" columns}
\NormalTok{data\_separated }\OtherTok{\textless{}{-}} \FunctionTok{separate}\NormalTok{(data\_gathered, variable, }\FunctionTok{c}\NormalTok{(}\StringTok{"var"}\NormalTok{, }\StringTok{"var\_n"}\NormalTok{), }\AttributeTok{sep =} \DecValTok{1}\NormalTok{)}

\CommentTok{\# group the data by id and var}
\NormalTok{data\_grouped }\OtherTok{\textless{}{-}} \FunctionTok{group\_by}\NormalTok{(data\_separated, id, var)}

\CommentTok{\# calculate the mean value for each id/var }
\NormalTok{data\_summarised }\OtherTok{\textless{}{-}} \FunctionTok{summarise}\NormalTok{(data\_grouped, }\AttributeTok{mean =} \FunctionTok{mean}\NormalTok{(value), }\AttributeTok{.groups =} \StringTok{"drop"}\NormalTok{)}

\CommentTok{\# spread the mean column into A and B columns}
\NormalTok{data\_spread }\OtherTok{\textless{}{-}} \FunctionTok{spread}\NormalTok{(data\_summarised, var, mean)}

\CommentTok{\# rename A and B to A\_mean and B\_mean}
\NormalTok{data }\OtherTok{\textless{}{-}} \FunctionTok{rename}\NormalTok{(data\_spread, }\AttributeTok{A\_mean =}\NormalTok{ A, }\AttributeTok{B\_mean =}\NormalTok{ B)}

\NormalTok{data}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 10 x 3
##       id  A_mean B_mean
##    <int>   <dbl>  <dbl>
##  1     1 -0.594   1.02 
##  2     2  0.744   2.72 
##  3     3  0.931   3.93 
##  4     4  0.720   1.97 
##  5     5 -0.0281  1.95 
##  6     6 -0.0983  3.21 
##  7     7  0.126   0.926
##  8     8  1.45    2.38 
##  9     9  0.298   1.66 
## 10    10  0.559   2.10
\end{verbatim}

\begin{warning}
You \emph{can} name each object \texttt{data} and keep replacing the old data object with the new one at each step. This will keep your environment clean, but I don't recommend it because it makes it too easy to accidentally run your code out of order when you are running line-by-line for development or debugging.

\end{warning}

One way to avoid extra objects is to nest your functions, literally replacing each data object with the code that generated it in the previous step. This can be fine for very short chains.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mean\_petal\_width }\OtherTok{\textless{}{-}} \FunctionTok{round}\NormalTok{(}\FunctionTok{mean}\NormalTok{(iris}\SpecialCharTok{$}\NormalTok{Petal.Width), }\DecValTok{2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

But it gets extremely confusing for long chains:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# do not ever do this!!}
\NormalTok{data }\OtherTok{\textless{}{-}} \FunctionTok{rename}\NormalTok{(}
  \FunctionTok{spread}\NormalTok{(}
    \FunctionTok{summarise}\NormalTok{(}
      \FunctionTok{group\_by}\NormalTok{(}
        \FunctionTok{separate}\NormalTok{(}
          \FunctionTok{gather}\NormalTok{(}
            \FunctionTok{tibble}\NormalTok{(}
              \AttributeTok{id =} \DecValTok{1}\SpecialCharTok{:}\DecValTok{10}\NormalTok{,}
              \AttributeTok{A1 =} \FunctionTok{rnorm}\NormalTok{(}\DecValTok{10}\NormalTok{, }\DecValTok{0}\NormalTok{),}
              \AttributeTok{A2 =} \FunctionTok{rnorm}\NormalTok{(}\DecValTok{10}\NormalTok{, }\DecValTok{1}\NormalTok{),}
              \AttributeTok{B1 =} \FunctionTok{rnorm}\NormalTok{(}\DecValTok{10}\NormalTok{, }\DecValTok{2}\NormalTok{),}
              \AttributeTok{B2 =} \FunctionTok{rnorm}\NormalTok{(}\DecValTok{10}\NormalTok{,}\DecValTok{3}\NormalTok{)), }
\NormalTok{            variable, value, A1}\SpecialCharTok{:}\NormalTok{B2), }
\NormalTok{          variable, }\FunctionTok{c}\NormalTok{(}\StringTok{"var"}\NormalTok{, }\StringTok{"var\_n"}\NormalTok{), }\AttributeTok{sep =} \DecValTok{1}\NormalTok{), }
\NormalTok{        id, var), }
      \AttributeTok{mean =} \FunctionTok{mean}\NormalTok{(value), }\AttributeTok{.groups =} \StringTok{"drop"}\NormalTok{), }
\NormalTok{    var, mean), }
  \AttributeTok{A\_mean =}\NormalTok{ A, }\AttributeTok{B\_mean =}\NormalTok{ B)}
\end{Highlighting}
\end{Shaded}

The pipe lets you ``pipe'' the result of each function into the next function, allowing you to put your code in a logical order without creating too many extra objects.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# calculate mean of A and B variables for each participant}
\NormalTok{data }\OtherTok{\textless{}{-}} \FunctionTok{tibble}\NormalTok{(}
  \AttributeTok{id =} \DecValTok{1}\SpecialCharTok{:}\DecValTok{10}\NormalTok{,}
  \AttributeTok{A1 =} \FunctionTok{rnorm}\NormalTok{(}\DecValTok{10}\NormalTok{, }\DecValTok{0}\NormalTok{),}
  \AttributeTok{A2 =} \FunctionTok{rnorm}\NormalTok{(}\DecValTok{10}\NormalTok{, }\DecValTok{1}\NormalTok{),}
  \AttributeTok{B1 =} \FunctionTok{rnorm}\NormalTok{(}\DecValTok{10}\NormalTok{, }\DecValTok{2}\NormalTok{),}
  \AttributeTok{B2 =} \FunctionTok{rnorm}\NormalTok{(}\DecValTok{10}\NormalTok{,}\DecValTok{3}\NormalTok{)}
\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{gather}\NormalTok{(variable, value, A1}\SpecialCharTok{:}\NormalTok{B2) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{separate}\NormalTok{(variable, }\FunctionTok{c}\NormalTok{(}\StringTok{"var"}\NormalTok{, }\StringTok{"var\_n"}\NormalTok{), }\AttributeTok{sep=}\DecValTok{1}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{group\_by}\NormalTok{(id, var) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{summarise}\NormalTok{(}\AttributeTok{mean =} \FunctionTok{mean}\NormalTok{(value), }\AttributeTok{.groups =} \StringTok{"drop"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{spread}\NormalTok{(var, mean) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{rename}\NormalTok{(}\AttributeTok{A\_mean =}\NormalTok{ A, }\AttributeTok{B\_mean =}\NormalTok{ B)}
\end{Highlighting}
\end{Shaded}

You can read this code from top to bottom as follows:

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Make a tibble called \texttt{data} with

  \begin{itemize}
  \tightlist
  \item
    id of 1 to 10,
  \item
    A1 of 10 random numbers from a normal distribution,
  \item
    A2 of 10 random numbers from a normal distribution,
  \item
    B1 of 10 random numbers from a normal distribution,
  \item
    B2 of 10 random numbers from a normal distribution; and then
  \end{itemize}
\item
  Gather to create \texttt{variable} and \texttt{value} column from columns \texttt{A\_1} to \texttt{B\_2}; and then
\item
  Separate the column \texttt{variable} into 2 new columns called \texttt{var}and \texttt{var\_n}, separate at character 1; and then
\item
  Group by columns \texttt{id} and \texttt{var}; and then
\item
  Summarise and new column called \texttt{mean} as the mean of the \texttt{value} column for each group and drop the grouping; and then
\item
  Spread to make new columns with the key names in \texttt{var} and values in \texttt{mean}; and then
\item
  Rename to make columns called \texttt{A\_mean} (old \texttt{A}) and \texttt{B\_mean} (old \texttt{B})
\end{enumerate}

You can make intermediate objects whenever you need to break up your code because it's getting too complicated or you need to debug something.

\begin{info}
You can debug a pipe by highlighting from the beginning to just before the pipe you want to stop at. Try this by highlighting from \texttt{data\ \textless{}-} to the end of the \texttt{separate} function and typing cmd-return. What does \texttt{data} look like now?

\end{info}

Chain all the steps above using pipes.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{personality\_reshaped }\OtherTok{\textless{}{-}}\NormalTok{ personality }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{gather}\NormalTok{(}\StringTok{"question"}\NormalTok{, }\StringTok{"score"}\NormalTok{, Op1}\SpecialCharTok{:}\NormalTok{Ex9) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{separate}\NormalTok{(question, }\FunctionTok{c}\NormalTok{(}\StringTok{"domain"}\NormalTok{, }\StringTok{"qnumber"}\NormalTok{), }\AttributeTok{sep =} \DecValTok{2}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{unite}\NormalTok{(}\StringTok{"domain\_n"}\NormalTok{, domain, qnumber, }\AttributeTok{sep =} \StringTok{"\_Q"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{spread}\NormalTok{(domain\_n, score)}
\end{Highlighting}
\end{Shaded}

\hypertarget{more-complex-example}{%
\section{More Complex Example}\label{more-complex-example}}

\hypertarget{load-data-1}{%
\subsection{Load Data}\label{load-data-1}}

Get data on infant and maternal mortality rates from the reprores package. If you don't have the package, you can download them here:

\begin{itemize}
\tightlist
\item
  \href{https://psyteachr.github.io/reprores/data/infmort.csv}{infant mortality}\\
\item
  \href{https://psyteachr.github.io/reprores/data/matmort.xls}{maternal mortality}
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{data}\NormalTok{(}\StringTok{"infmort"}\NormalTok{)}
\FunctionTok{head}\NormalTok{(infmort)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 6 x 3
##   Country      Year `Infant mortality rate (probability of dying between birth ~
##   <chr>       <dbl> <chr>                                                       
## 1 Afghanistan  2015 66.3 [52.7-83.9]                                            
## 2 Afghanistan  2014 68.1 [55.7-83.6]                                            
## 3 Afghanistan  2013 69.9 [58.7-83.5]                                            
## 4 Afghanistan  2012 71.7 [61.6-83.7]                                            
## 5 Afghanistan  2011 73.4 [64.4-84.2]                                            
## 6 Afghanistan  2010 75.1 [66.9-85.1]
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{data}\NormalTok{(}\StringTok{"matmort"}\NormalTok{)}
\FunctionTok{head}\NormalTok{(matmort)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 6 x 4
##   Country     `1990`               `2000`               `2015`           
##   <chr>       <chr>                <chr>                <chr>            
## 1 Afghanistan 1 340 [ 878 - 1 950] 1 100 [ 745 - 1 570] 396 [ 253 -  620]
## 2 Albania     71 [ 58 -  88]       43 [ 33 -  56]       29 [ 16 -  46]   
## 3 Algeria     216 [ 141 -  327]    170 [ 118 -  241]    140 [ 82 -  244] 
## 4 Angola      1 160 [ 627 - 2 020] 924 [ 472 - 1 730]   477 [ 221 -  988]
## 5 Argentina   72 [ 64 -  80]       60 [ 54 -  65]       52 [ 44 -  63]   
## 6 Armenia     58 [ 51 -  65]       40 [ 35 -  46]       25 [ 21 -  31]
\end{verbatim}

\hypertarget{wide-to-long}{%
\subsection{Wide to Long}\label{wide-to-long}}

\texttt{matmort} is in wide format, with a separate column for each year. Change it to long format, with a row for each Country/Year observation.

This example is complicated because the column names to gather \emph{are} numbers. If the column names are non-standard (e.g., have spaces, start with numbers, or have special characters), you can enclose them in backticks (`) like the example below.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{matmort\_long }\OtherTok{\textless{}{-}}\NormalTok{ matmort }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{pivot\_longer}\NormalTok{(}\AttributeTok{cols =} \StringTok{\textasciigrave{}}\AttributeTok{1990}\StringTok{\textasciigrave{}}\SpecialCharTok{:}\StringTok{\textasciigrave{}}\AttributeTok{2015}\StringTok{\textasciigrave{}}\NormalTok{,}
               \AttributeTok{names\_to =} \StringTok{"Year"}\NormalTok{,}
               \AttributeTok{values\_to =} \StringTok{"stats"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{glimpse}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Rows: 543
## Columns: 3
## $ Country <chr> "Afghanistan", "Afghanistan", "Afghanistan", "Albania", "Alban~
## $ Year    <chr> "1990", "2000", "2015", "1990", "2000", "2015", "1990", "2000"~
## $ stats   <chr> "1 340 [ 878 - 1 950]", "1 100 [ 745 - 1 570]", "396 [ 253 -  ~
\end{verbatim}

\begin{info}
You can put \texttt{matmort} at the first argument to \texttt{pivot\_longer()}; you don't have to pipe it in. But when I'm working on data processing I often find myself needing to insert or rearrange steps and I constantly introduce errors by forgetting to take the first argument out of a pipe chain, so now I start with the original data table and pipe from there.

\end{info}

Alternatively, you can use the \texttt{gather()} function.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{matmort\_long }\OtherTok{\textless{}{-}}\NormalTok{ matmort }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{gather}\NormalTok{(}\StringTok{"Year"}\NormalTok{, }\StringTok{"stats"}\NormalTok{, }\StringTok{\textasciigrave{}}\AttributeTok{1990}\StringTok{\textasciigrave{}}\SpecialCharTok{:}\StringTok{\textasciigrave{}}\AttributeTok{2015}\StringTok{\textasciigrave{}}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{glimpse}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Rows: 543
## Columns: 3
## $ Country <chr> "Afghanistan", "Albania", "Algeria", "Angola", "Argentina", "A~
## $ Year    <chr> "1990", "1990", "1990", "1990", "1990", "1990", "1990", "1990"~
## $ stats   <chr> "1 340 [ 878 - 1 950]", "71 [ 58 -  88]", "216 [ 141 -  327]",~
\end{verbatim}

\hypertarget{one-piece-of-data-per-column}{%
\subsection{One Piece of Data per Column}\label{one-piece-of-data-per-column}}

The data in the \texttt{stats} column is in an unusual format with some sort of confidence interval in brackets and lots of extra spaces. We don't need any of the spaces, so first we'll remove them with \texttt{mutate()}, which we'll learn more about in the next lesson.

The \texttt{separate} function will separate your data on anything that is not a number or letter, so try it first without specifying the \texttt{sep} argument. The \texttt{into} argument is a list of the new column names.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{matmort\_split }\OtherTok{\textless{}{-}}\NormalTok{ matmort\_long }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{stats =} \FunctionTok{gsub}\NormalTok{(}\StringTok{" "}\NormalTok{, }\StringTok{""}\NormalTok{, stats)) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{separate}\NormalTok{(stats, }\FunctionTok{c}\NormalTok{(}\StringTok{"rate"}\NormalTok{, }\StringTok{"ci\_low"}\NormalTok{, }\StringTok{"ci\_hi"}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{glimpse}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning: Expected 3 pieces. Additional pieces discarded in 543 rows [1, 2, 3, 4,
## 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, ...].
\end{verbatim}

\begin{verbatim}
## Rows: 543
## Columns: 5
## $ Country <chr> "Afghanistan", "Albania", "Algeria", "Angola", "Argentina", "A~
## $ Year    <chr> "1990", "1990", "1990", "1990", "1990", "1990", "1990", "1990"~
## $ rate    <chr> "1340", "71", "216", "1160", "72", "58", "8", "8", "64", "46",~
## $ ci_low  <chr> "878", "58", "141", "627", "64", "51", "7", "7", "56", "34", "~
## $ ci_hi   <chr> "1950", "88", "327", "2020", "80", "65", "9", "10", "74", "61"~
\end{verbatim}

\begin{info}
The \texttt{gsub(pattern,\ replacement,\ x)} function is a
flexible way to do search and replace. The example above replaces all occurances of the \texttt{pattern} " " (a space), with the \texttt{replacement} "" (nothing), in the string \texttt{x} (the \texttt{stats} column). Use \texttt{sub()} instead if you only want to replace the first occurance of a pattern. We only used a simple pattern here, but you can use more complicated \href{https://stat.ethz.ch/R-manual/R-devel/library/base/html/regex.html}{regex} patterns to replace, for example, all even numbers (e.g., \texttt{gsub("{[}:02468:{]}",\ "*",\ "id\ =\ 123456")}) or all occurances of the word colour in US or UK spelling
(e.g., \texttt{gsub("colo(u)?r",\ "***",\ "replace\ color,\ colour,\ or\ colours,\ but\ not\ collors")}).

\end{info}

\hypertarget{extra}{%
\subsubsection{\texorpdfstring{Handle spare columns with \texttt{extra}}{Handle spare columns with extra}}\label{extra}}

\begin{warning}
The previous example should have given you an error warning about
``Additional pieces discarded in 543 rows''. This is because \texttt{separate} splits the column at the brackets and dashes, so the text \texttt{100{[}90-110{]}} would split into four values \texttt{c("100",\ "90",\ "110",\ "")}, but we only specified 3 new columns. The fourth value is always empty (just the part after the last bracket), so we are happy to drop it, but \texttt{separate} generates a warning so you don't do that accidentally. You can turn off the warning by adding the \texttt{extra} argument and setting it to ``drop''. Look at the help for \texttt{??tidyr::separate} to see what the other options do.

\end{warning}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{matmort\_split }\OtherTok{\textless{}{-}}\NormalTok{ matmort\_long }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{stats =} \FunctionTok{gsub}\NormalTok{(}\StringTok{" "}\NormalTok{, }\StringTok{""}\NormalTok{, stats)) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{separate}\NormalTok{(stats, }\FunctionTok{c}\NormalTok{(}\StringTok{"rate"}\NormalTok{, }\StringTok{"ci\_low"}\NormalTok{, }\StringTok{"ci\_hi"}\NormalTok{), }\AttributeTok{extra =} \StringTok{"drop"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{glimpse}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Rows: 543
## Columns: 5
## $ Country <chr> "Afghanistan", "Albania", "Algeria", "Angola", "Argentina", "A~
## $ Year    <chr> "1990", "1990", "1990", "1990", "1990", "1990", "1990", "1990"~
## $ rate    <chr> "1340", "71", "216", "1160", "72", "58", "8", "8", "64", "46",~
## $ ci_low  <chr> "878", "58", "141", "627", "64", "51", "7", "7", "56", "34", "~
## $ ci_hi   <chr> "1950", "88", "327", "2020", "80", "65", "9", "10", "74", "61"~
\end{verbatim}

\hypertarget{sep}{%
\subsubsection{\texorpdfstring{Set delimiters with \texttt{sep}}{Set delimiters with sep}}\label{sep}}

Now do the same with \texttt{infmort}. It's already in long format, so you don't need to use \texttt{gather}, but the third column has a ridiculously long name, so we can just refer to it by its column number (3).

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{infmort\_split }\OtherTok{\textless{}{-}}\NormalTok{ infmort }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{separate}\NormalTok{(}\DecValTok{3}\NormalTok{, }\FunctionTok{c}\NormalTok{(}\StringTok{"rate"}\NormalTok{, }\StringTok{"ci\_low"}\NormalTok{, }\StringTok{"ci\_hi"}\NormalTok{), }\AttributeTok{extra =} \StringTok{"drop"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{glimpse}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Rows: 5,044
## Columns: 5
## $ Country <chr> "Afghanistan", "Afghanistan", "Afghanistan", "Afghanistan", "A~
## $ Year    <dbl> 2015, 2014, 2013, 2012, 2011, 2010, 2009, 2008, 2007, 2006, 20~
## $ rate    <chr> "66", "68", "69", "71", "73", "75", "76", "78", "80", "82", "8~
## $ ci_low  <chr> "3", "1", "9", "7", "4", "1", "8", "6", "4", "3", "4", "7", "0~
## $ ci_hi   <chr> "52", "55", "58", "61", "64", "66", "69", "71", "73", "75", "7~
\end{verbatim}

\textbf{Wait, that didn't work at all!} It split the column on spaces, brackets, \emph{and} full stops. We just want to split on the spaces, brackets and dashes. So we need to manually set \texttt{sep} to what the delimiters are. Also, once there are more than a few arguments specified for a function, it's easier to read them if you put one argument on each line.

\hypertarget{regex}{%
\subsubsection*{}\label{regex}}
\addcontentsline{toc}{subsubsection}{}

\begin{warning}
You can use \href{https://stat.ethz.ch/R-manual/R-devel/library/base/html/regex.html}{regular expressions}
to separate complex columns. Here, we want to separate on dashes and brackets. You can separate on a list of delimiters by putting them in parentheses, separated by ``\textbar{}''. It's a little more complicated because brackets have a special meaning in regex, so you need to ``escape'' the left one with two backslashes ``\textbackslash\textbackslash{}''.

\end{warning}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{infmort\_split }\OtherTok{\textless{}{-}}\NormalTok{ infmort }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{separate}\NormalTok{(}
    \AttributeTok{col =} \DecValTok{3}\NormalTok{, }
    \AttributeTok{into =} \FunctionTok{c}\NormalTok{(}\StringTok{"rate"}\NormalTok{, }\StringTok{"ci\_low"}\NormalTok{, }\StringTok{"ci\_hi"}\NormalTok{), }
    \AttributeTok{extra =} \StringTok{"drop"}\NormalTok{, }
    \AttributeTok{sep =} \StringTok{"(}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{[|{-}|])"}
\NormalTok{  ) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{glimpse}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Rows: 5,044
## Columns: 5
## $ Country <chr> "Afghanistan", "Afghanistan", "Afghanistan", "Afghanistan", "A~
## $ Year    <dbl> 2015, 2014, 2013, 2012, 2011, 2010, 2009, 2008, 2007, 2006, 20~
## $ rate    <chr> "66.3 ", "68.1 ", "69.9 ", "71.7 ", "73.4 ", "75.1 ", "76.8 ",~
## $ ci_low  <chr> "52.7", "55.7", "58.7", "61.6", "64.4", "66.9", "69.0", "71.2"~
## $ ci_hi   <chr> "83.9", "83.6", "83.5", "83.7", "84.2", "85.1", "86.1", "87.3"~
\end{verbatim}

\hypertarget{convert}{%
\subsubsection{\texorpdfstring{Fix data types with \texttt{convert}}{Fix data types with convert}}\label{convert}}

That's better. Notice the \emph{} next to \texttt{Year}, \texttt{rate}, \texttt{ci\_low} and \texttt{ci\_hi}. That means these columns hold characters (like words), not numbers or integers. This can cause problems when you try to do thigs like average the numbers (you can't average words), so we can fix it by adding the argument \texttt{convert} and setting it to \texttt{TRUE}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{infmort\_split }\OtherTok{\textless{}{-}}\NormalTok{ infmort }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{separate}\NormalTok{(}\AttributeTok{col =} \DecValTok{3}\NormalTok{, }
           \AttributeTok{into =} \FunctionTok{c}\NormalTok{(}\StringTok{"rate"}\NormalTok{, }\StringTok{"ci\_low"}\NormalTok{, }\StringTok{"ci\_hi"}\NormalTok{), }
           \AttributeTok{extra =} \StringTok{"drop"}\NormalTok{, }
           \AttributeTok{sep =} \StringTok{"(}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{[|{-}|])"}\NormalTok{, }
           \AttributeTok{convert =} \ConstantTok{TRUE}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{glimpse}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Rows: 5,044
## Columns: 5
## $ Country <chr> "Afghanistan", "Afghanistan", "Afghanistan", "Afghanistan", "A~
## $ Year    <dbl> 2015, 2014, 2013, 2012, 2011, 2010, 2009, 2008, 2007, 2006, 20~
## $ rate    <dbl> 66.3, 68.1, 69.9, 71.7, 73.4, 75.1, 76.8, 78.6, 80.4, 82.3, 84~
## $ ci_low  <dbl> 52.7, 55.7, 58.7, 61.6, 64.4, 66.9, 69.0, 71.2, 73.4, 75.5, 77~
## $ ci_hi   <dbl> 83.9, 83.6, 83.5, 83.7, 84.2, 85.1, 86.1, 87.3, 88.9, 90.7, 92~
\end{verbatim}

Do the same for \texttt{matmort}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{matmort\_split }\OtherTok{\textless{}{-}}\NormalTok{ matmort\_long }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{stats =} \FunctionTok{gsub}\NormalTok{(}\StringTok{" "}\NormalTok{, }\StringTok{""}\NormalTok{, stats)) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{separate}\NormalTok{(}\AttributeTok{col =}\NormalTok{ stats, }
           \AttributeTok{into =} \FunctionTok{c}\NormalTok{(}\StringTok{"rate"}\NormalTok{, }\StringTok{"ci\_low"}\NormalTok{, }\StringTok{"ci\_hi"}\NormalTok{), }
           \AttributeTok{extra =} \StringTok{"drop"}\NormalTok{, }
           \AttributeTok{convert =} \ConstantTok{TRUE}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{glimpse}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Rows: 543
## Columns: 5
## $ Country <chr> "Afghanistan", "Albania", "Algeria", "Angola", "Argentina", "A~
## $ Year    <chr> "1990", "1990", "1990", "1990", "1990", "1990", "1990", "1990"~
## $ rate    <int> 1340, 71, 216, 1160, 72, 58, 8, 8, 64, 46, 26, 569, 58, 33, 9,~
## $ ci_low  <int> 878, 58, 141, 627, 64, 51, 7, 7, 56, 34, 20, 446, 47, 28, 7, 4~
## $ ci_hi   <int> 1950, 88, 327, 2020, 80, 65, 9, 10, 74, 61, 33, 715, 72, 38, 1~
\end{verbatim}

\hypertarget{all-in-one-step}{%
\subsection{All in one step}\label{all-in-one-step}}

We can chain all the steps for \texttt{matmort} above together, since we don't need those intermediate data tables.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{matmort2 }\OtherTok{\textless{}{-}}\NormalTok{ matmort }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{gather}\NormalTok{(}\StringTok{"Year"}\NormalTok{, }\StringTok{"stats"}\NormalTok{, }\StringTok{\textasciigrave{}}\AttributeTok{1990}\StringTok{\textasciigrave{}}\SpecialCharTok{:}\StringTok{\textasciigrave{}}\AttributeTok{2015}\StringTok{\textasciigrave{}}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{stats =} \FunctionTok{gsub}\NormalTok{(}\StringTok{" "}\NormalTok{, }\StringTok{""}\NormalTok{, stats)) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{separate}\NormalTok{(}
    \AttributeTok{col =}\NormalTok{ stats, }
    \AttributeTok{into =} \FunctionTok{c}\NormalTok{(}\StringTok{"rate"}\NormalTok{, }\StringTok{"ci\_low"}\NormalTok{, }\StringTok{"ci\_hi"}\NormalTok{), }
    \AttributeTok{extra =} \StringTok{"drop"}\NormalTok{, }
    \AttributeTok{convert =} \ConstantTok{TRUE}
\NormalTok{  ) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{glimpse}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Rows: 543
## Columns: 5
## $ Country <chr> "Afghanistan", "Albania", "Algeria", "Angola", "Argentina", "A~
## $ Year    <chr> "1990", "1990", "1990", "1990", "1990", "1990", "1990", "1990"~
## $ rate    <int> 1340, 71, 216, 1160, 72, 58, 8, 8, 64, 46, 26, 569, 58, 33, 9,~
## $ ci_low  <int> 878, 58, 141, 627, 64, 51, 7, 7, 56, 34, 20, 446, 47, 28, 7, 4~
## $ ci_hi   <int> 1950, 88, 327, 2020, 80, 65, 9, 10, 74, 61, 33, 715, 72, 38, 1~
\end{verbatim}

\hypertarget{columns-by-year}{%
\subsection{Columns by Year}\label{columns-by-year}}

Spread out the maternal mortality rate by year.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{matmort\_wide }\OtherTok{\textless{}{-}}\NormalTok{ matmort2 }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{spread}\NormalTok{(}\AttributeTok{key =}\NormalTok{ Year, }\AttributeTok{value =}\NormalTok{ rate) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{print}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 542 x 6
##    Country     ci_low ci_hi `1990` `2000` `2015`
##    <chr>        <int> <int>  <int>  <int>  <int>
##  1 Afghanistan    253   620     NA     NA    396
##  2 Afghanistan    745  1570     NA   1100     NA
##  3 Afghanistan    878  1950   1340     NA     NA
##  4 Albania         16    46     NA     NA     29
##  5 Albania         33    56     NA     43     NA
##  6 Albania         58    88     71     NA     NA
##  7 Algeria         82   244     NA     NA    140
##  8 Algeria        118   241     NA    170     NA
##  9 Algeria        141   327    216     NA     NA
## 10 Angola         221   988     NA     NA    477
## # ... with 532 more rows
\end{verbatim}

\begin{warning}
Nope, that didn't work at all, but it's a really common mistake when spreading data. This is because \texttt{spread} matches on all the remaining columns, so Afghanistan with \texttt{ci\_low} of 253 is treated as a different observation than Afghanistan with \texttt{ci\_low} of 745.

\end{warning}

This is where \texttt{pivot\_wider()} can be very useful. You can set \texttt{values\_from} to multiple column names and their names will be added to the \texttt{names\_from} values.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{matmort\_wide }\OtherTok{\textless{}{-}}\NormalTok{ matmort2 }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{pivot\_wider}\NormalTok{(}
    \AttributeTok{names\_from =}\NormalTok{ Year,}
    \AttributeTok{values\_from =} \FunctionTok{c}\NormalTok{(rate, ci\_low, ci\_hi)}
\NormalTok{  )}
              
\FunctionTok{glimpse}\NormalTok{(matmort\_wide)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Rows: 181
## Columns: 10
## $ Country     <chr> "Afghanistan", "Albania", "Algeria", "Angola", "Argentina"~
## $ rate_1990   <int> 1340, 71, 216, 1160, 72, 58, 8, 8, 64, 46, 26, 569, 58, 33~
## $ rate_2000   <int> 1100, 43, 170, 924, 60, 40, 9, 5, 48, 61, 21, 399, 48, 26,~
## $ rate_2015   <int> 396, 29, 140, 477, 52, 25, 6, 4, 25, 80, 15, 176, 27, 4, 7~
## $ ci_low_1990 <int> 878, 58, 141, 627, 64, 51, 7, 7, 56, 34, 20, 446, 47, 28, ~
## $ ci_low_2000 <int> 745, 33, 118, 472, 54, 35, 8, 4, 42, 50, 18, 322, 38, 22, ~
## $ ci_low_2015 <int> 253, 16, 82, 221, 44, 21, 5, 3, 17, 53, 12, 125, 19, 3, 5,~
## $ ci_hi_1990  <int> 1950, 88, 327, 2020, 80, 65, 9, 10, 74, 61, 33, 715, 72, 3~
## $ ci_hi_2000  <int> 1570, 56, 241, 1730, 65, 46, 10, 6, 55, 74, 26, 496, 58, 3~
## $ ci_hi_2015  <int> 620, 46, 244, 988, 63, 31, 7, 5, 35, 124, 19, 280, 37, 6, ~
\end{verbatim}

\hypertarget{experimentum-data}{%
\subsection{Experimentum Data}\label{experimentum-data}}

Students in the Institute of Neuroscience and Psychology at the University of Glasgow can use the online experiment builder platform, \href{https://debruine.github.io/experimentum/}{Experimentum}. The platform is also \href{https://github.com/debruine/experimentum}{open source on github} for anyone who can install it on a web server. It allows you to group questionnaires and experiments into \textbf{projects} with randomisation and counterbalancing. Data for questionnaires and experiments are downloadable in long format, but researchers often need to put them in wide format for analysis.

Look at the help menu for built-in dataset \texttt{experimentum\_quests} to learn what each column is. Subjects are asked questions about dogs to test the different questionnaire response types.

\begin{itemize}
\tightlist
\item
  current: Do you own a dog? (yes/no)\\
\item
  past: Have you ever owned a dog? (yes/no)\\
\item
  name: What is the best name for a dog? (free short text)\\
\item
  good: How good are dogs? (1=pretty good:7=very good)\\
\item
  country: What country do borzois come from?\\
\item
  good\_borzoi: How good are borzois? (0=pretty good:100=very good)\\
\item
  text: Write some text about dogs. (free long text)\\
\item
  time: What time is it? (time)
\end{itemize}

To get the dataset into wide format, where each question is in a separate column, use the following code:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{q }\OtherTok{\textless{}{-}}\NormalTok{ experimentum\_quests }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{pivot\_wider}\NormalTok{(}\AttributeTok{id\_cols =}\NormalTok{ session\_id}\SpecialCharTok{:}\NormalTok{user\_age,}
              \AttributeTok{names\_from =}\NormalTok{ q\_name,}
              \AttributeTok{values\_from =}\NormalTok{ dv) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{type.convert}\NormalTok{(}\AttributeTok{as.is =} \ConstantTok{TRUE}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{print}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 24 x 15
##    session_id project_id quest_id user_id user_sex user_status user_age current
##         <int>      <int>    <int>   <int> <chr>    <chr>          <dbl>   <int>
##  1      34034          1        1   31105 female   guest           28.2       1
##  2      34104          1        1   31164 male     registered      19.4       1
##  3      34326          1        1   31392 female   guest           17         0
##  4      34343          1        1   31397 male     guest           22         1
##  5      34765          1        1   31770 female   guest           44         1
##  6      34796          1        1   31796 female   guest           35.9       0
##  7      34806          1        1   31798 female   guest           35         0
##  8      34822          1        1   31802 female   guest           58         1
##  9      34864          1        1   31820 male     guest           20         0
## 10      35014          1        1   31921 female   student         39.2       1
## # ... with 14 more rows, and 7 more variables: past <int>, name <chr>,
## #   good <int>, country <chr>, text <chr>, good_borzoi <int>, time <chr>
\end{verbatim}

\begin{info}
The responses in the \texttt{dv} column have multiple types (e.g., integer, double, and character), but they are all represented as character strings when they're in the same column. After you spread the data to wide format, each column should be given the ocrrect data type. The function \texttt{type.convert()} makes a best guess at what type each new column should be and converts it. The argument \texttt{as.is\ =\ TRUE} converts columns where none of the numbers have decimal places to integers.

\end{info}

\hypertarget{glossary-tidyr}{%
\section{Glossary}\label{glossary-tidyr}}

\begin{tabular}{l|l}
\hline
term & definition\\
\hline
character & A data type representing strings of text.\\
\hline
double & A data type representing a real decimal number\\
\hline
integer & A data type representing whole numbers.\\
\hline
long & Data where each observation is on a separate row\\
\hline
observation & All of the data about a single trial or question.\\
\hline
value & A single number or piece of data.\\
\hline
variable & A word that identifies and stores the value of some data for later use.\\
\hline
wide & Data where all of the observations about one subject are in the same row\\
\hline
\end{tabular}

\hypertarget{resources-tidyr}{%
\section{Further Resources}\label{resources-tidyr}}

\begin{itemize}
\tightlist
\item
  \href{http://vita.had.co.nz/papers/tidy-data.html}{Tidy Data}
\item
  \href{http://r4ds.had.co.nz/tidy-data.html}{Chapter 12: Tidy Data} in \emph{R for Data Science}
\item
  \href{http://r4ds.had.co.nz/pipes.html}{Chapter 18: Pipes} in \emph{R for Data Science}
\item
  \href{https://www.rstudio.com/wp-content/uploads/2015/02/data-wrangling-cheatsheet.pdf}{Data wrangling cheat sheet}
\end{itemize}

\hypertarget{dplyr}{%
\chapter{Data Wrangling}\label{dplyr}}

\hypertarget{ilo-dplyr}{%
\section{Learning Objectives}\label{ilo-dplyr}}

\hypertarget{basic-3}{%
\subsection*{Basic}\label{basic-3}}
\addcontentsline{toc}{subsection}{Basic}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Be able to use the 6 main dplyr one-table verbs: \href{https://youtu.be/l12tNKClTR0}{(video)}

  \begin{itemize}
  \tightlist
  \item
    \protect\hyperlink{select}{\texttt{select()}}
  \item
    \protect\hyperlink{filter}{\texttt{filter()}}
  \item
    \protect\hyperlink{arrange}{\texttt{arrange()}}
  \item
    \protect\hyperlink{mutate}{\texttt{mutate()}}
  \item
    \protect\hyperlink{summarise}{\texttt{summarise()}}
  \item
    \protect\hyperlink{group_by}{\texttt{group\_by()}}
  \end{itemize}
\item
  Be able to \protect\hyperlink{all-together}{wrangle data by chaining tidyr and dplyr functions} \href{https://youtu.be/hzFFAkwrkqA}{(video)}
\item
  Be able to use these additional one-table verbs: \href{https://youtu.be/GmfF162mq4g}{(video)}

  \begin{itemize}
  \tightlist
  \item
    \protect\hyperlink{rename}{\texttt{rename()}}
  \item
    \protect\hyperlink{distinct}{\texttt{distinct()}}
  \item
    \protect\hyperlink{count}{\texttt{count()}}
  \item
    \protect\hyperlink{slice}{\texttt{slice()}}
  \item
    \protect\hyperlink{pull}{\texttt{pull()}}
  \end{itemize}
\end{enumerate}

\hypertarget{intermediate-3}{%
\subsection*{Intermediate}\label{intermediate-3}}
\addcontentsline{toc}{subsection}{Intermediate}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{3}
\tightlist
\item
  Fine control of \protect\hyperlink{select_helpers}{\texttt{select()} operations} \href{https://youtu.be/R1bi1QwF9t0}{(video)}
\item
  Use \protect\hyperlink{window}{window functions} \href{https://youtu.be/uo4b0W9mqPc}{(video)}
\end{enumerate}

\hypertarget{setup-dplyr}{%
\section{Setup}\label{setup-dplyr}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# libraries needed for these examples}
\FunctionTok{library}\NormalTok{(tidyverse)}
\FunctionTok{library}\NormalTok{(lubridate)}
\FunctionTok{library}\NormalTok{(reprores)}
\FunctionTok{set.seed}\NormalTok{(}\DecValTok{8675309}\NormalTok{) }\CommentTok{\# makes sure random numbers are reproducible}
\end{Highlighting}
\end{Shaded}

\hypertarget{data-disgust}{%
\subsection{\texorpdfstring{The \texttt{disgust} dataset}{The disgust dataset}}\label{data-disgust}}

These examples will use data from \texttt{reprores::disgust}, which contains data from the \href{http://digitalrepository.unm.edu/cgi/viewcontent.cgi?article=1139\&context=psy_etds}{Three Domain Disgust Scale}. Each participant is identified by a unique \texttt{user\_id} and each questionnaire completion has a unique \texttt{id}. Look at the Help for this dataset to see the individual questions.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{data}\NormalTok{(}\StringTok{"disgust"}\NormalTok{, }\AttributeTok{package =} \StringTok{"reprores"}\NormalTok{)}

\CommentTok{\#disgust \textless{}{-} read\_csv("https://psyteachr.github.io/reprores/data/disgust.csv")}
\end{Highlighting}
\end{Shaded}

\hypertarget{six-main-dplyr-verbs}{%
\section{Six main dplyr verbs}\label{six-main-dplyr-verbs}}

Most of the data wrangling you'll want to do with psychological data will involve the \texttt{tidyr} functions you learned in \protect\hyperlink{tidyr}{Chapter 4} and the six main \texttt{dplyr} verbs: \texttt{select}, \texttt{filter}, \texttt{arrange}, \texttt{mutate}, \texttt{summarise}, and \texttt{group\_by}.

\hypertarget{select}{%
\subsection{select()}\label{select}}

Select columns by name or number.

You can select each column individually, separated by commas (e.g., \texttt{col1,\ col2}). You can also select all columns between two columns by separating them with a colon (e.g., \texttt{start\_col:end\_col}).

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{moral }\OtherTok{\textless{}{-}}\NormalTok{ disgust }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{select}\NormalTok{(user\_id, moral1}\SpecialCharTok{:}\NormalTok{moral7)}
\FunctionTok{names}\NormalTok{(moral)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "user_id" "moral1"  "moral2"  "moral3"  "moral4"  "moral5"  "moral6" 
## [8] "moral7"
\end{verbatim}

You can select columns by number, which is useful when the column names are long or complicated.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{sexual }\OtherTok{\textless{}{-}}\NormalTok{ disgust }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{select}\NormalTok{(}\DecValTok{2}\NormalTok{, }\DecValTok{11}\SpecialCharTok{:}\DecValTok{17}\NormalTok{)}
\FunctionTok{names}\NormalTok{(sexual)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "user_id" "sexual1" "sexual2" "sexual3" "sexual4" "sexual5" "sexual6"
## [8] "sexual7"
\end{verbatim}

You can use a minus symbol to unselect columns, leaving all of the other columns. If you want to exclude a span of columns, put parentheses around the span first (e.g., \texttt{-(moral1:moral7)}, not \texttt{-moral1:moral7}).

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pathogen }\OtherTok{\textless{}{-}}\NormalTok{ disgust }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{select}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{id, }\SpecialCharTok{{-}}\NormalTok{date, }\SpecialCharTok{{-}}\NormalTok{(moral1}\SpecialCharTok{:}\NormalTok{sexual7))}
\FunctionTok{names}\NormalTok{(pathogen)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "user_id"   "pathogen1" "pathogen2" "pathogen3" "pathogen4" "pathogen5"
## [7] "pathogen6" "pathogen7"
\end{verbatim}

\hypertarget{select_helpers}{%
\subsubsection{Select helpers}\label{select_helpers}}

You can select columns based on criteria about the column names.

\hypertarget{starts_with}{%
\paragraph{\texorpdfstring{\texttt{starts\_with()}}{starts\_with()}}\label{starts_with}}

Select columns that start with a character string.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{u }\OtherTok{\textless{}{-}}\NormalTok{ disgust }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{select}\NormalTok{(}\FunctionTok{starts\_with}\NormalTok{(}\StringTok{"u"}\NormalTok{))}
\FunctionTok{names}\NormalTok{(u)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "user_id"
\end{verbatim}

\hypertarget{ends_with}{%
\paragraph{\texorpdfstring{\texttt{ends\_with()}}{ends\_with()}}\label{ends_with}}

Select columns that end with a character string.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{firstq }\OtherTok{\textless{}{-}}\NormalTok{ disgust }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{select}\NormalTok{(}\FunctionTok{ends\_with}\NormalTok{(}\StringTok{"1"}\NormalTok{))}
\FunctionTok{names}\NormalTok{(firstq)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "moral1"    "sexual1"   "pathogen1"
\end{verbatim}

\hypertarget{contains}{%
\paragraph{\texorpdfstring{\texttt{contains()}}{contains()}}\label{contains}}

Select columns that contain a character string.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pathogen }\OtherTok{\textless{}{-}}\NormalTok{ disgust }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{select}\NormalTok{(}\FunctionTok{contains}\NormalTok{(}\StringTok{"pathogen"}\NormalTok{))}
\FunctionTok{names}\NormalTok{(pathogen)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "pathogen1" "pathogen2" "pathogen3" "pathogen4" "pathogen5" "pathogen6"
## [7] "pathogen7"
\end{verbatim}

\hypertarget{num_range}{%
\paragraph{\texorpdfstring{\texttt{num\_range()}}{num\_range()}}\label{num_range}}

Select columns with a name that matches the pattern \texttt{prefix}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{moral2\_4 }\OtherTok{\textless{}{-}}\NormalTok{ disgust }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{select}\NormalTok{(}\FunctionTok{num\_range}\NormalTok{(}\StringTok{"moral"}\NormalTok{, }\DecValTok{2}\SpecialCharTok{:}\DecValTok{4}\NormalTok{))}
\FunctionTok{names}\NormalTok{(moral2\_4)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "moral2" "moral3" "moral4"
\end{verbatim}

\begin{info}
Use \texttt{width} to set the number of digits with leading
zeros. For example, \texttt{num\_range(\textquotesingle{}var\_\textquotesingle{},\ 8:10,\ width=2)} selects columns \texttt{var\_08}, \texttt{var\_09}, and \texttt{var\_10}.

\end{info}

\hypertarget{filter}{%
\subsection{filter()}\label{filter}}

Select rows by matching column criteria.

Select all rows where the user\_id is 1 (that's Lisa).

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{disgust }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{filter}\NormalTok{(user\_id }\SpecialCharTok{==} \DecValTok{1}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 1 x 24
##      id user_id date       moral1 moral2 moral3 moral4 moral5 moral6 moral7
##   <dbl>   <dbl> <date>      <dbl>  <dbl>  <dbl>  <dbl>  <dbl>  <dbl>  <dbl>
## 1     1       1 2008-07-10      2      2      1      2      1      1      1
## # ... with 14 more variables: sexual1 <dbl>, sexual2 <dbl>, sexual3 <dbl>,
## #   sexual4 <dbl>, sexual5 <dbl>, sexual6 <dbl>, sexual7 <dbl>,
## #   pathogen1 <dbl>, pathogen2 <dbl>, pathogen3 <dbl>, pathogen4 <dbl>,
## #   pathogen5 <dbl>, pathogen6 <dbl>, pathogen7 <dbl>
\end{verbatim}

\begin{warning}
Remember to use \texttt{==} and not \texttt{=} to check if two things are equivalent. A single \texttt{=} assigns the righthand value to the lefthand variable and (usually) evaluates to \texttt{TRUE}.

\end{warning}

You can select on multiple criteria by separating them with commas.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{amoral }\OtherTok{\textless{}{-}}\NormalTok{ disgust }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{filter}\NormalTok{(}
\NormalTok{  moral1 }\SpecialCharTok{==} \DecValTok{0}\NormalTok{, }
\NormalTok{  moral2 }\SpecialCharTok{==} \DecValTok{0}\NormalTok{,}
\NormalTok{  moral3 }\SpecialCharTok{==} \DecValTok{0}\NormalTok{, }
\NormalTok{  moral4 }\SpecialCharTok{==} \DecValTok{0}\NormalTok{,}
\NormalTok{  moral5 }\SpecialCharTok{==} \DecValTok{0}\NormalTok{,}
\NormalTok{  moral6 }\SpecialCharTok{==} \DecValTok{0}\NormalTok{,}
\NormalTok{  moral7 }\SpecialCharTok{==} \DecValTok{0}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

You can use the symbols \texttt{\&}, \texttt{\textbar{}}, and \texttt{!} to mean ``and'', ``or'', and ``not''. You can also use other operators to make equations.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# everyone who chose either 0 or 7 for question moral1}
\NormalTok{moral\_extremes }\OtherTok{\textless{}{-}}\NormalTok{ disgust }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(moral1 }\SpecialCharTok{==} \DecValTok{0} \SpecialCharTok{|}\NormalTok{ moral1 }\SpecialCharTok{==} \DecValTok{7}\NormalTok{)}

\CommentTok{\# everyone who chose the same answer for all moral questions}
\NormalTok{moral\_consistent }\OtherTok{\textless{}{-}}\NormalTok{ disgust }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(}
\NormalTok{    moral2 }\SpecialCharTok{==}\NormalTok{ moral1 }\SpecialCharTok{\&} 
\NormalTok{    moral3 }\SpecialCharTok{==}\NormalTok{ moral1 }\SpecialCharTok{\&} 
\NormalTok{    moral4 }\SpecialCharTok{==}\NormalTok{ moral1 }\SpecialCharTok{\&}
\NormalTok{    moral5 }\SpecialCharTok{==}\NormalTok{ moral1 }\SpecialCharTok{\&}
\NormalTok{    moral6 }\SpecialCharTok{==}\NormalTok{ moral1 }\SpecialCharTok{\&}
\NormalTok{    moral7 }\SpecialCharTok{==}\NormalTok{ moral1}
\NormalTok{  )}

\CommentTok{\# everyone who did not answer 7 for all 7 moral questions}
\NormalTok{moral\_no\_ceiling }\OtherTok{\textless{}{-}}\NormalTok{ disgust }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{filter}\NormalTok{(moral1}\SpecialCharTok{+}\NormalTok{moral2}\SpecialCharTok{+}\NormalTok{moral3}\SpecialCharTok{+}\NormalTok{moral4}\SpecialCharTok{+}\NormalTok{moral5}\SpecialCharTok{+}\NormalTok{moral6}\SpecialCharTok{+}\NormalTok{moral7 }\SpecialCharTok{!=} \DecValTok{7}\SpecialCharTok{*}\DecValTok{7}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{match-operator}{%
\subsubsection{Match operator (\%in\%)}\label{match-operator}}

Sometimes you need to exclude some participant IDs for reasons that can't be described in code. The match operator (\texttt{\%in\%}) is useful here for testing if a column value is in a list. Surround the equation with parentheses and put \texttt{!} in front to test that a value is not in the list.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{no\_researchers }\OtherTok{\textless{}{-}}\NormalTok{ disgust }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{filter}\NormalTok{(}\SpecialCharTok{!}\NormalTok{(user\_id }\SpecialCharTok{\%in\%} \FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{2}\NormalTok{)))}
\end{Highlighting}
\end{Shaded}

\hypertarget{dates}{%
\subsubsection{Dates}\label{dates}}

You can use the \texttt{lubridate} package to work with dates. For example, you can use the \texttt{year()} function to return just the year from the \texttt{date} column and then select only data collected in 2010.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{disgust2010 }\OtherTok{\textless{}{-}}\NormalTok{ disgust }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{filter}\NormalTok{(}\FunctionTok{year}\NormalTok{(date) }\SpecialCharTok{==} \DecValTok{2010}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{table}

\caption{\label{tab:dates-year}Rows 1-6 from `disgust2010`}
\centering
\begin{tabular}[t]{r|r|l|r|r|r|r|r|r|r|r|r|r|r|r|r|r|r|r|r|r|r|r|r}
\hline
id & user\_id & date & moral1 & moral2 & moral3 & moral4 & moral5 & moral6 & moral7 & sexual1 & sexual2 & sexual3 & sexual4 & sexual5 & sexual6 & sexual7 & pathogen1 & pathogen2 & pathogen3 & pathogen4 & pathogen5 & pathogen6 & pathogen7\\
\hline
6902 & 5469 & 2010-12-06 & 0 & 1 & 3 & 4 & 1 & 0 & 1 & 3 & 5 & 2 & 4 & 6 & 6 & 5 & 5 & 2 & 4 & 4 & 2 & 2 & 6\\
\hline
6158 & 6066 & 2010-04-18 & 4 & 5 & 6 & 5 & 5 & 4 & 4 & 3 & 0 & 1 & 6 & 3 & 5 & 3 & 6 & 5 & 5 & 5 & 5 & 5 & 5\\
\hline
6362 & 7129 & 2010-06-09 & 4 & 4 & 4 & 4 & 3 & 3 & 2 & 4 & 2 & 1 & 3 & 2 & 3 & 6 & 5 & 2 & 0 & 4 & 5 & 5 & 4\\
\hline
6302 & 39318 & 2010-05-20 & 2 & 4 & 1 & 4 & 5 & 6 & 0 & 1 & 0 & 0 & 1 & 0 & 0 & 1 & 3 & 2 & 3 & 2 & 3 & 2 & 4\\
\hline
5429 & 43029 & 2010-01-02 & 1 & 1 & 1 & 3 & 6 & 4 & 2 & 2 & 0 & 1 & 4 & 6 & 6 & 6 & 4 & 6 & 6 & 6 & 6 & 6 & 4\\
\hline
6732 & 71955 & 2010-10-15 & 2 & 5 & 3 & 6 & 3 & 2 & 5 & 4 & 3 & 3 & 6 & 6 & 6 & 5 & 4 & 2 & 6 & 5 & 6 & 6 & 3\\
\hline
\end{tabular}
\end{table}

Or select data from at least 5 years ago. You can use the \texttt{range} function to check the minimum and maximum dates in the resulting dataset.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{disgust\_5ago }\OtherTok{\textless{}{-}}\NormalTok{ disgust }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{filter}\NormalTok{(date }\SpecialCharTok{\textless{}} \FunctionTok{today}\NormalTok{() }\SpecialCharTok{{-}} \FunctionTok{dyears}\NormalTok{(}\DecValTok{5}\NormalTok{))}

\FunctionTok{range}\NormalTok{(disgust\_5ago}\SpecialCharTok{$}\NormalTok{date)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "2008-07-10" "2016-09-20"
\end{verbatim}

\hypertarget{arrange}{%
\subsection{arrange()}\label{arrange}}

Sort your dataset using \texttt{arrange()}. You will find yourself needing to sort data in R much less than you do in Excel, since you don't need to have rows next to each other in order to, for example, calculate group means. But \texttt{arrange()} can be useful when preparing data from display in tables.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{disgust\_order }\OtherTok{\textless{}{-}}\NormalTok{ disgust }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{arrange}\NormalTok{(date, moral1)}
\end{Highlighting}
\end{Shaded}

\begin{table}

\caption{\label{tab:arrange}Rows 1-6 from `disgust_order`}
\centering
\begin{tabular}[t]{r|r|l|r|r|r|r|r|r|r|r|r|r|r|r|r|r|r|r|r|r|r|r|r}
\hline
id & user\_id & date & moral1 & moral2 & moral3 & moral4 & moral5 & moral6 & moral7 & sexual1 & sexual2 & sexual3 & sexual4 & sexual5 & sexual6 & sexual7 & pathogen1 & pathogen2 & pathogen3 & pathogen4 & pathogen5 & pathogen6 & pathogen7\\
\hline
1 & 1 & 2008-07-10 & 2 & 2 & 1 & 2 & 1 & 1 & 1 & 3 & 1 & 1 & 2 & 1 & 2 & 2 & 3 & 2 & 3 & 3 & 2 & 3 & 3\\
\hline
3 & 155324 & 2008-07-11 & 2 & 4 & 3 & 5 & 2 & 1 & 4 & 1 & 0 & 1 & 2 & 2 & 6 & 1 & 4 & 3 & 1 & 0 & 4 & 4 & 2\\
\hline
6 & 155386 & 2008-07-12 & 2 & 4 & 0 & 4 & 0 & 0 & 0 & 6 & 0 & 0 & 6 & 4 & 4 & 6 & 4 & 5 & 5 & 1 & 6 & 4 & 2\\
\hline
7 & 155409 & 2008-07-12 & 4 & 5 & 5 & 4 & 5 & 1 & 5 & 3 & 0 & 1 & 5 & 2 & 0 & 0 & 5 & 5 & 3 & 4 & 4 & 2 & 6\\
\hline
4 & 155366 & 2008-07-12 & 6 & 6 & 6 & 3 & 6 & 6 & 6 & 0 & 0 & 0 & 0 & 0 & 0 & 3 & 4 & 4 & 5 & 5 & 4 & 6 & 0\\
\hline
5 & 155370 & 2008-07-12 & 6 & 6 & 4 & 6 & 6 & 6 & 6 & 2 & 6 & 4 & 3 & 6 & 6 & 6 & 6 & 6 & 6 & 2 & 4 & 4 & 6\\
\hline
\end{tabular}
\end{table}

Reverse the order using \texttt{desc()}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{disgust\_order\_desc }\OtherTok{\textless{}{-}}\NormalTok{ disgust }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{arrange}\NormalTok{(}\FunctionTok{desc}\NormalTok{(date))}
\end{Highlighting}
\end{Shaded}

\begin{table}

\caption{\label{tab:arrange-desc}Rows 1-6 from `disgust_order_desc`}
\centering
\begin{tabular}[t]{r|r|l|r|r|r|r|r|r|r|r|r|r|r|r|r|r|r|r|r|r|r|r|r}
\hline
id & user\_id & date & moral1 & moral2 & moral3 & moral4 & moral5 & moral6 & moral7 & sexual1 & sexual2 & sexual3 & sexual4 & sexual5 & sexual6 & sexual7 & pathogen1 & pathogen2 & pathogen3 & pathogen4 & pathogen5 & pathogen6 & pathogen7\\
\hline
39456 & 356866 & 2017-08-21 & 1 & 1 & 1 & 1 & 1 & 1 & 1 & 1 & 1 & 1 & 1 & 1 & 1 & 1 & 1 & 1 & 1 & 1 & 1 & 1 & 1\\
\hline
39447 & 128727 & 2017-08-13 & 2 & 4 & 1 & 2 & 2 & 5 & 3 & 0 & 0 & 1 & 0 & 0 & 2 & 1 & 2 & 0 & 2 & 1 & 1 & 1 & 1\\
\hline
39371 & 152955 & 2017-06-13 & 6 & 6 & 3 & 6 & 6 & 6 & 6 & 1 & 0 & 0 & 2 & 1 & 4 & 4 & 5 & 0 & 5 & 4 & 3 & 6 & 3\\
\hline
39342 & 48303 & 2017-05-22 & 4 & 5 & 4 & 4 & 6 & 4 & 5 & 2 & 1 & 4 & 1 & 1 & 3 & 1 & 5 & 5 & 4 & 4 & 4 & 4 & 5\\
\hline
39159 & 151633 & 2017-04-04 & 4 & 5 & 6 & 5 & 3 & 6 & 2 & 6 & 4 & 0 & 4 & 0 & 3 & 6 & 4 & 4 & 6 & 6 & 6 & 6 & 4\\
\hline
38942 & 370464 & 2017-02-01 & 1 & 5 & 0 & 6 & 5 & 5 & 5 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 5 & 0 & 3 & 3 & 1 & 6 & 3\\
\hline
\end{tabular}
\end{table}

\hypertarget{mutate}{%
\subsection{mutate()}\label{mutate}}

Add new columns. This is one of the most useful functions in the tidyverse.

Refer to other columns by their names (unquoted). You can add more than one column in the same mutate function, just separate the columns with a comma. Once you make a new column, you can use it in further column definitions e.g., \texttt{total} below).

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{disgust\_total }\OtherTok{\textless{}{-}}\NormalTok{ disgust }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}
    \AttributeTok{pathogen =}\NormalTok{ pathogen1 }\SpecialCharTok{+}\NormalTok{ pathogen2 }\SpecialCharTok{+}\NormalTok{ pathogen3 }\SpecialCharTok{+}\NormalTok{ pathogen4 }\SpecialCharTok{+}\NormalTok{ pathogen5 }\SpecialCharTok{+}\NormalTok{ pathogen6 }\SpecialCharTok{+}\NormalTok{ pathogen7,}
    \AttributeTok{moral =}\NormalTok{ moral1 }\SpecialCharTok{+}\NormalTok{ moral2 }\SpecialCharTok{+}\NormalTok{ moral3 }\SpecialCharTok{+}\NormalTok{ moral4 }\SpecialCharTok{+}\NormalTok{ moral5 }\SpecialCharTok{+}\NormalTok{ moral6 }\SpecialCharTok{+}\NormalTok{ moral7,}
    \AttributeTok{sexual =}\NormalTok{ sexual1 }\SpecialCharTok{+}\NormalTok{ sexual2 }\SpecialCharTok{+}\NormalTok{ sexual3 }\SpecialCharTok{+}\NormalTok{ sexual4 }\SpecialCharTok{+}\NormalTok{ sexual5 }\SpecialCharTok{+}\NormalTok{ sexual6 }\SpecialCharTok{+}\NormalTok{ sexual7,}
    \AttributeTok{total =}\NormalTok{ pathogen }\SpecialCharTok{+}\NormalTok{ moral }\SpecialCharTok{+}\NormalTok{ sexual,}
    \AttributeTok{user\_id =} \FunctionTok{paste0}\NormalTok{(}\StringTok{"U"}\NormalTok{, user\_id)}
\NormalTok{  )}
\end{Highlighting}
\end{Shaded}

\begin{table}

\caption{\label{tab:mutate}Rows 1-6 from `disgust_total`}
\centering
\begin{tabular}[t]{r|l|l|r|r|r|r|r|r|r|r|r|r|r|r|r|r|r|r|r|r|r|r|r|r|r|r|r}
\hline
id & user\_id & date & moral1 & moral2 & moral3 & moral4 & moral5 & moral6 & moral7 & sexual1 & sexual2 & sexual3 & sexual4 & sexual5 & sexual6 & sexual7 & pathogen1 & pathogen2 & pathogen3 & pathogen4 & pathogen5 & pathogen6 & pathogen7 & pathogen & moral & sexual & total\\
\hline
1199 & U0 & 2008-10-07 & 5 & 6 & 4 & 6 & 5 & 5 & 6 & 4 & 0 & 1 & 0 & 1 & 4 & 5 & 6 & 1 & 6 & 5 & 4 & 5 & 6 & 33 & 37 & 15 & 85\\
\hline
1 & U1 & 2008-07-10 & 2 & 2 & 1 & 2 & 1 & 1 & 1 & 3 & 1 & 1 & 2 & 1 & 2 & 2 & 3 & 2 & 3 & 3 & 2 & 3 & 3 & 19 & 10 & 12 & 41\\
\hline
1599 & U2 & 2008-10-27 & 1 & 1 & 1 & 1 & NA & NA & 1 & 1 & NA & 1 & NA & 1 & NA & NA & NA & NA & 1 & NA & NA & NA & NA & NA & NA & NA & NA\\
\hline
13332 & U2118 & 2012-01-02 & 0 & 1 & 1 & 1 & 1 & 2 & 1 & 4 & 3 & 0 & 6 & 0 & 3 & 5 & 5 & 6 & 4 & 6 & 5 & 5 & 4 & 35 & 7 & 21 & 63\\
\hline
23 & U2311 & 2008-07-15 & 4 & 4 & 4 & 4 & 4 & 4 & 4 & 2 & 1 & 2 & 1 & 1 & 1 & 5 & 5 & 5 & 4 & 4 & 5 & 4 & 3 & 30 & 28 & 13 & 71\\
\hline
1160 & U3630 & 2008-10-06 & 1 & 5 & NA & 5 & 5 & 5 & 1 & 0 & 5 & 0 & 2 & 0 & 1 & 0 & 6 & 3 & 1 & 1 & 3 & 1 & 0 & 15 & NA & 8 & NA\\
\hline
\end{tabular}
\end{table}

\begin{warning}
You can overwrite a column by giving a new column the same name as the old column (see \texttt{user\_id}) above. Make sure that you mean to do this and that you aren't trying to use the old column value after you redefine it.

\end{warning}

\hypertarget{summarise}{%
\subsection{summarise()}\label{summarise}}

Create summary statistics for the dataset. Check the \href{https://www.rstudio.org/links/data_wrangling_cheat_sheet}{Data Wrangling Cheat Sheet} or the \href{https://github.com/rstudio/cheatsheets/raw/master/source/pdfs/data-transformation-cheatsheet.pdf}{Data Transformation Cheat Sheet} for various summary functions. Some common ones are: \texttt{mean()}, \texttt{sd()}, \texttt{n()}, \texttt{sum()}, and \texttt{quantile()}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{disgust\_summary}\OtherTok{\textless{}{-}}\NormalTok{ disgust\_total }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{summarise}\NormalTok{(}
    \AttributeTok{n =} \FunctionTok{n}\NormalTok{(),}
    \AttributeTok{q25 =} \FunctionTok{quantile}\NormalTok{(total, .}\DecValTok{25}\NormalTok{, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{),}
    \AttributeTok{q50 =} \FunctionTok{quantile}\NormalTok{(total, .}\DecValTok{50}\NormalTok{, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{),}
    \AttributeTok{q75 =} \FunctionTok{quantile}\NormalTok{(total, .}\DecValTok{75}\NormalTok{, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{),}
    \AttributeTok{avg\_total =} \FunctionTok{mean}\NormalTok{(total, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{),}
    \AttributeTok{sd\_total  =} \FunctionTok{sd}\NormalTok{(total, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{),}
    \AttributeTok{min\_total =} \FunctionTok{min}\NormalTok{(total, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{),}
    \AttributeTok{max\_total =} \FunctionTok{max}\NormalTok{(total, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{)}
\NormalTok{  )}
\end{Highlighting}
\end{Shaded}

\begin{table}

\caption{\label{tab:summarise}All rows from `disgust_summary`}
\centering
\begin{tabular}[t]{r|r|r|r|r|r|r|r}
\hline
n & q25 & q50 & q75 & avg\_total & sd\_total & min\_total & max\_total\\
\hline
20000 & 59 & 71 & 83 & 70.6868 & 18.24253 & 0 & 126\\
\hline
\end{tabular}
\end{table}

\hypertarget{group_by}{%
\subsection{group\_by()}\label{group_by}}

Create subsets of the data. You can use this to create summaries,
like the mean value for all of your experimental groups.

Here, we'll use \texttt{mutate} to create a new column called \texttt{year}, group by \texttt{year}, and calculate the average scores.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{disgust\_groups }\OtherTok{\textless{}{-}}\NormalTok{ disgust\_total }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{year =} \FunctionTok{year}\NormalTok{(date)) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{group\_by}\NormalTok{(year) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{summarise}\NormalTok{(}
    \AttributeTok{n =} \FunctionTok{n}\NormalTok{(),}
    \AttributeTok{avg\_total =} \FunctionTok{mean}\NormalTok{(total, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{),}
    \AttributeTok{sd\_total  =} \FunctionTok{sd}\NormalTok{(total, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{),}
    \AttributeTok{min\_total =} \FunctionTok{min}\NormalTok{(total, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{),}
    \AttributeTok{max\_total =} \FunctionTok{max}\NormalTok{(total, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{),}
    \AttributeTok{.groups =} \StringTok{"drop"}
\NormalTok{  )}
\end{Highlighting}
\end{Shaded}

\begin{table}

\caption{\label{tab:group-by}All rows from `disgust_groups`}
\centering
\begin{tabular}[t]{r|r|r|r|r|r}
\hline
year & n & avg\_total & sd\_total & min\_total & max\_total\\
\hline
2008 & 2578 & 70.29975 & 18.46251 & 0 & 126\\
\hline
2009 & 2580 & 69.74481 & 18.61959 & 3 & 126\\
\hline
2010 & 1514 & 70.59238 & 18.86846 & 6 & 126\\
\hline
2011 & 6046 & 71.34425 & 17.79446 & 0 & 126\\
\hline
2012 & 5938 & 70.42530 & 18.35782 & 0 & 126\\
\hline
2013 & 1251 & 71.59574 & 17.61375 & 0 & 126\\
\hline
2014 & 58 & 70.46296 & 17.23502 & 19 & 113\\
\hline
2015 & 21 & 74.26316 & 16.89787 & 43 & 107\\
\hline
2016 & 8 & 67.87500 & 32.62531 & 0 & 110\\
\hline
2017 & 6 & 57.16667 & 27.93862 & 21 & 90\\
\hline
\end{tabular}
\end{table}

\begin{warning}
If you don't add \texttt{.groups\ =\ "drop"} at the end of the \texttt{summarise()} function, you will get the following message: ``\texttt{summarise()} ungrouping output (override with \texttt{.groups} argument)''. This just reminds you that the groups are still in effect and any further functions will also be grouped.

Older versions of dplyr didn't do this, so older code will generate this warning if you run it with newer version of dplyr. Older code might \texttt{ungroup()} after \texttt{summarise()} to indicate that groupings should be dropped. The default behaviour is usually correct, so you don't need to worry, but it's best to explicitly set \texttt{.groups} in a \texttt{summarise()} function after \texttt{group\_by()} if you want to ``keep'' or ``drop'' the groupings.

\end{warning}

You can use \texttt{filter} after \texttt{group\_by}. The following example returns the lowest total score from each year (i.e., the row where the \texttt{rank()} of the value in the column \texttt{total} is equivalent to \texttt{1}).

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{disgust\_lowest }\OtherTok{\textless{}{-}}\NormalTok{ disgust\_total }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{year =} \FunctionTok{year}\NormalTok{(date)) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{select}\NormalTok{(user\_id, year, total) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{group\_by}\NormalTok{(year) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{filter}\NormalTok{(}\FunctionTok{rank}\NormalTok{(total) }\SpecialCharTok{==} \DecValTok{1}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{arrange}\NormalTok{(year)}
\end{Highlighting}
\end{Shaded}

\begin{table}

\caption{\label{tab:group-by-filter}All rows from `disgust_lowest`}
\centering
\begin{tabular}[t]{l|r|r}
\hline
user\_id & year & total\\
\hline
U236585 & 2009 & 3\\
\hline
U292359 & 2010 & 6\\
\hline
U245384 & 2013 & 0\\
\hline
U206293 & 2014 & 19\\
\hline
U407089 & 2015 & 43\\
\hline
U453237 & 2016 & 0\\
\hline
U356866 & 2017 & 21\\
\hline
\end{tabular}
\end{table}

You can also use \texttt{mutate} after \texttt{group\_by}. The following example calculates subject-mean-centered scores by grouping the scores by \texttt{user\_id} and then subtracting the group-specific mean from each score. {Note the use of \texttt{gather} to tidy the data into a long format first.}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{disgust\_smc }\OtherTok{\textless{}{-}}\NormalTok{ disgust }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{gather}\NormalTok{(}\StringTok{"question"}\NormalTok{, }\StringTok{"score"}\NormalTok{, moral1}\SpecialCharTok{:}\NormalTok{pathogen7) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{group\_by}\NormalTok{(user\_id) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{score\_smc =}\NormalTok{ score }\SpecialCharTok{{-}} \FunctionTok{mean}\NormalTok{(score, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ungroup}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{warning}
Use \texttt{ungroup()} as soon as you are done with grouped functions, otherwise the data table will still be grouped when you use it in the future.

\end{warning}

\begin{table}

\caption{\label{tab:group-by-mutate}Rows 1-6 from `disgust_smc`}
\centering
\begin{tabular}[t]{r|r|l|l|r|r}
\hline
id & user\_id & date & question & score & score\_smc\\
\hline
1199 & 0 & 2008-10-07 & moral1 & 5 & 0.9523810\\
\hline
1 & 1 & 2008-07-10 & moral1 & 2 & 0.0476190\\
\hline
1599 & 2 & 2008-10-27 & moral1 & 1 & 0.0000000\\
\hline
13332 & 2118 & 2012-01-02 & moral1 & 0 & -3.0000000\\
\hline
23 & 2311 & 2008-07-15 & moral1 & 4 & 0.6190476\\
\hline
1160 & 3630 & 2008-10-06 & moral1 & 1 & -1.2500000\\
\hline
\end{tabular}
\end{table}

\hypertarget{all-together}{%
\subsection{All Together}\label{all-together}}

A lot of what we did above would be easier if the data were tidy, so let's do that first. Then we can use \texttt{group\_by} to calculate the domain scores.

After that, we can spread out the 3 domains, calculate the total score, remove any rows with a missing (\texttt{NA}) total, and calculate mean values by year.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{disgust\_tidy }\OtherTok{\textless{}{-}}\NormalTok{ reprores}\SpecialCharTok{::}\NormalTok{disgust }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{gather}\NormalTok{(}\StringTok{"question"}\NormalTok{, }\StringTok{"score"}\NormalTok{, moral1}\SpecialCharTok{:}\NormalTok{pathogen7) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{separate}\NormalTok{(question, }\FunctionTok{c}\NormalTok{(}\StringTok{"domain"}\NormalTok{,}\StringTok{"q\_num"}\NormalTok{), }\AttributeTok{sep =} \SpecialCharTok{{-}}\DecValTok{1}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{group\_by}\NormalTok{(id, user\_id, date, domain) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{summarise}\NormalTok{(}\AttributeTok{score =} \FunctionTok{mean}\NormalTok{(score), }\AttributeTok{.groups =} \StringTok{"drop"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{table}

\caption{\label{tab:all-tidy}Rows 1-6 from `disgust_tidy`}
\centering
\begin{tabular}[t]{r|r|l|l|r}
\hline
id & user\_id & date & domain & score\\
\hline
1 & 1 & 2008-07-10 & moral & 1.428571\\
\hline
1 & 1 & 2008-07-10 & pathogen & 2.714286\\
\hline
1 & 1 & 2008-07-10 & sexual & 1.714286\\
\hline
3 & 155324 & 2008-07-11 & moral & 3.000000\\
\hline
3 & 155324 & 2008-07-11 & pathogen & 2.571429\\
\hline
3 & 155324 & 2008-07-11 & sexual & 1.857143\\
\hline
\end{tabular}
\end{table}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{disgust\_scored }\OtherTok{\textless{}{-}}\NormalTok{ disgust\_tidy }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{spread}\NormalTok{(domain, score) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}
    \AttributeTok{total =}\NormalTok{ moral }\SpecialCharTok{+}\NormalTok{ sexual }\SpecialCharTok{+}\NormalTok{ pathogen,}
    \AttributeTok{year =} \FunctionTok{year}\NormalTok{(date)}
\NormalTok{  ) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{filter}\NormalTok{(}\SpecialCharTok{!}\FunctionTok{is.na}\NormalTok{(total)) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{arrange}\NormalTok{(user\_id) }
\end{Highlighting}
\end{Shaded}

\begin{table}

\caption{\label{tab:all-scored}Rows 1-6 from `disgust_scored`}
\centering
\begin{tabular}[t]{r|r|l|r|r|r|r|r}
\hline
id & user\_id & date & moral & pathogen & sexual & total & year\\
\hline
1199 & 0 & 2008-10-07 & 5.285714 & 4.714286 & 2.142857 & 12.142857 & 2008\\
\hline
1 & 1 & 2008-07-10 & 1.428571 & 2.714286 & 1.714286 & 5.857143 & 2008\\
\hline
13332 & 2118 & 2012-01-02 & 1.000000 & 5.000000 & 3.000000 & 9.000000 & 2012\\
\hline
23 & 2311 & 2008-07-15 & 4.000000 & 4.285714 & 1.857143 & 10.142857 & 2008\\
\hline
7980 & 4458 & 2011-09-05 & 3.428571 & 3.571429 & 3.000000 & 10.000000 & 2011\\
\hline
552 & 4651 & 2008-08-23 & 3.857143 & 4.857143 & 4.285714 & 13.000000 & 2008\\
\hline
\end{tabular}
\end{table}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{disgust\_summarised }\OtherTok{\textless{}{-}}\NormalTok{ disgust\_scored }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{group\_by}\NormalTok{(year) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{summarise}\NormalTok{(}
    \AttributeTok{n =} \FunctionTok{n}\NormalTok{(),}
    \AttributeTok{avg\_pathogen =} \FunctionTok{mean}\NormalTok{(pathogen),}
    \AttributeTok{avg\_moral =} \FunctionTok{mean}\NormalTok{(moral),}
    \AttributeTok{avg\_sexual =} \FunctionTok{mean}\NormalTok{(sexual),}
    \AttributeTok{first\_user =} \FunctionTok{first}\NormalTok{(user\_id),}
    \AttributeTok{last\_user =} \FunctionTok{last}\NormalTok{(user\_id),}
    \AttributeTok{.groups =} \StringTok{"drop"}
\NormalTok{  )}
\end{Highlighting}
\end{Shaded}

\begin{table}

\caption{\label{tab:all-summarised}Rows 1-6 from `disgust_summarised`}
\centering
\begin{tabular}[t]{r|r|r|r|r|r|r}
\hline
year & n & avg\_pathogen & avg\_moral & avg\_sexual & first\_user & last\_user\\
\hline
2008 & 2392 & 3.697265 & 3.806259 & 2.539298 & 0 & 188708\\
\hline
2009 & 2410 & 3.674333 & 3.760937 & 2.528275 & 6093 & 251959\\
\hline
2010 & 1418 & 3.731412 & 3.843139 & 2.510075 & 5469 & 319641\\
\hline
2011 & 5586 & 3.756918 & 3.806506 & 2.628612 & 4458 & 406569\\
\hline
2012 & 5375 & 3.740465 & 3.774591 & 2.545701 & 2118 & 458194\\
\hline
2013 & 1222 & 3.771920 & 3.906944 & 2.549100 & 7646 & 462428\\
\hline
2014 & 54 & 3.759259 & 4.000000 & 2.306878 & 11090 & 461307\\
\hline
2015 & 19 & 3.781955 & 4.451128 & 2.375940 & 102699 & 460283\\
\hline
2016 & 8 & 3.696429 & 3.625000 & 2.375000 & 4976 & 453237\\
\hline
2017 & 6 & 3.071429 & 3.690476 & 1.404762 & 48303 & 370464\\
\hline
\end{tabular}
\end{table}

\hypertarget{additional-dplyr-one-table-verbs}{%
\section{Additional dplyr one-table verbs}\label{additional-dplyr-one-table-verbs}}

Use the code examples below and the help pages to figure out what the following one-table verbs do. Most have pretty self-explanatory names.

\hypertarget{rename}{%
\subsection{rename()}\label{rename}}

You can rename columns with \texttt{rename()}. Set the argument name to the new name, and the value to the old name. You need to put a name in quotes or backticks if it doesn't follow the rules for a good variable name (contains only letter, numbers, underscores, and full stops; and doesn't start with a number).

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{sw }\OtherTok{\textless{}{-}}\NormalTok{ starwars }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{rename}\NormalTok{(}\AttributeTok{Name =}\NormalTok{ name,}
         \AttributeTok{Height =}\NormalTok{ height,}
         \AttributeTok{Mass =}\NormalTok{ mass,}
         \StringTok{\textasciigrave{}}\AttributeTok{Hair Colour}\StringTok{\textasciigrave{}} \OtherTok{=}\NormalTok{ hair\_color,}
         \StringTok{\textasciigrave{}}\AttributeTok{Skin Colour}\StringTok{\textasciigrave{}} \OtherTok{=}\NormalTok{ skin\_color,}
         \StringTok{\textasciigrave{}}\AttributeTok{Eye Colour}\StringTok{\textasciigrave{}} \OtherTok{=}\NormalTok{ eye\_color,}
         \StringTok{\textasciigrave{}}\AttributeTok{Birth Year}\StringTok{\textasciigrave{}} \OtherTok{=}\NormalTok{ birth\_year)}

\FunctionTok{names}\NormalTok{(sw)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1] "Name"        "Height"      "Mass"        "Hair Colour" "Skin Colour"
##  [6] "Eye Colour"  "Birth Year"  "sex"         "gender"      "homeworld"  
## [11] "species"     "films"       "vehicles"    "starships"
\end{verbatim}

\begin{try}
Almost everyone gets confused at some point with \texttt{rename()} and tries to put the original names on the left and the new names on the right. Try it and see what the error message looks like.

\end{try}

\hypertarget{distinct}{%
\subsection{distinct()}\label{distinct}}

Get rid of exactly duplicate rows with \texttt{distinct()}. This can be helpful if, for example, you are merging data from multiple computers and some of the data got copied from one computer to another, creating duplicate rows.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# create a data table with duplicated values}
\NormalTok{dupes }\OtherTok{\textless{}{-}} \FunctionTok{tibble}\NormalTok{(}
  \AttributeTok{id =} \FunctionTok{c}\NormalTok{( }\DecValTok{1}\NormalTok{,   }\DecValTok{2}\NormalTok{,   }\DecValTok{1}\NormalTok{,   }\DecValTok{2}\NormalTok{,   }\DecValTok{1}\NormalTok{,   }\DecValTok{2}\NormalTok{),}
  \AttributeTok{dv =} \FunctionTok{c}\NormalTok{(}\StringTok{"A"}\NormalTok{, }\StringTok{"B"}\NormalTok{, }\StringTok{"C"}\NormalTok{, }\StringTok{"D"}\NormalTok{, }\StringTok{"A"}\NormalTok{, }\StringTok{"B"}\NormalTok{)}
\NormalTok{)}

\FunctionTok{distinct}\NormalTok{(dupes)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 4 x 2
##      id dv   
##   <dbl> <chr>
## 1     1 A    
## 2     2 B    
## 3     1 C    
## 4     2 D
\end{verbatim}

\hypertarget{count}{%
\subsection{count()}\label{count}}

The function \texttt{count()} is a quick shortcut for the common combination of \texttt{group\_by()} and \texttt{summarise()} used to count the number of rows per group.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{starwars }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{group\_by}\NormalTok{(sex) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{summarise}\NormalTok{(}\AttributeTok{n =} \FunctionTok{n}\NormalTok{(), }\AttributeTok{.groups =} \StringTok{"drop"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 5 x 2
##   sex                n
##   <chr>          <int>
## 1 female            16
## 2 hermaphroditic     1
## 3 male              60
## 4 none               6
## 5 <NA>               4
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{count}\NormalTok{(starwars, sex)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 5 x 2
##   sex                n
##   <chr>          <int>
## 1 female            16
## 2 hermaphroditic     1
## 3 male              60
## 4 none               6
## 5 <NA>               4
\end{verbatim}

\hypertarget{slice}{%
\subsection{slice()}\label{slice}}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{slice}\NormalTok{(starwars, }\DecValTok{1}\SpecialCharTok{:}\DecValTok{3}\NormalTok{, }\DecValTok{10}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 4 x 14
##   name     height  mass hair_color  skin_color eye_color birth_year sex   gender
##   <chr>     <int> <dbl> <chr>       <chr>      <chr>          <dbl> <chr> <chr> 
## 1 Luke Sk~    172    77 blond       fair       blue              19 male  mascu~
## 2 C-3PO       167    75 <NA>        gold       yellow           112 none  mascu~
## 3 R2-D2        96    32 <NA>        white, bl~ red               33 none  mascu~
## 4 Obi-Wan~    182    77 auburn, wh~ fair       blue-gray         57 male  mascu~
## # ... with 5 more variables: homeworld <chr>, species <chr>, films <list>,
## #   vehicles <list>, starships <list>
\end{verbatim}

\hypertarget{pull}{%
\subsection{pull()}\label{pull}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{starwars }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{filter}\NormalTok{(species }\SpecialCharTok{==} \StringTok{"Droid"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{pull}\NormalTok{(name)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "C-3PO"  "R2-D2"  "R5-D4"  "IG-88"  "R4-P17" "BB8"
\end{verbatim}

\hypertarget{window}{%
\section{Window functions}\label{window}}

Window functions use the order of rows to calculate values. You can use them to do things that require ranking or ordering, like choose the top scores in each class, or accessing the previous and next rows, like calculating cumulative sums or means.

The \href{https://dplyr.tidyverse.org/articles/window-functions.html}{dplyr window functions vignette} has very good detailed explanations of these functions, but we've described a few of the most useful ones below.

\hypertarget{ranking-functions}{%
\subsection{Ranking functions}\label{ranking-functions}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{grades }\OtherTok{\textless{}{-}} \FunctionTok{tibble}\NormalTok{(}
  \AttributeTok{id =} \DecValTok{1}\SpecialCharTok{:}\DecValTok{5}\NormalTok{,}
  \StringTok{"Data Skills"} \OtherTok{=} \FunctionTok{c}\NormalTok{(}\DecValTok{16}\NormalTok{, }\DecValTok{17}\NormalTok{, }\DecValTok{17}\NormalTok{, }\DecValTok{19}\NormalTok{, }\DecValTok{20}\NormalTok{), }
  \StringTok{"Statistics"}  \OtherTok{=} \FunctionTok{c}\NormalTok{(}\DecValTok{14}\NormalTok{, }\DecValTok{16}\NormalTok{, }\DecValTok{18}\NormalTok{, }\DecValTok{18}\NormalTok{, }\DecValTok{19}\NormalTok{)}
\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{gather}\NormalTok{(class, grade, }\DecValTok{2}\SpecialCharTok{:}\DecValTok{3}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{group\_by}\NormalTok{(class) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{row\_number =} \FunctionTok{row\_number}\NormalTok{(),}
         \AttributeTok{rank       =} \FunctionTok{rank}\NormalTok{(grade),}
         \AttributeTok{min\_rank   =} \FunctionTok{min\_rank}\NormalTok{(grade),}
         \AttributeTok{dense\_rank =} \FunctionTok{dense\_rank}\NormalTok{(grade),}
         \AttributeTok{quartile   =} \FunctionTok{ntile}\NormalTok{(grade, }\DecValTok{4}\NormalTok{),}
         \AttributeTok{percentile =} \FunctionTok{ntile}\NormalTok{(grade, }\DecValTok{100}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{table}

\caption{\label{tab:unnamed-chunk-1}All rows from `grades`}
\centering
\begin{tabular}[t]{r|l|r|r|r|r|r|r|r}
\hline
id & class & grade & row\_number & rank & min\_rank & dense\_rank & quartile & percentile\\
\hline
1 & Data Skills & 16 & 1 & 1.0 & 1 & 1 & 1 & 1\\
\hline
2 & Data Skills & 17 & 2 & 2.5 & 2 & 2 & 1 & 2\\
\hline
3 & Data Skills & 17 & 3 & 2.5 & 2 & 2 & 2 & 3\\
\hline
4 & Data Skills & 19 & 4 & 4.0 & 4 & 3 & 3 & 4\\
\hline
5 & Data Skills & 20 & 5 & 5.0 & 5 & 4 & 4 & 5\\
\hline
1 & Statistics & 14 & 1 & 1.0 & 1 & 1 & 1 & 1\\
\hline
2 & Statistics & 16 & 2 & 2.0 & 2 & 2 & 1 & 2\\
\hline
3 & Statistics & 18 & 3 & 3.5 & 3 & 3 & 2 & 3\\
\hline
4 & Statistics & 18 & 4 & 3.5 & 3 & 3 & 3 & 4\\
\hline
5 & Statistics & 19 & 5 & 5.0 & 5 & 4 & 4 & 5\\
\hline
\end{tabular}
\end{table}

\begin{try}

\begin{itemize}
\tightlist
\item
  What are the differences among \texttt{row\_number()}, \texttt{rank()}, \texttt{min\_rank()}, \texttt{dense\_rank()}, and \texttt{ntile()}?
\item
  Why doesn't \texttt{row\_number()} need an argument?
\item
  What would happen if you gave it the argument \texttt{grade} or \texttt{class}?
\item
  What do you think would happen if you removed the \texttt{group\_by(class)} line above?
\item
  What if you added \texttt{id} to the grouping?
\item
  What happens if you change the order of the rows?
\item
  What does the second argument in \texttt{ntile()} do?
\end{itemize}

\end{try}

You can use window functions to group your data into quantiles.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{sw\_mass }\OtherTok{\textless{}{-}}\NormalTok{ starwars }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{group\_by}\NormalTok{(}\AttributeTok{tertile =} \FunctionTok{ntile}\NormalTok{(mass, }\DecValTok{3}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{summarise}\NormalTok{(}\AttributeTok{min =} \FunctionTok{min}\NormalTok{(mass),}
            \AttributeTok{max =} \FunctionTok{max}\NormalTok{(mass),}
            \AttributeTok{mean =} \FunctionTok{mean}\NormalTok{(mass),}
            \AttributeTok{.groups =} \StringTok{"drop"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{table}

\caption{\label{tab:unnamed-chunk-2}All rows from `sw_mass`}
\centering
\begin{tabular}[t]{r|r|r|r}
\hline
tertile & min & max & mean\\
\hline
1 & 15 & 68 & 45.6600\\
\hline
2 & 74 & 82 & 78.4100\\
\hline
3 & 83 & 1358 & 171.5789\\
\hline
NA & NA & NA & NA\\
\hline
\end{tabular}
\end{table}

\begin{try}
Why is there a row of \texttt{NA} values? How would you get rid of them?

\end{try}

\hypertarget{offset-functions}{%
\subsection{Offset functions}\label{offset-functions}}

The function \texttt{lag()} gives a previous row's value. It defaults to 1 row back, but you can change that with the \texttt{n} argument. The function \texttt{lead()} gives values ahead of the current row.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{lag\_lead }\OtherTok{\textless{}{-}} \FunctionTok{tibble}\NormalTok{(}\AttributeTok{x =} \DecValTok{1}\SpecialCharTok{:}\DecValTok{6}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{lag =} \FunctionTok{lag}\NormalTok{(x),}
         \AttributeTok{lag2 =} \FunctionTok{lag}\NormalTok{(x, }\AttributeTok{n =} \DecValTok{2}\NormalTok{),}
         \AttributeTok{lead =} \FunctionTok{lead}\NormalTok{(x, }\AttributeTok{default =} \DecValTok{0}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{table}

\caption{\label{tab:unnamed-chunk-3}All rows from `lag_lead`}
\centering
\begin{tabular}[t]{r|r|r|r}
\hline
x & lag & lag2 & lead\\
\hline
1 & NA & NA & 2\\
\hline
2 & 1 & NA & 3\\
\hline
3 & 2 & 1 & 4\\
\hline
4 & 3 & 2 & 5\\
\hline
5 & 4 & 3 & 6\\
\hline
6 & 5 & 4 & 0\\
\hline
\end{tabular}
\end{table}

You can use offset functions to calculate change between trials or where a value changes. Use the \texttt{order\_by} argument to specify the order of the rows. Alternatively, you can use \texttt{arrange()} before the offset functions.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{trials }\OtherTok{\textless{}{-}} \FunctionTok{tibble}\NormalTok{(}
  \AttributeTok{trial =} \FunctionTok{sample}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\DecValTok{10}\NormalTok{, }\DecValTok{10}\NormalTok{),}
  \AttributeTok{cond =} \FunctionTok{sample}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{"exp"}\NormalTok{, }\StringTok{"ctrl"}\NormalTok{), }\DecValTok{10}\NormalTok{, T),}
  \AttributeTok{score =} \FunctionTok{rpois}\NormalTok{(}\DecValTok{10}\NormalTok{, }\DecValTok{4}\NormalTok{)}
\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}
    \AttributeTok{score\_change =}\NormalTok{ score }\SpecialCharTok{{-}} \FunctionTok{lag}\NormalTok{(score, }\AttributeTok{order\_by =}\NormalTok{ trial),}
    \AttributeTok{change\_cond =}\NormalTok{ cond }\SpecialCharTok{!=} \FunctionTok{lag}\NormalTok{(cond, }\AttributeTok{order\_by =}\NormalTok{ trial, }
                              \AttributeTok{default =} \StringTok{"no condition"}\NormalTok{)}
\NormalTok{  ) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{arrange}\NormalTok{(trial)}
\end{Highlighting}
\end{Shaded}

\begin{table}

\caption{\label{tab:offset-adv}All rows from `trials`}
\centering
\begin{tabular}[t]{r|l|r|r|l}
\hline
trial & cond & score & score\_change & change\_cond\\
\hline
1 & ctrl & 8 & NA & TRUE\\
\hline
2 & ctrl & 4 & -4 & FALSE\\
\hline
3 & exp & 6 & 2 & TRUE\\
\hline
4 & ctrl & 2 & -4 & TRUE\\
\hline
5 & ctrl & 3 & 1 & FALSE\\
\hline
6 & ctrl & 6 & 3 & FALSE\\
\hline
7 & ctrl & 2 & -4 & FALSE\\
\hline
8 & exp & 4 & 2 & TRUE\\
\hline
9 & ctrl & 4 & 0 & TRUE\\
\hline
10 & exp & 3 & -1 & TRUE\\
\hline
\end{tabular}
\end{table}

\begin{try}

Look at the help pages for \texttt{lag()} and \texttt{lead()}.

\begin{itemize}
\tightlist
\item
  What happens if you remove the \texttt{order\_by} argument or change it to \texttt{cond}?
\item
  What does the \texttt{default} argument do?
\item
  Can you think of circumstances in your own data where you might need to use \texttt{lag()} or \texttt{lead()}?
\end{itemize}

\end{try}

\hypertarget{cumulative-aggregates}{%
\subsection{Cumulative aggregates}\label{cumulative-aggregates}}

\texttt{cumsum()}, \texttt{cummin()}, and \texttt{cummax()} are base R functions for calculating cumulative means, minimums, and maximums. The dplyr package introduces \texttt{cumany()} and \texttt{cumall()}, which return \texttt{TRUE} if any or all of the previous values meet their criteria.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{cumulative }\OtherTok{\textless{}{-}} \FunctionTok{tibble}\NormalTok{(}
  \AttributeTok{time =} \DecValTok{1}\SpecialCharTok{:}\DecValTok{10}\NormalTok{,}
  \AttributeTok{obs =} \FunctionTok{c}\NormalTok{(}\DecValTok{2}\NormalTok{, }\DecValTok{2}\NormalTok{, }\DecValTok{1}\NormalTok{, }\DecValTok{2}\NormalTok{, }\DecValTok{4}\NormalTok{, }\DecValTok{3}\NormalTok{, }\DecValTok{1}\NormalTok{, }\DecValTok{0}\NormalTok{, }\DecValTok{3}\NormalTok{, }\DecValTok{5}\NormalTok{)}
\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}
    \AttributeTok{cumsum =} \FunctionTok{cumsum}\NormalTok{(obs),}
    \AttributeTok{cummin =} \FunctionTok{cummin}\NormalTok{(obs),}
    \AttributeTok{cummax =} \FunctionTok{cummax}\NormalTok{(obs),}
    \AttributeTok{cumany =} \FunctionTok{cumany}\NormalTok{(obs }\SpecialCharTok{==} \DecValTok{3}\NormalTok{),}
    \AttributeTok{cumall =} \FunctionTok{cumall}\NormalTok{(obs }\SpecialCharTok{\textless{}} \DecValTok{4}\NormalTok{)}
\NormalTok{  )}
\end{Highlighting}
\end{Shaded}

\begin{table}

\caption{\label{tab:unnamed-chunk-4}All rows from `cumulative`}
\centering
\begin{tabular}[t]{r|r|r|r|r|l|l}
\hline
time & obs & cumsum & cummin & cummax & cumany & cumall\\
\hline
1 & 2 & 2 & 2 & 2 & FALSE & TRUE\\
\hline
2 & 2 & 4 & 2 & 2 & FALSE & TRUE\\
\hline
3 & 1 & 5 & 1 & 2 & FALSE & TRUE\\
\hline
4 & 2 & 7 & 1 & 2 & FALSE & TRUE\\
\hline
5 & 4 & 11 & 1 & 4 & FALSE & FALSE\\
\hline
6 & 3 & 14 & 1 & 4 & TRUE & FALSE\\
\hline
7 & 1 & 15 & 1 & 4 & TRUE & FALSE\\
\hline
8 & 0 & 15 & 0 & 4 & TRUE & FALSE\\
\hline
9 & 3 & 18 & 0 & 4 & TRUE & FALSE\\
\hline
10 & 5 & 23 & 0 & 5 & TRUE & FALSE\\
\hline
\end{tabular}
\end{table}

\begin{try}

\begin{itemize}
\tightlist
\item
  What would happen if you change \texttt{cumany(obs\ ==\ 3)} to \texttt{cumany(obs\ \textgreater{}\ 2)}?
\item
  What would happen if you change \texttt{cumall(obs\ \textless{}\ 4)} to \texttt{cumall(obs\ \textless{}\ 2)}?
\item
  Can you think of circumstances in your own data where you might need to use \texttt{cumany()} or \texttt{cumall()}?
\end{itemize}

\end{try}

\hypertarget{glossary-dplyr}{%
\section{Glossary}\label{glossary-dplyr}}

\begin{tabular}{l|l}
\hline
term & definition\\
\hline
data-wrangling & The process of preparing data for visualisation and statistical analysis.\\
\hline
\end{tabular}

\hypertarget{resources-dplyr}{%
\section{Further Resources}\label{resources-dplyr}}

\begin{itemize}
\tightlist
\item
  \href{http://r4ds.had.co.nz/transform.html}{Chapter 5: Data Transformation} in \emph{R for Data Science}
\item
  \href{https://github.com/rstudio/cheatsheets/raw/master/data-transformation.pdf}{Data transformation cheat sheet}
\item
  \href{http://r4ds.had.co.nz/dates-and-times.html}{Chapter 16: Date and times} in \emph{R for Data Science}
\end{itemize}

\hypertarget{glm}{%
\chapter{Introduction to GLM}\label{glm}}

\hypertarget{ilo-glm}{%
\section{Learning Objectives}\label{ilo-glm}}

\hypertarget{basic-4}{%
\subsection*{Basic}\label{basic-4}}
\addcontentsline{toc}{subsection}{Basic}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Define the \protect\hyperlink{glm-components}{components} of the GLM
\item
  \protect\hyperlink{sim-glm}{Simulate data} using GLM equations \href{https://youtu.be/JQ90LnVCbKc}{(video)}
\item
  Identify the model parameters that correspond to the data-generation parameters
\item
  Understand and plot \protect\hyperlink{residuals}{residuals} \href{https://youtu.be/sr-NtxiH2Qk}{(video)}
\item
  \protect\hyperlink{predict}{Predict new values} using the model \href{https://youtu.be/0o4LEbVVWfM}{(video)}
\item
  Explain the differences among \protect\hyperlink{coding-schemes}{coding schemes} \href{https://youtu.be/SqL28AbLj3g}{(video)}
\end{enumerate}

\hypertarget{intermediate-4}{%
\subsection*{Intermediate}\label{intermediate-4}}
\addcontentsline{toc}{subsection}{Intermediate}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{6}
\tightlist
\item
  Demonstrate the \protect\hyperlink{test-rels}{relationships} among two-sample t-test, one-way ANOVA, and linear regression
\item
  Given data and a GLM, \protect\hyperlink{decomp}{generate a decomposition matrix} and calculate sums of squares, mean squares, and F ratios for a one-way ANOVA
\end{enumerate}

\hypertarget{setup-glm}{%
\section{Setup}\label{setup-glm}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# libraries needed for these examples}
\FunctionTok{library}\NormalTok{(tidyverse)}
\FunctionTok{library}\NormalTok{(broom)}
\FunctionTok{set.seed}\NormalTok{(}\DecValTok{30250}\NormalTok{) }\CommentTok{\# makes sure random numbers are reproducible}
\end{Highlighting}
\end{Shaded}

\hypertarget{glm-1}{%
\section{GLM}\label{glm-1}}

\hypertarget{what-is-the-glm}{%
\subsection{What is the GLM?}\label{what-is-the-glm}}

The General Linear Model (GLM) is a general mathematical framework for expressing relationships among variables that can express or test linear relationships between a numerical dependent variable and any combination of categorical or continuous independent variables.

\hypertarget{glm-components}{%
\subsection{Components}\label{glm-components}}

There are some mathematical conventions that you need to learn to understand the equations representing linear models. Once you understand those, learning about the GLM will get much easier.

\begin{longtable}[]{@{}ll@{}}
\toprule
Component of GLM & Notation \\
\midrule
\endhead
Dependent Variable (DV) & \(Y\) \\
Grand Average & \(\mu\) (the Greek letter ``mu'') \\
Main Effects & \(A, B, C, \ldots\) \\
Interactions & \(AB, AC, BC, ABC, \ldots\) \\
Random Error & \(S(Group)\) \\
\bottomrule
\end{longtable}

The linear equation predicts the dependent variable (\(Y\)) as the sum of the grand average value of \(Y\) (\(\mu\), also called the intercept), the main effects of all the predictor variables (\(A+B+C+ \ldots\)), the interactions among all the predictor variables (\(AB, AC, BC, ABC, \ldots\)), and some random error (\(S(Group)\)). The equation for a model with two predictor variables (\(A\) and \(B\)) and their interaction (\(AB\)) is written like this:

\(Y\) \textasciitilde{} \(\mu+A+B+AB+S(Group)\)

Don't worry if this doesn't make sense until we walk through a concrete example.

\hypertarget{sim-glm}{%
\subsection{Simulating data from GLM}\label{sim-glm}}

A good way to learn about linear models is to simulate data where you know exactly how the variables are related, and then analyse this simulated data to see where the parameters show up in the analysis.

We'll start with a very simple linear model that just has a single categorical factor with two levels. Let's say we're predicting reaction times for congruent and incongruent trials in a Stroop task for a single participant. Average reaction time (\texttt{mu}) is 800ms, and is 50ms faster for congruent than incongruent trials (\texttt{effect}).

\begin{warning}
A \textbf{factor} is a categorical variable that is used to divide subjects into groups, usually to draw some comparison. Factors are composed of different \textbf{levels}. Do not confuse factors with levels!

In the example above, trial type is a factorlevel, incongrunt is a factorlevel, and congruent is a factorlevel.

\end{warning}

You need to represent categorical factors with numbers. The numbers, or coding scheme you choose will affect the numbers you get out of the analysis and how you need to interpret them. Here, we will effect code the trial types so that congruent trials are coded as +0.5, and incongruent trials are coded as -0.5.

A person won't always respond exactly the same way. They might be a little faster on some trials than others, due to random fluctuations in attention, learning about the task, or fatigue. So we can add an error term to each trial. We can't know how much any specific trial will differ, but we can characterise the distribution of how much trials differ from average and then sample from this distribution.

Here, we'll assume the error term is sampled from a normal distribution with a standard deviation of 100 ms (the mean of the error term distribution is always 0). We'll also sample 100 trials of each type, so we can see a range of variation.

So first create variables for all of the parameters that describe your data.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{n\_per\_grp }\OtherTok{\textless{}{-}} \DecValTok{100}
\NormalTok{mu }\OtherTok{\textless{}{-}} \DecValTok{800} \CommentTok{\# average RT}
\NormalTok{effect }\OtherTok{\textless{}{-}} \DecValTok{50} \CommentTok{\# average difference between congruent and incongruent trials}
\NormalTok{error\_sd }\OtherTok{\textless{}{-}} \DecValTok{100} \CommentTok{\# standard deviation of the error term}
\NormalTok{trial\_types }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"congruent"} \OtherTok{=} \FloatTok{0.5}\NormalTok{, }\StringTok{"incongruent"} \OtherTok{=} \SpecialCharTok{{-}}\FloatTok{0.5}\NormalTok{) }\CommentTok{\# effect code}
\end{Highlighting}
\end{Shaded}

Then simulate the data by creating a data table with a row for each trial and columns for the trial type and the error term (random numbers samples from a normal distribution with the SD specified by \texttt{error\_sd}). For categorical variables, include both a column with the text labels (\texttt{trial\_type}) and another column with the coded version (\texttt{trial\_type.e}) to make it easier to check what the codings mean and to use for graphing. Calculate the dependent variable (\texttt{RT}) as the sum of the grand mean (\texttt{mu}), the coefficient (\texttt{effect}) multiplied by the effect-coded predictor variable (\texttt{trial\_type.e}), and the error term.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dat }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}
  \AttributeTok{trial\_type =} \FunctionTok{rep}\NormalTok{(}\FunctionTok{names}\NormalTok{(trial\_types), }\AttributeTok{each =}\NormalTok{ n\_per\_grp)}
\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}
    \AttributeTok{trial\_type.e =} \FunctionTok{recode}\NormalTok{(trial\_type, }\SpecialCharTok{!!!}\NormalTok{trial\_types),}
    \AttributeTok{error =} \FunctionTok{rnorm}\NormalTok{(}\FunctionTok{nrow}\NormalTok{(.), }\DecValTok{0}\NormalTok{, error\_sd),}
    \AttributeTok{RT =}\NormalTok{ mu }\SpecialCharTok{+}\NormalTok{ effect}\SpecialCharTok{*}\NormalTok{trial\_type.e }\SpecialCharTok{+}\NormalTok{ error}
\NormalTok{  )}
\end{Highlighting}
\end{Shaded}

\begin{info}
The \texttt{!!!} (triple bang) in the code \texttt{recode(trial\_type,\ !!!trial\_types)} is a way to expand the vector \texttt{trial\_types\ \textless{}-\ c("congruent"\ =\ 0.5,\ "incongruent"\ =\ -0.5)}. It's equivalent to \texttt{recode(trial\_type,\ "congruent"\ =\ 0.5,\ "incongruent"\ =\ -0.5)}. This pattern avoids making mistakes with recoding because there is only one place where you set up the category to code mapping (in the \texttt{trial\_types} vector).

\end{info}

Last but not least, always plot simulated data to make sure it looks like you expect.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(dat, }\FunctionTok{aes}\NormalTok{(trial\_type, RT)) }\SpecialCharTok{+} 
  \FunctionTok{geom\_violin}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{geom\_boxplot}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{fill =}\NormalTok{ trial\_type), }
               \AttributeTok{width =} \FloatTok{0.25}\NormalTok{, }\AttributeTok{show.legend =} \ConstantTok{FALSE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{figure}

{\centering \includegraphics[width=1\linewidth]{08-glm_files/figure-latex/plot-sim-1} 

}

\caption{Simulated Data}\label{fig:plot-sim}
\end{figure}

\hypertarget{linear-regression}{%
\subsection{Linear Regression}\label{linear-regression}}

Now we can analyse the data we simulated using the function \texttt{lm()}. It takes the formula as the first argument. This is the same as the data-generating equation, but you can omit the error term (this is implied), and takes the data table as the second argument. Use the \texttt{summary()} function to see the statistical summary.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my\_lm }\OtherTok{\textless{}{-}} \FunctionTok{lm}\NormalTok{(RT }\SpecialCharTok{\textasciitilde{}}\NormalTok{ trial\_type.e, }\AttributeTok{data =}\NormalTok{ dat)}
\FunctionTok{summary}\NormalTok{(my\_lm)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Call:
## lm(formula = RT ~ trial_type.e, data = dat)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -302.110  -70.052    0.948   68.262  246.220 
## 
## Coefficients:
##              Estimate Std. Error t value Pr(>|t|)    
## (Intercept)   788.192      7.206 109.376  < 2e-16 ***
## trial_type.e   61.938     14.413   4.297 2.71e-05 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 101.9 on 198 degrees of freedom
## Multiple R-squared:  0.08532,    Adjusted R-squared:  0.0807 
## F-statistic: 18.47 on 1 and 198 DF,  p-value: 2.707e-05
\end{verbatim}

Notice how the \textbf{estimate} for the \texttt{(Intercept)} is close to the value we set for \texttt{mu} and the estimate for \texttt{trial\_type.e} is close to the value we set for \texttt{effect}.

\begin{try}
Change the values of \texttt{mu} and \texttt{effect}, resimulate the data, and re-run the linear model. What happens to the estimates?

\end{try}

\hypertarget{residuals}{%
\subsection{Residuals}\label{residuals}}

You can use the \texttt{residuals()} function to extract the error term for each each data point. This is the DV values, minus the estimates for the intercept and trial type. We'll make a density plot of the residuals below and compare it to the normal distribution we used for the error term.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{res }\OtherTok{\textless{}{-}} \FunctionTok{residuals}\NormalTok{(my\_lm)}
\FunctionTok{ggplot}\NormalTok{(dat) }\SpecialCharTok{+} 
  \FunctionTok{stat\_function}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\DecValTok{0}\NormalTok{), }\AttributeTok{color =} \StringTok{"grey60"}\NormalTok{,}
                \AttributeTok{fun =}\NormalTok{ dnorm, }\AttributeTok{n =} \DecValTok{101}\NormalTok{,}
                \AttributeTok{args =} \FunctionTok{list}\NormalTok{(}\AttributeTok{mean =} \DecValTok{0}\NormalTok{, }\AttributeTok{sd =}\NormalTok{ error\_sd)) }\SpecialCharTok{+}
  \FunctionTok{geom\_density}\NormalTok{(}\FunctionTok{aes}\NormalTok{(res, }\AttributeTok{color =}\NormalTok{ trial\_type))}
\end{Highlighting}
\end{Shaded}

\begin{figure}

{\centering \includegraphics[width=1\linewidth]{08-glm_files/figure-latex/res-density-plot-1} 

}

\caption{Model residuals should be approximately normally distributed for each group}\label{fig:res-density-plot}
\end{figure}

You can also compare the model residuals to the simulated error values. If the model is accurate, they should be almost identical. If the intercept estimate is slightly off, the points will be slightly above or below the black line. If the estimate for the effect of trial type is slightly off, there will be a small, systematic difference between residuals for congruent and incongruent trials.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(dat) }\SpecialCharTok{+}
  \FunctionTok{geom\_abline}\NormalTok{(}\AttributeTok{slope =} \DecValTok{1}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\FunctionTok{aes}\NormalTok{(error, res,}\AttributeTok{color =}\NormalTok{ trial\_type)) }\SpecialCharTok{+}
  \FunctionTok{ylab}\NormalTok{(}\StringTok{"Model Residuals"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{xlab}\NormalTok{(}\StringTok{"Simulated Error"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{figure}

{\centering \includegraphics[width=1\linewidth]{08-glm_files/figure-latex/res-err-plot-1} 

}

\caption{Model residuals should be very similar to the simulated error}\label{fig:res-err-plot}
\end{figure}

\begin{try}
What happens to the residuals if you fit a model that ignores trial type (e.g., \texttt{lm(Y\ \textasciitilde{}\ 1,\ data\ =\ dat)})?

\end{try}

\hypertarget{predict}{%
\subsection{Predict New Values}\label{predict}}

You can use the estimates from your model to predict new data points, given values for the model parameters. For this simple example, we just need to know the trial type to make a prediction.

For congruent trials, you would predict that a new data point would be equal to the intercept estimate plus the trial type estimate multiplied by 0.5 (the effect code for congruent trials).

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{int\_est }\OtherTok{\textless{}{-}}\NormalTok{ my\_lm}\SpecialCharTok{$}\NormalTok{coefficients[[}\StringTok{"(Intercept)"}\NormalTok{]]}
\NormalTok{tt\_est  }\OtherTok{\textless{}{-}}\NormalTok{ my\_lm}\SpecialCharTok{$}\NormalTok{coefficients[[}\StringTok{"trial\_type.e"}\NormalTok{]]}
\NormalTok{tt\_code }\OtherTok{\textless{}{-}}\NormalTok{ trial\_types[[}\StringTok{"congruent"}\NormalTok{]]}
\NormalTok{new\_congruent\_RT }\OtherTok{\textless{}{-}}\NormalTok{ int\_est }\SpecialCharTok{+}\NormalTok{ tt\_est }\SpecialCharTok{*}\NormalTok{ tt\_code}
\NormalTok{new\_congruent\_RT}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 819.1605
\end{verbatim}

You can also use the \texttt{predict()} function to do this more easily. The second argument is a data table with columns for the factors in the model and rows with the values that you want to use for the prediction.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{predict}\NormalTok{(my\_lm, }\AttributeTok{newdata =} \FunctionTok{tibble}\NormalTok{(}\AttributeTok{trial\_type.e =} \FloatTok{0.5}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##        1 
## 819.1605
\end{verbatim}

\begin{info}
If you look up this function using \texttt{?predict}, you will see that ``The function invokes particular methods which depend on the class of the first argument.''
What this means is that \texttt{predict()} works differently depending on whether you're predicting from the output of \texttt{lm()} or other analysis functions. You can search for help on the lm version with \texttt{?predict.lm}.

\end{info}

\hypertarget{coding-schemes}{%
\subsection{Coding Categorical Variables}\label{coding-schemes}}

In the example above, we used \textbf{effect coding} for trial type. You can also use \textbf{sum coding}, which assigns +1 and -1 to the levels instead of +0.5 and -0.5. More commonly, you might want to use \textbf{treatment coding}, which assigns 0 to one level (usually a baseline or control condition) and 1 to the other level (usually a treatment or experimental condition).

Here we will add sum-coded and treatment-coded versions of \texttt{trial\_type} to the dataset using the \texttt{recode()} function.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dat }\OtherTok{\textless{}{-}}\NormalTok{ dat }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{mutate}\NormalTok{(}
  \AttributeTok{trial\_type.sum =} \FunctionTok{recode}\NormalTok{(trial\_type, }\StringTok{"congruent"} \OtherTok{=} \SpecialCharTok{+}\DecValTok{1}\NormalTok{, }\StringTok{"incongruent"} \OtherTok{=} \SpecialCharTok{{-}}\DecValTok{1}\NormalTok{),}
  \AttributeTok{trial\_type.tr =} \FunctionTok{recode}\NormalTok{(trial\_type, }\StringTok{"congruent"} \OtherTok{=} \DecValTok{1}\NormalTok{, }\StringTok{"incongruent"} \OtherTok{=} \DecValTok{0}\NormalTok{)}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

If you define named vectors with your levels and coding, you can use them with the \texttt{recode()} function if you expand them using \texttt{!!!}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{tt\_sum }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"congruent"}   \OtherTok{=} \SpecialCharTok{+}\DecValTok{1}\NormalTok{, }
            \StringTok{"incongruent"} \OtherTok{=} \SpecialCharTok{{-}}\DecValTok{1}\NormalTok{)}
\NormalTok{tt\_tr }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"congruent"}   \OtherTok{=} \DecValTok{1}\NormalTok{, }
           \StringTok{"incongruent"} \OtherTok{=} \DecValTok{0}\NormalTok{)}
\NormalTok{dat }\OtherTok{\textless{}{-}}\NormalTok{ dat }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{mutate}\NormalTok{(}
  \AttributeTok{trial\_type.sum =} \FunctionTok{recode}\NormalTok{(trial\_type, }\SpecialCharTok{!!!}\NormalTok{tt\_sum),}
  \AttributeTok{trial\_type.tr =} \FunctionTok{recode}\NormalTok{(trial\_type, }\SpecialCharTok{!!!}\NormalTok{tt\_tr)}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Here are the coefficients for the effect-coded version. They should be the same as those from the last analysis.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{lm}\NormalTok{(RT }\SpecialCharTok{\textasciitilde{}}\NormalTok{ trial\_type.e, }\AttributeTok{data =}\NormalTok{ dat)}\SpecialCharTok{$}\NormalTok{coefficients}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  (Intercept) trial_type.e 
##    788.19166     61.93773
\end{verbatim}

Here are the coefficients for the sum-coded version. This give the same results as effect coding, except the estimate for the categorical factor will be exactly half as large, as it represents the difference between each trial type and the hypothetical condition of 0 (the overall mean RT), rather than the difference between the two trial types.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{lm}\NormalTok{(RT }\SpecialCharTok{\textasciitilde{}}\NormalTok{ trial\_type.sum, }\AttributeTok{data =}\NormalTok{ dat)}\SpecialCharTok{$}\NormalTok{coefficients}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##    (Intercept) trial_type.sum 
##      788.19166       30.96887
\end{verbatim}

Here are the coefficients for the treatment-coded version. The estimate for the categorical factor will be the same as in the effect-coded version, but the intercept will decrease. It will be equal to the intercept minus the estimate for trial type from the sum-coded version.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{lm}\NormalTok{(RT }\SpecialCharTok{\textasciitilde{}}\NormalTok{ trial\_type.tr, }\AttributeTok{data =}\NormalTok{ dat)}\SpecialCharTok{$}\NormalTok{coefficients}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##   (Intercept) trial_type.tr 
##     757.22279      61.93773
\end{verbatim}

\hypertarget{test-rels}{%
\section{Relationships among tests}\label{test-rels}}

\hypertarget{t-test-t-test-glm}{%
\subsection{T-test \{t-test-glm\}}\label{t-test-t-test-glm}}

The t-test is just a special, limited example of a general linear model.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{t.test}\NormalTok{(RT }\SpecialCharTok{\textasciitilde{}}\NormalTok{ trial\_type.e, }\AttributeTok{data =}\NormalTok{ dat, }\AttributeTok{var.equal =} \ConstantTok{TRUE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
##  Two Sample t-test
## 
## data:  RT by trial_type.e
## t = -4.2975, df = 198, p-value = 2.707e-05
## alternative hypothesis: true difference in means between group -0.5 and group 0.5 is not equal to 0
## 95 percent confidence interval:
##  -90.35945 -33.51601
## sample estimates:
## mean in group -0.5  mean in group 0.5 
##           757.2228           819.1605
\end{verbatim}

\begin{try}
What happens when you use other codings for trial type in the t-test above? Which coding maps onto the results of the t-test best?

\end{try}

\hypertarget{anova}{%
\subsection{ANOVA}\label{anova}}

ANOVA is also a special, limited version of the linear model.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my\_aov }\OtherTok{\textless{}{-}} \FunctionTok{aov}\NormalTok{(RT }\SpecialCharTok{\textasciitilde{}}\NormalTok{ trial\_type.e, }\AttributeTok{data =}\NormalTok{ dat)}
\FunctionTok{summary}\NormalTok{(my\_aov, }\AttributeTok{intercept =} \ConstantTok{TRUE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##               Df    Sum Sq   Mean Sq  F value   Pr(>F)    
## (Intercept)    1 124249219 124249219 11963.12  < 2e-16 ***
## trial_type.e   1    191814    191814    18.47 2.71e-05 ***
## Residuals    198   2056432     10386                      
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
\end{verbatim}

The easiest way to get parameters out of an analysis is to use the \texttt{broom::tidy()} function. This returns a tidy table that you can extract numbers of interest from. Here, we just want to get the F-value for the effect of trial\_type. Compare the square root of this value to the t-value from the t-tests above.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{f }\OtherTok{\textless{}{-}}\NormalTok{ broom}\SpecialCharTok{::}\FunctionTok{tidy}\NormalTok{(my\_aov)}\SpecialCharTok{$}\NormalTok{statistic[}\DecValTok{1}\NormalTok{]}
\FunctionTok{sqrt}\NormalTok{(f)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 4.297498
\end{verbatim}

\hypertarget{understanding-anova}{%
\section{Understanding ANOVA}\label{understanding-anova}}

We'll walk through an example of a one-way ANOVA with the following equation:

\(Y_{ij} = \mu + A_i + S(A)_{ij}\)

This means that each data point (\(Y_{ij}\)) is predicted to be the sum of the grand mean (\(\mu\)), plus the effect of factor A (\(A_i\)), plus some residual error (\(S(A)_{ij}\)).

\hypertarget{means-variability-and-deviation-scores}{%
\subsection{Means, Variability, and Deviation Scores}\label{means-variability-and-deviation-scores}}

Let's create a simple simulation function so you can quickly create a two-sample dataset with specified Ns, means, and SDs.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{two\_sample }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(}\AttributeTok{n =} \DecValTok{10}\NormalTok{, }\AttributeTok{m1 =} \DecValTok{0}\NormalTok{, }\AttributeTok{m2 =} \DecValTok{0}\NormalTok{, }\AttributeTok{sd1 =} \DecValTok{1}\NormalTok{, }\AttributeTok{sd2 =} \DecValTok{1}\NormalTok{) \{}
\NormalTok{  s1 }\OtherTok{\textless{}{-}} \FunctionTok{rnorm}\NormalTok{(n, m1, sd1)}
\NormalTok{  s2 }\OtherTok{\textless{}{-}} \FunctionTok{rnorm}\NormalTok{(n, m2, sd2)}
  
  \FunctionTok{data.frame}\NormalTok{(}
    \AttributeTok{Y =} \FunctionTok{c}\NormalTok{(s1, s2),}
    \AttributeTok{grp =} \FunctionTok{rep}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{"A"}\NormalTok{, }\StringTok{"B"}\NormalTok{), }\AttributeTok{each =}\NormalTok{ n)}
\NormalTok{  )}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

Now we will use \texttt{two\_sample()} to create a dataset \texttt{dat} with N=5 per group, means of -2 and +2, and SDs of 1 and 1 (yes, this is an effect size of d = 4).

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dat }\OtherTok{\textless{}{-}} \FunctionTok{two\_sample}\NormalTok{(}\DecValTok{5}\NormalTok{, }\SpecialCharTok{{-}}\DecValTok{2}\NormalTok{, }\SpecialCharTok{+}\DecValTok{2}\NormalTok{, }\DecValTok{1}\NormalTok{, }\DecValTok{1}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

You can calculate how each data point (\texttt{Y}) deviates from the overall sample mean (\(\hat{\mu}\)), which is represented by the horizontal grey line below and the deviations are the vertical grey lines. You can also calculate how different each point is from its group-specific mean (\(\hat{A_i}\)), which are represented by the horizontal coloured lines below and the deviations are the coloured vertical lines.

\begin{figure}

{\centering \includegraphics[width=1\linewidth]{08-glm_files/figure-latex/deviation-1} 

}

\caption{Deviations of each data point (Y) from the overall and group means}\label{fig:deviation}
\end{figure}

You can use these deviations to calculate variability between groups and within groups. ANOVA tests whether the variability between groups is larger than that within groups, accounting for the number of groups and observations.

\hypertarget{decomp}{%
\subsection{Decomposition matrices}\label{decomp}}

We can use the estimation equations for a one-factor ANOVA to calculate the model components.

\begin{itemize}
\tightlist
\item
  \texttt{mu} is the overall mean
\item
  \texttt{a} is how different each group mean is from the overall mean
\item
  \texttt{err} is residual error, calculated by subtracting \texttt{mu} and \texttt{a} from \texttt{Y}
\end{itemize}

This produces a \emph{decomposition matrix}, a table with columns for \texttt{Y}, \texttt{mu}, \texttt{a}, and \texttt{err}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{decomp }\OtherTok{\textless{}{-}}\NormalTok{ dat }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{select}\NormalTok{(Y, grp) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{mu =} \FunctionTok{mean}\NormalTok{(Y)) }\SpecialCharTok{\%\textgreater{}\%}     \CommentTok{\# calculate mu\_hat}
  \FunctionTok{group\_by}\NormalTok{(grp) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{a =} \FunctionTok{mean}\NormalTok{(Y) }\SpecialCharTok{{-}}\NormalTok{ mu) }\SpecialCharTok{\%\textgreater{}\%} \CommentTok{\# calculate a\_hat for each grp}
  \FunctionTok{ungroup}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{err =}\NormalTok{ Y }\SpecialCharTok{{-}}\NormalTok{ mu }\SpecialCharTok{{-}}\NormalTok{ a)     }\CommentTok{\# calculate residual error}
\end{Highlighting}
\end{Shaded}

\begin{tabular}{r|l|r|r|r}
\hline
Y & grp & mu & a & err\\
\hline
-1.4770938 & A & 0.1207513 & -1.533501 & -0.0643443\\
\hline
-2.9508741 & A & 0.1207513 & -1.533501 & -1.5381246\\
\hline
-0.6376736 & A & 0.1207513 & -1.533501 & 0.7750759\\
\hline
-1.7579084 & A & 0.1207513 & -1.533501 & -0.3451589\\
\hline
-0.2401977 & A & 0.1207513 & -1.533501 & 1.1725518\\
\hline
0.1968155 & B & 0.1207513 & 1.533501 & -1.4574367\\
\hline
2.6308008 & B & 0.1207513 & 1.533501 & 0.9765486\\
\hline
2.0293297 & B & 0.1207513 & 1.533501 & 0.3750775\\
\hline
2.1629037 & B & 0.1207513 & 1.533501 & 0.5086516\\
\hline
1.2514112 & B & 0.1207513 & 1.533501 & -0.4028410\\
\hline
\end{tabular}

Calculate sums of squares for \texttt{mu}, \texttt{a}, and \texttt{err}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{SS }\OtherTok{\textless{}{-}}\NormalTok{ decomp }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{summarise}\NormalTok{(}\AttributeTok{mu =} \FunctionTok{sum}\NormalTok{(mu}\SpecialCharTok{*}\NormalTok{mu),}
            \AttributeTok{a =} \FunctionTok{sum}\NormalTok{(a}\SpecialCharTok{*}\NormalTok{a),}
            \AttributeTok{err =} \FunctionTok{sum}\NormalTok{(err}\SpecialCharTok{*}\NormalTok{err))}
\end{Highlighting}
\end{Shaded}

\begin{tabular}{r|r|r}
\hline
mu & a & err\\
\hline
0.1458088 & 23.51625 & 8.104182\\
\hline
\end{tabular}

If you've done everything right, \texttt{SS\$mu\ +\ SS\$a\ +\ SS\$err} should equal the sum of squares for Y.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{SS\_Y }\OtherTok{\textless{}{-}} \FunctionTok{sum}\NormalTok{(decomp}\SpecialCharTok{$}\NormalTok{Y}\SpecialCharTok{\^{}}\DecValTok{2}\NormalTok{)}
\FunctionTok{all.equal}\NormalTok{(SS\_Y, SS}\SpecialCharTok{$}\NormalTok{mu }\SpecialCharTok{+}\NormalTok{ SS}\SpecialCharTok{$}\NormalTok{a }\SpecialCharTok{+}\NormalTok{ SS}\SpecialCharTok{$}\NormalTok{err)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] TRUE
\end{verbatim}

Divide each sum of squares by its corresponding degrees of freedom (df) to calculate mean squares. The df for \texttt{mu} is 1, the df for factor \texttt{a} is \texttt{K-1} (K is the number of groups), and the df for \texttt{err} is \texttt{N\ -\ K} (N is the number of observations).

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{K }\OtherTok{\textless{}{-}} \FunctionTok{n\_distinct}\NormalTok{(dat}\SpecialCharTok{$}\NormalTok{grp)}
\NormalTok{N }\OtherTok{\textless{}{-}} \FunctionTok{nrow}\NormalTok{(dat)}
\NormalTok{df }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\AttributeTok{mu =} \DecValTok{1}\NormalTok{, }\AttributeTok{a =}\NormalTok{ K }\SpecialCharTok{{-}} \DecValTok{1}\NormalTok{, }\AttributeTok{err =}\NormalTok{ N }\SpecialCharTok{{-}}\NormalTok{ K)}
\NormalTok{MS }\OtherTok{\textless{}{-}}\NormalTok{ SS }\SpecialCharTok{/}\NormalTok{ df}
\end{Highlighting}
\end{Shaded}

\begin{tabular}{r|r|r}
\hline
mu & a & err\\
\hline
0.1458088 & 23.51625 & 1.013023\\
\hline
\end{tabular}

Then calculate an F-ratio for \texttt{mu} and \texttt{a} by dividing their mean squares by the error term mean square. Get the p-values that correspond to these F-values using the \texttt{pf()} function.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{F\_mu }\OtherTok{\textless{}{-}}\NormalTok{ MS}\SpecialCharTok{$}\NormalTok{mu }\SpecialCharTok{/}\NormalTok{ MS}\SpecialCharTok{$}\NormalTok{err}
\NormalTok{F\_a  }\OtherTok{\textless{}{-}}\NormalTok{ MS}\SpecialCharTok{$}\NormalTok{a  }\SpecialCharTok{/}\NormalTok{ MS}\SpecialCharTok{$}\NormalTok{err}
\NormalTok{p\_mu }\OtherTok{\textless{}{-}} \FunctionTok{pf}\NormalTok{(F\_mu, }\AttributeTok{df1 =}\NormalTok{ df[}\StringTok{\textquotesingle{}mu\textquotesingle{}}\NormalTok{], }\AttributeTok{df2 =}\NormalTok{ df[}\StringTok{\textquotesingle{}err\textquotesingle{}}\NormalTok{], }\AttributeTok{lower.tail =} \ConstantTok{FALSE}\NormalTok{)}
\NormalTok{p\_a  }\OtherTok{\textless{}{-}} \FunctionTok{pf}\NormalTok{(F\_a,  }\AttributeTok{df1 =}\NormalTok{ df[}\StringTok{\textquotesingle{}a\textquotesingle{}}\NormalTok{],  }\AttributeTok{df2 =}\NormalTok{ df[}\StringTok{\textquotesingle{}err\textquotesingle{}}\NormalTok{], }\AttributeTok{lower.tail =} \ConstantTok{FALSE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Put everything into a data frame to display it in the same way as the ANOVA summary function.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my\_calcs }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}
  \AttributeTok{term =} \FunctionTok{c}\NormalTok{(}\StringTok{"Intercept"}\NormalTok{, }\StringTok{"grp"}\NormalTok{, }\StringTok{"Residuals"}\NormalTok{),}
  \AttributeTok{Df =}\NormalTok{ df,}
  \AttributeTok{SS =} \FunctionTok{c}\NormalTok{(SS}\SpecialCharTok{$}\NormalTok{mu, SS}\SpecialCharTok{$}\NormalTok{a, SS}\SpecialCharTok{$}\NormalTok{err),}
  \AttributeTok{MS =} \FunctionTok{c}\NormalTok{(MS}\SpecialCharTok{$}\NormalTok{mu, MS}\SpecialCharTok{$}\NormalTok{a, MS}\SpecialCharTok{$}\NormalTok{err),}
  \AttributeTok{F =} \FunctionTok{c}\NormalTok{(F\_mu, F\_a, }\ConstantTok{NA}\NormalTok{),}
  \AttributeTok{p =} \FunctionTok{c}\NormalTok{(p\_mu, p\_a, }\ConstantTok{NA}\NormalTok{)}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{tabular}{l|l|r|r|r|r|r}
\hline
  & term & Df & SS & MS & F & p\\
\hline
mu & Intercept & 1 & 0.146 & 0.146 & 0.144 & 0.714\\
\hline
a & grp & 1 & 23.516 & 23.516 & 23.214 & 0.001\\
\hline
err & Residuals & 8 & 8.104 & 1.013 & NA & NA\\
\hline
\end{tabular}

Now run a one-way ANOVA on your results and compare it to what you obtained in your calculations.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{aov}\NormalTok{(Y }\SpecialCharTok{\textasciitilde{}}\NormalTok{ grp, }\AttributeTok{data =}\NormalTok{ dat) }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{summary}\NormalTok{(}\AttributeTok{intercept =} \ConstantTok{TRUE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##             Df Sum Sq Mean Sq F value  Pr(>F)   
## (Intercept)  1  0.146   0.146   0.144 0.71427   
## grp          1 23.516  23.516  23.214 0.00132 **
## Residuals    8  8.104   1.013                   
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
\end{verbatim}

\begin{try}
Using the code above, write your own function that takes a table of data and returns the ANOVA results table like above.

\end{try}

\hypertarget{glossary-glm}{%
\section{Glossary}\label{glossary-glm}}

\begin{tabular}{l|l}
\hline
term & definition\\
\hline
categorical & Data that can only take certain values, such as types of pet.\\
\hline
coding-scheme & How to represent categorical variables with numbers for use in models\\
\hline
continuous & Data that can take on any values between other existing values.\\
\hline
dependent-variable & The target variable that is being analyzed, whose value is assumed to depend on other variables.\\
\hline
effect-code & A coding scheme for categorical variables that contrasts each group mean with the mean of all the group means.\\
\hline
error-term & The term in a model that represents the difference between the actual and predicted values\\
\hline
general-linear-model & A mathematical model comparing how one or more independent variables affect a continuous dependent variable\\
\hline
independent-variable & A variable whose value is assumed to influence the value of a dependent variable.\\
\hline
normal-distribution & A symmetric distribution of data where values near the centre are most probable.\\
\hline
residual-error & \\
\hline
simulation & Generating data from summary parameters\\
\hline
standard-deviation & A descriptive statistic that measures how spread out data are relative to the mean.\\
\hline
\end{tabular}

\hypertarget{resources-glm}{%
\section{Further Resources}\label{resources-glm}}

\begin{itemize}
\tightlist
\item
  \href{https://psyteachr.github.io/stat-models-v1/}{Statistical Models} by Dale Barr from the psyTeachR team
\item
  \href{http://rstudio2.psy.gla.ac.uk/Dale/GLM}{GLM shiny app}
\item
  \href{http://rstudio2.psy.gla.ac.uk/Dale/fdist}{F distribution}
\item
  \href{http://www.otago.ac.nz/psychology/otago039309.pdf}{Jeff Miller and Patricia Haden, Statistical Analysis with the Linear Model (free online textbook)}
\end{itemize}

\hypertarget{func}{%
\chapter{Iteration \& Functions}\label{func}}

\hypertarget{ilo-func}{%
\section{Learning Objectives}\label{ilo-func}}

You will learn about functions and iteration by using simulation to calculate a power analysis for an independent samples t-test.

\hypertarget{basic-5}{%
\subsection*{Basic}\label{basic-5}}
\addcontentsline{toc}{subsection}{Basic}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Work with basic \protect\hyperlink{iteration-functions}{iteration functions} \texttt{rep}, \texttt{seq}, \texttt{replicate} \href{https://youtu.be/X3zFA71JzgE}{(video)}
\item
  Use \protect\hyperlink{map-apply}{\texttt{map()} and \texttt{apply()} functions} \href{https://youtu.be/HcZxQZwJ8T4}{(video)}
\item
  Write your own \protect\hyperlink{custom-functions}{custom functions} with \texttt{function()} \href{https://youtu.be/Qqjva0xgYC4}{(video)}
\item
  Set \protect\hyperlink{defaults}{default values} for the arguments in your functions
\end{enumerate}

\hypertarget{intermediate-5}{%
\subsection*{Intermediate}\label{intermediate-5}}
\addcontentsline{toc}{subsection}{Intermediate}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{4}
\tightlist
\item
  Understand \protect\hyperlink{scope}{scope}
\item
  Use \protect\hyperlink{warnings-errors}{error handling and warnings} in a function
\end{enumerate}

\hypertarget{advanced}{%
\subsection*{Advanced}\label{advanced}}
\addcontentsline{toc}{subsection}{Advanced}

The topics below are not (yet) covered in these materials, but they are directions for independent learning.

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{6}
\tightlist
\item
  Repeat commands having multiple arguments using \texttt{purrr::map2\_*()} and \texttt{purrr::pmap\_*()}
\item
  Create \textbf{nested data frames} using \texttt{dplyr::group\_by()} and \texttt{tidyr::nest()}
\item
  Work with \textbf{nested data frames} in \texttt{dplyr}
\item
  Capture and deal with errors using `adverb' functions \texttt{purrr::safely()} and \texttt{purrr::possibly()}
\end{enumerate}

In the next two lectures, we are going to learn more about iteration (doing the same commands over and over) and custom functions through a data simulation exercise, which will also lead us into more traditional statistical topics.

\hypertarget{setup-func}{%
\section{Setup}\label{setup-func}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# libraries needed for these examples}
\FunctionTok{library}\NormalTok{(tidyverse)  }\DocumentationTok{\#\# contains purrr, tidyr, dplyr}
\FunctionTok{library}\NormalTok{(broom) }\DocumentationTok{\#\# converts test output to tidy tables}

\FunctionTok{set.seed}\NormalTok{(}\DecValTok{8675309}\NormalTok{) }\CommentTok{\# makes sure random numbers are reproducible}
\end{Highlighting}
\end{Shaded}

\hypertarget{iteration-functions}{%
\section{Iteration functions}\label{iteration-functions}}

We first learned about the two basic iteration functions, \texttt{rep()} and \texttt{seq()} in the \protect\hyperlink{rep_seq}{Working with Data} chapter.

\hypertarget{rep}{%
\subsection{rep()}\label{rep}}

The function \texttt{rep()} lets you repeat the first argument a number of times.

Use \texttt{rep()} to create a vector of alternating \texttt{"A"} and \texttt{"B"} values of length 24.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{rep}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{"A"}\NormalTok{, }\StringTok{"B"}\NormalTok{), }\DecValTok{12}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1] "A" "B" "A" "B" "A" "B" "A" "B" "A" "B" "A" "B" "A" "B" "A" "B" "A" "B" "A"
## [20] "B" "A" "B" "A" "B"
\end{verbatim}

If you don't specify what the second argument is, it defaults to \texttt{times}, repeating the vector in the first argument that many times. Make the same vector as above, setting the second argument explicitly.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{rep}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{"A"}\NormalTok{, }\StringTok{"B"}\NormalTok{), }\AttributeTok{times =} \DecValTok{12}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1] "A" "B" "A" "B" "A" "B" "A" "B" "A" "B" "A" "B" "A" "B" "A" "B" "A" "B" "A"
## [20] "B" "A" "B" "A" "B"
\end{verbatim}

If the second argument is a vector that is the same length as the first argument, each element in the first vector is repeated than many times. Use \texttt{rep()} to create a vector of 11 \texttt{"A"} values followed by 3 \texttt{"B"} values.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{rep}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{"A"}\NormalTok{, }\StringTok{"B"}\NormalTok{), }\FunctionTok{c}\NormalTok{(}\DecValTok{11}\NormalTok{, }\DecValTok{3}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1] "A" "A" "A" "A" "A" "A" "A" "A" "A" "A" "A" "B" "B" "B"
\end{verbatim}

You can repeat each element of the vector a sepcified number of times using the \texttt{each} argument, Use \texttt{rep()} to create a vector of 12 \texttt{"A"} values followed by 12 \texttt{"B"} values.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{rep}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{"A"}\NormalTok{, }\StringTok{"B"}\NormalTok{), }\AttributeTok{each =} \DecValTok{12}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1] "A" "A" "A" "A" "A" "A" "A" "A" "A" "A" "A" "A" "B" "B" "B" "B" "B" "B" "B"
## [20] "B" "B" "B" "B" "B"
\end{verbatim}

What do you think will happen if you set both \texttt{times} to 3 and \texttt{each} to 2?

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{rep}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{"A"}\NormalTok{, }\StringTok{"B"}\NormalTok{), }\AttributeTok{times =} \DecValTok{3}\NormalTok{, }\AttributeTok{each =} \DecValTok{2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1] "A" "A" "B" "B" "A" "A" "B" "B" "A" "A" "B" "B"
\end{verbatim}

\hypertarget{seq}{%
\subsection{seq()}\label{seq}}

The function \texttt{seq()} is useful for generating a sequence of numbers with some pattern.

Use \texttt{seq()} to create a vector of the integers 0 to 10.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{seq}\NormalTok{(}\DecValTok{0}\NormalTok{, }\DecValTok{10}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1]  0  1  2  3  4  5  6  7  8  9 10
\end{verbatim}

You can set the \texttt{by} argument to count by numbers other than 1 (the default). Use \texttt{seq()} to create a vector of the numbers 0 to 100 by 10s.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{seq}\NormalTok{(}\DecValTok{0}\NormalTok{, }\DecValTok{100}\NormalTok{, }\AttributeTok{by =} \DecValTok{10}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1]   0  10  20  30  40  50  60  70  80  90 100
\end{verbatim}

The argument \texttt{length.out} is useful if you know how many steps you want to divide something into. Use \texttt{seq()} to create a vector that starts with 0, ends with 100, and has 12 equally spaced steps (hint: how many numbers would be in a vector with 2 \emph{steps}?).

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{seq}\NormalTok{(}\DecValTok{0}\NormalTok{, }\DecValTok{100}\NormalTok{, }\AttributeTok{length.out =} \DecValTok{13}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1]   0.000000   8.333333  16.666667  25.000000  33.333333  41.666667
##  [7]  50.000000  58.333333  66.666667  75.000000  83.333333  91.666667
## [13] 100.000000
\end{verbatim}

\hypertarget{replicate}{%
\subsection{replicate()}\label{replicate}}

You can use the \texttt{replicate()} function to run a function \texttt{n} times.

For example, you can get 3 sets of 5 numbers from a random normal distribution by setting \texttt{n} to \texttt{3} and \texttt{expr} to \texttt{rnorm(5)}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{replicate}\NormalTok{(}\AttributeTok{n =} \DecValTok{3}\NormalTok{, }\AttributeTok{expr =} \FunctionTok{rnorm}\NormalTok{(}\DecValTok{5}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##            [,1]       [,2]       [,3]
## [1,] -0.9965824 0.98721974 -1.5495524
## [2,]  0.7218241 0.02745393  1.0226378
## [3,] -0.6172088 0.67287232  0.1500832
## [4,]  2.0293916 0.57206650 -0.6599640
## [5,]  1.0654161 0.90367770 -0.9945890
\end{verbatim}

By default, \texttt{replicate()} simplifies your result into a matrix that is easy to convert into a table if your function returns vectors that are the same length. If you'd rather have a list of vectors, set \texttt{simplify\ =\ FALSE}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{replicate}\NormalTok{(}\AttributeTok{n =} \DecValTok{3}\NormalTok{, }\AttributeTok{expr =} \FunctionTok{rnorm}\NormalTok{(}\DecValTok{5}\NormalTok{), }\AttributeTok{simplify =} \ConstantTok{FALSE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [[1]]
## [1]  1.9724587 -0.4418016 -0.9006372 -0.1505882 -0.8278942
## 
## [[2]]
## [1]  1.98582582  0.04400503 -0.40428231 -0.47299855 -0.41482324
## 
## [[3]]
## [1]  0.6832342  0.6902011  0.5334919 -0.1861048  0.3829458
\end{verbatim}

\hypertarget{map-apply}{%
\subsection{map() and apply() functions}\label{map-apply}}

\texttt{purrr::map()} and \texttt{lapply()} return a list of the same length as a vector or list, each element of which is the result of applying a function to the corresponding element. They function much the same, but purrr functions have some optimisations for working with the tidyverse. We'll be working mostly with purrr functions in this course, but apply functions are very common in code that you might see in examples on the web.

Imagine you want to calculate the power for a two-sample t-test with a mean difference of 0.2 and SD of 1, for all the sample sizes 100 to 1000 (by 100s). You could run the \texttt{power.t.test()} function 20 times and extract the values for ``power'' from the resulting list and put it in a table.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{p100 }\OtherTok{\textless{}{-}} \FunctionTok{power.t.test}\NormalTok{(}\AttributeTok{n =} \DecValTok{100}\NormalTok{, }\AttributeTok{delta =} \FloatTok{0.2}\NormalTok{, }\AttributeTok{sd =} \DecValTok{1}\NormalTok{, }\AttributeTok{type=}\StringTok{"two.sample"}\NormalTok{)}
\CommentTok{\# 18 more lines}
\NormalTok{p1000 }\OtherTok{\textless{}{-}} \FunctionTok{power.t.test}\NormalTok{(}\AttributeTok{n =} \DecValTok{500}\NormalTok{, }\AttributeTok{delta =} \FloatTok{0.2}\NormalTok{, }\AttributeTok{sd =} \DecValTok{1}\NormalTok{, }\AttributeTok{type=}\StringTok{"two.sample"}\NormalTok{)}

\FunctionTok{tibble}\NormalTok{(}
  \AttributeTok{n =} \FunctionTok{c}\NormalTok{(}\DecValTok{100}\NormalTok{, }\StringTok{"..."}\NormalTok{, }\DecValTok{1000}\NormalTok{),}
  \AttributeTok{power =} \FunctionTok{c}\NormalTok{(p100}\SpecialCharTok{$}\NormalTok{power, }\StringTok{"..."}\NormalTok{, p1000}\SpecialCharTok{$}\NormalTok{power)}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 3 x 2
##   n     power            
##   <chr> <chr>            
## 1 100   0.290266404572217
## 2 ...   ...              
## 3 1000  0.884788352886661
\end{verbatim}

However, the \texttt{apply()} and \texttt{map()} functions allow you to perform a function on each item in a vector or list. First make an object \texttt{n} that is the vector of the sample sizes you want to test, then use \texttt{lapply()} or \texttt{map()} to run the function \texttt{power.t.test()} on each item. You can set other arguments to \texttt{power.t.test()} after the function argument.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{n }\OtherTok{\textless{}{-}} \FunctionTok{seq}\NormalTok{(}\DecValTok{100}\NormalTok{, }\DecValTok{1000}\NormalTok{, }\DecValTok{100}\NormalTok{)}
\NormalTok{pcalc }\OtherTok{\textless{}{-}} \FunctionTok{lapply}\NormalTok{(n, power.t.test, }
                \AttributeTok{delta =} \FloatTok{0.2}\NormalTok{, }\AttributeTok{sd =} \DecValTok{1}\NormalTok{, }\AttributeTok{type=}\StringTok{"two.sample"}\NormalTok{)}
\CommentTok{\# or}
\NormalTok{pcalc }\OtherTok{\textless{}{-}}\NormalTok{ purrr}\SpecialCharTok{::}\FunctionTok{map}\NormalTok{(n, power.t.test, }
                \AttributeTok{delta =} \FloatTok{0.2}\NormalTok{, }\AttributeTok{sd =} \DecValTok{1}\NormalTok{, }\AttributeTok{type=}\StringTok{"two.sample"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

These functions return a list where each item is the result of \texttt{power.t.test()}, which returns a list of results that includes the named item ``power''. This is a special list that has a summary format if you just print it directly:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pcalc[[}\DecValTok{1}\NormalTok{]]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
##      Two-sample t test power calculation 
## 
##               n = 100
##           delta = 0.2
##              sd = 1
##       sig.level = 0.05
##           power = 0.2902664
##     alternative = two.sided
## 
## NOTE: n is number in *each* group
\end{verbatim}

But you can see the individual items using the \texttt{str()} function.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pcalc[[}\DecValTok{1}\NormalTok{]] }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{str}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## List of 8
##  $ n          : num 100
##  $ delta      : num 0.2
##  $ sd         : num 1
##  $ sig.level  : num 0.05
##  $ power      : num 0.29
##  $ alternative: chr "two.sided"
##  $ note       : chr "n is number in *each* group"
##  $ method     : chr "Two-sample t test power calculation"
##  - attr(*, "class")= chr "power.htest"
\end{verbatim}

\texttt{sapply()} is a version of \texttt{lapply()} that returns a vector or array instead of a list, where appropriate. The corresponding purrr functions are \texttt{map\_dbl()}, \texttt{map\_chr()}, \texttt{map\_int()} and \texttt{map\_lgl()}, which return vectors with the corresponding data type.

You can extract a value from a list with the function \texttt{{[}{[}}. You usually see this written as \texttt{pcalc{[}{[}1{]}{]}}, but if you put it inside backticks, you can use it in apply and map functions.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{sapply}\NormalTok{(pcalc, }\StringTok{\textasciigrave{}}\AttributeTok{[[}\StringTok{\textasciigrave{}}\NormalTok{, }\StringTok{"power"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1] 0.2902664 0.5140434 0.6863712 0.8064964 0.8847884 0.9333687 0.9623901
##  [8] 0.9792066 0.9887083 0.9939638
\end{verbatim}

We use \texttt{map\_dbl()} here because the value for ``power'' is a double.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{purrr}\SpecialCharTok{::}\FunctionTok{map\_dbl}\NormalTok{(pcalc, }\StringTok{\textasciigrave{}}\AttributeTok{[[}\StringTok{\textasciigrave{}}\NormalTok{, }\StringTok{"power"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1] 0.2902664 0.5140434 0.6863712 0.8064964 0.8847884 0.9333687 0.9623901
##  [8] 0.9792066 0.9887083 0.9939638
\end{verbatim}

We can use the \texttt{map()} functions inside a \texttt{mutate()} function to run the \texttt{power.t.test()} function on the value of \texttt{n} from each row of a table, then extract the value for ``power'', and delete the column with the power calculations.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mypower }\OtherTok{\textless{}{-}} \FunctionTok{tibble}\NormalTok{(}
  \AttributeTok{n =} \FunctionTok{seq}\NormalTok{(}\DecValTok{100}\NormalTok{, }\DecValTok{1000}\NormalTok{, }\DecValTok{100}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{pcalc =}\NormalTok{ purrr}\SpecialCharTok{::}\FunctionTok{map}\NormalTok{(n, power.t.test, }
                            \AttributeTok{delta =} \FloatTok{0.2}\NormalTok{, }
                            \AttributeTok{sd =} \DecValTok{1}\NormalTok{, }
                            \AttributeTok{type=}\StringTok{"two.sample"}\NormalTok{),}
         \AttributeTok{power =}\NormalTok{ purrr}\SpecialCharTok{::}\FunctionTok{map\_dbl}\NormalTok{(pcalc, }\StringTok{\textasciigrave{}}\AttributeTok{[[}\StringTok{\textasciigrave{}}\NormalTok{, }\StringTok{"power"}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{select}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{pcalc)}
\end{Highlighting}
\end{Shaded}

\begin{figure}

{\centering \includegraphics[width=1\linewidth]{09-func_files/figure-latex/purrr-plot-1} 

}

\caption{Power for a two-sample t-test with d = 0.2}\label{fig:purrr-plot}
\end{figure}

\hypertarget{custom-functions}{%
\section{Custom functions}\label{custom-functions}}

In addition to the built-in functions and functions you can access from packages, you can also write your own functions (and eventually even packages!).

\hypertarget{structure-function}{%
\subsection{Structuring a function}\label{structure-function}}

The general structure of a function is as follows:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{function\_name }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(my\_args) \{}
  \CommentTok{\# process the arguments}
  \CommentTok{\# return some value}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

Here is a very simple function. Can you guess what it does?

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{add1 }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(my\_number) \{}
\NormalTok{  my\_number }\SpecialCharTok{+} \DecValTok{1}
\NormalTok{\}}

\FunctionTok{add1}\NormalTok{(}\DecValTok{10}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 11
\end{verbatim}

Let's make a function that reports p-values in APA format (with ``p = {[}rounded value{]}'' when p \textgreater= .001 and ``p \textless{} .001'' when p \textless{} .001).

First, we have to name the function. You can name it anything, but try not to duplicate existing functions or you will overwrite them. For example, if you call your function \texttt{rep}, then you will need to use \texttt{base::rep()} to access the normal \texttt{rep} function. Let's call our p-value function \texttt{report\_p} and set up the framework of the function.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{report\_p }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{() \{}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\hypertarget{arguments}{%
\subsection{Arguments}\label{arguments}}

We need to add one argument, the p-value you want to report. The names you choose for the arguments are private to that argument, so it is not a problem if they conflict with other variables in your script. You put the arguments in the parentheses of \texttt{function()} in the order you want them to default (just like the built-in functions you've used before).

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{report\_p }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(p) \{}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\hypertarget{defaults}{%
\subsection{Argument defaults}\label{defaults}}

You can add a default value to any argument. If that argument is skipped, then the function uses the default argument. It probably doesn't make sense to run this function without specifying the p-value, but we can add a second argument called \texttt{digits} that defaults to 3, so we can round p-values to any number of digits.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{report\_p }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(p, }\AttributeTok{digits =} \DecValTok{3}\NormalTok{) \{}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

Now we need to write some code inside the function to process the input arguments and turn them into a \textbf{return}ed output. Put the output as the last item in function.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{report\_p }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(p, }\AttributeTok{digits =} \DecValTok{3}\NormalTok{) \{}
  \ControlFlowTok{if}\NormalTok{ (p }\SpecialCharTok{\textless{}}\NormalTok{ .}\DecValTok{001}\NormalTok{) \{}
\NormalTok{    reported }\OtherTok{=} \StringTok{"p \textless{} .001"}
\NormalTok{  \} }\ControlFlowTok{else}\NormalTok{ \{}
\NormalTok{    roundp }\OtherTok{\textless{}{-}} \FunctionTok{round}\NormalTok{(p, digits)}
\NormalTok{    reported }\OtherTok{=} \FunctionTok{paste}\NormalTok{(}\StringTok{"p ="}\NormalTok{, roundp)}
\NormalTok{  \}}
  
\NormalTok{  reported}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

You might also see the returned output inside of the \texttt{return()} function. This does the same thing.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{report\_p }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(p, }\AttributeTok{digits =} \DecValTok{3}\NormalTok{) \{}
  \ControlFlowTok{if}\NormalTok{ (p }\SpecialCharTok{\textless{}}\NormalTok{ .}\DecValTok{001}\NormalTok{) \{}
\NormalTok{    reported }\OtherTok{=} \StringTok{"p \textless{} .001"}
\NormalTok{  \} }\ControlFlowTok{else}\NormalTok{ \{}
\NormalTok{    roundp }\OtherTok{\textless{}{-}} \FunctionTok{round}\NormalTok{(p, digits)}
\NormalTok{    reported }\OtherTok{=} \FunctionTok{paste}\NormalTok{(}\StringTok{"p ="}\NormalTok{, roundp)}
\NormalTok{  \}}
  
  \FunctionTok{return}\NormalTok{(reported)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

When you run the code defining your function, it doesn't output anything, but makes a new object in the Environment tab under \textbf{\texttt{Functions}}. Now you can run the function.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{report\_p}\NormalTok{(}\FloatTok{0.04869}\NormalTok{)}
\FunctionTok{report\_p}\NormalTok{(}\FloatTok{0.0000023}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "p = 0.049"
## [1] "p < .001"
\end{verbatim}

\hypertarget{scope}{%
\subsection{Scope}\label{scope}}

What happens in a function stays in a function. You can change the value of a variable passed to a function, but that won't change the value of the variable outside of the function, even if that variable has the same name as the one in the function.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{reported }\OtherTok{\textless{}{-}} \StringTok{"not changed"}

\CommentTok{\# inside this function, reported == "p = 0.002"}
\FunctionTok{report\_p}\NormalTok{(}\FloatTok{0.0023}\NormalTok{) }

\NormalTok{reported }\CommentTok{\# still "not changed"}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "p = 0.002"
## [1] "not changed"
\end{verbatim}

\hypertarget{warnings-errors}{%
\subsection{Warnings and errors}\label{warnings-errors}}

\begin{try}

What happens when you omit the argument for \texttt{p}? Or if you set \texttt{p} to 1.5 or ``a''?

\end{try}

You might want to add a more specific warning and stop running the function code if someone enters a value that isn't a number. You can do this with the \texttt{stop()} function.

If someone enters a number that isn't possible for a p-value (0-1), you might want to warn them that this is probably not what they intended, but still continue with the function. You can do this with \texttt{warning()}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{report\_p }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(p, }\AttributeTok{digits =} \DecValTok{3}\NormalTok{) \{}
  \ControlFlowTok{if}\NormalTok{ (}\SpecialCharTok{!}\FunctionTok{is.numeric}\NormalTok{(p)) }\FunctionTok{stop}\NormalTok{(}\StringTok{"p must be a number"}\NormalTok{)}
  \ControlFlowTok{if}\NormalTok{ (p }\SpecialCharTok{\textless{}=} \DecValTok{0}\NormalTok{) }\FunctionTok{warning}\NormalTok{(}\StringTok{"p{-}values are normally greater than 0"}\NormalTok{)}
  \ControlFlowTok{if}\NormalTok{ (p }\SpecialCharTok{\textgreater{}=} \DecValTok{1}\NormalTok{) }\FunctionTok{warning}\NormalTok{(}\StringTok{"p{-}values are normally less than 1"}\NormalTok{)}
  
  \ControlFlowTok{if}\NormalTok{ (p }\SpecialCharTok{\textless{}}\NormalTok{ .}\DecValTok{001}\NormalTok{) \{}
\NormalTok{    reported }\OtherTok{=} \StringTok{"p \textless{} .001"}
\NormalTok{  \} }\ControlFlowTok{else}\NormalTok{ \{}
\NormalTok{    roundp }\OtherTok{\textless{}{-}} \FunctionTok{round}\NormalTok{(p, digits)}
\NormalTok{    reported }\OtherTok{=} \FunctionTok{paste}\NormalTok{(}\StringTok{"p ="}\NormalTok{, roundp)}
\NormalTok{  \}}
  
\NormalTok{  reported}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{report\_p}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Error in report_p(): argument "p" is missing, with no default
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{report\_p}\NormalTok{(}\StringTok{"a"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Error in report_p("a"): p must be a number
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{report\_p}\NormalTok{(}\SpecialCharTok{{-}}\DecValTok{2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning in report_p(-2): p-values are normally greater than 0
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{report\_p}\NormalTok{(}\DecValTok{2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning in report_p(2): p-values are normally less than 1
\end{verbatim}

\begin{verbatim}
## [1] "p < .001"
## [1] "p = 2"
\end{verbatim}

\hypertarget{iterating-your-own-functions}{%
\section{Iterating your own functions}\label{iterating-your-own-functions}}

First, let's build up the code that we want to iterate.

\hypertarget{rnorm}{%
\subsection{rnorm()}\label{rnorm}}

Create a vector of 20 random numbers drawn from a normal distribution with a mean of 5 and standard deviation of 1 using the \texttt{rnorm()} function and store them in the variable \texttt{A}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{A }\OtherTok{\textless{}{-}} \FunctionTok{rnorm}\NormalTok{(}\DecValTok{20}\NormalTok{, }\AttributeTok{mean =} \DecValTok{5}\NormalTok{, }\AttributeTok{sd =} \DecValTok{1}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{tibbletibble}{%
\subsection{tibble::tibble()}\label{tibbletibble}}

A \texttt{tibble} is a type of table or \texttt{data.frame}. The function \texttt{tibble::tibble()} creates a tibble with a column for each argument. Each argument takes the form \texttt{column\_name\ =\ data\_vector}.

Create a table called \texttt{dat} including two vectors: \texttt{A} that is a vector of 20 random normally distributed numbers with a mean of 5 and SD of 1, and \texttt{B} that is a vector of 20 random normally distributed numbers with a mean of 5.5 and SD of 1.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dat }\OtherTok{\textless{}{-}} \FunctionTok{tibble}\NormalTok{(}
  \AttributeTok{A =} \FunctionTok{rnorm}\NormalTok{(}\DecValTok{20}\NormalTok{, }\DecValTok{5}\NormalTok{, }\DecValTok{1}\NormalTok{),}
  \AttributeTok{B =} \FunctionTok{rnorm}\NormalTok{(}\DecValTok{20}\NormalTok{, }\FloatTok{5.5}\NormalTok{, }\DecValTok{1}\NormalTok{)}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{t.test}{%
\subsection{t.test()}\label{t.test}}

You can run a Welch two-sample t-test by including the two samples you made as the first two arguments to the function \texttt{t.test}. You can reference one column of a table by its names using the format \texttt{table\_name\$column\_name}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{t.test}\NormalTok{(dat}\SpecialCharTok{$}\NormalTok{A, dat}\SpecialCharTok{$}\NormalTok{B)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
##  Welch Two Sample t-test
## 
## data:  dat$A and dat$B
## t = -1.7716, df = 36.244, p-value = 0.08487
## alternative hypothesis: true difference in means is not equal to 0
## 95 percent confidence interval:
##  -1.2445818  0.0838683
## sample estimates:
## mean of x mean of y 
##  4.886096  5.466453
\end{verbatim}

You can also convert the table to long format using the \texttt{gather} function and specify the t-test using the format \texttt{dv\_column\textasciitilde{}grouping\_column}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{longdat }\OtherTok{\textless{}{-}} \FunctionTok{gather}\NormalTok{(dat, group, score, A}\SpecialCharTok{:}\NormalTok{B)}

\FunctionTok{t.test}\NormalTok{(score}\SpecialCharTok{\textasciitilde{}}\NormalTok{group, }\AttributeTok{data =}\NormalTok{ longdat) }
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
##  Welch Two Sample t-test
## 
## data:  score by group
## t = -1.7716, df = 36.244, p-value = 0.08487
## alternative hypothesis: true difference in means between group A and group B is not equal to 0
## 95 percent confidence interval:
##  -1.2445818  0.0838683
## sample estimates:
## mean in group A mean in group B 
##        4.886096        5.466453
\end{verbatim}

\hypertarget{broomtidy}{%
\subsection{broom::tidy()}\label{broomtidy}}

You can use the function \texttt{broom::tidy()} to extract the data from a statistical test in a table format. The example below pipes everything together.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{tibble}\NormalTok{(}
  \AttributeTok{A =} \FunctionTok{rnorm}\NormalTok{(}\DecValTok{20}\NormalTok{, }\DecValTok{5}\NormalTok{, }\DecValTok{1}\NormalTok{),}
  \AttributeTok{B =} \FunctionTok{rnorm}\NormalTok{(}\DecValTok{20}\NormalTok{, }\FloatTok{5.5}\NormalTok{, }\DecValTok{1}\NormalTok{)}
\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{gather}\NormalTok{(group, score, A}\SpecialCharTok{:}\NormalTok{B) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{t.test}\NormalTok{(score}\SpecialCharTok{\textasciitilde{}}\NormalTok{group, }\AttributeTok{data =}\NormalTok{ .) }\SpecialCharTok{\%\textgreater{}\%}
\NormalTok{  broom}\SpecialCharTok{::}\FunctionTok{tidy}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 1 x 10
##   estimate estimate1 estimate2 statistic p.value parameter conf.low conf.high
##      <dbl>     <dbl>     <dbl>     <dbl>   <dbl>     <dbl>    <dbl>     <dbl>
## 1   -0.642      5.04      5.69     -2.31  0.0265      37.3    -1.21   -0.0792
## # ... with 2 more variables: method <chr>, alternative <chr>
\end{verbatim}

\begin{info}
In the pipeline above, \texttt{t.test(score\textasciitilde{}group,\ data\ =\ .)} uses the \texttt{.} notation to change the location of the piped-in data table from it's default position as the first argument to a different position.

\end{info}

Finally, we can extract a single value from this results table using \texttt{pull()}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{tibble}\NormalTok{(}
  \AttributeTok{A =} \FunctionTok{rnorm}\NormalTok{(}\DecValTok{20}\NormalTok{, }\DecValTok{5}\NormalTok{, }\DecValTok{1}\NormalTok{),}
  \AttributeTok{B =} \FunctionTok{rnorm}\NormalTok{(}\DecValTok{20}\NormalTok{, }\FloatTok{5.5}\NormalTok{, }\DecValTok{1}\NormalTok{)}
\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{gather}\NormalTok{(group, score, A}\SpecialCharTok{:}\NormalTok{B) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{t.test}\NormalTok{(score}\SpecialCharTok{\textasciitilde{}}\NormalTok{group, }\AttributeTok{data =}\NormalTok{ .) }\SpecialCharTok{\%\textgreater{}\%}
\NormalTok{  broom}\SpecialCharTok{::}\FunctionTok{tidy}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{pull}\NormalTok{(p.value)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.7075268
\end{verbatim}

\hypertarget{custom-function-t_sim}{%
\subsection{Custom function: t\_sim()}\label{custom-function-t_sim}}

First, name your function \texttt{t\_sim} and wrap the code above in a function with no arguments.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{t\_sim }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{() \{}
  \FunctionTok{tibble}\NormalTok{(}
    \AttributeTok{A =} \FunctionTok{rnorm}\NormalTok{(}\DecValTok{20}\NormalTok{, }\DecValTok{5}\NormalTok{, }\DecValTok{1}\NormalTok{),}
    \AttributeTok{B =} \FunctionTok{rnorm}\NormalTok{(}\DecValTok{20}\NormalTok{, }\FloatTok{5.5}\NormalTok{, }\DecValTok{1}\NormalTok{)}
\NormalTok{  ) }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{gather}\NormalTok{(group, score, A}\SpecialCharTok{:}\NormalTok{B) }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{t.test}\NormalTok{(score}\SpecialCharTok{\textasciitilde{}}\NormalTok{group, }\AttributeTok{data =}\NormalTok{ .) }\SpecialCharTok{\%\textgreater{}\%}
\NormalTok{    broom}\SpecialCharTok{::}\FunctionTok{tidy}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{pull}\NormalTok{(p.value) }
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

Run it a few times to see what happens.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{t\_sim}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.00997552
\end{verbatim}

\hypertarget{iterate-t_sim}{%
\subsection{Iterate t\_sim()}\label{iterate-t_sim}}

Let's run the \texttt{t\_sim} function 1000 times, assign the resulting p-values to a vector called \texttt{reps}, and check what proportion of p-values are lower than alpha (e.g., .05). This number is the power for this analysis.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{reps }\OtherTok{\textless{}{-}} \FunctionTok{replicate}\NormalTok{(}\DecValTok{1000}\NormalTok{, }\FunctionTok{t\_sim}\NormalTok{())}
\NormalTok{alpha }\OtherTok{\textless{}{-}}\NormalTok{ .}\DecValTok{05}
\NormalTok{power }\OtherTok{\textless{}{-}} \FunctionTok{mean}\NormalTok{(reps }\SpecialCharTok{\textless{}}\NormalTok{ alpha)}
\NormalTok{power}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.328
\end{verbatim}

\hypertarget{seed}{%
\subsection{Set seed}\label{seed}}

You can use the \texttt{set.seed} function before you run a function that uses random numbers to make sure that you get the same random data back each time. You can use any integer you like as the seed.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{set.seed}\NormalTok{(}\DecValTok{90201}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{warning}
Make sure you don't ever use \texttt{set.seed()} \textbf{inside} of a simulation function, or you will just simulate the exact same data over and over again.

\end{warning}

\begin{figure}

{\centering \includegraphics[width=1\linewidth]{images/memes/seed_alignment} 

}

\caption{&commat;KellyBodwin}\label{fig:img-seed-alignment}
\end{figure}

\hypertarget{add-arguments}{%
\subsection{Add arguments}\label{add-arguments}}

You can just edit your function each time you want to cacluate power for a different sample n, but it is more efficent to build this into your fuction as an arguments. Redefine \texttt{t\_sim}, setting arguments for the mean and SD of group A, the mean and SD of group B, and the number of subjects per group. Give them all default values.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{t\_sim }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(}\AttributeTok{n =} \DecValTok{10}\NormalTok{, }\AttributeTok{m1=}\DecValTok{0}\NormalTok{, }\AttributeTok{sd1=}\DecValTok{1}\NormalTok{, }\AttributeTok{m2=}\DecValTok{0}\NormalTok{, }\AttributeTok{sd2=}\DecValTok{1}\NormalTok{) \{}
  \FunctionTok{tibble}\NormalTok{(}
    \AttributeTok{A =} \FunctionTok{rnorm}\NormalTok{(n, m1, sd1),}
    \AttributeTok{B =} \FunctionTok{rnorm}\NormalTok{(n, m2, sd2)}
\NormalTok{  ) }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{gather}\NormalTok{(group, score, A}\SpecialCharTok{:}\NormalTok{B) }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{t.test}\NormalTok{(score}\SpecialCharTok{\textasciitilde{}}\NormalTok{group, }\AttributeTok{data =}\NormalTok{ .) }\SpecialCharTok{\%\textgreater{}\%}
\NormalTok{    broom}\SpecialCharTok{::}\FunctionTok{tidy}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{pull}\NormalTok{(p.value) }
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

Test your function with some different values to see if the results make sense.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{t\_sim}\NormalTok{(}\DecValTok{100}\NormalTok{)}
\FunctionTok{t\_sim}\NormalTok{(}\DecValTok{100}\NormalTok{, }\DecValTok{0}\NormalTok{, }\DecValTok{1}\NormalTok{, }\FloatTok{0.5}\NormalTok{, }\DecValTok{1}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.5065619
## [1] 0.001844064
\end{verbatim}

Use \texttt{replicate} to calculate power for 100 subjects/group with an effect size of 0.2 (e.g., A: m = 0, SD = 1; B: m = 0.2, SD = 1). Use 1000 replications.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{reps }\OtherTok{\textless{}{-}} \FunctionTok{replicate}\NormalTok{(}\DecValTok{1000}\NormalTok{, }\FunctionTok{t\_sim}\NormalTok{(}\DecValTok{100}\NormalTok{, }\DecValTok{0}\NormalTok{, }\DecValTok{1}\NormalTok{, }\FloatTok{0.2}\NormalTok{, }\DecValTok{1}\NormalTok{))}
\NormalTok{power }\OtherTok{\textless{}{-}} \FunctionTok{mean}\NormalTok{(reps }\SpecialCharTok{\textless{}}\NormalTok{ .}\DecValTok{05}\NormalTok{)}
\NormalTok{power}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.268
\end{verbatim}

Compare this to power calculated from the \texttt{power.t.test} function.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{power.t.test}\NormalTok{(}\AttributeTok{n =} \DecValTok{100}\NormalTok{, }\AttributeTok{delta =} \FloatTok{0.2}\NormalTok{, }\AttributeTok{sd =} \DecValTok{1}\NormalTok{, }\AttributeTok{type=}\StringTok{"two.sample"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
##      Two-sample t test power calculation 
## 
##               n = 100
##           delta = 0.2
##              sd = 1
##       sig.level = 0.05
##           power = 0.2902664
##     alternative = two.sided
## 
## NOTE: n is number in *each* group
\end{verbatim}

Calculate power via simulation and \texttt{power.t.test} for the following tests:

\begin{itemize}
\tightlist
\item
  20 subjects/group, A: m = 0, SD = 1; B: m = 0.2, SD = 1
\item
  40 subjects/group, A: m = 0, SD = 1; B: m = 0.2, SD = 1
\item
  20 subjects/group, A: m = 10, SD = 1; B: m = 12, SD = 1.5
\end{itemize}

\hypertarget{glossary-func}{%
\section{Glossary}\label{glossary-func}}

\begin{tabular}{l|l}
\hline
term & definition\\
\hline
argument & A variable that provides input to a function.\\
\hline
data-type & The kind of data represented by an object.\\
\hline
double & A data type representing a real decimal number\\
\hline
function & A named section of code that can be reused.\\
\hline
iteration & Repeating a process or function\\
\hline
matrix & A container data type consisting of numbers arranged into a fixed number of rows and columns\\
\hline
\end{tabular}

\hypertarget{resources-func}{%
\section{Further Resources}\label{resources-func}}

\begin{itemize}
\tightlist
\item
  Chapters 19 and 21 of \href{http://r4ds.had.co.nz}{R for Data Science}
\item
  \href{https://github.com/rstudio/cheatsheets/raw/master/purrr.pdf}{RStudio Apply Functions Cheatsheet}
\end{itemize}

\hypertarget{sim}{%
\chapter{Probability \& Simulation}\label{sim}}

\hypertarget{ilo-sim}{%
\section{Learning Objectives}\label{ilo-sim}}

\hypertarget{basic-6}{%
\subsection*{Basic}\label{basic-6}}
\addcontentsline{toc}{subsection}{Basic}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Generate and plot data randomly sampled from common distributions \href{https://youtu.be/iuecrT3q1kg}{(video)}

  \begin{itemize}
  \tightlist
  \item
    \protect\hyperlink{uniform}{uniform}
  \item
    \protect\hyperlink{binomial}{binomial}
  \item
    \protect\hyperlink{normal}{normal}
  \item
    \protect\hyperlink{poisson}{poisson}
  \end{itemize}
\item
  Generate related variables from a \protect\hyperlink{mvdist}{multivariate} distribution \href{https://youtu.be/B14HfWQ1kIc}{(video)}
\item
  Define the following \protect\hyperlink{stat-terms}{statistical terms}:

  \begin{itemize}
  \tightlist
  \item
    \protect\hyperlink{p-value}{p-value}
  \item
    \protect\hyperlink{alpha}{alpha}
  \item
    \protect\hyperlink{power}{power}
  \item
    smallest effect size of interest (\protect\hyperlink{sesoi}{SESOI})
  \item
    \protect\hyperlink{false-pos}{false positive} (type I error)
  \item
    \protect\hyperlink{false-neg}{false negative} (type II error)
  \item
    confidence interval (\protect\hyperlink{conf-inf}{CI})
  \end{itemize}
\item
  Test sampled distributions against a null hypothesis \href{https://youtu.be/Am3G6rA2S1s}{(video)}

  \begin{itemize}
  \tightlist
  \item
    \protect\hyperlink{exact-binom}{exact binomial test}
  \item
    \protect\hyperlink{t-test}{t-test} (1-sample, independent samples, paired samples)
  \item
    \protect\hyperlink{correlation}{correlation} (pearson, kendall and spearman)
  \end{itemize}
\item
  \protect\hyperlink{calc-power-binom}{Calculate power} using iteration and a sampling function
\end{enumerate}

\hypertarget{intermediate-6}{%
\subsection*{Intermediate}\label{intermediate-6}}
\addcontentsline{toc}{subsection}{Intermediate}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{4}
\tightlist
\item
  Calculate the minimum sample size for a specific power level and design
\item
  Calculate power over a range of study parameters
\end{enumerate}

\hypertarget{setup8}{%
\section{Setup}\label{setup8}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# libraries needed for these examples}
\FunctionTok{library}\NormalTok{(tidyverse)}
\FunctionTok{library}\NormalTok{(plotly)}
\FunctionTok{library}\NormalTok{(faux)}

\FunctionTok{set.seed}\NormalTok{(}\DecValTok{8675309}\NormalTok{) }\CommentTok{\# makes sure random numbers are reproducible}
\end{Highlighting}
\end{Shaded}

Simulating data is a very powerful way to test your understanding of statistical concepts. We are going to use simulations to learn the basics of probability.

\hypertarget{univariate-distributions}{%
\section{Univariate Distributions}\label{univariate-distributions}}

First, we need to understand some different ways data might be distributed and how to simulate data from these distributions. A univariate distribution is the distribution of a single variable.

\hypertarget{uniform}{%
\subsection{Uniform Distribution}\label{uniform}}

The uniform distribution is the simplest distribution. All numbers in the range have an equal probability of being sampled.

\begin{try}
Take a minute to think of things in your own research that are uniformly distributed.

\end{try}

\hypertarget{continuous-distribution}{%
\subsubsection{Continuous distribution}\label{continuous-distribution}}

\texttt{runif(n,\ min=0,\ max=1)}

Use \texttt{runif()} to sample from a continuous uniform distribution.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{u }\OtherTok{\textless{}{-}} \FunctionTok{runif}\NormalTok{(}\DecValTok{100000}\NormalTok{, }\AttributeTok{min =} \DecValTok{0}\NormalTok{, }\AttributeTok{max =} \DecValTok{1}\NormalTok{)}

\CommentTok{\# plot to visualise}
\FunctionTok{ggplot}\NormalTok{() }\SpecialCharTok{+} 
  \FunctionTok{geom\_histogram}\NormalTok{(}\FunctionTok{aes}\NormalTok{(u), }\AttributeTok{binwidth =} \FloatTok{0.05}\NormalTok{, }\AttributeTok{boundary =} \DecValTok{0}\NormalTok{,}
                 \AttributeTok{fill =} \StringTok{"white"}\NormalTok{, }\AttributeTok{colour =} \StringTok{"black"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics[width=1\linewidth]{10-sim_files/figure-latex/runif-1} \end{center}

\hypertarget{discrete}{%
\subsubsection{Discrete}\label{discrete}}

\texttt{sample(x,\ size,\ replace\ =\ FALSE,\ prob\ =\ NULL)}

Use \texttt{sample()} to sample from a discrete distribution.

You can use \texttt{sample()} to simulate events like rolling dice or choosing from a deck of cards. The code below simulates rolling a 6-sided die 10000 times. We set \texttt{replace} to \texttt{TRUE} so that each event is independent. See what happens if you set \texttt{replace} to \texttt{FALSE}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{rolls }\OtherTok{\textless{}{-}} \FunctionTok{sample}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\DecValTok{6}\NormalTok{, }\DecValTok{10000}\NormalTok{, }\AttributeTok{replace =} \ConstantTok{TRUE}\NormalTok{)}

\CommentTok{\# plot the results}
\FunctionTok{ggplot}\NormalTok{() }\SpecialCharTok{+} 
  \FunctionTok{geom\_histogram}\NormalTok{(}\FunctionTok{aes}\NormalTok{(rolls), }\AttributeTok{binwidth =} \DecValTok{1}\NormalTok{, }
                 \AttributeTok{fill =} \StringTok{"white"}\NormalTok{, }\AttributeTok{color =} \StringTok{"black"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{figure}

{\centering \includegraphics[width=1\linewidth]{10-sim_files/figure-latex/sample-replace-1} 

}

\caption{Distribution of dice rolls.}\label{fig:sample-replace}
\end{figure}

You can also use sample to sample from a list of named outcomes.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pet\_types }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"cat"}\NormalTok{, }\StringTok{"dog"}\NormalTok{, }\StringTok{"ferret"}\NormalTok{, }\StringTok{"bird"}\NormalTok{, }\StringTok{"fish"}\NormalTok{)}
\FunctionTok{sample}\NormalTok{(pet\_types, }\DecValTok{10}\NormalTok{, }\AttributeTok{replace =} \ConstantTok{TRUE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1] "cat"    "cat"    "cat"    "cat"    "ferret" "dog"    "bird"   "cat"   
##  [9] "dog"    "fish"
\end{verbatim}

Ferrets are a much less common pet than cats and dogs, so our sample isn't very realistic. You can set the probabilities of each item in the list with the \texttt{prob} argument.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pet\_types }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"cat"}\NormalTok{, }\StringTok{"dog"}\NormalTok{, }\StringTok{"ferret"}\NormalTok{, }\StringTok{"bird"}\NormalTok{, }\StringTok{"fish"}\NormalTok{)}
\NormalTok{pet\_prob }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\FloatTok{0.3}\NormalTok{, }\FloatTok{0.4}\NormalTok{, }\FloatTok{0.1}\NormalTok{, }\FloatTok{0.1}\NormalTok{, }\FloatTok{0.1}\NormalTok{)}
\FunctionTok{sample}\NormalTok{(pet\_types, }\DecValTok{10}\NormalTok{, }\AttributeTok{replace =} \ConstantTok{TRUE}\NormalTok{, }\AttributeTok{prob =}\NormalTok{ pet\_prob)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1] "fish" "dog"  "cat"  "dog"  "cat"  "dog"  "fish" "dog"  "cat"  "fish"
\end{verbatim}

\hypertarget{binomial}{%
\subsection{Binomial Distribution}\label{binomial}}

The binomial distribution is useful for modelling binary data, where each observation can have one of two outcomes, like success/failure, yes/no or head/tails.

\texttt{rbinom(n,\ size,\ prob)}

The \texttt{rbinom} function will generate a random binomial distribution.

\begin{itemize}
\tightlist
\item
  \texttt{n} = number of observations
\item
  \texttt{size} = number of trials
\item
  \texttt{prob} = probability of success on each trial
\end{itemize}

Coin flips are a typical example of a binomial distribution, where we can assign heads to 1 and tails to 0.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# 20 individual coin flips of a fair coin}
\FunctionTok{rbinom}\NormalTok{(}\DecValTok{20}\NormalTok{, }\DecValTok{1}\NormalTok{, }\FloatTok{0.5}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1] 1 1 1 0 1 1 0 1 0 0 1 1 1 0 0 0 1 0 0 0
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# 20 individual coin flips of a baised (0.75) coin}
\FunctionTok{rbinom}\NormalTok{(}\DecValTok{20}\NormalTok{, }\DecValTok{1}\NormalTok{, }\FloatTok{0.75}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1] 1 1 1 0 1 0 1 1 1 0 1 1 1 0 0 1 1 1 1 1
\end{verbatim}

You can generate the total number of heads in 1 set of 20 coin flips by setting \texttt{size} to 20 and \texttt{n} to 1.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{rbinom}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{20}\NormalTok{, }\FloatTok{0.75}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 13
\end{verbatim}

You can generate more sets of 20 coin flips by increasing the \texttt{n}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{rbinom}\NormalTok{(}\DecValTok{10}\NormalTok{, }\DecValTok{20}\NormalTok{, }\FloatTok{0.5}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1] 10 14 11  7 11 13  6 10  9  9
\end{verbatim}

You should always check your randomly generated data to check that it makes sense. For large samples, it's easiest to do that graphically. A histogram is usually the best choice for plotting binomial data.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{flips }\OtherTok{\textless{}{-}} \FunctionTok{rbinom}\NormalTok{(}\DecValTok{1000}\NormalTok{, }\DecValTok{20}\NormalTok{, }\FloatTok{0.5}\NormalTok{)}

\FunctionTok{ggplot}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{geom\_histogram}\NormalTok{(}
    \FunctionTok{aes}\NormalTok{(flips), }
    \AttributeTok{binwidth =} \DecValTok{1}\NormalTok{, }
    \AttributeTok{fill =} \StringTok{"white"}\NormalTok{, }
    \AttributeTok{color =} \StringTok{"black"}
\NormalTok{  )}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics[width=1\linewidth]{10-sim_files/figure-latex/sim_flips-1} \end{center}

\begin{try}
Run the simulation above several times, noting how the histogram changes. Try changing the values of \texttt{n}, \texttt{size}, and \texttt{prob}.

\end{try}

\hypertarget{normal}{%
\subsection{Normal Distribution}\label{normal}}

\texttt{rnorm(n,\ mean,\ sd)}

We can simulate a normal distribution of size \texttt{n} if we know the \texttt{mean} and standard deviation (\texttt{sd}). A density plot is usually the best way to visualise this type of data if your \texttt{n} is large.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dv }\OtherTok{\textless{}{-}} \FunctionTok{rnorm}\NormalTok{(}\FloatTok{1e5}\NormalTok{, }\DecValTok{10}\NormalTok{, }\DecValTok{2}\NormalTok{)}

\CommentTok{\# proportions of normally{-}distributed data }
\CommentTok{\# within 1, 2, or 3 SD of the mean}
\NormalTok{sd1 }\OtherTok{\textless{}{-}}\NormalTok{ .}\DecValTok{6827} 
\NormalTok{sd2 }\OtherTok{\textless{}{-}}\NormalTok{ .}\DecValTok{9545}
\NormalTok{sd3 }\OtherTok{\textless{}{-}}\NormalTok{ .}\DecValTok{9973}

\FunctionTok{ggplot}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{geom\_density}\NormalTok{(}\FunctionTok{aes}\NormalTok{(dv), }\AttributeTok{fill =} \StringTok{"white"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{geom\_vline}\NormalTok{(}\AttributeTok{xintercept =} \FunctionTok{mean}\NormalTok{(dv), }\AttributeTok{color =} \StringTok{"red"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{geom\_vline}\NormalTok{(}\AttributeTok{xintercept =} \FunctionTok{quantile}\NormalTok{(dv, .}\DecValTok{5} \SpecialCharTok{{-}}\NormalTok{ sd1}\SpecialCharTok{/}\DecValTok{2}\NormalTok{), }\AttributeTok{color =} \StringTok{"darkgreen"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{geom\_vline}\NormalTok{(}\AttributeTok{xintercept =} \FunctionTok{quantile}\NormalTok{(dv, .}\DecValTok{5} \SpecialCharTok{+}\NormalTok{ sd1}\SpecialCharTok{/}\DecValTok{2}\NormalTok{), }\AttributeTok{color =} \StringTok{"darkgreen"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{geom\_vline}\NormalTok{(}\AttributeTok{xintercept =} \FunctionTok{quantile}\NormalTok{(dv, .}\DecValTok{5} \SpecialCharTok{{-}}\NormalTok{ sd2}\SpecialCharTok{/}\DecValTok{2}\NormalTok{), }\AttributeTok{color =} \StringTok{"blue"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{geom\_vline}\NormalTok{(}\AttributeTok{xintercept =} \FunctionTok{quantile}\NormalTok{(dv, .}\DecValTok{5} \SpecialCharTok{+}\NormalTok{ sd2}\SpecialCharTok{/}\DecValTok{2}\NormalTok{), }\AttributeTok{color =} \StringTok{"blue"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{geom\_vline}\NormalTok{(}\AttributeTok{xintercept =} \FunctionTok{quantile}\NormalTok{(dv, .}\DecValTok{5} \SpecialCharTok{{-}}\NormalTok{ sd3}\SpecialCharTok{/}\DecValTok{2}\NormalTok{), }\AttributeTok{color =} \StringTok{"purple"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{geom\_vline}\NormalTok{(}\AttributeTok{xintercept =} \FunctionTok{quantile}\NormalTok{(dv, .}\DecValTok{5} \SpecialCharTok{+}\NormalTok{ sd3}\SpecialCharTok{/}\DecValTok{2}\NormalTok{), }\AttributeTok{color =} \StringTok{"purple"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{scale\_x\_continuous}\NormalTok{(}
    \AttributeTok{limits =} \FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{,}\DecValTok{20}\NormalTok{), }
    \AttributeTok{breaks =} \FunctionTok{seq}\NormalTok{(}\DecValTok{0}\NormalTok{,}\DecValTok{20}\NormalTok{)}
\NormalTok{  )}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics[width=1\linewidth]{10-sim_files/figure-latex/rnorm-1} \end{center}

\begin{info}
Run the simulation above several times, noting how the density plot changes. What do the vertical lines represent? Try changing the values of \texttt{n}, \texttt{mean}, and \texttt{sd}.

\end{info}

\hypertarget{poisson}{%
\subsection{Poisson Distribution}\label{poisson}}

The Poisson distribution is useful for modelling events, like how many times something happens over a unit of time, as long as the events are independent (e.g., an event having happened in one time period doesn't make it more or less likely to happen in the next).

\texttt{rpois(n,\ lambda)}

The \texttt{rpois} function will generate a random Poisson distribution.

\begin{itemize}
\tightlist
\item
  \texttt{n} = number of observations
\item
  \texttt{lambda} = the mean number of events per observation
\end{itemize}

Let's say we want to model how many texts you get each day for a whole. You know that you get an average of 20 texts per day. So we set \texttt{n\ =\ 365} and \texttt{lambda\ =\ 20}. Lambda is a parameter that describes the Poisson distribution, just like mean and standard deviation are parameters that describe the normal distribution.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{texts }\OtherTok{\textless{}{-}} \FunctionTok{rpois}\NormalTok{(}\AttributeTok{n =} \DecValTok{365}\NormalTok{, }\AttributeTok{lambda =} \DecValTok{20}\NormalTok{)}

\FunctionTok{ggplot}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{geom\_histogram}\NormalTok{(}
    \FunctionTok{aes}\NormalTok{(texts), }
    \AttributeTok{binwidth =} \DecValTok{1}\NormalTok{, }
    \AttributeTok{fill =} \StringTok{"white"}\NormalTok{, }
    \AttributeTok{color =} \StringTok{"black"}
\NormalTok{  )}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics[width=1\linewidth]{10-sim_files/figure-latex/rpois-1} \end{center}

So we can see that over a year, you're unlikely to get fewer than 5 texts in a day, or more than 35 (although it's not impossible).

\hypertarget{mvdist}{%
\section{Multivariate Distributions}\label{mvdist}}

\hypertarget{bvn}{%
\subsection{Bivariate Normal}\label{bvn}}

A bivariate normal distribution is two normally distributed vectors that have a specified relationship, or correlation to each other.

What if we want to sample from a population with specific relationships between variables? We can sample from a bivariate normal distribution using \texttt{mvrnorm()} from the \texttt{MASS} package.

\begin{warning}
Don't load MASS with the \texttt{library()} function because it will create a conflict with the \texttt{select()} function from dplyr and you will always need to preface it with \texttt{dplyr::}. Just use \texttt{MASS::mvrnorm()}.

\end{warning}

You need to know how many observations you want to simulate (\texttt{n}) the means of the two variables (\texttt{mu}) and you need to calculate a covariance matrix (\texttt{sigma}) from the correlation between the variables (\texttt{rho}) and their standard deviations (\texttt{sd}).

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{n   }\OtherTok{\textless{}{-}} \DecValTok{1000} \CommentTok{\# number of random samples}
\CommentTok{\# name the mu values to give the resulting columns names}
\NormalTok{mu     }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \DecValTok{10}\NormalTok{, }\AttributeTok{y =} \DecValTok{20}\NormalTok{) }\CommentTok{\# the means of the samples}
\NormalTok{sd }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\DecValTok{5}\NormalTok{, }\DecValTok{6}\NormalTok{)   }\CommentTok{\# the SDs of the samples}

\NormalTok{rho }\OtherTok{\textless{}{-}} \FloatTok{0.5}  \CommentTok{\# population correlation between the two variables}

\CommentTok{\# correlation matrix}
\NormalTok{cor\_mat }\OtherTok{\textless{}{-}} \FunctionTok{matrix}\NormalTok{(}\FunctionTok{c}\NormalTok{(  }\DecValTok{1}\NormalTok{, rho, }
\NormalTok{                    rho,   }\DecValTok{1}\NormalTok{), }\DecValTok{2}\NormalTok{) }

\CommentTok{\# create the covariance matrix}
\NormalTok{sigma }\OtherTok{\textless{}{-}}\NormalTok{ (sd }\SpecialCharTok{\%*\%} \FunctionTok{t}\NormalTok{(sd)) }\SpecialCharTok{*}\NormalTok{ cor\_mat}

\CommentTok{\# sample from bivariate normal distribution}
\NormalTok{bvn }\OtherTok{\textless{}{-}}\NormalTok{ MASS}\SpecialCharTok{::}\FunctionTok{mvrnorm}\NormalTok{(n, mu, sigma) }
\end{Highlighting}
\end{Shaded}

Plot your sampled variables to check everything worked like you expect. It's easiest to convert the output of \texttt{mvnorm} into a tibble in order to use it in ggplot.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{bvn }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{as\_tibble}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{ggplot}\NormalTok{(}\FunctionTok{aes}\NormalTok{(x, y)) }\SpecialCharTok{+}
    \FunctionTok{geom\_point}\NormalTok{(}\AttributeTok{alpha =} \FloatTok{0.5}\NormalTok{) }\SpecialCharTok{+} 
    \FunctionTok{geom\_smooth}\NormalTok{(}\AttributeTok{method =} \StringTok{"lm"}\NormalTok{) }\SpecialCharTok{+}
    \FunctionTok{geom\_density2d}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## `geom_smooth()` using formula 'y ~ x'
\end{verbatim}

\begin{center}\includegraphics[width=1\linewidth]{10-sim_files/figure-latex/graph-bvn-1} \end{center}

\hypertarget{mvnorm}{%
\subsection{Multivariate Normal}\label{mvnorm}}

You can generate more than 2 correlated variables, but it gets a little trickier to create the correlation matrix.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{n      }\OtherTok{\textless{}{-}} \DecValTok{200} \CommentTok{\# number of random samples}
\NormalTok{mu     }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \DecValTok{10}\NormalTok{, }\AttributeTok{y =} \DecValTok{20}\NormalTok{, }\AttributeTok{z =} \DecValTok{30}\NormalTok{) }\CommentTok{\# the means of the samples}
\NormalTok{sd }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\DecValTok{8}\NormalTok{, }\DecValTok{9}\NormalTok{, }\DecValTok{10}\NormalTok{)   }\CommentTok{\# the SDs of the samples}

\NormalTok{rho1\_2 }\OtherTok{\textless{}{-}} \FloatTok{0.5} \CommentTok{\# correlation between x and y}
\NormalTok{rho1\_3 }\OtherTok{\textless{}{-}} \DecValTok{0}   \CommentTok{\# correlation between x and z}
\NormalTok{rho2\_3 }\OtherTok{\textless{}{-}} \FloatTok{0.7} \CommentTok{\# correlation between y and z}

\CommentTok{\# correlation matrix}
\NormalTok{cor\_mat }\OtherTok{\textless{}{-}} \FunctionTok{matrix}\NormalTok{(}\FunctionTok{c}\NormalTok{(     }\DecValTok{1}\NormalTok{, rho1\_2, rho1\_3, }
\NormalTok{                    rho1\_2,      }\DecValTok{1}\NormalTok{, rho2\_3,}
\NormalTok{                    rho1\_3, rho2\_3,      }\DecValTok{1}\NormalTok{), }\DecValTok{3}\NormalTok{) }

\NormalTok{sigma }\OtherTok{\textless{}{-}}\NormalTok{ (sd }\SpecialCharTok{\%*\%} \FunctionTok{t}\NormalTok{(sd)) }\SpecialCharTok{*}\NormalTok{ cor\_mat}
\NormalTok{bvn3 }\OtherTok{\textless{}{-}}\NormalTok{ MASS}\SpecialCharTok{::}\FunctionTok{mvrnorm}\NormalTok{(n, mu, sigma)}

\FunctionTok{cor}\NormalTok{(bvn3) }\CommentTok{\# check correlation matrix}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##           x         y         z
## x 1.0000000 0.5896674 0.1513108
## y 0.5896674 1.0000000 0.7468737
## z 0.1513108 0.7468737 1.0000000
\end{verbatim}

You can use the \texttt{plotly} library to make a 3D graph.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#set up the marker style}
\NormalTok{marker\_style }\OtherTok{=} \FunctionTok{list}\NormalTok{(}
    \AttributeTok{color =} \StringTok{"\#ff0000"}\NormalTok{, }
    \AttributeTok{line =} \FunctionTok{list}\NormalTok{(}
      \AttributeTok{color =} \StringTok{"\#444"}\NormalTok{, }
      \AttributeTok{width =} \DecValTok{1}
\NormalTok{    ), }
    \AttributeTok{opacity =} \FloatTok{0.5}\NormalTok{,}
    \AttributeTok{size =} \DecValTok{5}
\NormalTok{  )}

\CommentTok{\# convert bvn3 to a tibble, plot and add markers}
\NormalTok{bvn3 }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{as\_tibble}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{plot\_ly}\NormalTok{(}\AttributeTok{x =} \SpecialCharTok{\textasciitilde{}}\NormalTok{x, }\AttributeTok{y =} \SpecialCharTok{\textasciitilde{}}\NormalTok{y, }\AttributeTok{z =} \SpecialCharTok{\textasciitilde{}}\NormalTok{z, }\AttributeTok{marker =}\NormalTok{ marker\_style) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{add\_markers}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics[width=1\linewidth]{10-sim_files/figure-latex/3d-graph-mvn-1} \end{center}

\hypertarget{faux}{%
\subsection{Faux}\label{faux}}

Alternatively, you can use the package \href{https://debruine.github.io/faux/}{faux} to generate any number of correlated variables. It also has a function for checking the parameters of your new simulated data (\texttt{check\_sim\_stats()}).

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{bvn3 }\OtherTok{\textless{}{-}} \FunctionTok{rnorm\_multi}\NormalTok{(}
  \AttributeTok{n =}\NormalTok{ n, }
  \AttributeTok{vars =} \DecValTok{3}\NormalTok{,}
  \AttributeTok{mu =}\NormalTok{ mu, }
  \AttributeTok{sd =}\NormalTok{ sd,}
  \AttributeTok{r =} \FunctionTok{c}\NormalTok{(rho1\_2, rho1\_3, rho2\_3),}
  \AttributeTok{varnames =} \FunctionTok{c}\NormalTok{(}\StringTok{"x"}\NormalTok{, }\StringTok{"y"}\NormalTok{, }\StringTok{"z"}\NormalTok{)}
\NormalTok{)}

\FunctionTok{check\_sim\_stats}\NormalTok{(bvn3)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##     n var    x    y    z  mean   sd
## 1 200   x 1.00 0.54 0.05 10.23 7.92
## 2 200   y 0.54 1.00 0.65 19.94 8.72
## 3 200   z 0.05 0.65 1.00 30.09 9.51
\end{verbatim}

You can also use faux to simulate data for factorial designs. Set up the between-subject and within-subject factors as lists with the levels as (named) vectors. Means and standard deviations can be included as vectors or data frames. The function calculates sigma for you, structures your dataset, and outputs a plot of the design.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{b }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(}\AttributeTok{pet =} \FunctionTok{c}\NormalTok{(}\AttributeTok{cat =} \StringTok{"Cat Owners"}\NormalTok{,}
                  \AttributeTok{dog =} \StringTok{"Dog Owners"}\NormalTok{))}
\NormalTok{w }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(}\AttributeTok{time =} \FunctionTok{c}\NormalTok{(}\StringTok{"morning"}\NormalTok{,}
                   \StringTok{"noon"}\NormalTok{,}
                   \StringTok{"night"}\NormalTok{))}
\NormalTok{mu }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}
  \AttributeTok{cat    =} \FunctionTok{c}\NormalTok{(}\DecValTok{10}\NormalTok{, }\DecValTok{12}\NormalTok{, }\DecValTok{14}\NormalTok{),}
  \AttributeTok{dog    =} \FunctionTok{c}\NormalTok{(}\DecValTok{10}\NormalTok{, }\DecValTok{15}\NormalTok{, }\DecValTok{20}\NormalTok{),}
  \AttributeTok{row.names =}\NormalTok{ w}\SpecialCharTok{$}\NormalTok{time}
\NormalTok{)}
\NormalTok{sd }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\DecValTok{3}\NormalTok{, }\DecValTok{3}\NormalTok{, }\DecValTok{3}\NormalTok{, }\DecValTok{5}\NormalTok{, }\DecValTok{5}\NormalTok{, }\DecValTok{5}\NormalTok{)}

\NormalTok{pet\_data }\OtherTok{\textless{}{-}} \FunctionTok{sim\_design}\NormalTok{(}
  \AttributeTok{within =}\NormalTok{ w, }
  \AttributeTok{between =}\NormalTok{ b,}
  \AttributeTok{n =} \DecValTok{100}\NormalTok{, }
  \AttributeTok{mu =}\NormalTok{ mu,}
  \AttributeTok{sd =}\NormalTok{ sd, }
  \AttributeTok{r =}\NormalTok{ .}\DecValTok{5}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics[width=1\linewidth]{10-sim_files/figure-latex/faux-sim-design-1} \end{center}

You can use the \texttt{check\_sim\_stats()} function, but you need to set the argument \texttt{between} to a vector of all the between-subject factor columns.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{check\_sim\_stats}\NormalTok{(pet\_data, }\AttributeTok{between =} \StringTok{"pet"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##   pet   n     var morning noon night  mean   sd
## 1 cat 100 morning    1.00 0.52  0.48 10.79 3.40
## 2 cat 100    noon    0.52 1.00  0.50 12.41 2.88
## 3 cat 100   night    0.48 0.50  1.00 14.64 3.13
## 4 dog 100 morning    1.00 0.55  0.44  9.65 4.74
## 5 dog 100    noon    0.55 1.00  0.46 14.45 5.69
## 6 dog 100   night    0.44 0.46  1.00 19.86 5.46
\end{verbatim}

See the \href{https://debruine.github.io/faux/}{faux website} for more detailed tutorials.

\hypertarget{stat-terms}{%
\section{Statistical terms}\label{stat-terms}}

Let's review some important statistical terms before we review tests of distributions.

\hypertarget{effect}{%
\subsection{Effect}\label{effect}}

The effect is some measure of your data. This will depend on the type of data you have and the type of statistical test you are using. For example, if you flipped a coin 100 times and it landed heads 66 times, the effect would be 66/100. You can then use the exact binomial test to compare this effect to the null effect you would expect from a fair coin (50/100) or to any other effect you choose. The effect size refers to the difference between the effect in your data and the null effect (usually a chance value).

\hypertarget{p-value}{%
\subsection{P-value}\label{p-value}}

The p-value of a test is the probability of seeing an effect at least as extreme as what you have, if the real effect was the value you are testing against (e.g., a null effect). So if you used a binomial test to test against a chance probability of 1/6 (e.g., the probability of rolling 1 with a 6-sided die), then a p-value of 0.17 means that you could expect to see effects at least as extreme as your data 17\% of the time just by chance alone.

\hypertarget{alpha}{%
\subsection{Alpha}\label{alpha}}

If you are using null hypothesis significance testing (NHST), then you need to decide on a cutoff value (alpha) for making a decision to reject the null hypothesis. We call p-values below the alpha cutoff significant. In psychology, alpha is traditionally set at 0.05, but there are good arguments for \href{http://daniellakens.blogspot.com/2019/05/justifying-your-alpha-by-minimizing-or.html}{setting a different criterion in some circumstances}.

\hypertarget{false-pos}{%
\subsection{False Positive/Negative}\label{false-pos}}

The probability that a test concludes there is an effect when there is really no effect (e.g., concludes a fair coin is biased) is called the false positive rate (or Type I Error Rate). The alpha is the false positive rate we accept for a test. The probability that a test concludes there is no effect when there really is one (e.g., concludes a biased coin is fair) is called the false negative rate (or Type II Error Rate). The beta is the false negative rate we accept for a test.

\begin{info}
The false positive rate is not the overall probability of getting a false positive, but the probability of a false positive \emph{under the null hypothesis}. Similarly, the false negative rate is the probability of a false negative \emph{under the alternative hypothesis}. Unless we know the probability that we are testing a null effect, we can't say anything about the overall probability of false positives or negatives. If 100\% of the hypotheses we test are false, then all significant effects are false positives, but if all of the hypotheses we test are true, then all of the positives are true positives and the overall false positive rate is 0.

\end{info}

\hypertarget{power}{%
\subsection{Power and SESOI}\label{power}}

Power is equal to 1 minus beta (i.e., the true positive rate), and depends on the effect size, how many samples we take (n), and what we set alpha to. For any test, if you specify all but one of these values, you can calculate the last. The effect size you use in power calculations should be the smallest effect size of interest (SESOI). See \citep{TOSTtutorial}(\url{https://doi.org/10.1177/2515245918770963}) for a tutorial on methods for choosing an SESOI.

\begin{try}

Let's say you want to be able to detect at least a 15\% difference from chance (50\%) in a coin's fairness, and you want your test to have a 5\% chance of false positives and a 10\% chance of false negatives. What are the following values?

\begin{itemize}
\tightlist
\item
  alpha =
\item
  beta =
\item
  false positive rate =
\item
  false negative rate =
\item
  power =
\item
  SESOI =
\end{itemize}

\end{try}

\hypertarget{conf-int}{%
\subsection{Confidence Intervals}\label{conf-int}}

The confidence interval is a range around some value (such as a mean) that has some probability of containing the parameter, if you repeated the process many times. Traditionally in psychology, we use 95\% confidence intervals, but you can calculate CIs for any percentage.

\begin{info}
A 95\% CI does \emph{not} mean that there is a 95\% probability that the true mean lies within this range, but that, if you repeated the study many times and calculated the CI this same way every time, you'd expect the true mean to be inside the CI in 95\% of the studies. This seems like a subtle distinction, but can lead to some misunderstandings. See \citep{Morey2016}(\url{https://link.springer.com/article/10.3758/s13423-015-0947-8}) for more detailed discussion.

\end{info}

\hypertarget{tests}{%
\section{Tests}\label{tests}}

\hypertarget{exact-binom}{%
\subsection{Exact binomial test}\label{exact-binom}}

\texttt{binom.test(x,\ n,\ p)}

You can test a binomial distribution against a specific probability using the exact binomial test.

\begin{itemize}
\tightlist
\item
  \texttt{x} = the number of successes
\item
  \texttt{n} = the number of trials
\item
  \texttt{p} = hypothesised probability of success
\end{itemize}

Here we can test a series of 10 coin flips from a fair coin and a biased coin against the hypothesised probability of 0.5 (even odds).

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{n }\OtherTok{\textless{}{-}} \DecValTok{10}
\NormalTok{fair\_coin }\OtherTok{\textless{}{-}} \FunctionTok{rbinom}\NormalTok{(}\DecValTok{1}\NormalTok{, n, }\FloatTok{0.5}\NormalTok{)}
\NormalTok{biased\_coin }\OtherTok{\textless{}{-}} \FunctionTok{rbinom}\NormalTok{(}\DecValTok{1}\NormalTok{, n, }\FloatTok{0.6}\NormalTok{)}

\FunctionTok{binom.test}\NormalTok{(fair\_coin, n, }\AttributeTok{p =} \FloatTok{0.5}\NormalTok{)}
\FunctionTok{binom.test}\NormalTok{(biased\_coin, n, }\AttributeTok{p =} \FloatTok{0.5}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
##  Exact binomial test
## 
## data:  fair_coin and n
## number of successes = 5, number of trials = 10, p-value = 1
## alternative hypothesis: true probability of success is not equal to 0.5
## 95 percent confidence interval:
##  0.187086 0.812914
## sample estimates:
## probability of success 
##                    0.5 
## 
## 
##  Exact binomial test
## 
## data:  biased_coin and n
## number of successes = 5, number of trials = 10, p-value = 1
## alternative hypothesis: true probability of success is not equal to 0.5
## 95 percent confidence interval:
##  0.187086 0.812914
## sample estimates:
## probability of success 
##                    0.5
\end{verbatim}

\begin{info}

Run the code above several times, noting the p-values for the fair and biased coins. Alternatively, you can \href{http://shiny.psy.gla.ac.uk/debruine/coinsim/}{simulate coin flips} online and build up a graph of results and p-values.

\begin{itemize}
\tightlist
\item
  How does the p-value vary for the fair and biased coins?
\item
  What happens to the confidence intervals if you increase n from 10 to 100?
\item
  What criterion would you use to tell if the observed data indicate the coin is fair or biased?
\item
  How often do you conclude the fair coin is biased (false positives)?
\item
  How often do you conclude the biased coin is fair (false negatives)?
\end{itemize}

\end{info}

\hypertarget{sampling-binom}{%
\subsubsection{Sampling function}\label{sampling-binom}}

To estimate these rates, we need to repeat the sampling above many times. A function is ideal for repeating the exact same procedure over and over. Set the arguments of the function to variables that you might want to change. Here, we will want to estimate power for:

\begin{itemize}
\tightlist
\item
  different sample sizes (\texttt{n})
\item
  different effects (\texttt{bias})
\item
  different hypothesised probabilities (\texttt{p}, defaults to 0.5)
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{sim\_binom\_test }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(n, bias, }\AttributeTok{p =} \FloatTok{0.5}\NormalTok{) \{}
  \CommentTok{\# simulate 1 coin flip n times with the specified bias}
\NormalTok{  coin }\OtherTok{\textless{}{-}} \FunctionTok{rbinom}\NormalTok{(}\DecValTok{1}\NormalTok{, n, bias)}
  \CommentTok{\# run a binomial test on the simulated data for the specified p}
\NormalTok{  btest }\OtherTok{\textless{}{-}} \FunctionTok{binom.test}\NormalTok{(coin, n, p)}
  \CommentTok{\# return the p{-}value of this test}
\NormalTok{  btest}\SpecialCharTok{$}\NormalTok{p.value}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

Once you've created your function, test it a few times, changing the values.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{sim\_binom\_test}\NormalTok{(}\DecValTok{100}\NormalTok{, }\FloatTok{0.6}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.271253
\end{verbatim}

\hypertarget{calc-power-binom}{%
\subsubsection{Calculate power}\label{calc-power-binom}}

Then you can use the \texttt{replicate()} function to run it many times and save all the output values. You can calculate the power of your analysis by checking the proportion of your simulated analyses that have a p-value less than your alpha (the probability of rejecting the null hypothesis when the null hypothesis is true).

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my\_reps }\OtherTok{\textless{}{-}} \FunctionTok{replicate}\NormalTok{(}\FloatTok{1e4}\NormalTok{, }\FunctionTok{sim\_binom\_test}\NormalTok{(}\DecValTok{100}\NormalTok{, }\FloatTok{0.6}\NormalTok{))}

\NormalTok{alpha }\OtherTok{\textless{}{-}} \FloatTok{0.05} \CommentTok{\# this does not always have to be 0.05}

\FunctionTok{mean}\NormalTok{(my\_reps }\SpecialCharTok{\textless{}}\NormalTok{ alpha)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.4565
\end{verbatim}

\begin{info}
\texttt{1e4} is just scientific notation for a 1 followed by 4 zeros (\texttt{10000}). When you're running simulations, you usually want to run a lot of them. It's a pain to keep track of whether you've typed 5 or 6 zeros (100000 vs 1000000) and this will change your running time by an order of magnitude.

\end{info}

You can plot the distribution of p-values.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{() }\SpecialCharTok{+} 
  \FunctionTok{geom\_histogram}\NormalTok{(}
    \FunctionTok{aes}\NormalTok{(my\_reps), }
    \AttributeTok{binwidth =} \FloatTok{0.05}\NormalTok{, }
    \AttributeTok{boundary =} \DecValTok{0}\NormalTok{,}
    \AttributeTok{fill =} \StringTok{"white"}\NormalTok{, }
    \AttributeTok{color =} \StringTok{"black"}
\NormalTok{  )}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics[width=1\linewidth]{10-sim_files/figure-latex/plot-reps-binom-1} \end{center}

\hypertarget{t-test}{%
\subsection{T-test}\label{t-test}}

\texttt{t.test(x,\ y,\ alternative,\ mu,\ paired)}

Use a t-test to compare the mean of one distribution to a null hypothesis (one-sample t-test), compare the means of two samples (independent-samples t-test), or compare pairs of values (paired-samples t-test).

You can run a one-sample t-test comparing the mean of your data to \texttt{mu}. Here is a simulated distribution with a mean of 0.5 and an SD of 1, creating an effect size of 0.5 SD when tested against a \texttt{mu} of 0. Run the simulation a few times to see how often the t-test returns a significant p-value (or run it in the \href{http://shiny.psy.gla.ac.uk/debruine/normsim/}{shiny app}).

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{sim\_norm }\OtherTok{\textless{}{-}} \FunctionTok{rnorm}\NormalTok{(}\DecValTok{100}\NormalTok{, }\FloatTok{0.5}\NormalTok{, }\DecValTok{1}\NormalTok{)}
\FunctionTok{t.test}\NormalTok{(sim\_norm, }\AttributeTok{mu =} \DecValTok{0}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
##  One Sample t-test
## 
## data:  sim_norm
## t = 5.9355, df = 99, p-value = 4.34e-08
## alternative hypothesis: true mean is not equal to 0
## 95 percent confidence interval:
##  0.3679233 0.7374439
## sample estimates:
## mean of x 
## 0.5526836
\end{verbatim}

Run an independent-samples t-test by comparing two lists of values.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{a }\OtherTok{\textless{}{-}} \FunctionTok{rnorm}\NormalTok{(}\DecValTok{100}\NormalTok{, }\FloatTok{0.5}\NormalTok{, }\DecValTok{1}\NormalTok{)}
\NormalTok{b }\OtherTok{\textless{}{-}} \FunctionTok{rnorm}\NormalTok{(}\DecValTok{100}\NormalTok{, }\FloatTok{0.7}\NormalTok{, }\DecValTok{1}\NormalTok{)}
\NormalTok{t\_ind }\OtherTok{\textless{}{-}} \FunctionTok{t.test}\NormalTok{(a, b, }\AttributeTok{paired =} \ConstantTok{FALSE}\NormalTok{)}
\NormalTok{t\_ind}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
##  Welch Two Sample t-test
## 
## data:  a and b
## t = -0.98718, df = 197.75, p-value = 0.3248
## alternative hypothesis: true difference in means is not equal to 0
## 95 percent confidence interval:
##  -0.4344457  0.1445867
## sample estimates:
## mean of x mean of y 
## 0.5524265 0.6973560
\end{verbatim}

\begin{warning}
The \texttt{paired} argument defaults to \texttt{FALSE}, but it's good practice to always explicitly set it so you are never confused about what type of test you are performing.

\end{warning}

\hypertarget{sampling-t}{%
\subsubsection{Sampling function}\label{sampling-t}}

We can use the \texttt{names()} function to find out the names of all the t.test parameters and use this to just get one type of data, like the test statistic (e.g., t-value).

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{names}\NormalTok{(t\_ind)}
\NormalTok{t\_ind}\SpecialCharTok{$}\NormalTok{statistic}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1] "statistic"   "parameter"   "p.value"     "conf.int"    "estimate"   
##  [6] "null.value"  "stderr"      "alternative" "method"      "data.name"  
##          t 
## -0.9871838
\end{verbatim}

If you want to run the simulation many times and record information each time, first you need to turn your simulation into a function.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{sim\_t\_ind }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(n, m1, sd1, m2, sd2) \{}
  \CommentTok{\# simulate v1}
\NormalTok{  v1 }\OtherTok{\textless{}{-}} \FunctionTok{rnorm}\NormalTok{(n, m1, sd1)}
  
  \CommentTok{\#simulate v2}
\NormalTok{  v2 }\OtherTok{\textless{}{-}} \FunctionTok{rnorm}\NormalTok{(n, m2, sd2)}
    
  \CommentTok{\# compare using an independent samples t{-}test}
\NormalTok{  t\_ind }\OtherTok{\textless{}{-}} \FunctionTok{t.test}\NormalTok{(v1, v2, }\AttributeTok{paired =} \ConstantTok{FALSE}\NormalTok{)}
  
  \CommentTok{\# return the p{-}value}
  \FunctionTok{return}\NormalTok{(t\_ind}\SpecialCharTok{$}\NormalTok{p.value)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

Run it a few times to check that it gives you sensible values.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{sim\_t\_ind}\NormalTok{(}\DecValTok{100}\NormalTok{, }\FloatTok{0.7}\NormalTok{, }\DecValTok{1}\NormalTok{, }\FloatTok{0.5}\NormalTok{, }\DecValTok{1}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.0533657
\end{verbatim}

\hypertarget{calc-power-t}{%
\subsubsection{Calculate power}\label{calc-power-t}}

Now replicate the simulation 1000 times.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my\_reps }\OtherTok{\textless{}{-}} \FunctionTok{replicate}\NormalTok{(}\FloatTok{1e4}\NormalTok{, }\FunctionTok{sim\_t\_ind}\NormalTok{(}\DecValTok{100}\NormalTok{, }\FloatTok{0.7}\NormalTok{, }\DecValTok{1}\NormalTok{, }\FloatTok{0.5}\NormalTok{, }\DecValTok{1}\NormalTok{))}

\NormalTok{alpha }\OtherTok{\textless{}{-}} \FloatTok{0.05}
\NormalTok{power }\OtherTok{\textless{}{-}} \FunctionTok{mean}\NormalTok{(my\_reps }\SpecialCharTok{\textless{}}\NormalTok{ alpha)}
\NormalTok{power}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.2906
\end{verbatim}

\begin{try}
Run the code above several times. How much does the power value fluctuate? How many replications do you need to run to get a reliable estimate of power?

\end{try}

Compare your power estimate from simluation to a power calculation using \texttt{power.t.test()}. Here, \texttt{delta} is the difference between \texttt{m1} and \texttt{m2} above.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{power.t.test}\NormalTok{(}\AttributeTok{n =} \DecValTok{100}\NormalTok{, }
             \AttributeTok{delta =} \FloatTok{0.2}\NormalTok{, }
             \AttributeTok{sd =} \DecValTok{1}\NormalTok{, }
             \AttributeTok{sig.level =}\NormalTok{ alpha, }
             \AttributeTok{type =} \StringTok{"two.sample"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
##      Two-sample t test power calculation 
## 
##               n = 100
##           delta = 0.2
##              sd = 1
##       sig.level = 0.05
##           power = 0.2902664
##     alternative = two.sided
## 
## NOTE: n is number in *each* group
\end{verbatim}

You can plot the distribution of p-values.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{() }\SpecialCharTok{+} 
  \FunctionTok{geom\_histogram}\NormalTok{(}
    \FunctionTok{aes}\NormalTok{(my\_reps), }
    \AttributeTok{binwidth =} \FloatTok{0.05}\NormalTok{, }
    \AttributeTok{boundary =} \DecValTok{0}\NormalTok{,}
    \AttributeTok{fill =} \StringTok{"white"}\NormalTok{, }
    \AttributeTok{color =} \StringTok{"black"}
\NormalTok{  )}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics[width=1\linewidth]{10-sim_files/figure-latex/plot-reps-t-1} \end{center}

\begin{try}
What do you think the distribution of p-values is
when there is no effect (i.e., the means are identical)? Check this yourself.

\end{try}

\begin{warning}
Make sure the \texttt{boundary} argument is set to \texttt{0} for p-value histograms. See what happens with a null effect if \texttt{boundary} is not set.

\end{warning}

\hypertarget{correlation}{%
\subsection{Correlation}\label{correlation}}

You can test if continuous variables are related to each other using the \texttt{cor()} function. Let's use \texttt{rnorm\_multi()} to make a quick table of correlated values.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dat }\OtherTok{\textless{}{-}} \FunctionTok{rnorm\_multi}\NormalTok{(}
  \AttributeTok{n =} \DecValTok{100}\NormalTok{, }
  \AttributeTok{vars =} \DecValTok{2}\NormalTok{, }
  \AttributeTok{r =} \SpecialCharTok{{-}}\FloatTok{0.5}\NormalTok{,}
  \AttributeTok{varnames =} \FunctionTok{c}\NormalTok{(}\StringTok{"x"}\NormalTok{, }\StringTok{"y"}\NormalTok{)}
\NormalTok{)}

\FunctionTok{cor}\NormalTok{(dat}\SpecialCharTok{$}\NormalTok{x, dat}\SpecialCharTok{$}\NormalTok{y)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] -0.4218379
\end{verbatim}

\begin{try}
Set \texttt{n} to a large number like 1e6 so that the correlations are less affected by chance. Change the value of the \textbf{mean} for \texttt{a}, \texttt{x}, or \texttt{y}. Does it change the correlation between \texttt{x} and \texttt{y}? What happens when you increase or decrease the \textbf{sd}? Can you work out any rules here?

\end{try}

\texttt{cor()} defaults to Pearson's correlations. Set the \texttt{method} argument to use Kendall or Spearman correlations.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{cor}\NormalTok{(dat}\SpecialCharTok{$}\NormalTok{x, dat}\SpecialCharTok{$}\NormalTok{y, }\AttributeTok{method =} \StringTok{"spearman"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] -0.389559
\end{verbatim}

\hypertarget{sampling-cor}{%
\subsubsection{Sampling function}\label{sampling-cor}}

Create a function that creates two variables with \texttt{n} observations and \texttt{r} correlation. Use the function \texttt{cor.test()} to give you p-values for the correlation.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{sim\_cor\_test }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(}\AttributeTok{n =} \DecValTok{100}\NormalTok{, }\AttributeTok{r =} \DecValTok{0}\NormalTok{) \{}
\NormalTok{  dat }\OtherTok{\textless{}{-}} \FunctionTok{rnorm\_multi}\NormalTok{(}
    \AttributeTok{n =}\NormalTok{ n, }
    \AttributeTok{vars =} \DecValTok{2}\NormalTok{, }
    \AttributeTok{r =}\NormalTok{ r,}
    \AttributeTok{varnames =} \FunctionTok{c}\NormalTok{(}\StringTok{"x"}\NormalTok{, }\StringTok{"y"}\NormalTok{)}
\NormalTok{  )}

\NormalTok{  ctest }\OtherTok{\textless{}{-}} \FunctionTok{cor.test}\NormalTok{(dat}\SpecialCharTok{$}\NormalTok{x, dat}\SpecialCharTok{$}\NormalTok{y)}
\NormalTok{  ctest}\SpecialCharTok{$}\NormalTok{p.value}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

Once you've created your function, test it a few times, changing the values.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{sim\_cor\_test}\NormalTok{(}\DecValTok{50}\NormalTok{, .}\DecValTok{5}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.0002660767
\end{verbatim}

\hypertarget{calc-power-cor}{%
\subsubsection{Calculate power}\label{calc-power-cor}}

Now replicate the simulation 1000 times.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my\_reps }\OtherTok{\textless{}{-}} \FunctionTok{replicate}\NormalTok{(}\FloatTok{1e4}\NormalTok{, }\FunctionTok{sim\_cor\_test}\NormalTok{(}\DecValTok{50}\NormalTok{, }\FloatTok{0.5}\NormalTok{))}

\NormalTok{alpha }\OtherTok{\textless{}{-}} \FloatTok{0.05}
\NormalTok{power }\OtherTok{\textless{}{-}} \FunctionTok{mean}\NormalTok{(my\_reps }\SpecialCharTok{\textless{}}\NormalTok{ alpha)}
\NormalTok{power}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.97
\end{verbatim}

Compare to the value calcuated by the pwr package.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pwr}\SpecialCharTok{::}\FunctionTok{pwr.r.test}\NormalTok{(}\AttributeTok{n =} \DecValTok{50}\NormalTok{, }\AttributeTok{r =} \FloatTok{0.5}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
##      approximate correlation power calculation (arctangh transformation) 
## 
##               n = 50
##               r = 0.5
##       sig.level = 0.05
##           power = 0.9669813
##     alternative = two.sided
\end{verbatim}

\hypertarget{example}{%
\section{Example}\label{example}}

This example uses the \href{https://www.cdc.gov/growthcharts/data/zscore/zstatage.csv}{Growth Chart Data Tables} from the \href{https://www.cdc.gov/growthcharts/zscore.htm}{US CDC}. The data consist of height in centimeters for the z-scores of --2, -1.5, -1, -0.5, 0, 0.5, 1, 1.5, and 2 by sex (1=male; 2=female) and half-month of age (from 24.0 to 240.5 months).

\hypertarget{load-wrangle}{%
\subsection{Load \& wrangle}\label{load-wrangle}}

We have to do a little data wrangling first. Have a look at the data after you import it and relabel \texttt{Sex} to \texttt{male} and \texttt{female} instead of \texttt{1} and \texttt{2}. Also convert \texttt{Agemos} (age in months) to years. Relabel the column \texttt{0} as \texttt{mean} and calculate a new column named \texttt{sd} as the difference between columns \texttt{1} and \texttt{0}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{orig\_height\_age }\OtherTok{\textless{}{-}} \FunctionTok{read\_csv}\NormalTok{(}\StringTok{"https://www.cdc.gov/growthcharts/data/zscore/zstatage.csv"}\NormalTok{) }
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Rows: 872 Columns: 11
\end{verbatim}

\begin{verbatim}
## -- Column specification --------------------------------------------------------
## Delimiter: ","
## chr (2): Sex, Agemos
## dbl (9): -2, -1.5, -1, -0.5, 0, 0.5, 1, 1.5, 2
\end{verbatim}

\begin{verbatim}
## 
## i Use `spec()` to retrieve the full column specification for this data.
## i Specify the column types or set `show_col_types = FALSE` to quiet this message.
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{height\_age }\OtherTok{\textless{}{-}}\NormalTok{ orig\_height\_age }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{filter}\NormalTok{(Sex }\SpecialCharTok{\%in\%} \FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{2}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}
    \AttributeTok{sex =} \FunctionTok{recode}\NormalTok{(Sex, }\StringTok{"1"} \OtherTok{=} \StringTok{"male"}\NormalTok{, }\StringTok{"2"} \OtherTok{=} \StringTok{"female"}\NormalTok{),}
    \AttributeTok{age =} \FunctionTok{as.numeric}\NormalTok{(Agemos)}\SpecialCharTok{/}\DecValTok{12}\NormalTok{,}
    \AttributeTok{sd =} \StringTok{\textasciigrave{}}\AttributeTok{1}\StringTok{\textasciigrave{}} \SpecialCharTok{{-}} \StringTok{\textasciigrave{}}\AttributeTok{0}\StringTok{\textasciigrave{}}
\NormalTok{  ) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{select}\NormalTok{(sex, age, }\AttributeTok{mean =} \StringTok{\textasciigrave{}}\AttributeTok{0}\StringTok{\textasciigrave{}}\NormalTok{, sd)}
\end{Highlighting}
\end{Shaded}

\hypertarget{plot}{%
\subsection{Plot}\label{plot}}

Plot your new data frame to see how mean height changes with age for boys and girls.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(height\_age, }\FunctionTok{aes}\NormalTok{(age, mean, }\AttributeTok{color =}\NormalTok{ sex)) }\SpecialCharTok{+}
  \FunctionTok{geom\_smooth}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{ymin =}\NormalTok{ mean }\SpecialCharTok{{-}}\NormalTok{ sd, }
                  \AttributeTok{ymax =}\NormalTok{ mean }\SpecialCharTok{+}\NormalTok{ sd),}
              \AttributeTok{stat=}\StringTok{"identity"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics[width=1\linewidth]{10-sim_files/figure-latex/plot-height-means-1} \end{center}

\hypertarget{simulate-a-population}{%
\subsection{Simulate a population}\label{simulate-a-population}}

Simulate 50 random male heights and 50 random female heights for 20-year-olds using the \texttt{rnorm()} function and the means and SDs from the \texttt{height\_age} table. Plot the data.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{age\_filter }\OtherTok{\textless{}{-}} \DecValTok{20}
\NormalTok{m }\OtherTok{\textless{}{-}} \FunctionTok{filter}\NormalTok{(height\_age, age }\SpecialCharTok{==}\NormalTok{ age\_filter, sex }\SpecialCharTok{==} \StringTok{"male"}\NormalTok{)}
\NormalTok{f }\OtherTok{\textless{}{-}} \FunctionTok{filter}\NormalTok{(height\_age, age }\SpecialCharTok{==}\NormalTok{ age\_filter, sex }\SpecialCharTok{==} \StringTok{"female"}\NormalTok{)}

\NormalTok{sim\_height }\OtherTok{\textless{}{-}} \FunctionTok{tibble}\NormalTok{(}
  \AttributeTok{male =} \FunctionTok{rnorm}\NormalTok{(}\DecValTok{50}\NormalTok{, m}\SpecialCharTok{$}\NormalTok{mean, m}\SpecialCharTok{$}\NormalTok{sd),}
  \AttributeTok{female =} \FunctionTok{rnorm}\NormalTok{(}\DecValTok{50}\NormalTok{, f}\SpecialCharTok{$}\NormalTok{mean, f}\SpecialCharTok{$}\NormalTok{sd)}
\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{gather}\NormalTok{(}\StringTok{"sex"}\NormalTok{, }\StringTok{"height"}\NormalTok{, male}\SpecialCharTok{:}\NormalTok{female)}

\FunctionTok{ggplot}\NormalTok{(sim\_height) }\SpecialCharTok{+}
  \FunctionTok{geom\_density}\NormalTok{(}\FunctionTok{aes}\NormalTok{(height, }\AttributeTok{fill =}\NormalTok{ sex), }\AttributeTok{alpha =} \FloatTok{0.5}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{xlim}\NormalTok{(}\DecValTok{125}\NormalTok{, }\DecValTok{225}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics[width=1\linewidth]{10-sim_files/figure-latex/sim-height-20-1} \end{center}

\begin{try}
Run the simulation above several times, noting how the density plot changes. Try changing the age you're simulating.

\end{try}

\hypertarget{analyse-simulated-data}{%
\subsection{Analyse simulated data}\label{analyse-simulated-data}}

Use the \texttt{sim\_t\_ind(n,\ m1,\ sd1,\ m2,\ sd2)} function we created above to generate one simulation with a sample size of 50 in each group using the means and SDs of male and female 14-year-olds.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{age\_filter }\OtherTok{\textless{}{-}} \DecValTok{14}
\NormalTok{m }\OtherTok{\textless{}{-}} \FunctionTok{filter}\NormalTok{(height\_age, age }\SpecialCharTok{==}\NormalTok{ age\_filter, sex }\SpecialCharTok{==} \StringTok{"male"}\NormalTok{)}
\NormalTok{f }\OtherTok{\textless{}{-}} \FunctionTok{filter}\NormalTok{(height\_age, age }\SpecialCharTok{==}\NormalTok{ age\_filter, sex }\SpecialCharTok{==} \StringTok{"female"}\NormalTok{)}

\FunctionTok{sim\_t\_ind}\NormalTok{(}\DecValTok{50}\NormalTok{, m}\SpecialCharTok{$}\NormalTok{mean, m}\SpecialCharTok{$}\NormalTok{sd, f}\SpecialCharTok{$}\NormalTok{mean, f}\SpecialCharTok{$}\NormalTok{sd)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.001543531
\end{verbatim}

\hypertarget{replicate-simulation}{%
\subsection{Replicate simulation}\label{replicate-simulation}}

Now replicate this 1e4 times using the \texttt{replicate()} function. This function will save the returned p-values in a list (\texttt{my\_reps}). We can then check what proportion of those p-values are less than our alpha value. This is the power of our test.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my\_reps }\OtherTok{\textless{}{-}} \FunctionTok{replicate}\NormalTok{(}\FloatTok{1e4}\NormalTok{, }\FunctionTok{sim\_t\_ind}\NormalTok{(}\DecValTok{50}\NormalTok{, m}\SpecialCharTok{$}\NormalTok{mean, m}\SpecialCharTok{$}\NormalTok{sd, f}\SpecialCharTok{$}\NormalTok{mean, f}\SpecialCharTok{$}\NormalTok{sd))}

\NormalTok{alpha }\OtherTok{\textless{}{-}} \FloatTok{0.05}
\NormalTok{power }\OtherTok{\textless{}{-}} \FunctionTok{mean}\NormalTok{(my\_reps }\SpecialCharTok{\textless{}}\NormalTok{ alpha)}
\NormalTok{power}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.6405
\end{verbatim}

\hypertarget{one-tailed-prediction}{%
\subsection{One-tailed prediction}\label{one-tailed-prediction}}

This design has about 65\% power to detect the sex difference in height (with a 2-tailed test). Modify the \texttt{sim\_t\_ind} function for a 1-tailed prediction.

You could just set \texttt{alternative} equal to ``greater'' in the function, but it might be better to add the \texttt{alt} argument to your function (giving it the same default value as \texttt{t.test}) and change the value of \texttt{alternative} in the function to \texttt{alt}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{sim\_t\_ind }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(n, m1, sd1, m2, sd2, }\AttributeTok{alt =} \StringTok{"two.sided"}\NormalTok{) \{}
\NormalTok{  v1 }\OtherTok{\textless{}{-}} \FunctionTok{rnorm}\NormalTok{(n, m1, sd1)}
\NormalTok{  v2 }\OtherTok{\textless{}{-}} \FunctionTok{rnorm}\NormalTok{(n, m2, sd2)}
\NormalTok{  t\_ind }\OtherTok{\textless{}{-}} \FunctionTok{t.test}\NormalTok{(v1, v2, }\AttributeTok{paired =} \ConstantTok{FALSE}\NormalTok{, }\AttributeTok{alternative =}\NormalTok{ alt)}
  
  \FunctionTok{return}\NormalTok{(t\_ind}\SpecialCharTok{$}\NormalTok{p.value)}
\NormalTok{\}}

\NormalTok{alpha }\OtherTok{\textless{}{-}} \FloatTok{0.05}
\NormalTok{my\_reps }\OtherTok{\textless{}{-}} \FunctionTok{replicate}\NormalTok{(}\FloatTok{1e4}\NormalTok{, }\FunctionTok{sim\_t\_ind}\NormalTok{(}\DecValTok{50}\NormalTok{, m}\SpecialCharTok{$}\NormalTok{mean, m}\SpecialCharTok{$}\NormalTok{sd, f}\SpecialCharTok{$}\NormalTok{mean, f}\SpecialCharTok{$}\NormalTok{sd, }\StringTok{"greater"}\NormalTok{))}
\FunctionTok{mean}\NormalTok{(my\_reps }\SpecialCharTok{\textless{}}\NormalTok{ alpha)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.7613
\end{verbatim}

\hypertarget{range-of-sample-sizes}{%
\subsection{Range of sample sizes}\label{range-of-sample-sizes}}

What if we want to find out what sample size will give us 80\% power? We can try trial and error. We know the number should be slightly larger than 50. But you can search more systematically by repeating your power calculation for a range of sample sizes.

\begin{info}
This might seem like overkill for a t-test, where you can easily look up sample size calculators online, but it is a valuable skill to learn for when your analyses become more complicated.

\end{info}

Start with a relatively low number of replications and/or more spread-out samples to estimate where you should be looking more specifically. Then you can repeat with a narrower/denser range of sample sizes and more iterations.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# make another custom function to return power}
\NormalTok{pwr\_func }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(n, }\AttributeTok{reps =} \DecValTok{100}\NormalTok{, }\AttributeTok{alpha =} \FloatTok{0.05}\NormalTok{) \{}
\NormalTok{  ps }\OtherTok{\textless{}{-}} \FunctionTok{replicate}\NormalTok{(reps, }\FunctionTok{sim\_t\_ind}\NormalTok{(n, m}\SpecialCharTok{$}\NormalTok{mean, m}\SpecialCharTok{$}\NormalTok{sd, f}\SpecialCharTok{$}\NormalTok{mean, f}\SpecialCharTok{$}\NormalTok{sd, }\StringTok{"greater"}\NormalTok{))}
  \FunctionTok{mean}\NormalTok{(ps }\SpecialCharTok{\textless{}}\NormalTok{ alpha)}
\NormalTok{\}}

\CommentTok{\# make a table of the n values you want to check}
\NormalTok{power\_table }\OtherTok{\textless{}{-}} \FunctionTok{tibble}\NormalTok{(}
  \AttributeTok{n =} \FunctionTok{seq}\NormalTok{(}\DecValTok{20}\NormalTok{, }\DecValTok{100}\NormalTok{, }\AttributeTok{by =} \DecValTok{5}\NormalTok{)}
\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \CommentTok{\# run the power function for each n}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{power =} \FunctionTok{map\_dbl}\NormalTok{(n, pwr\_func))}

\CommentTok{\# plot the results}
\FunctionTok{ggplot}\NormalTok{(power\_table, }\FunctionTok{aes}\NormalTok{(n, power)) }\SpecialCharTok{+}
  \FunctionTok{geom\_smooth}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{geom\_hline}\NormalTok{(}\AttributeTok{yintercept =} \FloatTok{0.8}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## `geom_smooth()` using method = 'loess' and formula 'y ~ x'
\end{verbatim}

\begin{center}\includegraphics[width=1\linewidth]{10-sim_files/figure-latex/range-sample-sizes-1} \end{center}

Now we can narrow down our search to values around 55 (plus or minus 5) and increase the number of replications from 1e3 to 1e4.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{power\_table }\OtherTok{\textless{}{-}} \FunctionTok{tibble}\NormalTok{(}
  \AttributeTok{n =} \FunctionTok{seq}\NormalTok{(}\DecValTok{50}\NormalTok{, }\DecValTok{60}\NormalTok{)}
\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{power =} \FunctionTok{map\_dbl}\NormalTok{(n, pwr\_func, }\AttributeTok{reps =} \FloatTok{1e4}\NormalTok{))}

\FunctionTok{ggplot}\NormalTok{(power\_table, }\FunctionTok{aes}\NormalTok{(n, power)) }\SpecialCharTok{+}
 \FunctionTok{geom\_smooth}\NormalTok{() }\SpecialCharTok{+}
 \FunctionTok{geom\_point}\NormalTok{() }\SpecialCharTok{+}
 \FunctionTok{geom\_hline}\NormalTok{(}\AttributeTok{yintercept =} \FloatTok{0.8}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## `geom_smooth()` using method = 'loess' and formula 'y ~ x'
\end{verbatim}

\begin{center}\includegraphics[width=1\linewidth]{10-sim_files/figure-latex/narrow-range-sample-sizes-1} \end{center}

\hypertarget{glossary-sim}{%
\section{Glossary}\label{glossary-sim}}

\begin{tabular}{l|l}
\hline
term & definition\\
\hline
alpha & (stats) The cutoff value for making a decision to reject the null hypothesis; (graphics) A value between 0 and 1 used to control the levels of transparency in a plot\\
\hline
beta & The false negative rate we accept for a statistical test.\\
\hline
binomial-distribution & The distribution of data where each observation can have one of two outcomes, like success/failure, yes/no or head/tails.\\
\hline
bivariate-normal & Two normally distributed vectors that have a specified correlation with each other.\\
\hline
confidence-interval & A type of interval estimate used to summarise a given statistic or measurement where a proportion of intervals calculated from the sample(s) will contain the true value of the statistic.\\
\hline
correlation & The relationship two vectors have to each other.\\
\hline
covariance-matrix & Parameters showing how a set of vectors vary and are correlated.\\
\hline
discrete & Data that can only take certain values, such as integers.\\
\hline
effect & Some measure of your data, such as the mean value, or the number of standard deviations the mean differs from a chance value.\\
\hline
effect-size & The difference between the effect in your data and the null effect (usually a chance value)\\
\hline
false-negative & When a test concludes there is no effect when there really is an effect\\
\hline
false-positive & When a test concludes there is an effect when there really is no effect\\
\hline
function & A named section of code that can be reused.\\
\hline
nhst & Null Hypothesis Signficance Testing\\
\hline
normal-distribution & A symmetric distribution of data where values near the centre are most probable.\\
\hline
null-effect & An outcome that does not show an otherwise expected effect.\\
\hline
p-value & The probability of seeing an effect at least as extreme as what you have, if the real effect was the value you are testing against (e.g., a null effect)\\
\hline
parameter & A quantity characterizing a population.\\
\hline
poisson-distribution & A distribution that models independent events happening over a unit of time\\
\hline
power & The probability of rejecting the null hypothesis when it is false.\\
\hline
probability & A number between 0 and 1 where 0 indicates impossibility of the event and 1 indicates certainty\\
\hline
sesoi & Smallest Effect Size of Interest: the smallest effect that is theoretically or practically meaningful\\
\hline
significant & The conclusion when the p-value is less than the critical alpha.\\
\hline
simulation & Generating data from summary parameters\\
\hline
true-positive & When a test concludes there is an effect when there is really is an effect\\
\hline
type-i-error & A false positive; When a test concludes there is an effect when there is really is no effect\\
\hline
type-ii-error & A false negative; When a test concludes there is no effect when there is really is an effect\\
\hline
uniform-distribution & A distribution where all numbers in the range have an equal probability of being sampled\\
\hline
univariate & Relating to a single variable.\\
\hline
\end{tabular}

\hypertarget{resources8}{%
\section{Further Resources}\label{resources8}}

\begin{itemize}
\tightlist
\item
  \href{http://shiny.psy.gla.ac.uk/debruine/simulate/}{Distribution Shiny App} (or run \texttt{reprores::app("simulate")}
\item
  \href{https://debruine.github.io/data-sim-workshops/}{Simulation tutorials} by Lisa DeBruine
\item
  \href{http://r4ds.had.co.nz/iteration.html}{Chapter 21: Iteration} of \emph{R for Data Science}
\item
  \href{https://www.coursera.org/learn/statistical-inferences/}{Improving your statistical inferences} on Coursera (week 1)
\item
  \href{https://debruine.github.io/faux/}{Faux} package for data simulation
\item
  \href{https://psyarxiv.com/baxsf}{Simulation-Based Power-Analysis for Factorial ANOVA Designs} \citep{lakens_caldwell_2019}
\item
  \href{https://psyarxiv.com/xp5cy/}{Understanding mixed effects models through data simulation} \citep{debruine_barr_2019}
\end{itemize}

\hypertarget{acknowledgements}{%
\chapter*{Acknowledgements}\label{acknowledgements}}
\addcontentsline{toc}{chapter}{Acknowledgements}

\href{https://zenodo.org/badge/latestdoi/166541547}{\includegraphics{https://zenodo.org/badge/166541547.svg}}

The whole \href{https://psyteachr.github.io}{psyTeachR} team at the University of Glasgow School of Psychology deserves enormous thanks for making it possible and rewarding to teach methods with a focus on reproducibility and open science. Particularly
\href{https://github.com/clelandwoods}{Heather Cleland Woods},
\href{https://github.com/philmcaleer}{Phil McAleer},
\href{https://github.com/HelenaPaterson}{Helena Paterson},
\href{https://github.com/emilynordmann}{Emily Nordmann},
\href{https://github.com/carolinakt}{Carolina Keuper-Tetzel}, and
\href{https://github.com/eavanmac}{Niamh Stack}.

We greatly appreciate \href{https://github.com/orgs/facelab/people/iholzleitner}{Iris Holzleitner}'s volunteer in-class assistance with the first year of this course. We were ever so lucky to get \href{https://github.com/RebeccaJLai}{Rebecca Lai} as a teaching assistant in the second year; her kind and patient approach to teaching technical skills is an inspiration. \href{https://www.strath.ac.uk/staff/jonesbenedictprofessor/}{Benedict Jones} made invaluable contributions to the ethos of reproducible research at Glasgow. Thanks to \href{https://github.com/Lakens}{Daniël Lakens} for many inspirational discussions and resources.

\hypertarget{contributors}{%
\section*{Contributors}\label{contributors}}
\addcontentsline{toc}{section}{Contributors}

Several people contributed to testing these materials.

\begin{itemize}
\tightlist
\item
  \href{https://github.com/RebeccaJLai}{Rebecca Lai}
\item
  \href{https://github.com/richarddmorey}{Richard Morey}
\item
  \href{https://github.com/CGMossa}{Mossa Merhi Reimert}
\end{itemize}

\hypertarget{appendix-appendices}{%
\appendix}


\hypertarget{installingr}{%
\chapter{Installing and Updating}\label{installingr}}

Installing R and RStudio is usually straightforward. The sections below explain how and \href{https://www.youtube.com/watch?v=lVKMsaWju8w}{there is a helpful YouTube video here}.

From time-to-time, updated version of R, RStudio, and the packages you use (e.g., ggplot2) will become available. Remember that each of these are separate, so they each have a different process and come with different considerations. We recommend updating to the latest version of all three at the start of each academic year.

\hypertarget{installing-base-r}{%
\section{Installing Base R}\label{installing-base-r}}

\href{https://cran.rstudio.com/}{Install base R}. Choose the download link for your operating system (Linux, Mac OS X, or Windows).

If you have a \textbf{Mac}, install the latest release from the newest \texttt{R-x.x.x.pkg} link (or a legacy version if you have an older operating system). After you install R, you should also install \href{http://xquartz.macosforge.org/}{XQuartz} to be able to use some visualisation packages.

If you are installing the \textbf{Windows} version, choose the ``\href{https://cran.rstudio.com/bin/windows/base/}{base}'' subdirectory and click on the download link at the top of the page. After you install R, you should also install \href{https://cran.rstudio.com/bin/windows/Rtools/}{RTools}; use the ``recommended'' version highlighted near the top of the list.

If you are using \textbf{Linux}, choose your specific operating system and follow the installation instructions.

\hypertarget{rstudio-online}{%
\subsection{R Online}\label{rstudio-online}}

You may need to access R and RStudio online if you use a tablet or Chromebook that can't install R.

Students in the School of Psychology and Neuroscience at the University of Glasgow can access \href{https://rstudio.psy.gla.ac.uk}{Glasgow Psychology RStudio} with their GUID and password.

\href{https://rstudio.cloud/}{RStudio Cloud} is a free online service that allows access to R and RStudio.

\hypertarget{updating-r}{%
\subsection{Updating R}\label{updating-r}}

The key thing to be aware of is that when you update R, if you just download the latest version from the website, you will lose all your packages. The easiest way to update R and not cause yourself a huge headache is to use the installr package. When you use the \texttt{updateR()} function, a series of dialogue boxes will appear. These should be fairly self-explanatory but there is a \href{https://www.r-statistics.com/2015/06/a-step-by-step-screenshots-tutorial-for-upgrading-r-on-windows/}{full step-by-step guide} for how to use installr, the important bit is to select ``Yes'' when it asked if you would like to copy your packages from the older version of R.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Install the installr package}
\FunctionTok{install.packages}\NormalTok{(}\StringTok{"installr"}\NormalTok{)}

\CommentTok{\# Load installr}
\FunctionTok{library}\NormalTok{(installr)}

\CommentTok{\# Run the update function}
\FunctionTok{updateR}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\hypertarget{installing-rstudio}{%
\section{Installing RStudio}\label{installing-rstudio}}

Go to \href{https://www.rstudio.com/products/rstudio/download/\#download}{rstudio.com} and download the RStudio Desktop (Open Source License) version for your operating system under the list titled \textbf{Installers for Supported Platforms}.

\hypertarget{updating-rstudio}{%
\subsection{Updating RStudio}\label{updating-rstudio}}

Typically, updates to RStudio won't affect your code, instead they add in new features, like spell-check or upgrades to what RStudio can do. There's usually very little downside to updating RStudio and it's easy to do.

Click \textbf{\texttt{Help\ \textgreater{}\ Check\ for\ updates}}; if an update is available, it will prompt you to download it and you can install it as usual.

\hypertarget{rstudio-settings}{%
\subsection{RStudio Settings}\label{rstudio-settings}}

There are a few settings you should fix immediately after updating RStudio. Go to \textbf{\texttt{Global\ Options...}} under the \textbf{\texttt{Tools}} menu (⌘,), and in the General tab, uncheck the box that says \textbf{\texttt{Restore\ .RData\ into\ workspace\ at\ startup}}. If you keep things around in your workspace, things will get messy, and unexpected things will happen. You should always start with a clear workspace. This also means that you never want to save your workspace when you exit, so set this to \textbf{\texttt{Never}}. The only thing you want to save are your scripts.

You may also want to change the appearance of your code. Different fonts and themes can sometimes help with visual difficulties or \href{https://datacarpentry.org/blog/2017/09/coding-and-dyslexia}{dyslexia}.

\begin{figure}

{\centering \includegraphics[width=1\linewidth]{images/appendices/rstudio_settings_general_appearance} 

}

\caption{RStudio General and Appearance settings}\label{fig:settings-general}
\end{figure}

You may also want to change the settings in the Code tab. For example, some prefer two spaces instead of tabs for indenting and like to be able to see the whitespace characters. But these are all a matter of personal preference.

\begin{figure}

{\centering \includegraphics[width=1\linewidth]{images/appendices/rstudio_settings_code} 

}

\caption{RStudio Code settings}\label{fig:settings-code}
\end{figure}

\hypertarget{installing-latex}{%
\section{Installing LaTeX}\label{installing-latex}}

You can install the LaTeX typesetting system to produce PDF reports from RStudio. Without this additional installation, you will be able to produce reports in HTML but not PDF. This course will not require you to make PDFs. To generate PDF reports, you will additionally need to install tinytex \citep{R-tinytex} and run the following code:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{tinytex}\SpecialCharTok{::}\FunctionTok{install\_tinytex}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\hypertarget{installing-packages}{%
\section{Installing Packages}\label{installing-packages}}

Add-on packages are not distributed with base R, but have to be downloaded and installed from an archive, in the same way that you would, for instance, download and install PokemonGo on your smartphone.

The main repository where packages reside is called CRAN, the Comprehensive R Archive Network. A package has to pass strict tests devised by the R core team to be allowed to be part of the CRAN archive. You can install from the CRAN archive with the {install.packages}{(}{)} function.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{install.packages}\NormalTok{(}\StringTok{"tidyverse"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{dangerous}
Never install a package from inside a script. Only do this from the console pane.

\end{dangerous}

\hypertarget{development-packages}{%
\subsection{Development Packages}\label{development-packages}}

Many R packages are not yet on CRAN because they are still in development. Increasingly, datasets and code for papers are available as packages you can download from github. You'll need to install the devtools package to be able to install packages from github.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# install devtools if you get}
\CommentTok{\# Error in loadNamespace(name) : there is no package called ‘devtools’}
\CommentTok{\# install.packages("devtools")}
\NormalTok{devtools}\SpecialCharTok{::}\FunctionTok{install\_github}\NormalTok{(}\StringTok{"psyteachr/reprores{-}v2"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

If you use a development package in a script, it is good practice to include a comment with the website where you downloaded the package. Other people who use your script are unlikely to have that package or know where to find it.

\hypertarget{updating-packages}{%
\subsection{Updating Packages}\label{updating-packages}}

Package developers will occasionally release updates to their packages. This is typically to add in new functions to the package, or to fix or amend existing functions. \textbf{Be aware that some package updates may cause your previous code to stop working}. This does not tend to happen with minor updates to packages, but occasionally with major updates, you can have serious issues if the developer has made fundamental changes to how the code works. For this reason, we recommend updating all your packages once at the beginning of each academic year (or semester) -- don't do it before an assessment or deadline just in case!

To update an individual package, the easiest way is to use the \texttt{install.packages()} function, as this always installs the most recent version of the package.

To update multiple packages, or indeed all packages, RStudio provides helpful tools. Click \textbf{\texttt{Tools\ \textgreater{}\ Check\ for\ Package\ Updates}}. A dialogue box will appear and you can select the packages you wish to update. Be aware that if you select all packages, this may take some time and you will be unable to use R whilst the process completes.

\hypertarget{troubleshooting-1}{%
\subsection{Troubleshooting}\label{troubleshooting-1}}

Occasionally, you might have a few problem packages that seemingly refuse to update, for me, \texttt{rlang} and \texttt{vctrs} cause me no end of trouble. These aren't packages that you will likely ever explicitly load, but they're required beneath the surface for RStudio to do things like knit your Markdown files.

If you try to update a package and get an error message that says something like \texttt{Warning\ in\ install.packages\ :\ installation\ of\ package\ ‘vctrs’\ had\ non-zero\ exit\ status} or perhaps \texttt{Error\ in\ loadNamespace(i,\ c(lib.loc,\ .libPaths()),\ versionCheck\ =\ vI{[}{[}i{]}{]})\ :\ \ namespace\ \textquotesingle{}rlang\textquotesingle{}\ 0.4.9\ is\ being\ loaded,\ but\ \textgreater{}=\ 0.4.10\ is\ required} one solution I have found is to manually uninstall the package, restart R, and then install the package new, rather than trying to update an existing version. The \texttt{rpkg("installr")} package has a useful function for uninstalling packages.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Load installr}
\FunctionTok{library}\NormalTok{(installr)}

\CommentTok{\# Uninstall the problem package}
\FunctionTok{uninstall.packages}\NormalTok{(}\StringTok{"package\_name"}\NormalTok{)}

\CommentTok{\# Then restart R using session {-} restart R}

\CommentTok{\# Then install the package fresh}
\FunctionTok{install.packages}\NormalTok{(}\StringTok{"package"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{conventions}{%
\chapter{Conventions}\label{conventions}}

This book will use the following conventions:

\begin{itemize}
\tightlist
\item
  Generic code: \texttt{list(number\ =\ 1,\ letter\ =\ "A")}
\item
  Highlighted code: {list}{(}number {=} {1}, letter {=} {``A''}{)}
\item
  File paths: data/sales.csv
\item
  R Packages: tidyverse
\item
  Functions: {paste}{(}{)}
\item
  Strings: {``Lisa''}, {``Dale''}
\item
  Numbers: {100}, {3.14}
\item
  Logical values: {TRUE}, {FALSE}
\item
  Glossary items: ordinal
\item
  Citations: \citet{R-tidyverse}
\item
  Internal links: Chapter~\ref{intro}
\item
  External links: \href{https://mastering-shiny.org/}{Mastering Shiny}
\item
  Menu/interface options: \textbf{\texttt{New\ File...}}
\item
  Quiz question: I am going to learn a lot: TRUEFALSE
\end{itemize}

Hidden Solutions

You found it!

\begin{info}
Informational asides.

\end{info}

\begin{warning}
Notes to warn you about something.

\end{warning}

\begin{dangerous}
Notes about things that could cause serious errors.

\end{dangerous}

\begin{try}
Try it yourself.

\end{try}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# code chunks}
\FunctionTok{paste}\NormalTok{(}\StringTok{"Reproducible "}\NormalTok{, }\StringTok{"Research"}\NormalTok{, }\DecValTok{1}\NormalTok{, }\AttributeTok{sep =} \StringTok{" "}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "Reproducible  Research 1"
\end{verbatim}

\hypertarget{symbols}{%
\chapter{Symbols}\label{symbols}}

\begin{longtable}[]{@{}cll@{}}
\toprule
Symbol & psyTeachR Term & Also Known As \\
\midrule
\endhead
() & (round) brackets & parentheses \\
{[}{]} & square brackets & brackets \\
\{\} & curly brackets & squiggly brackets \\
\textless\textgreater{} & chevrons & angled brackets / guillemets \\
\textless{} & less than & \\
\textgreater{} & greater than & \\
\& & ampersand & ``and'' symbol \\
\# & hash & pound / octothorpe \\
/ & slash & forward slash \\
\textbackslash{} & backslash & \\
- & dash & hyphen / minus \\
\_ & underscore & \\
* & asterisk & star \\
\^{} & caret & power symbol \\
\textasciitilde{} & tilde & twiddle / squiggle \\
= & equal sign & \\
== & double equal sign & \\
. & full stop & period / point \\
! & exclamation mark & bang / not \\
? & question mark & \\
' & single quote & quote / apostrophe \\
" & double quote & quote \\
\%\textgreater\% & pipe & magrittr pipe \\
\textbar{} & vertical bar & pipe \\
, & comma & \\
; & semi-colon & \\
: & colon & \\
@ & ``at'' symbol & \href{https://www.theguardian.com/notesandqueries/query/0,5753,-1773,00.html}{various hilarious regional terms} \\
\bottomrule
\end{longtable}

\hypertarget{datasets}{%
\chapter{Datasets}\label{datasets}}

You can download a \href{data/data.zip}{zip file of the datasets} or access them from the class package with \texttt{getdata()}. The help files for each data table describe the data and each column. Each data table comes with a codebook in \href{https://psych-ds.github.io/}{Psych-DS} format.

\begin{itemize}
\tightlist
\item
  \href{data/country_codes.csv}{Country Codes} Multiple country, subregion, and region codes for 249 countries.
\item
  \href{data/demo.csv}{Importing Demo} A dataset with five different types of columns, and in five different formats (csv, tsv, xlsx, sav, and json), used to practice importing.
\item
  \href{data/demo.xlsx}{Importing Demo} A dataset with five different types of columns, and in five different formats (csv, tsv, xlsx, sav, and json), used to practice importing.
\item
  \href{data/disgust_cors.csv}{Three Domain Disgust Questionnaire (correlations)} Correlations among questions on the Three Domain Disgust Questionnaire (Tybur et al.)
\item
  \href{data/disgust_scores.csv}{Three Domain Disgust Questionnaire (scores)} A dataset containing subscale scores for to the Three Domain Disgust Questionnaire (Tybur et al.), calculated from {[}disgust{]}.
\item
  \href{data/disgust.csv}{Three Domain Disgust Questionnaire (items)} A dataset containing responses to the 21 items in the Three Domain Disgust Questionnaire (Tybur et al.)
\item
  \href{data/EMBU_mother.csv}{Parental Attachment (Mothers)} Items starting with r, p and e are for the rejection (r), overprotection (p), and emotional warmth (e) subscales.
\item
  \href{data/eq_data.csv}{Empathizing Quotient} Reverse coded (Q\#R) questions coded and strongly disagree = 2, slightly disagree = 1, else = 0. The other questions are coded as strongly agree = 2, slightly agree = 1, else = 0.
\item
  \href{data/experimentum_exps.csv}{Experimentum Project Experiment} Data from a demo experiment on Experimentum \url{https://debruine.github.io/experimentum/}. Subjects are shown pairs of upright and inverted Mooney faces and asked to click on the upright face.
\item
  \href{data/experimentum_quests.csv}{Experimentum Project Questionnaires} Data from a demo questionnaire on Experimentum \url{https://debruine.github.io/experimentum/}. Subjects are asked questions about dogs to test the different questionnaire response types. Questions

  \begin{itemize}
  \tightlist
  \item
    current: Do you own a dog? (yes/no)
  \item
    past: Have you ever owned a dog? (yes/no)
  \item
    name: What is the best name for a dog? (free short text)
  \item
    good: How good are dogs? (1=pretty good:7=very good)
  \item
    country: What country do borzois come from?
  \item
    good\_borzoi: How good are borzois? (0=pretty good:100=very good)
  \item
    text: Write some text about dogs. (free long text)
  \item
    time: What time is it? (time)
  \end{itemize}
\item
  \href{data/eye_descriptions.csv}{Descriptions of Eyes} Participant's written descriptions of the eyes of 50 people
\item
  \href{data/family_composition.csv}{Family Composition} Responses to a brief questionnaire about family composition.
\item
  \href{data/infmort.csv}{Infant Mortality} Infant mortality by country and year from the World Health Organisation.
\item
  \href{data/matmort.xls}{Maternal Mortality} Maternal mortality by country and year from the World Health Organisation.
\item
  \href{data/mess.csv}{Messy Data} A dataset with missing values, blank rows, incorrect data types, multiple values in one column, and multiple date types for practicing data import.
\item
  \href{data/personality_scores.csv}{5-Factor Personality Scores} Archival data from the Face Research Lab of a 5-factor personality questionnaire, with factor score calculated from {[}personality{]}.
\item
  \href{data/personality.csv}{5-Factor Personality Items} Archival data from the Face Research Lab of a 5-factor personality questionnaire. Each question is labelled with the domain (Op = openness, Co = conscientiousness, Ex = extroversion, Ag = agreeableness, and Ne = neuroticism) and the question number. Participants rate each statement on a Likert scale from 0 (Never) to 6 (Always). Questions with REV have already been reverse-coded (0 = Always, 6 = Never).
\item
  \href{data/pets.csv}{Pets} A simulated dataset with one random factor (id), two categorical factors (pet, country) and three continuous variables (score, age, weight). This dataset is useful for practicing plotting.
\item
  \href{data/psa001_agg.csv}{First Impressions of Faces (Aggregated)} Aggregated data from Psychological Science Accelerator project: To Which World Regions Does the Valence-Dominance Model of Social Perception Apply? \url{https://psyarxiv.com/n26dy}. Mean ratings on 13 traits for each of 120 faces shown in 10 world regions. Face characteristics at {[}psa001\_cfd\_faces{]}.
\item
  \href{data/psa001_cfd_faces.csv}{Face Characteristics} Face stimulus characteristics from Psychological Science Accelerator project: To Which World Regions Does the Valence-Dominance Model of Social Perception Apply? \url{https://psyarxiv.com/n26dy}. To be used with {[}psa001\_agg{]}.
\item
  \href{data/sensation_seeking.csv}{Sensation Seeking Scale} Zuckerman M. (1984). Sensation seeking: a comparative approach to a human trait. Behavioral and Brain Sciences. 7: 413-471.
\item
  \href{data/smalldata.csv}{Small Factorial Design: 2w*2b} Small simulated dataset (n = 5) with one within-subject factor (time) having 2 levels (pre and post) and one beteen-subject factor (group) having two levels (control and experimental). The dataset is in wide format and created with faux.
\item
  \href{data/sq_data.csv}{Systemizing Quotient} Reverse coded (Q\#R) questions coded as strongly disagree = 2, slightly disagree = 1, else = 0. The other questions are coded as strongly agree = 2, slightly agree = 1, else = 0.
\item
  \href{data/stroop.csv}{Stroop Task} 50 simulated subject in a stroop task viewing all combinations of word and ink colours blue, purple, green, red, and brown, 5 times each. Subjects respond with the ink colour. Subjects who do not respond in time have NA for response and rt.
\item
  \href{data/stroop.xlsx}{Stroop Task} 50 simulated subject in a stroop task viewing all combinations of word and ink colours blue, purple, green, red, and brown, 5 times each. Subjects respond with the ink colour. Subjects who do not respond in time have NA for response and rt.
\item
  \href{data/users.csv}{User Demographics} A dataset with unique participant ID, sex and birth year. To be used in conjunction with data from {[}disgust{]}, {[}disgust\_scores{]}, {[}personality{]}, {[}personality\_scores{]}, and {[}users2{]}.
\item
  \href{data/users2.csv}{User Demographics 2} A dataset with unique participant ID, birth year, and sex. To be used in conjunction with data from {[}disgust{]}, {[}disgust\_scores{]}, {[}personality{]}, {[}personality\_scores{]}, and {[}users{]}.
\end{itemize}

\hypertarget{plotstyle}{%
\chapter{Styling Plots}\label{plotstyle}}

\hypertarget{aesthetics}{%
\section{Aesthetics}\label{aesthetics}}

\hypertarget{colourfill}{%
\subsection{Colour/Fill}\label{colourfill}}

The \texttt{colour} argument changes the point and line colour, while the \texttt{fill} argument changes the interior colour of shapes. Type \texttt{colours()} into the console to see a list of all the named colours in R. Alternatively, you can use hexadecimal colours like \texttt{"\#FF8000"} or the \texttt{rgb()} function to set red, green, and blue values on a scale from 0 to 1.

Hover over a colour to see its R name.

{black}

{gray1}

{gray2}

{gray3}

{gray4}

{gray5}

{gray6}

{gray7}

{gray8}

{gray9}

{gray10}

{gray11}

{gray12}

{gray13}

{gray14}

{gray15}

{gray16}

{gray17}

{gray18}

{gray19}

{gray20}

{gray21}

{gray22}

{gray23}

{gray24}

{gray25}

{gray26}

{gray27}

{gray28}

{gray29}

{gray30}

{gray31}

{gray32}

{gray33}

{gray34}

{gray35}

{gray36}

{gray37}

{gray38}

{gray39}

{gray40}

{dimgray}

{gray42}

{gray43}

{gray44}

{gray45}

{gray46}

{gray47}

{gray48}

{gray49}

{gray50}

{gray51}

{gray52}

{gray53}

{gray54}

{gray55}

{gray56}

{gray57}

{gray58}

{gray59}

{gray60}

{gray61}

{gray62}

{gray63}

{gray64}

{gray65}

{darkgray}

{gray66}

{gray67}

{gray68}

{gray69}

{gray70}

{gray71}

{gray72}

{gray73}

{gray74}

{gray}

{gray75}

{gray76}

{gray77}

{gray78}

{gray79}

{gray80}

{gray81}

{gray82}

{gray83}

{lightgray}

{gray84}

{gray85}

{gainsboro}

{gray86}

{gray87}

{gray88}

{gray89}

{gray90}

{gray91}

{gray92}

{gray93}

{gray94}

{gray95}

{gray96}

{gray97}

{gray98}

{gray99}

{white}

{snow4}

{snow3}

{snow2}

{snow}

{rosybrown4}

{rosybrown}

{rosybrown3}

{rosybrown2}

{rosybrown1}

{lightcoral}

{indianred}

{indianred4}

{indianred2}

{indianred1}

{indianred3}

{brown4}

{brown}

{brown3}

{brown2}

{brown1}

{firebrick4}

{firebrick}

{firebrick3}

{firebrick1}

{firebrick2}

{darkred}

{red3}

{red2}

{red}

{mistyrose3}

{mistyrose4}

{mistyrose2}

{mistyrose}

{salmon}

{tomato3}

{coral4}

{coral3}

{coral2}

{coral1}

{tomato2}

{tomato}

{tomato4}

{darksalmon}

{salmon4}

{salmon3}

{salmon2}

{salmon1}

{coral}

{orangered4}

{orangered3}

{orangered2}

{lightsalmon3}

{lightsalmon2}

{lightsalmon}

{lightsalmon4}

{sienna}

{sienna3}

{sienna2}

{sienna1}

{sienna4}

{orangered}

{seashell4}

{seashell3}

{seashell2}

{seashell}

{chocolate4}

{chocolate3}

{chocolate}

{chocolate2}

{chocolate1}

{linen}

{peachpuff4}

{peachpuff3}

{peachpuff2}

{peachpuff}

{sandybrown}

{tan4}

{peru}

{tan2}

{tan1}

{darkorange4}

{darkorange3}

{darkorange2}

{darkorange1}

{antiquewhite3}

{antiquewhite2}

{antiquewhite1}

{bisque4}

{bisque3}

{bisque2}

{bisque}

{burlywood4}

{burlywood3}

{burlywood}

{burlywood2}

{burlywood1}

{darkorange}

{antiquewhite4}

{antiquewhite}

{papayawhip}

{blanchedalmond}

{navajowhite4}

{navajowhite3}

{navajowhite2}

{navajowhite}

{tan}

{floralwhite}

{oldlace}

{wheat4}

{wheat3}

{wheat2}

{wheat}

{wheat1}

{moccasin}

{orange4}

{orange3}

{orange2}

{orange}

{goldenrod}

{goldenrod1}

{goldenrod4}

{goldenrod3}

{goldenrod2}

{darkgoldenrod4}

{darkgoldenrod}

{darkgoldenrod3}

{darkgoldenrod2}

{darkgoldenrod1}

{cornsilk}

{cornsilk4}

{cornsilk3}

{cornsilk2}

{lightgoldenrod4}

{lightgoldenrod3}

{lightgoldenrod}

{lightgoldenrod2}

{lightgoldenrod1}

{gold4}

{gold3}

{gold2}

{gold}

{lemonchiffon4}

{lemonchiffon3}

{lemonchiffon2}

{lemonchiffon}

{palegoldenrod}

{khaki}

{darkkhaki}

{khaki4}

{khaki3}

{khaki2}

{khaki1}

{ivory4}

{ivory3}

{ivory2}

{ivory}

{beige}

{lightyellow4}

{lightyellow3}

{lightyellow2}

{lightyellow}

{lightgoldenrodyellow}

{yellow4}

{yellow3}

{yellow2}

{yellow}

{olivedrab}

{olivedrab4}

{olivedrab3}

{olivedrab2}

{olivedrab1}

{darkolivegreen}

{darkolivegreen4}

{darkolivegreen3}

{darkolivegreen2}

{darkolivegreen1}

{greenyellow}

{chartreuse4}

{chartreuse3}

{chartreuse2}

{lawngreen}

{chartreuse}

{honeydew4}

{honeydew3}

{honeydew2}

{honeydew}

{darkseagreen4}

{darkseagreen}

{darkseagreen3}

{darkseagreen2}

{darkseagreen1}

{lightgreen}

{palegreen}

{palegreen4}

{palegreen3}

{palegreen1}

{forestgreen}

{limegreen}

{darkgreen}

{green4}

{green3}

{green2}

{green}

{mediumseagreen}

{seagreen}

{seagreen3}

{seagreen2}

{seagreen1}

{mintcream}

{springgreen4}

{springgreen3}

{springgreen2}

{springgreen}

{aquamarine3}

{aquamarine2}

{aquamarine}

{mediumspringgreen}

{aquamarine4}

{turquoise}

{mediumturquoise}

{lightseagreen}

{azure4}

{azure3}

{azure2}

{azure}

{lightcyan4}

{lightcyan3}

{lightcyan2}

{lightcyan}

{paleturquoise}

{paleturquoise4}

{paleturquoise3}

{paleturquoise2}

{paleturquoise1}

{darkslategray}

{darkslategray4}

{darkslategray3}

{darkslategray2}

{darkslategray1}

{cyan4}

{cyan3}

{darkturquoise}

{cyan2}

{cyan}

{cadetblue4}

{cadetblue}

{turquoise4}

{turquoise3}

{turquoise2}

{turquoise1}

{powderblue}

{cadetblue3}

{cadetblue2}

{cadetblue1}

{lightblue4}

{lightblue3}

{lightblue}

{lightblue2}

{lightblue1}

{deepskyblue4}

{deepskyblue3}

{deepskyblue2}

{deepskyblue}

{skyblue}

{lightskyblue4}

{lightskyblue3}

{lightskyblue2}

{lightskyblue1}

{lightskyblue}

{skyblue4}

{skyblue3}

{skyblue2}

{skyblue1}

{aliceblue}

{slategray}

{lightslategray}

{slategray3}

{slategray2}

{slategray1}

{steelblue4}

{steelblue}

{steelblue3}

{steelblue2}

{steelblue1}

{dodgerblue4}

{dodgerblue3}

{dodgerblue2}

{dodgerblue}

{lightsteelblue4}

{lightsteelblue3}

{lightsteelblue}

{lightsteelblue2}

{lightsteelblue1}

{slategray4}

{cornflowerblue}

{royalblue}

{royalblue4}

{royalblue3}

{royalblue2}

{royalblue1}

{ghostwhite}

{lavender}

{midnightblue}

{navy}

{blue4}

{blue3}

{blue2}

{blue}

{darkslateblue}

{slateblue}

{mediumslateblue}

{lightslateblue}

{slateblue1}

{slateblue4}

{slateblue3}

{slateblue2}

{mediumpurple4}

{mediumpurple3}

{mediumpurple}

{mediumpurple2}

{mediumpurple1}

{purple4}

{purple3}

{blueviolet}

{purple1}

{purple2}

{purple}

{darkorchid}

{darkorchid4}

{darkorchid3}

{darkorchid2}

{darkorchid1}

{darkviolet}

{mediumorchid4}

{mediumorchid3}

{mediumorchid}

{mediumorchid2}

{mediumorchid1}

{thistle4}

{thistle3}

{thistle}

{thistle2}

{thistle1}

{plum4}

{plum3}

{plum2}

{plum1}

{plum}

{violet}

{darkmagenta}

{magenta3}

{magenta2}

{magenta}

{orchid4}

{orchid3}

{orchid}

{orchid2}

{orchid1}

{maroon4}

{violetred}

{maroon3}

{maroon2}

{maroon1}

{mediumvioletred}

{deeppink3}

{deeppink2}

{deeppink}

{deeppink4}

{hotpink2}

{hotpink1}

{hotpink4}

{hotpink}

{violetred4}

{violetred3}

{violetred2}

{violetred1}

{hotpink3}

{lavenderblush4}

{lavenderblush3}

{lavenderblush2}

{lavenderblush}

{maroon}

{palevioletred4}

{palevioletred3}

{palevioletred}

{palevioletred2}

{palevioletred1}

{pink4}

{pink3}

{pink2}

{pink1}

{pink}

{lightpink}

{lightpink4}

{lightpink3}

{lightpink2}

{lightpink1}

\hypertarget{alpha-1}{%
\subsection{Alpha}\label{alpha-1}}

The \texttt{alpha} argument changes transparency (0 = totally transparent, 1 = totally opaque).

\begin{figure}

{\centering \includegraphics[width=1\linewidth]{appendix-e-plotstyles_files/figure-latex/alpha-demo-1} 

}

\caption{Varying alpha values.}\label{fig:alpha-demo}
\end{figure}

\hypertarget{shape}{%
\subsection{Shape}\label{shape}}

The \texttt{shape} argument changes the shape of points.

\begin{figure}

{\centering \includegraphics[width=1\linewidth]{appendix-e-plotstyles_files/figure-latex/shape-demo-1} 

}

\caption{The 25 shape values}\label{fig:shape-demo}
\end{figure}

\hypertarget{linetype}{%
\subsection{Linetype}\label{linetype}}

You can probably guess what the \texttt{linetype} argument does.

\begin{figure}

{\centering \includegraphics[width=1\linewidth]{appendix-e-plotstyles_files/figure-latex/linetype-demo-1} 

}

\caption{The 6 linetype values at different sizes.}\label{fig:linetype-demo}
\end{figure}

\hypertarget{palettes}{%
\section{Palettes}\label{palettes}}

Discrete palettes change depending on the number of categories.

\begin{figure}

{\centering \includegraphics[width=1\linewidth]{appendix-e-plotstyles_files/figure-latex/unnamed-chunk-3-1} 

}

\caption{Default discrete palette with different numbers of levels.}\label{fig:unnamed-chunk-3}
\end{figure}

\hypertarget{viridis-palettes}{%
\subsection{Viridis Palettes}\label{viridis-palettes}}

Viridis palettes are very good for colourblind-safe and greyscale-safe plots. The work with any number of categories, but are best for larger numbers of categories or continuous colours.

\hypertarget{discrete-viridis-palettes}{%
\subsubsection{Discrete Viridis Palettes}\label{discrete-viridis-palettes}}

Set discrete viridis colours with \texttt{scale\_colour\_viridis\_d()} or \texttt{scale\_fill\_viridis\_d()} and set the \texttt{option} argument to one of the options below. Set \texttt{direction\ =\ -1} to reverse the order of colours.

\begin{figure}

{\centering \includegraphics[width=1\linewidth]{appendix-e-plotstyles_files/figure-latex/unnamed-chunk-4-1} 

}

\caption{Discrete viridis palettes.}\label{fig:unnamed-chunk-4}
\end{figure}

\begin{info}
If the end colour is too light for your plot or the start colour too dark, you can set the \texttt{begin} and \texttt{end} arguments to values between 0 and 1, such as {scale\_colour\_viridis\_c}{(}begin {=} {0.1}, end {=} {0.9}{)}.

\end{info}

\hypertarget{continuous-viridis-palettes}{%
\subsubsection{Continuous Viridis Palettes}\label{continuous-viridis-palettes}}

Set continuous viridis colours with \texttt{scale\_colour\_viridis\_c()} or \texttt{scale\_fill\_viridis\_c()} and set the \texttt{option} argument to one of the options below. Set \texttt{direction\ =\ -1} to reverse the order of colours.

\begin{figure}

{\centering \includegraphics[width=1\linewidth]{appendix-e-plotstyles_files/figure-latex/unnamed-chunk-5-1} 

}

\caption{Continuous viridis palettes.}\label{fig:unnamed-chunk-5}
\end{figure}

\hypertarget{brewer-palettes}{%
\subsection{Brewer Palettes}\label{brewer-palettes}}

Brewer palettes give you a lot of control over plot colour and fill. You set them with \texttt{scale\_color\_brewer()} or \texttt{scale\_fill\_brewer()} and set the \texttt{palette} argument to one of the palettes below. Set \texttt{direction\ =\ -1} to reverse the order of colours.

\hypertarget{qualitative-brewer-palettes}{%
\subsubsection{Qualitative Brewer Palettes}\label{qualitative-brewer-palettes}}

These palettes are good for categorical data with up to 8 categories (some palettes can handle up to 12). The ``Paired'' palette is useful if your categories are arranged in pairs.

\begin{figure}

{\centering \includegraphics[width=1\linewidth]{appendix-e-plotstyles_files/figure-latex/unnamed-chunk-6-1} 

}

\caption{Qualitative brewer palettes.}\label{fig:unnamed-chunk-6}
\end{figure}

\hypertarget{sequential-brewer-palettes}{%
\subsubsection{Sequential Brewer Palettes}\label{sequential-brewer-palettes}}

These palettes are good for up to 9 ordinal categories with a lot of categories.

\begin{figure}

{\centering \includegraphics[width=1\linewidth]{appendix-e-plotstyles_files/figure-latex/unnamed-chunk-7-1} 

}

\caption{Sequential brewer palettes.}\label{fig:unnamed-chunk-7}
\end{figure}

\hypertarget{diverging-brewer-palettes}{%
\subsubsection{Diverging Brewer Palettes}\label{diverging-brewer-palettes}}

These palettes are good for ordinal categories with up to 11 levels where the centre level is a neutral or baseline category and the levels above and below it differ in an important way, such as agree versus disagree options.

\begin{figure}

{\centering \includegraphics[width=1\linewidth]{appendix-e-plotstyles_files/figure-latex/unnamed-chunk-8-1} 

}

\caption{Diverging brewer palettes.}\label{fig:unnamed-chunk-8}
\end{figure}

\hypertarget{themes-1}{%
\section{Themes}\label{themes-1}}

ggplot2 has 8 built-in themes that you can add to a plot like \texttt{plot\ +\ theme\_bw()} or set as the default theme at the top of your script like \texttt{theme\_set(theme\_bw())}.

\begin{figure}

{\centering \includegraphics[width=1\linewidth]{appendix-e-plotstyles_files/figure-latex/unnamed-chunk-9-1} 

}

\caption{{ggplot2} themes.}\label{fig:unnamed-chunk-9}
\end{figure}

\hypertarget{ggthemes}{%
\subsection{ggthemes}\label{ggthemes}}

You can get more themes from add-on packages, like ggthemes. Most of the themes also have custom \texttt{scale\_} functions like \texttt{scale\_colour\_economist()}. Their website has extensive examples and instructions for alternate or dark version sof these themes.

\begin{figure}

{\centering \includegraphics[width=1\linewidth]{appendix-e-plotstyles_files/figure-latex/unnamed-chunk-10-1} 

}

\caption{{ggthemes} themes.}\label{fig:unnamed-chunk-10}
\end{figure}

\hypertarget{exercises}{%
\chapter{Exercises}\label{exercises}}

You can access exercises and answers for all of the chapters through the reprores package.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# run this to access the exercise}
\NormalTok{reprores}\SpecialCharTok{::}\FunctionTok{exercise}\NormalTok{(}\DecValTok{1}\NormalTok{)}

\CommentTok{\# run this to access the answers}
\NormalTok{reprores}\SpecialCharTok{::}\FunctionTok{exercise}\NormalTok{(}\DecValTok{1}\NormalTok{, }\AttributeTok{answers =} \ConstantTok{TRUE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Alternatively, download all \href{exercises/exercises.zip}{exercises and data files} below as a ZIP archive. The answers are not included in the zip file.

\begin{itemize}
\tightlist
\item
  Chapter 1: Intro to R, functions, R markdown
\item
  Exercise: \href{exercises/01_intro_exercise.Rmd}{Rmd}\textbar{}\href{exercises/01_intro_exercise.html}{html}; Answers: \href{exercises/01_intro_answers.Rmd}{Rmd}\textbar{}\href{exercises/01_intro_answers.html}{html}
\item
  Chapter 2: Create an R Markdown project
\item
  Exercise: \href{exercises/02_repro_exercise.Rmd}{Rmd}\textbar{}\href{exercises/02_repro_exercise.html}{html}; Answers: \href{exercises/02_repro_answers.Rmd}{Rmd}\textbar{}\href{exercises/02_repro_answers.html}{html}
\item
  Chapter 3: Data visualisation
\item
  Exercise: \href{exercises/03_ggplot_exercise.Rmd}{Rmd}\textbar{}\href{exercises/03_ggplot_exercise.html}{html}; Answers: \href{exercises/03_ggplot_answers.Rmd}{Rmd}\textbar{}\href{exercises/03_ggplot_answers.html}{html}
\item
  Chapter 4: Data
\item
  Exercise: \href{exercises/04_data_exercise.Rmd}{Rmd}\textbar{}\href{exercises/04_data_exercise.html}{html}; Answers: \href{exercises/04_data_answers.Rmd}{Rmd}\textbar{}\href{exercises/04_data_answers.html}{html}
\item
  Chapter 5: Data relations
\item
  Exercise: \href{exercises/05_joins_exercise.Rmd}{Rmd}\textbar{}\href{exercises/05_joins_exercise.html}{html}; Answers: \href{exercises/05_joins_answers.Rmd}{Rmd}\textbar{}\href{exercises/05_joins_answers.html}{html}
\item
  Chapter 6: Tidy Data
\item
  Exercise: \href{exercises/06_tidyr_exercise.Rmd}{Rmd}\textbar{}\href{exercises/06_tidyr_exercise.html}{html}; Answers: \href{exercises/06_tidyr_answers.Rmd}{Rmd}\textbar{}\href{exercises/06_tidyr_answers.html}{html}
\item
  Chapter 7: Data wrangling
\item
  Exercise: \href{exercises/07_dplyr_exercise.Rmd}{Rmd}\textbar{}\href{exercises/07_dplyr_exercise.html}{html}; Answers: \href{exercises/07_dplyr_answers.Rmd}{Rmd}\textbar{}\href{exercises/07_dplyr_answers.html}{html}
\item
  Chapter 8: GLM
\item
  Exercise: \href{exercises/08_glm_exercise.Rmd}{Rmd}\textbar{}\href{exercises/08_glm_exercise.html}{html}; Answers: \href{exercises/08_glm_answers.Rmd}{Rmd}\textbar{}\href{exercises/08_glm_answers.html}{html}
\item
  Chapter 9: Functions and iteration
\item
  Exercise: \href{exercises/09_func_exercise.Rmd}{Rmd}\textbar{}\href{exercises/09_func_exercise.html}{html}; Answers: \href{exercises/09_func_answers.Rmd}{Rmd}\textbar{}\href{exercises/09_func_answers.html}{html}
\item
  Chapter 10: Simulation
\item
  Exercise: \href{exercises/10_sim_exercise.Rmd}{Rmd}\textbar{}\href{exercises/10_sim_exercise.html}{html}; Answers: \href{exercises/10_sim_answers.Rmd}{Rmd}\textbar{}\href{exercises/10_sim_answers.html}{html}
\end{itemize}

\hypertarget{bookrefs}{%
\chapter{References}\label{bookrefs}}

  \bibliography{book.bib,packages.bib}

\end{document}
